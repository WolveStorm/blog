<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='GinÁöÑÁ¨îËÆ∞'>
<title>Â≠¶‰π†Gin</title>

<link rel='canonical' href='http://example.org/posts/gin/'>

<link rel="stylesheet" href="/scss/style.min.5be32ca3f6e1a997c75795c4359147cc6d4fbd34948c0acd51e31d237033978a.css"><meta property='og:title' content='Â≠¶‰π†Gin'>
<meta property='og:description' content='GinÁöÑÁ¨îËÆ∞'>
<meta property='og:url' content='http://example.org/posts/gin/'>
<meta property='og:site_name' content='ËèúGOÁöÑÂçöÂÆ¢'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='Golang' /><meta property='article:tag' content='GRPC' /><meta property='article:published_time' content='2023-01-05T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-01-05T00:00:00&#43;00:00'/><meta property='og:image' content='http://example.org/posts/gin/d8ccbe52c5255121e5a554ce275ee72d.png' />
<meta name="twitter:title" content="Â≠¶‰π†Gin">
<meta name="twitter:description" content="GinÁöÑÁ¨îËÆ∞"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://example.org/posts/gin/d8ccbe52c5255121e5a554ce275ee72d.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu8b46cb020651f4f5a46bc8297d5d9089_86497_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ËèúGOÁöÑÂçöÂÆ¢</a></h1>
            <h2 class="site-description">A Blog Of Vegetable Gopher</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://weibo.com/u/6116124329'
                        target="_blank"
                        title="Weibo"
                        rel="me"
                    >
                        
                        
                            <svg viewBox="0 0 32 32" style="width:1em;height:1em;vertical-align:middle" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" overflow="hidden"><path fill="currentColor" d="M22.4 8.891c.754 1.074 3.52.046 3.909 2.4.251 1.554 0 2.309.983 2.217.894-.069 2.446-3.017-.32-5.12-3.017-2.263-5.166-.389-4.571.503zm-.731-4.937c.32 1.143 2.741.777 4.638 1.166.937.183 2.651 1.326 3.451 4.114.802 2.789-1.003 5.349.937 5.577 1.6.206 1.465-5.029.937-6.743-.549-1.737-2.24-4.503-5.646-5.44-3.403-.937-4.661.137-4.318 1.326zM7.291 22.037c.389 2.398 3.109 3.952 6.034 3.474 2.857-.457 4.8-2.697 4.434-5.003-.389-2.313-2.949-3.867-5.806-3.502-2.926.366-5.051 2.629-4.663 5.031zm1.532.294c-.16-.914.526-1.826 1.577-2.034 1.029-.206 2.011.366 2.194 1.278.16.937-.526 1.831-1.577 2.037-1.029.229-2.011-.366-2.194-1.28zm6.88-10.445c-.48-.503 1.371-2.994-.343-4.411-1.943-1.623-6.469.48-10.354 3.977C1.097 14.949-.548 18.949.16 22.469c.686 3.543 7.177 7.909 16.251 7.131 9.074-.779 12.526-7.819 12.094-10.583-.437-2.743-3.088-2.951-3.771-3.086-.711-.137-2.08-.046-1.054-1.371 1.054-1.349.549-3.063-.8-3.634-1.326-.549-3.634-.069-4.709.434-1.44.686-2.469.526-2.469.526zm-12.069 9.6c-.389-3.451 3.566-7.017 8.914-7.726 5.349-.686 10.469 1.783 10.834 5.237.389 3.449-4.046 7.381-9.394 8.066-5.326.688-9.966-2.126-10.354-5.577z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://user.qzone.qq.com/892552140/infocenter'
                        target="_blank"
                        title="qq"
                        rel="me"
                    >
                        
                        
                            <svg viewBox="0 0 32 32" style="width:1em;height:1em;vertical-align:middle" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" overflow="hidden"><path fill="currentColor" d="M16 0l-4.937 10.537L0 12.228l8 8.183L6.103 32 16 26.535 25.897 32l-1.6-9.714c-4.343.594-9.44 1.003-14.88.297l8.869-6.857s-5.143-.869-11.154-1.737c0 0 8.594-1.851 17.872-.274l-9.438 6.718s3.566 1.006 8.571.848L24 20.412l8-8.183-11.063-1.691L16 .001z"/></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>ÈìæÊé•</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="http://example.org/en/" >English</option>
                        
                            <option value="http://example.org/" selected>‰∏≠Êñá</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>ÊöóËâ≤Ê®°Âºè</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ginÊ°ÜÊû∂Ë∑ØÁî±ËØ¶Ëß£">ginÊ°ÜÊû∂Ë∑ØÁî±ËØ¶Ëß£</a>
      <ol>
        <li><a href="#radix-tree">Radix Tree</a></li>
        <li><a href="#Ë∑ØÁî±Ê†ëËäÇÁÇπ">Ë∑ØÁî±Ê†ëËäÇÁÇπ</a></li>
        <li><a href="#ËØ∑Ê±ÇÊñπÊ≥ïÊ†ë">ËØ∑Ê±ÇÊñπÊ≥ïÊ†ë</a></li>
        <li><a href="#Ê≥®ÂÜåË∑ØÁî±">Ê≥®ÂÜåË∑ØÁî±</a>
          <ol>
            <li><a href="#addroute">addRoute</a></li>
            <li><a href="#insertchild">insertChild</a></li>
          </ol>
        </li>
        <li><a href="#Ë∑ØÁî±ÂåπÈÖç">Ë∑ØÁî±ÂåπÈÖç</a></li>
      </ol>
    </li>
    <li><a href="#ginÊ°ÜÊû∂‰∏≠Èó¥‰ª∂ËØ¶Ëß£">ginÊ°ÜÊû∂‰∏≠Èó¥‰ª∂ËØ¶Ëß£</a>
      <ol>
        <li><a href="#‰∏≠Èó¥‰ª∂ÁöÑÊ≥®ÂÜå">‰∏≠Èó¥‰ª∂ÁöÑÊ≥®ÂÜå</a></li>
        <li><a href="#‰∏≠Èó¥‰ª∂ÁöÑÊâßË°å">‰∏≠Èó¥‰ª∂ÁöÑÊâßË°å</a></li>
        <li><a href="#csetcget">c.Set()/c.Get()</a></li>
      </ol>
    </li>
    <li><a href="#ÊÄªÁªì">ÊÄªÁªì</a></li>
    <li><a href="#ginËøûÊé•mysql">GinËøûÊé•mysql</a>
      <ol>
        <li><a href="#ÊµÖÊµÖÁöÑÁ†îÁ©∂‰∏Ä‰∏ãÊ∫êÁ†Å">ÊµÖÊµÖÁöÑÁ†îÁ©∂‰∏Ä‰∏ãÊ∫êÁ†Å</a></li>
        <li><a href="#Â¢ûÂà†ÊîπÊü•">Â¢ûÂà†ÊîπÊü•</a>
          <ol>
            <li><a href="#queryrowÊü•ËØ¢‰∏ÄÂàó">queryRowÔºàÊü•ËØ¢‰∏ÄÂàóÔºâ</a></li>
            <li><a href="#queryÊü•ËØ¢Â§öË°å">queryÔºàÊü•ËØ¢Â§öË°åÔºâ</a></li>
            <li><a href="#execÊèíÂÖ•ÂíåÊõ¥Êñ∞ÂíåÂà†Èô§">execÔºàÊèíÂÖ•ÂíåÊõ¥Êñ∞ÂíåÂà†Èô§Ôºâ</a></li>
          </ol>
        </li>
        <li><a href="#mysqlÈ¢ÑÂ§ÑÁêÜ‰∏ésqlÊ≥®ÂÖ•">MysqlÈ¢ÑÂ§ÑÁêÜ‰∏éSqlÊ≥®ÂÖ•</a>
          <ol>
            <li><a href="#sqlÊ≥®ÂÖ•">sqlÊ≥®ÂÖ•</a></li>
          </ol>
        </li>
        <li><a href="#mysqlÁöÑ‰∫ãÂä°">MysqlÁöÑ‰∫ãÂä°</a></li>
        <li><a href="#sqlx-Âº∫Â§ßÁöÑÂ∑•ÂÖ∑">sqlX Âº∫Â§ßÁöÑÂ∑•ÂÖ∑</a>
          <ol>
            <li><a href="#ËøûÊé•">ËøûÊé•</a></li>
            <li><a href="#sqlxÁöÑÂü∫Êú¨‰ΩøÁî®">SQLXÁöÑÂü∫Êú¨‰ΩøÁî®</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#go-redis">go-redis</a>
      <ol>
        <li><a href="#ËøûÊé•redis">ËøûÊé•redis</a></li>
        <li><a href="#ËøûÊé•Âì®ÂÖµÊ®°Âºè">ËøûÊé•Âì®ÂÖµÊ®°Âºè</a></li>
        <li><a href="#Âü∫Êú¨‰ΩøÁî®">Âü∫Êú¨‰ΩøÁî®</a></li>
        <li><a href="#pipeline">pipeline</a>
          <ol>
            <li><a href="#‰∫ãÂä°">‰∫ãÂä°</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#zapÊó•ÂøóÂ∫ì">ZapÊó•ÂøóÂ∫ì</a>
      <ol>
        <li><a href="#gologger">Gologger</a></li>
        <li><a href="#go-loggerÁöÑ‰ºòÂä£">Go loggerÁöÑ‰ºòÂä£Ôºü</a></li>
        <li><a href="#zapÁöÑ‰ºòÁÇπ">ZapÁöÑ‰ºòÁÇπ</a></li>
        <li><a href="#‰ΩøÁî®">‰ΩøÁî®</a>
          <ol>
            <li><a href="#logger">Logger</a></li>
            <li><a href="#Ëá™ÂÆö‰πâÈÖçÁΩÆÈ°π">Ëá™ÂÆö‰πâÈÖçÁΩÆÈ°π</a></li>
          </ol>
        </li>
        <li><a href="#‰ΩøÁî®lumberjackËøõË°åÊó•ÂøóÂàáÂâ≤ÂΩíÊ°£">‰ΩøÁî®LumberjackËøõË°åÊó•ÂøóÂàáÂâ≤ÂΩíÊ°£</a>
          <ol>
            <li><a href="#ÂÆâË£Ö">ÂÆâË£Ö</a></li>
            <li><a href="#zap-logger‰∏≠Âä†ÂÖ•lumberjack">zap logger‰∏≠Âä†ÂÖ•Lumberjack</a></li>
            <li><a href="#ÊµãËØïÊâÄÊúâÂäüËÉΩ">ÊµãËØïÊâÄÊúâÂäüËÉΩ</a></li>
          </ol>
        </li>
        <li><a href="#ginÊï¥Âêàzap">ginÊï¥Âêàzap</a>
          <ol>
            <li><a href="#Âü∫‰∫ézapÁöÑ‰∏≠Èó¥‰ª∂">Âü∫‰∫ézapÁöÑ‰∏≠Èó¥‰ª∂</a></li>
            <li><a href="#Âú®ginÈ°πÁõÆ‰∏≠‰ΩøÁî®zap">Âú®ginÈ°πÁõÆ‰∏≠‰ΩøÁî®zap</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#ÂÆâË£Ö-1">ÂÆâË£Ö</a></li>
    <li><a href="#‰ªÄ‰πàÊòØviper">‰ªÄ‰πàÊòØViperÔºü</a></li>
    <li><a href="#‰∏∫‰ªÄ‰πàÈÄâÊã©viper">‰∏∫‰ªÄ‰πàÈÄâÊã©Viper?</a></li>
    <li><a href="#ÊääÂÄºÂ≠òÂÖ•viper">ÊääÂÄºÂ≠òÂÖ•Viper</a>
      <ol>
        <li><a href="#Âª∫Á´ãÈªòËÆ§ÂÄº">Âª∫Á´ãÈªòËÆ§ÂÄº</a></li>
        <li><a href="#ËØªÂèñÈÖçÁΩÆÊñá‰ª∂">ËØªÂèñÈÖçÁΩÆÊñá‰ª∂</a></li>
        <li><a href="#ÂÜôÂÖ•ÈÖçÁΩÆÊñá‰ª∂">ÂÜôÂÖ•ÈÖçÁΩÆÊñá‰ª∂</a></li>
        <li><a href="#ÁõëÊéßÂπ∂ÈáçÊñ∞ËØªÂèñÈÖçÁΩÆÊñá‰ª∂">ÁõëÊéßÂπ∂ÈáçÊñ∞ËØªÂèñÈÖçÁΩÆÊñá‰ª∂</a></li>
        <li><a href="#‰ªéioreaderËØªÂèñÈÖçÁΩÆ">‰ªéio.ReaderËØªÂèñÈÖçÁΩÆ</a></li>
        <li><a href="#Ë¶ÜÁõñËÆæÁΩÆ">Ë¶ÜÁõñËÆæÁΩÆ</a></li>
        <li><a href="#Ê≥®ÂÜåÂíå‰ΩøÁî®Âà´Âêç">Ê≥®ÂÜåÂíå‰ΩøÁî®Âà´Âêç</a></li>
        <li><a href="#‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáè">‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáè</a>
          <ol>
            <li><a href="#env-Á§∫‰æã">Env Á§∫‰æãÔºö</a></li>
          </ol>
        </li>
        <li><a href="#‰ΩøÁî®flags">‰ΩøÁî®Flags</a>
          <ol>
            <li><a href="#flagÊé•Âè£">flagÊé•Âè£</a></li>
          </ol>
        </li>
        <li><a href="#ËøúÁ®ãkeyvalueÂ≠òÂÇ®ÊîØÊåÅ">ËøúÁ®ãKey/ValueÂ≠òÂÇ®ÊîØÊåÅ</a></li>
        <li><a href="#ËøúÁ®ãkeyvalueÂ≠òÂÇ®Á§∫‰æã-Êú™Âä†ÂØÜ">ËøúÁ®ãKey/ValueÂ≠òÂÇ®Á§∫‰æã-Êú™Âä†ÂØÜ</a>
          <ol>
            <li><a href="#etcd">etcd</a></li>
            <li><a href="#consul">Consul</a></li>
            <li><a href="#firestore">Firestore</a></li>
          </ol>
        </li>
        <li><a href="#ËøúÁ®ãkeyvalueÂ≠òÂÇ®Á§∫‰æã-Âä†ÂØÜ">ËøúÁ®ãKey/ValueÂ≠òÂÇ®Á§∫‰æã-Âä†ÂØÜ</a></li>
        <li><a href="#ÁõëÊéßetcd‰∏≠ÁöÑÊõ¥Êîπ-Êú™Âä†ÂØÜ">ÁõëÊéßetcd‰∏≠ÁöÑÊõ¥Êîπ-Êú™Âä†ÂØÜ</a></li>
      </ol>
    </li>
    <li><a href="#‰ªéviperËé∑ÂèñÂÄº">‰ªéViperËé∑ÂèñÂÄº</a>
      <ol>
        <li><a href="#ËÆøÈóÆÂµåÂ•óÁöÑÈîÆ">ËÆøÈóÆÂµåÂ•óÁöÑÈîÆ</a></li>
        <li><a href="#ÊèêÂèñÂ≠êÊ†ë">ÊèêÂèñÂ≠êÊ†ë</a></li>
        <li><a href="#ÂèçÂ∫èÂàóÂåñ">ÂèçÂ∫èÂàóÂåñ</a></li>
        <li><a href="#Â∫èÂàóÂåñÊàêÂ≠óÁ¨¶‰∏≤">Â∫èÂàóÂåñÊàêÂ≠óÁ¨¶‰∏≤</a></li>
      </ol>
    </li>
    <li><a href="#‰ΩøÁî®Âçï‰∏™ËøòÊòØÂ§ö‰∏™viperÂÆû‰æã">‰ΩøÁî®Âçï‰∏™ËøòÊòØÂ§ö‰∏™ViperÂÆû‰æã?</a>
      <ol>
        <li><a href="#‰ΩøÁî®Â§ö‰∏™viperÂÆû‰æã">‰ΩøÁî®Â§ö‰∏™viperÂÆû‰æã</a></li>
      </ol>
    </li>
    <li><a href="#‰ΩøÁî®viperÁ§∫‰æã">‰ΩøÁî®ViperÁ§∫‰æã</a>
      <ol>
        <li><a href="#Áõ¥Êé•‰ΩøÁî®viperÁÆ°ÁêÜÈÖçÁΩÆ">Áõ¥Êé•‰ΩøÁî®viperÁÆ°ÁêÜÈÖçÁΩÆ</a></li>
        <li><a href="#‰ΩøÁî®ÁªìÊûÑ‰ΩìÂèòÈáè‰øùÂ≠òÈÖçÁΩÆ‰ø°ÊÅØ">‰ΩøÁî®ÁªìÊûÑ‰ΩìÂèòÈáè‰øùÂ≠òÈÖçÁΩÆ‰ø°ÊÅØ</a></li>
      </ol>
    </li>
    <li><a href="#‰ºòÈõÖÁöÑÂÖ≥Êú∫">‰ºòÈõÖÁöÑÂÖ≥Êú∫</a></li>
    <li><a href="#‰ºòÈõÖÂú∞ÂÖ≥Êú∫">‰ºòÈõÖÂú∞ÂÖ≥Êú∫</a>
      <ol>
        <li><a href="#‰ªÄ‰πàÊòØ‰ºòÈõÖÂÖ≥Êú∫">‰ªÄ‰πàÊòØ‰ºòÈõÖÂÖ≥Êú∫Ôºü</a></li>
        <li><a href="#Â¶Ç‰ΩïÂÆûÁé∞‰ºòÈõÖÂÖ≥Êú∫">Â¶Ç‰ΩïÂÆûÁé∞‰ºòÈõÖÂÖ≥Êú∫Ôºü</a></li>
        <li><a href="#‰ºòÈõÖÂú∞ÈáçÂêØ">‰ºòÈõÖÂú∞ÈáçÂêØ</a></li>
      </ol>
    </li>
    <li><a href="#Êê≠Âª∫‰∏Ä‰∏™ÈÄöÁî®ÁöÑËÑöÊâãÊû∂Â∑•ÂÖ∑">Êê≠Âª∫‰∏Ä‰∏™ÈÄöÁî®ÁöÑËÑöÊâãÊû∂Â∑•ÂÖ∑</a>
      <ol>
        <li><a href="#v10">v1.0</a></li>
        <li><a href="#v20Â∞ÜÈÖçÁΩÆ‰ø°ÊÅØÂÜôÈÅìÁªìÊûÑ‰Ωì">v2.0(Â∞ÜÈÖçÁΩÆ‰ø°ÊÅØÂÜôÈÅìÁªìÊûÑ‰Ωì)</a></li>
        <li><a href="#v30Áî®ÂëΩ‰ª§Ë°åÊåáÂÆöÊñá‰ª∂">v3.0(Áî®ÂëΩ‰ª§Ë°åÊåáÂÆöÊñá‰ª∂)</a></li>
      </ol>
    </li>
    <li><a href="#È°πÁõÆÊê≠Âª∫">È°πÁõÆÊê≠Âª∫</a>
      <ol>
        <li><a href="#ÂàÜÂ∏ÉÂºèid">ÂàÜÂ∏ÉÂºèID</a></li>
        <li><a href="#Èõ™Ëä±ÁÆóÊ≥ï">Èõ™Ëä±ÁÆóÊ≥ï</a>
          <ol>
            <li></li>
          </ol>
        </li>
        <li><a href="#Ê≥®ÂÜåÈÄªËæë">Ê≥®ÂÜåÈÄªËæë</a>
          <ol>
            <li><a href="#Áî®Á¨¨‰∏âÊñπÂ∫ìËøõË°åÂèÇÊï∞Ê†°È™å">Áî®Á¨¨‰∏âÊñπÂ∫ìËøõË°åÂèÇÊï∞Ê†°È™å</a></li>
            <li><a href="#validatorËøîÂõûÈîôËØØ‰ø°ÊÅØÁöÑÂõΩÈôÖÂåñ">validatorËøîÂõûÈîôËØØ‰ø°ÊÅØÁöÑÂõΩÈôÖÂåñ</a></li>
            <li><a href="#Êó•ÂøóËæìÂá∫Âà∞ÊéßÂà∂Âè∞ÂíåÊñá‰ª∂devÁéØÂ¢É‰∏ãÊñπ‰æøË∞ÉËØï">Êó•ÂøóËæìÂá∫Âà∞ÊéßÂà∂Âè∞ÂíåÊñá‰ª∂ÔºàdevÁéØÂ¢É‰∏ãÊñπ‰æøË∞ÉËØïÔºâ</a></li>
            <li><a href="#Â∞ÅË£ÖËøîÂõûÁöÑjson">Â∞ÅË£ÖËøîÂõûÁöÑjson</a></li>
            <li><a href="#Â∞ÜerrorsnewÂ∞ÅË£ÖÊàêÂØπË±°Êñπ‰æøcontrollerÂà§Êñ≠">Â∞Üerrors.NewÂ∞ÅË£ÖÊàêÂØπË±°ÔºåÊñπ‰æøcontrollerÂà§Êñ≠</a></li>
          </ol>
        </li>
        <li><a href="#Âà©Áî®jwtÁöÑtokenËøõË°åÁôªÂΩï">Âà©Áî®JwtÁöÑtokenËøõË°åÁôªÂΩï</a>
          <ol>
            <li><a href="#ÈÄöËøátokenËøõË°åÊ†°È™å">ÈÄöËøátokenËøõË°åÊ†°È™å</a></li>
            <li><a href="#refresh-token">refresh token</a></li>
            <li><a href="#Â¶Ç‰ΩïÈôêÂà∂‰∏ÄÂè∞ÁîµËÑëÂè™ËÉΩÁôªÂΩï‰∏Ä‰∏™Ë¥¶Âè∑">Â¶Ç‰ΩïÈôêÂà∂‰∏ÄÂè∞ÁîµËÑëÂè™ËÉΩÁôªÂΩï‰∏Ä‰∏™Ë¥¶Âè∑</a></li>
          </ol>
        </li>
        <li><a href="#‰∏∫goÈ°πÁõÆÁºñÂÜômake-file">‰∏∫goÈ°πÁõÆÁºñÂÜômake file</a>
          <ol>
            <li><a href="#make‰ªãÁªç">make‰ªãÁªç</a></li>
            <li><a href="#makefile‰ªãÁªç">Makefile‰ªãÁªç</a></li>
            <li><a href="#ËßÑÂàôÊ¶ÇËø∞">ËßÑÂàôÊ¶ÇËø∞</a></li>
            <li><a href="#Á§∫‰æã">Á§∫‰æã</a></li>
          </ol>
        </li>
        <li><a href="#airÂ§ßÂ§ßÊèêÈ´òÂºÄÂèëÊïàÁéá">airÔºàÂ§ßÂ§ßÊèêÈ´òÂºÄÂèëÊïàÁéáÔºâ</a></li>
        <li><a href="#goÂÜÖÂ≠òÂØπÈΩê">GoÂÜÖÂ≠òÂØπÈΩê</a></li>
        <li><a href="#ÂØπÊü•ËØ¢ÁªìÊûúÁöÑ‰ºòÂåñ">ÂØπÊü•ËØ¢ÁªìÊûúÁöÑ‰ºòÂåñ</a></li>
        <li><a href="#ÂàÜÈ°µÊü•ËØ¢">ÂàÜÈ°µÊü•ËØ¢</a></li>
        <li><a href="#Ëß£ÂÜ≥idÂèëÈÄÅÁªôÂâçÁ´ØÂ§±ÁúüÁöÑÈóÆÈ¢ò">Ëß£ÂÜ≥idÂèëÈÄÅÁªôÂâçÁ´ØÂ§±ÁúüÁöÑÈóÆÈ¢ò</a></li>
        <li><a href="#ÊäïÁ•®ÂäüËÉΩ">ÊäïÁ•®ÂäüËÉΩ</a></li>
      </ol>
    </li>
    <li><a href="#swaggerÊé•Âè£ÊñáÊ°£">swaggerÊé•Âè£ÊñáÊ°£</a>
      <ol>
        <li><a href="#Á¨¨‰∏ÄÊ≠•Ê∑ªÂä†Ê≥®Èáä">Á¨¨‰∏ÄÊ≠•ÔºöÊ∑ªÂä†Ê≥®Èáä</a></li>
        <li><a href="#Á¨¨‰∫åÊ≠•ÁîüÊàêÊé•Âè£ÊñáÊ°£Êï∞ÊçÆ">Á¨¨‰∫åÊ≠•ÔºöÁîüÊàêÊé•Âè£ÊñáÊ°£Êï∞ÊçÆ</a></li>
        <li><a href="#Á¨¨‰∏âÊ≠•ÂºïÂÖ•gin-swaggerÊ∏≤ÊüìÊñáÊ°£Êï∞ÊçÆ">Á¨¨‰∏âÊ≠•ÔºöÂºïÂÖ•gin-swaggerÊ∏≤ÊüìÊñáÊ°£Êï∞ÊçÆ</a></li>
      </ol>
    </li>
    <li><a href="#goËØ≠Ë®ÄÂçïÂÖÉÊµãËØï">GoËØ≠Ë®ÄÂçïÂÖÉÊµãËØï</a>
      <ol>
        <li><a href="#go-testÂ∑•ÂÖ∑">go testÂ∑•ÂÖ∑</a></li>
        <li><a href="#ÂçïÂÖÉÊµãËØïÂáΩÊï∞">ÂçïÂÖÉÊµãËØïÂáΩÊï∞</a>
          <ol>
            <li><a href="#Ê†ºÂºè">Ê†ºÂºè</a></li>
            <li><a href="#ÂçïÂÖÉÊµãËØïÁ§∫‰æã">ÂçïÂÖÉÊµãËØïÁ§∫‰æã</a></li>
          </ol>
        </li>
        <li><a href="#go-test--v">go test -v</a></li>
        <li><a href="#go-test--run">go test -run</a></li>
        <li><a href="#ÂõûÂΩíÊµãËØï">ÂõûÂΩíÊµãËØï</a></li>
        <li><a href="#Ë∑≥ËøáÊüê‰∫õÊµãËØïÁî®‰æã">Ë∑≥ËøáÊüê‰∫õÊµãËØïÁî®‰æã</a></li>
        <li><a href="#Â≠êÊµãËØï">Â≠êÊµãËØï</a></li>
        <li><a href="#Ë°®Ê†ºÈ©±Âä®ÊµãËØï">Ë°®Ê†ºÈ©±Âä®ÊµãËØï</a>
          <ol>
            <li><a href="#‰ªãÁªç">‰ªãÁªç</a></li>
            <li><a href="#Á§∫‰æã-1">Á§∫‰æã</a></li>
            <li><a href="#Âπ∂Ë°åÊµãËØï">Âπ∂Ë°åÊµãËØï</a></li>
            <li><a href="#‰ΩøÁî®Â∑•ÂÖ∑ÁîüÊàêÊµãËØï‰ª£Á†Å">‰ΩøÁî®Â∑•ÂÖ∑ÁîüÊàêÊµãËØï‰ª£Á†Å</a></li>
          </ol>
        </li>
        <li><a href="#ÊµãËØïË¶ÜÁõñÁéá">ÊµãËØïË¶ÜÁõñÁéá</a></li>
      </ol>
    </li>
    <li><a href="#testifyassert">testify/assert</a>
      <ol>
        <li><a href="#ÂÆâË£Ö-2">ÂÆâË£Ö</a></li>
        <li><a href="#‰ΩøÁî®Á§∫‰æã">‰ΩøÁî®Á§∫‰æã</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#ÈôêÊµÅ">ÈôêÊµÅ</a></li>
    <li><a href="#Â∏∏Áî®ÁöÑÈôêÊµÅÁ≠ñÁï•">Â∏∏Áî®ÁöÑÈôêÊµÅÁ≠ñÁï•</a>
      <ol>
        <li><a href="#ÊºèÊ°∂">ÊºèÊ°∂</a></li>
        <li><a href="#‰ª§ÁâåÊ°∂">‰ª§ÁâåÊ°∂</a></li>
      </ol>
    </li>
    <li><a href="#ginÊ°ÜÊû∂‰∏≠‰ΩøÁî®ÈôêÊµÅ‰∏≠Èó¥‰ª∂">ginÊ°ÜÊû∂‰∏≠‰ΩøÁî®ÈôêÊµÅ‰∏≠Èó¥‰ª∂</a></li>
    <li><a href="#ÂÆå">ÂÆå</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/gin/">
                <img src="/posts/gin/d8ccbe52c5255121e5a554ce275ee72d_hu7f5d8dacba1592bb3a5cf38c96474382_14659_800x0_resize_box_3.png"
                        srcset="/posts/gin/d8ccbe52c5255121e5a554ce275ee72d_hu7f5d8dacba1592bb3a5cf38c96474382_14659_800x0_resize_box_3.png 800w, /posts/gin/d8ccbe52c5255121e5a554ce275ee72d_hu7f5d8dacba1592bb3a5cf38c96474382_14659_1600x0_resize_box_3.png 1600w"
                        width="800" 
                        height="267" 
                        loading="lazy"
                        alt="Featured image of post Â≠¶‰π†Gin" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/golang/" >
                Golang
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/gin/">Â≠¶‰π†Gin</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            GinÁöÑÁ¨îËÆ∞
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 05, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 59 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="gin">Gin</h1>
<h2 id="ginÊ°ÜÊû∂Ë∑ØÁî±ËØ¶Ëß£">ginÊ°ÜÊû∂Ë∑ØÁî±ËØ¶Ëß£</h2>
<p>ginÊ°ÜÊû∂‰ΩøÁî®ÁöÑÊòØÂÆöÂà∂ÁâàÊú¨ÁöÑ<a class="link" href="https://github.com/julienschmidt/httprouter"  target="_blank" rel="noopener"
    >httprouter</a>ÔºåÂÖ∂Ë∑ØÁî±ÁöÑÂéüÁêÜÊòØÂ§ßÈáè‰ΩøÁî®ÂÖ¨ÂÖ±ÂâçÁºÄÁöÑÊ†ëÁªìÊûÑÔºåÂÆÉÂü∫Êú¨‰∏äÊòØ‰∏Ä‰∏™Á¥ßÂáëÁöÑ<a class="link" href="https://baike.sogou.com/v66237892.htm"  target="_blank" rel="noopener"
    >Trie tree</a>ÔºàÊàñËÄÖÂè™ÊòØ<a class="link" href="https://baike.sogou.com/v73626121.htm"  target="_blank" rel="noopener"
    >Radix Tree</a>Ôºâ„ÄÇÂÖ∑ÊúâÂÖ¨ÂÖ±ÂâçÁºÄÁöÑËäÇÁÇπ‰πüÂÖ±‰∫´‰∏Ä‰∏™ÂÖ¨ÂÖ±Áà∂ËäÇÁÇπ„ÄÇ</p>
<h3 id="radix-tree">Radix Tree</h3>
<p>Âü∫Êï∞Ê†ëÔºàRadix TreeÔºâÂèàÁß∞‰∏∫PAT‰ΩçÊ†ëÔºàPatricia Trie or crit bit treeÔºâÔºåÊòØ‰∏ÄÁßçÊõ¥ËäÇÁúÅÁ©∫Èó¥ÁöÑÂâçÁºÄÊ†ëÔºàTrie TreeÔºâ„ÄÇÂØπ‰∫éÂü∫Êï∞Ê†ëÁöÑÊØè‰∏™ËäÇÁÇπÔºåÂ¶ÇÊûúËØ•ËäÇÁÇπÊòØÂîØ‰∏ÄÁöÑÂ≠êÊ†ëÁöÑËØùÔºåÂ∞±ÂíåÁà∂ËäÇÁÇπÂêàÂπ∂„ÄÇ‰∏ãÂõæ‰∏∫‰∏Ä‰∏™Âü∫Êï∞Ê†ëÁ§∫‰æãÔºö</p>
<p><img src="https://www.liwenzhou.com/images/Go/gin/radix_tree.png"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p><code>Radix Tree</code>ÂèØ‰ª•Ë¢´ËÆ§‰∏∫ÊòØ‰∏ÄÊ£µÁÆÄÊ¥ÅÁâàÁöÑÂâçÁºÄÊ†ë„ÄÇÊàë‰ª¨Ê≥®ÂÜåË∑ØÁî±ÁöÑËøáÁ®ãÂ∞±ÊòØÊûÑÈÄ†ÂâçÁºÄÊ†ëÁöÑËøáÁ®ãÔºåÂÖ∑ÊúâÂÖ¨ÂÖ±ÂâçÁºÄÁöÑËäÇÁÇπ‰πüÂÖ±‰∫´‰∏Ä‰∏™ÂÖ¨ÂÖ±Áà∂ËäÇÁÇπ„ÄÇÂÅáËÆæÊàë‰ª¨Áé∞Âú®Ê≥®ÂÜåÊúâ‰ª•‰∏ãË∑ØÁî±‰ø°ÊÅØÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">func1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/search/&#34;</span><span class="p">,</span> <span class="nx">func2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/support/&#34;</span><span class="p">,</span> <span class="nx">func3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/blog/&#34;</span><span class="p">,</span> <span class="nx">func4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/blog/:post/&#34;</span><span class="p">,</span> <span class="nx">func5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/about-us/&#34;</span><span class="p">,</span> <span class="nx">func6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/about-us/team/&#34;</span><span class="p">,</span> <span class="nx">func7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/contact/&#34;</span><span class="p">,</span> <span class="nx">func8</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÇ£‰πàÊàë‰ª¨‰ºöÂæóÂà∞‰∏Ä‰∏™<code>GET</code>ÊñπÊ≥ïÂØπÂ∫îÁöÑË∑ØÁî±Ê†ëÔºåÂÖ∑‰ΩìÁªìÊûÑÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Priority   Path             Handle
</span></span><span class="line"><span class="cl"><span class="m">9</span>          <span class="se">\ </span>               *&lt;1&gt;
</span></span><span class="line"><span class="cl"><span class="m">3</span>          ‚îús               nil
</span></span><span class="line"><span class="cl"><span class="m">2</span>          <span class="p">|</span>‚îúearch<span class="se">\ </span>        *&lt;2&gt;
</span></span><span class="line"><span class="cl"><span class="m">1</span>          <span class="p">|</span>‚îîupport<span class="se">\ </span>       *&lt;3&gt;
</span></span><span class="line"><span class="cl"><span class="m">2</span>          ‚îúblog<span class="se">\ </span>          *&lt;4&gt;
</span></span><span class="line"><span class="cl"><span class="m">1</span>          <span class="p">|</span>    ‚îî:post      nil
</span></span><span class="line"><span class="cl"><span class="m">1</span>          <span class="p">|</span>         ‚îî<span class="se">\ </span>    *&lt;5&gt;
</span></span><span class="line"><span class="cl"><span class="m">2</span>          ‚îúabout-us<span class="se">\ </span>      *&lt;6&gt;
</span></span><span class="line"><span class="cl"><span class="m">1</span>          <span class="p">|</span>        ‚îîteam<span class="se">\ </span> *&lt;7&gt;
</span></span><span class="line"><span class="cl"><span class="m">1</span>          ‚îîcontact<span class="se">\ </span>       *&lt;8&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢ÊúÄÂè≥ËæπÈÇ£‰∏ÄÂàóÊØè‰∏™<code>*&lt;Êï∞Â≠ó&gt;</code>Ë°®Á§∫HandleÂ§ÑÁêÜÂáΩÊï∞ÁöÑÂÜÖÂ≠òÂú∞ÂùÄ(‰∏Ä‰∏™ÊåáÈíà)„ÄÇ‰ªéÊ†πËäÇÁÇπÈÅçÂéÜÂà∞Âè∂Â≠êËäÇÁÇπÊàë‰ª¨Â∞±ËÉΩÂæóÂà∞ÂÆåÊï¥ÁöÑË∑ØÁî±Ë°®„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö<code>blog/:post</code>ÂÖ∂‰∏≠<code>:post</code>Âè™ÊòØÂÆûÈôÖÊñáÁ´†ÂêçÁß∞ÁöÑÂç†‰ΩçÁ¨¶(ÂèÇÊï∞)„ÄÇ‰∏é<code>hash-maps</code>‰∏çÂêåÔºåËøôÁßçÊ†ëÁªìÊûÑËøòÂÖÅËÆ∏Êàë‰ª¨‰ΩøÁî®ÂÉè<code>:post</code>ÂèÇÊï∞ËøôÁßçÂä®ÊÄÅÈÉ®ÂàÜÔºåÂõ†‰∏∫Êàë‰ª¨ÂÆûÈôÖ‰∏äÊòØÊ†πÊçÆË∑ØÁî±Ê®°ÂºèËøõË°åÂåπÈÖçÔºåËÄå‰∏ç‰ªÖ‰ªÖÊòØÊØîËæÉÂìàÂ∏åÂÄº„ÄÇ</p>
<p>Áî±‰∫éURLË∑ØÂæÑÂÖ∑ÊúâÂ±ÇÊ¨°ÁªìÊûÑÔºåÂπ∂‰∏îÂè™‰ΩøÁî®ÊúâÈôêÁöÑ‰∏ÄÁªÑÂ≠óÁ¨¶(Â≠óËäÇÂÄº)ÔºåÊâÄ‰ª•ÂæàÂèØËÉΩÊúâËÆ∏Â§öÂ∏∏ËßÅÁöÑÂâçÁºÄ„ÄÇËøô‰ΩøÊàë‰ª¨ÂèØ‰ª•ÂæàÂÆπÊòìÂú∞Â∞ÜË∑ØÁî±ÁÆÄÂåñ‰∏∫Êõ¥Â∞èÁöÑÈóÆÈ¢ò„ÄÇÊ≠§Â§ñÔºå<strong>Ë∑ØÁî±Âô®‰∏∫ÊØèÁßçËØ∑Ê±ÇÊñπÊ≥ïÁÆ°ÁêÜ‰∏ÄÊ£µÂçïÁã¨ÁöÑÊ†ë</strong>„ÄÇ‰∏ÄÊñπÈù¢ÔºåÂÆÉÊØîÂú®ÊØè‰∏™ËäÇÁÇπ‰∏≠ÈÉΩ‰øùÂ≠ò‰∏Ä‰∏™method-&gt; handle mapÊõ¥Âä†ËäÇÁúÅÁ©∫Èó¥ÔºåÂÆÉËøò‰ΩøÊàë‰ª¨ÁîöËá≥ÂèØ‰ª•Âú®ÂºÄÂßãÂú®ÂâçÁºÄÊ†ë‰∏≠Êü•Êâæ‰πãÂâçÂ§ßÂ§ßÂáèÂ∞ëË∑ØÁî±ÈóÆÈ¢ò„ÄÇ</p>
<p>‰∏∫‰∫ÜËé∑ÂæóÊõ¥Â•ΩÁöÑÂèØ‰º∏Áº©ÊÄßÔºåÊØè‰∏™Ê†ëÁ∫ßÂà´‰∏äÁöÑÂ≠êËäÇÁÇπÈÉΩÊåâ<code>Priority(‰ºòÂÖàÁ∫ß)</code>ÊéíÂ∫èÔºåÂÖ∂‰∏≠‰ºòÂÖàÁ∫ßÔºàÊúÄÂ∑¶ÂàóÔºâÂ∞±ÊòØÂú®Â≠êËäÇÁÇπ(Â≠êËäÇÁÇπ„ÄÅÂ≠êÂ≠êËäÇÁÇπÁ≠âÁ≠â)‰∏≠Ê≥®ÂÜåÁöÑÂè•ÊüÑÁöÑÊï∞Èáè„ÄÇËøôÊ†∑ÂÅöÊúâ‰∏§‰∏™Â•ΩÂ§Ñ:</p>
<ol>
<li>È¶ñÂÖà‰ºòÂÖàÂåπÈÖçË¢´Â§ßÂ§öÊï∞Ë∑ØÁî±Ë∑ØÂæÑÂåÖÂê´ÁöÑËäÇÁÇπ„ÄÇËøôÊ†∑ÂèØ‰ª•ËÆ©Â∞ΩÂèØËÉΩÂ§öÁöÑË∑ØÁî±Âø´ÈÄüË¢´ÂÆö‰Ωç„ÄÇ</li>
<li>Á±ª‰ºº‰∫éÊàêÊú¨Ë°•ÂÅø„ÄÇÊúÄÈïøÁöÑË∑ØÂæÑÂèØ‰ª•Ë¢´‰ºòÂÖàÂåπÈÖçÔºåË°•ÂÅø‰ΩìÁé∞Âú®ÊúÄÈïøÁöÑË∑ØÂæÑÈúÄË¶ÅËä±Ë¥πÊõ¥ÈïøÁöÑÊó∂Èó¥Êù•ÂÆö‰ΩçÔºåÂ¶ÇÊûúÊúÄÈïøË∑ØÂæÑÁöÑËäÇÁÇπËÉΩË¢´‰ºòÂÖàÂåπÈÖçÔºàÂç≥ÊØèÊ¨°ÊãøÂ≠êËäÇÁÇπÈÉΩÂëΩ‰∏≠ÔºâÔºåÈÇ£‰πàË∑ØÁî±ÂåπÈÖçÊâÄËä±ÁöÑÊó∂Èó¥‰∏ç‰∏ÄÂÆöÊØîÁü≠Ë∑ØÂæÑÁöÑË∑ØÁî±Èïø„ÄÇ‰∏ãÈù¢Â±ïÁ§∫‰∫ÜËäÇÁÇπÔºàÊØè‰∏™<code>-</code>ÂèØ‰ª•ÁúãÂÅö‰∏Ä‰∏™ËäÇÁÇπÔºâÂåπÈÖçÁöÑË∑ØÂæÑÔºö‰ªéÂ∑¶Âà∞Âè≥Ôºå‰ªé‰∏äÂà∞‰∏ã„ÄÇ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">   ‚îú------------
</span></span><span class="line"><span class="cl">   ‚îú---------
</span></span><span class="line"><span class="cl">   ‚îú-----
</span></span><span class="line"><span class="cl">   ‚îú----
</span></span><span class="line"><span class="cl">   ‚îú--
</span></span><span class="line"><span class="cl">   ‚îú--
</span></span><span class="line"><span class="cl">   ‚îî-
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ë∑ØÁî±Ê†ëËäÇÁÇπ">Ë∑ØÁî±Ê†ëËäÇÁÇπ</h3>
<p>Ë∑ØÁî±Ê†ëÊòØÁî±‰∏Ä‰∏™‰∏™ËäÇÁÇπÊûÑÊàêÁöÑÔºåginÊ°ÜÊû∂Ë∑ØÁî±Ê†ëÁöÑËäÇÁÇπÁî±<code>node</code>ÁªìÊûÑ‰ΩìË°®Á§∫ÔºåÂÆÉÊúâ‰ª•‰∏ãÂ≠óÊÆµÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// tree.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">node</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">// ËäÇÁÇπË∑ØÂæÑÔºåÊØîÂ¶Ç‰∏äÈù¢ÁöÑsÔºåearchÔºåÂíåupport
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">path</span>      <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÂíåchildrenÂ≠óÊÆµÂØπÂ∫î, ‰øùÂ≠òÁöÑÊòØÂàÜË£ÇÁöÑÂàÜÊîØÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ‰æãÂ¶ÇsearchÂíåsupport, ÈÇ£‰πàsËäÇÁÇπÁöÑindicesÂØπÂ∫îÁöÑ&#34;eu&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ‰ª£Ë°®Êúâ‰∏§‰∏™ÂàÜÊîØ, ÂàÜÊîØÁöÑÈ¶ñÂ≠óÊØçÂàÜÂà´ÊòØeÂíåu
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">indices</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÂÑøÂ≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">children</span>  <span class="p">[]</span><span class="o">*</span><span class="nx">node</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Â§ÑÁêÜÂáΩÊï∞ÈìæÊù°ÔºàÂàáÁâáÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">handlers</span>  <span class="nx">HandlersChain</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ‰ºòÂÖàÁ∫ßÔºåÂ≠êËäÇÁÇπ„ÄÅÂ≠êÂ≠êËäÇÁÇπÁ≠âÊ≥®ÂÜåÁöÑhandlerÊï∞Èáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">priority</span>  <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ËäÇÁÇπÁ±ªÂûãÔºåÂåÖÊã¨static, root, param, catchAll
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// static: ÈùôÊÄÅËäÇÁÇπÔºàÈªòËÆ§ÔºâÔºåÊØîÂ¶Ç‰∏äÈù¢ÁöÑsÔºåearchÁ≠âËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// root: Ê†ëÁöÑÊ†πËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// catchAll: Êúâ*ÂåπÈÖçÁöÑËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// param: ÂèÇÊï∞ËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">nType</span>     <span class="nx">nodeType</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Ë∑ØÂæÑ‰∏äÊúÄÂ§ßÂèÇÊï∞‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">maxParams</span> <span class="kt">uint8</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ËäÇÁÇπÊòØÂê¶ÊòØÂèÇÊï∞ËäÇÁÇπÔºåÊØîÂ¶Ç‰∏äÈù¢ÁöÑ:post
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">wildChild</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÂÆåÊï¥Ë∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fullPath</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ËØ∑Ê±ÇÊñπÊ≥ïÊ†ë">ËØ∑Ê±ÇÊñπÊ≥ïÊ†ë</h3>
<p>Âú®ginÁöÑË∑ØÁî±‰∏≠ÔºåÊØè‰∏Ä‰∏™<code>HTTP Method</code>(GET„ÄÅPOST„ÄÅPUT„ÄÅDELETE‚Ä¶)ÈÉΩÂØπÂ∫î‰∫Ü‰∏ÄÊ£µ <code>radix tree</code>ÔºåÊàë‰ª¨Ê≥®ÂÜåË∑ØÁî±ÁöÑÊó∂ÂÄô‰ºöË∞ÉÁî®‰∏ãÈù¢ÁöÑ<code>addRoute</code>ÂáΩÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// gin.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="nx">HandlersChain</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">// liwenzhou.com...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   
</span></span><span class="line"><span class="cl">   <span class="c1">// Ëé∑ÂèñËØ∑Ê±ÇÊñπÊ≥ïÂØπÂ∫îÁöÑÊ†ë
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">root</span> <span class="o">:=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">trees</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">root</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	   <span class="c1">// Â¶ÇÊûúÊ≤°ÊúâÂ∞±ÂàõÂª∫‰∏Ä‰∏™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">root</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">root</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="s">&#34;/&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="nx">engine</span><span class="p">.</span><span class="nx">trees</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">engine</span><span class="p">.</span><span class="nx">trees</span><span class="p">,</span> <span class="nx">methodTree</span><span class="p">{</span><span class="nx">method</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">root</span><span class="p">:</span> <span class="nx">root</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">root</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Âú®Ê≥®ÂÜåË∑ØÁî±ÁöÑÊó∂ÂÄôÈÉΩÊòØÂÖàÊ†πÊçÆËØ∑Ê±ÇÊñπÊ≥ïËé∑ÂèñÂØπÂ∫îÁöÑÊ†ëÔºå‰πüÂ∞±ÊòØginÊ°ÜÊû∂‰ºö‰∏∫ÊØè‰∏Ä‰∏™ËØ∑Ê±ÇÊñπÊ≥ïÂàõÂª∫‰∏ÄÊ£µÂØπÂ∫îÁöÑÊ†ë„ÄÇÂè™‰∏çËøáÈúÄË¶ÅÊ≥®ÊÑèÂà∞‰∏Ä‰∏™ÁªÜËäÇÊòØginÊ°ÜÊû∂‰∏≠‰øùÂ≠òËØ∑Ê±ÇÊñπÊ≥ïÂØπÂ∫îÊ†ëÂÖ≥Á≥ªÂπ∂‰∏çÊòØ‰ΩøÁî®ÁöÑmapËÄåÊòØ‰ΩøÁî®ÁöÑÂàáÁâáÔºå<code>engine.trees</code>ÁöÑÁ±ªÂûãÊòØ<code>methodTrees</code>ÔºåÂÖ∂ÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">methodTree</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">method</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">root</span>   <span class="o">*</span><span class="nx">node</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">methodTrees</span> <span class="p">[]</span><span class="nx">methodTree</span>  <span class="c1">// slice
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ËÄåËé∑ÂèñËØ∑Ê±ÇÊñπÊ≥ïÂØπÂ∫îÊ†ëÁöÑgetÊñπÊ≥ïÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">trees</span> <span class="nx">methodTrees</span><span class="p">)</span> <span class="nf">get</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">node</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tree</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">trees</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="nx">method</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">root</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏∫‰ªÄ‰πà‰ΩøÁî®ÂàáÁâáËÄå‰∏çÊòØmapÊù•Â≠òÂÇ®<code>ËØ∑Ê±ÇÊñπÊ≥ï-&gt;Ê†ë</code>ÁöÑÁªìÊûÑÂë¢ÔºüÊàëÁåúÊòØÂá∫‰∫éËäÇÁúÅÂÜÖÂ≠òÁöÑËÄÉËôëÂêßÔºåÊØïÁ´üHTTPËØ∑Ê±ÇÊñπÊ≥ïÁöÑÊï∞ÈáèÊòØÂõ∫ÂÆöÁöÑÔºåËÄå‰∏îÂ∏∏Áî®ÁöÑÂ∞±ÈÇ£Âá†ÁßçÔºåÊâÄ‰ª•Âç≥‰Ωø‰ΩøÁî®ÂàáÁâáÂ≠òÂÇ®Êü•ËØ¢Ëµ∑Êù•ÊïàÁéá‰πüË∂≥Â§ü‰∫Ü„ÄÇÈ°∫ÁùÄËøô‰∏™ÊÄùË∑ØÔºåÊàë‰ª¨ÂèØ‰ª•Áúã‰∏Ä‰∏ãginÊ°ÜÊû∂‰∏≠<code>engine</code>ÁöÑÂàùÂßãÂåñÊñπÊ≥ï‰∏≠ÔºåÁ°ÆÂÆûÂØπ<code>tress</code>Â≠óÊÆµÂÅö‰∫Ü‰∏ÄÊ¨°ÂÜÖÂ≠òÁî≥ËØ∑Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">New</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">debugPrintWARNINGNew</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Engine</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">RouterGroup</span><span class="p">:</span> <span class="nx">RouterGroup</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Handlers</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">basePath</span><span class="p">:</span> <span class="s">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">root</span><span class="p">:</span>     <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// liwenzhou.com ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// ÂàùÂßãÂåñÂÆπÈáè‰∏∫9ÁöÑÂàáÁâáÔºàHTTP1.1ËØ∑Ê±ÇÊñπÊ≥ïÂÖ±9ÁßçÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">trees</span><span class="p">:</span>                  <span class="nb">make</span><span class="p">(</span><span class="nx">methodTrees</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// liwenzhou.com...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">.</span><span class="nx">engine</span> <span class="p">=</span> <span class="nx">engine</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">New</span> <span class="p">=</span> <span class="kd">func</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">engine</span><span class="p">.</span><span class="nf">allocateContext</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">engine</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê≥®ÂÜåË∑ØÁî±">Ê≥®ÂÜåË∑ØÁî±</h3>
<p>Ê≥®ÂÜåË∑ØÁî±ÁöÑÈÄªËæë‰∏ªË¶ÅÊúâ<code>addRoute</code>ÂáΩÊï∞Âíå<code>insertChild</code>ÊñπÊ≥ï„ÄÇ</p>
<h4 id="addroute">addRoute</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// tree.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// addRoute Â∞ÜÂÖ∑ÊúâÁªôÂÆöÂè•ÊüÑÁöÑËäÇÁÇπÊ∑ªÂä†Âà∞Ë∑ØÂæÑ‰∏≠„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1">// ‰∏çÊòØÂπ∂ÂèëÂÆâÂÖ®ÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="nx">HandlersChain</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fullPath</span> <span class="o">:=</span> <span class="nx">path</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span><span class="p">.</span><span class="nx">priority</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">	<span class="nx">numParams</span> <span class="o">:=</span> <span class="nf">countParams</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>  <span class="c1">// Êï∞‰∏Ä‰∏ãÂèÇÊï∞‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Á©∫Ê†ëÂ∞±Áõ¥Êé•ÊèíÂÖ•ÂΩìÂâçËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nf">insertChild</span><span class="p">(</span><span class="nx">numParams</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">fullPath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">nType</span> <span class="p">=</span> <span class="nx">root</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">parentFullPathIndex</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">walk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Êõ¥Êñ∞ÂΩìÂâçËäÇÁÇπÁöÑÊúÄÂ§ßÂèÇÊï∞‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">numParams</span> <span class="p">&gt;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">=</span> <span class="nx">numParams</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// ÊâæÂà∞ÊúÄÈïøÁöÑÈÄöÁî®ÂâçÁºÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Ëøô‰πüÊÑèÂë≥ÁùÄÂÖ¨ÂÖ±ÂâçÁºÄ‰∏çÂåÖÂê´‚Äú:‚Äù&#34;Êàñ‚Äú*‚Äù /
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Âõ†‰∏∫Áé∞ÊúâÈîÆ‰∏çËÉΩÂåÖÂê´Ëøô‰∫õÂ≠óÁ¨¶„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">i</span> <span class="o">:=</span> <span class="nf">longestCommonPrefix</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// ÂàÜË£ÇËæπÁºòÔºàÊ≠§Â§ÑÂàÜË£ÇÁöÑÊòØÂΩìÂâçÊ†ëËäÇÁÇπÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// ‰æãÂ¶Ç‰∏ÄÂºÄÂßãpathÊòØsearchÔºåÊñ∞Âä†ÂÖ•supportÔºåsÊòØ‰ªñ‰ª¨ÈÄöÁî®ÁöÑÊúÄÈïøÂâçÁºÄÈÉ®ÂàÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// ÈÇ£‰πà‰ºöÂ∞ÜsÊãøÂá∫Êù•‰Ωú‰∏∫parentËäÇÁÇπÔºåÂ¢ûÂä†earchÂíåupport‰Ωú‰∏∫childËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">child</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">path</span><span class="p">:</span>      <span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="p">:],</span>  <span class="c1">// ÂÖ¨ÂÖ±ÂâçÁºÄÂêéÁöÑÈÉ®ÂàÜ‰Ωú‰∏∫Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">wildChild</span><span class="p">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">wildChild</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">indices</span><span class="p">:</span>   <span class="nx">n</span><span class="p">.</span><span class="nx">indices</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">children</span><span class="p">:</span>  <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">handlers</span><span class="p">:</span>  <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">priority</span><span class="p">:</span>  <span class="nx">n</span><span class="p">.</span><span class="nx">priority</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">//Â≠êËäÇÁÇπ‰ºòÂÖàÁ∫ß-1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">fullPath</span><span class="p">:</span>  <span class="nx">n</span><span class="p">.</span><span class="nx">fullPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Update maxParams (max of all children)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">child</span><span class="p">.</span><span class="nx">children</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">&gt;</span> <span class="nx">child</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">child</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">maxParams</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span><span class="p">{</span><span class="o">&amp;</span><span class="nx">child</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// []byte for proper unicode char conversion, see #65
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">n</span><span class="p">.</span><span class="nx">indices</span> <span class="p">=</span> <span class="nb">string</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[:</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">wildChild</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">fullPath</span><span class="p">[:</span><span class="nx">parentFullPathIndex</span><span class="o">+</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Â∞ÜÊñ∞Êù•ÁöÑËäÇÁÇπÊèíÂÖ•Êñ∞ÁöÑparentËäÇÁÇπ‰Ωú‰∏∫Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">wildChild</span> <span class="p">{</span>  <span class="c1">// Â¶ÇÊûúÊòØÂèÇÊï∞ËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">parentFullPathIndex</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span><span class="p">.</span><span class="nx">priority</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// Update maxParams of the child node
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="nx">numParams</span> <span class="p">&gt;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">=</span> <span class="nx">numParams</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">numParams</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// Ê£ÄÊü•ÈÄöÈÖçÁ¨¶ÊòØÂê¶ÂåπÈÖç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="o">==</span> <span class="nx">path</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// Ê£ÄÊü•Êõ¥ÈïøÁöÑÈÄöÈÖçÁ¨¶, ‰æãÂ¶Ç :name and :names
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">||</span> <span class="nx">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">continue</span> <span class="nx">walk</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="nx">pathSeg</span> <span class="o">:=</span> <span class="nx">path</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nType</span> <span class="o">!=</span> <span class="nx">catchAll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">pathSeg</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">SplitN</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">prefix</span> <span class="o">:=</span> <span class="nx">fullPath</span><span class="p">[:</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">,</span> <span class="nx">pathSeg</span><span class="p">)]</span> <span class="o">+</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span>
</span></span><span class="line"><span class="cl">				<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;&#39;&#34;</span> <span class="o">+</span> <span class="nx">pathSeg</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">					<span class="s">&#34;&#39; in new path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">					<span class="s">&#34;&#39; conflicts with existing wildcard &#39;&#34;</span> <span class="o">+</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">					<span class="s">&#34;&#39; in existing prefix &#39;&#34;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">					<span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// ÂèñpathÈ¶ñÂ≠óÊØçÔºåÁî®Êù•‰∏éindicesÂÅöÊØîËæÉ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">c</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Â§ÑÁêÜÂèÇÊï∞ÂêéÂä†ÊñúÁ∫øÊÉÖÂÜµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nType</span> <span class="o">==</span> <span class="nx">param</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">parentFullPathIndex</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span><span class="p">.</span><span class="nx">priority</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">				<span class="k">continue</span> <span class="nx">walk</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Ê£ÄÊü•Ë∑Øpath‰∏ã‰∏Ä‰∏™Â≠óËäÇÁöÑÂ≠êËäÇÁÇπÊòØÂê¶Â≠òÂú®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// ÊØîÂ¶ÇsÁöÑÂ≠êËäÇÁÇπÁé∞Âú®ÊòØearchÂíåupportÔºåindices‰∏∫eu
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// Â¶ÇÊûúÊñ∞Âä†‰∏Ä‰∏™Ë∑ØÁî±‰∏∫superÔºåÈÇ£‰πàÂ∞±ÊòØÂíåupportÊúâÂåπÈÖçÁöÑÈÉ®ÂàÜuÔºåÂ∞ÜÁªßÁª≠ÂàÜÂàóÁé∞Âú®ÁöÑupportËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">max</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">indices</span><span class="p">);</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">c</span> <span class="o">==</span> <span class="nx">n</span><span class="p">.</span><span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">parentFullPathIndex</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="nx">i</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nf">incrementChildPrio</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">					<span class="k">continue</span> <span class="nx">walk</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Âê¶ÂàôÂ∞±ÊèíÂÖ•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">c</span> <span class="o">!=</span> <span class="sc">&#39;:&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">!=</span> <span class="sc">&#39;*&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// []byte for proper unicode char conversion, see #65
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// Ê≥®ÊÑèËøôÈáåÊòØÁõ¥Êé•ÊãºÊé•Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶Âà∞n.indices
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">n</span><span class="p">.</span><span class="nx">indices</span> <span class="o">+=</span> <span class="nb">string</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="nx">c</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">				<span class="nx">child</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">maxParams</span><span class="p">:</span> <span class="nx">numParams</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">fullPath</span><span class="p">:</span>  <span class="nx">fullPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// ËøΩÂä†Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="nx">child</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span><span class="p">.</span><span class="nf">incrementChildPrio</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">indices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span> <span class="p">=</span> <span class="nx">child</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nf">insertChild</span><span class="p">(</span><span class="nx">numParams</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">fullPath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Â∑≤ÁªèÊ≥®ÂÜåËøáÁöÑËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;handlers are already registered for path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">handlers</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂ÂÆû‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂæàÂ•ΩÁêÜËß£ÔºåÂ§ßÂÆ∂ÂèØ‰ª•ÂèÇÁÖßÂä®ÁîªÂ∞ùËØïÂ∞Ü‰ª•‰∏ãÊÉÖÂΩ¢‰ª£ÂÖ•‰∏äÈù¢ÁöÑ‰ª£Á†ÅÈÄªËæëÔºå‰ΩìÂë≥Êï¥‰∏™Ë∑ØÁî±Ê†ëÊûÑÈÄ†ÁöÑËØ¶ÁªÜËøáÁ®ãÔºö</p>
<ol>
<li>Á¨¨‰∏ÄÊ¨°Ê≥®ÂÜåË∑ØÁî±Ôºå‰æãÂ¶ÇÊ≥®ÂÜåsearch</li>
<li>ÁªßÁª≠Ê≥®ÂÜå‰∏ÄÊù°Ê≤°ÊúâÂÖ¨ÂÖ±ÂâçÁºÄÁöÑË∑ØÁî±Ôºå‰æãÂ¶Çblog</li>
<li>Ê≥®ÂÜå‰∏ÄÊù°‰∏éÂÖàÂâçÊ≥®ÂÜåÁöÑË∑ØÁî±ÊúâÂÖ¨ÂÖ±ÂâçÁºÄÁöÑË∑ØÁî±Ôºå‰æãÂ¶Çsupport</li>
</ol>
<p><img src="https://www.liwenzhou.com/images/Go/gin/addroute.gif"
	
	
	
	loading="lazy"
	
		alt="addroute"
	
	
></p>
<h4 id="insertchild">insertChild</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// tree.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">insertChild</span><span class="p">(</span><span class="nx">numParams</span> <span class="kt">uint8</span><span class="p">,</span> <span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">fullPath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="nx">HandlersChain</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ÊâæÂà∞ÊâÄÊúâÁöÑÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">numParams</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Êü•ÊâæÂâçÁºÄÁõ¥Âà∞Á¨¨‰∏Ä‰∏™ÈÄöÈÖçÁ¨¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">wildcard</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">valid</span> <span class="o">:=</span> <span class="nf">findWildcard</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">// Ê≤°ÊúâÂèëÁé∞ÈÄöÈÖçÁ¨¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// ÈÄöÈÖçÁ¨¶ÁöÑÂêçÁß∞ÂøÖÈ°ªÂåÖÂê´&#39;:&#39; Âíå &#39;*&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">!</span><span class="nx">valid</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;only one wildcard per path segment is allowed, has: &#39;&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">				<span class="nx">wildcard</span> <span class="o">+</span> <span class="s">&#34;&#39; in path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Ê£ÄÊü•ÈÄöÈÖçÁ¨¶ÊòØÂê¶ÊúâÂêçÁß∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wildcard</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;wildcards must be named with a non-empty name in path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Ê£ÄÊü•Ëøô‰∏™ËäÇÁÇπÊòØÂê¶ÊúâÂ∑≤ÁªèÂ≠òÂú®ÁöÑÂ≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Â¶ÇÊûúÊàë‰ª¨Âú®ËøôÈáåÊèíÂÖ•ÈÄöÈÖçÁ¨¶ÔºåËøô‰∫õÂ≠êËäÇÁÇπÂ∞ÜÊó†Ê≥ïËÆøÈóÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;wildcard segment &#39;&#34;</span> <span class="o">+</span> <span class="nx">wildcard</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">				<span class="s">&#34;&#39; conflicts with existing children in path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">wildcard</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;:&#39;</span> <span class="p">{</span> <span class="c1">// param
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Âú®ÂΩìÂâçÈÄöÈÖçÁ¨¶‰πãÂâçÊèíÂÖ•ÂâçÁºÄ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[:</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">wildChild</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">			<span class="nx">child</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">nType</span><span class="p">:</span>     <span class="nx">param</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">path</span><span class="p">:</span>      <span class="nx">wildcard</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">maxParams</span><span class="p">:</span> <span class="nx">numParams</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="nx">fullPath</span><span class="p">:</span>  <span class="nx">fullPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span><span class="p">{</span><span class="nx">child</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span> <span class="p">=</span> <span class="nx">child</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">priority</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">			<span class="nx">numParams</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Â¶ÇÊûúË∑ØÂæÑÊ≤°Êúâ‰ª•ÈÄöÈÖçÁ¨¶ÁªìÊùü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// ÈÇ£‰πàÂ∞ÜÊúâÂè¶‰∏Ä‰∏™‰ª•&#39;/&#39;ÂºÄÂßãÁöÑÈùûÈÄöÈÖçÁ¨¶Â≠êË∑ØÂæÑ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">wildcard</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">wildcard</span><span class="p">):]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="nx">child</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">maxParams</span><span class="p">:</span> <span class="nx">numParams</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">priority</span><span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">fullPath</span><span class="p">:</span>  <span class="nx">fullPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span><span class="p">{</span><span class="nx">child</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">n</span> <span class="p">=</span> <span class="nx">child</span>  <span class="c1">// ÁªßÁª≠‰∏ã‰∏ÄËΩÆÂæ™ÁéØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">continue</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Âê¶ÂàôÊàë‰ª¨Â∞±ÂÆåÊàê‰∫Ü„ÄÇÂ∞ÜÂ§ÑÁêÜÂáΩÊï∞ÊèíÂÖ•Êñ∞Âè∂Â≠ê‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">handlers</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// catchAll
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="nx">wildcard</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">||</span> <span class="nx">numParams</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;catch-all routes are only allowed at the end of the path in path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;catch-all conflicts with existing handle for the path segment root in path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// currently fixed width 1 for &#39;/&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">i</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;/&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;no / before catch-all in path &#39;&#34;</span> <span class="o">+</span> <span class="nx">fullPath</span> <span class="o">+</span> <span class="s">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[:</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="c1">// Á¨¨‰∏Ä‰∏™ËäÇÁÇπ:Ë∑ØÂæÑ‰∏∫Á©∫ÁöÑcatchAllËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">child</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">wildChild</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">nType</span><span class="p">:</span>     <span class="nx">catchAll</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">maxParams</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fullPath</span><span class="p">:</span>  <span class="nx">fullPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Êõ¥Êñ∞Áà∂ËäÇÁÇπÁöÑmaxParams
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span><span class="p">{</span><span class="nx">child</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">indices</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="sc">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span> <span class="p">=</span> <span class="nx">child</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">priority</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Á¨¨‰∫å‰∏™ËäÇÁÇπ:‰øùÂ≠òÂèòÈáèÁöÑËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">child</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">path</span><span class="p">:</span>      <span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="p">:],</span>
</span></span><span class="line"><span class="cl">			<span class="nx">nType</span><span class="p">:</span>     <span class="nx">catchAll</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">maxParams</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">handlers</span><span class="p">:</span>  <span class="nx">handlers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">priority</span><span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fullPath</span><span class="p">:</span>  <span class="nx">fullPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span><span class="p">{</span><span class="nx">child</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÈÄöÈÖçÁ¨¶ÔºåÂè™ÈúÄÊèíÂÖ•Ë∑ØÂæÑÂíåÂè•ÊüÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">handlers</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">fullPath</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>insertChild</code>ÂáΩÊï∞ÊòØÊ†πÊçÆ<code>path</code>Êú¨Ë∫´ËøõË°åÂàÜÂâ≤ÔºåÂ∞Ü<code>/</code>ÂàÜÂºÄÁöÑÈÉ®ÂàÜÂàÜÂà´‰Ωú‰∏∫ËäÇÁÇπ‰øùÂ≠òÔºåÂΩ¢Êàê‰∏ÄÊ£µÊ†ëÁªìÊûÑ„ÄÇÂèÇÊï∞ÂåπÈÖç‰∏≠ÁöÑ<code>:</code>Âíå<code>*</code>ÁöÑÂå∫Âà´ÊòØÔºåÂâçËÄÖÊòØÂåπÈÖç‰∏Ä‰∏™Â≠óÊÆµËÄåÂêéËÄÖÊòØÂåπÈÖçÂêéÈù¢ÊâÄÊúâÁöÑË∑ØÂæÑ„ÄÇ</p>
<h3 id="Ë∑ØÁî±ÂåπÈÖç">Ë∑ØÁî±ÂåπÈÖç</h3>
<p>Êàë‰ª¨ÂÖàÊù•ÁúãginÊ°ÜÊû∂Â§ÑÁêÜËØ∑Ê±ÇÁöÑÂÖ•Âè£ÂáΩÊï∞<code>ServeHTTP</code>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// gin.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ËøôÈáå‰ΩøÁî®‰∫ÜÂØπË±°Ê±†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span> <span class="o">:=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nf">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">Context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ËøôÈáåÊúâ‰∏Ä‰∏™ÁªÜËäÇÂ∞±ÊòØGetÂØπË±°ÂêéÂÅöÂàùÂßãÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span><span class="p">.</span><span class="nx">writermem</span><span class="p">.</span><span class="nf">reset</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">Request</span> <span class="p">=</span> <span class="nx">req</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nf">handleHTTPRequest</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>  <span class="c1">// Êàë‰ª¨Ë¶ÅÊâæÁöÑÂ§ÑÁêÜHTTPËØ∑Ê±ÇÁöÑÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>  <span class="c1">// Â§ÑÁêÜÂÆåËØ∑Ê±ÇÂêéÂ∞ÜÂØπË±°ÊîæÂõûÊ±†Â≠ê
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂáΩÊï∞ÂæàÈïøÔºåËøôÈáåÁúÅÁï•‰∫ÜÈÉ®ÂàÜ‰ª£Á†ÅÔºåÂè™‰øùÁïôÁõ∏ÂÖ≥ÈÄªËæë‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// gin.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">handleHTTPRequest</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// liwenzhou.com...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Ê†πÊçÆËØ∑Ê±ÇÊñπÊ≥ïÊâæÂà∞ÂØπÂ∫îÁöÑË∑ØÁî±Ê†ë
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">t</span> <span class="o">:=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">trees</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">tl</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">tl</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">t</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">method</span> <span class="o">!=</span> <span class="nx">httpMethod</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">continue</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">root</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">root</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Âú®Ë∑ØÁî±Ê†ë‰∏≠Ê†πÊçÆpathÊü•Êâæ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">value</span> <span class="o">:=</span> <span class="nx">root</span><span class="p">.</span><span class="nf">getValue</span><span class="p">(</span><span class="nx">rPath</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Params</span><span class="p">,</span> <span class="nx">unescape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nx">Params</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">params</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">fullPath</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>  <span class="c1">// ÊâßË°åÂáΩÊï∞ÈìæÊù°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">c</span><span class="p">.</span><span class="nx">writermem</span><span class="p">.</span><span class="nf">WriteHeaderNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// liwenzhou.com...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">allNoRoute</span>
</span></span><span class="line"><span class="cl">	<span class="nf">serveError</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span> <span class="nx">default404Body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ë∑ØÁî±ÂåπÈÖçÊòØÁî±ËäÇÁÇπÁöÑ <code>getValue</code>ÊñπÊ≥ïÂÆûÁé∞ÁöÑ„ÄÇ<code>getValue</code>Ê†πÊçÆÁªôÂÆöÁöÑË∑ØÂæÑ(ÈîÆ)ËøîÂõû<code>nodeValue</code>ÂÄºÔºå‰øùÂ≠òÊ≥®ÂÜåÁöÑÂ§ÑÁêÜÂáΩÊï∞ÂíåÂåπÈÖçÂà∞ÁöÑË∑ØÂæÑÂèÇÊï∞Êï∞ÊçÆ„ÄÇ</p>
<p>Â¶ÇÊûúÊâæ‰∏çÂà∞‰ªª‰ΩïÂ§ÑÁêÜÂáΩÊï∞ÔºåÂàô‰ºöÂ∞ùËØïTSR(Â∞æÈöèÊñúÊù†ÈáçÂÆöÂêë)„ÄÇ</p>
<p>‰ª£Á†ÅËôΩÁÑ∂ÂæàÈïøÔºå‰ΩÜËøòÁÆóÊØîËæÉÂ∑•Êï¥„ÄÇÂ§ßÂÆ∂ÂèØ‰ª•ÂÄüÂä©Ê≥®ÈáäÁúã‰∏Ä‰∏ãË∑ØÁî±Êü•ÊâæÂèäÂèÇÊï∞ÂåπÈÖçÁöÑÈÄªËæë„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// tree.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">nodeValue</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">handlers</span> <span class="nx">HandlersChain</span>
</span></span><span class="line"><span class="cl">	<span class="nx">params</span>   <span class="nx">Params</span>  <span class="c1">// []Param
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tsr</span>      <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fullPath</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// liwenzhou.com...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">getValue</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">po</span> <span class="nx">Params</span><span class="p">,</span> <span class="nx">unescape</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">value</span> <span class="nx">nodeValue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">value</span><span class="p">.</span><span class="nx">params</span> <span class="p">=</span> <span class="nx">po</span>
</span></span><span class="line"><span class="cl"><span class="nx">walk</span><span class="p">:</span> <span class="c1">// Outer loop for walking the tree
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">prefix</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">path</span> <span class="o">==</span> <span class="nx">prefix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// Êàë‰ª¨Â∫îËØ•Â∑≤ÁªèÂà∞ËææÂåÖÂê´Â§ÑÁêÜÂáΩÊï∞ÁöÑËäÇÁÇπ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// Ê£ÄÊü•ËØ•ËäÇÁÇπÊòØÂê¶Ê≥®ÂÜåÊúâÂ§ÑÁêÜÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span><span class="p">;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">value</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">fullPath</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">wildChild</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nType</span> <span class="o">!=</span> <span class="nx">root</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">value</span><span class="p">.</span><span class="nx">tsr</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Ê≤°ÊúâÊâæÂà∞Â§ÑÁêÜÂáΩÊï∞ Ê£ÄÊü•Ëøô‰∏™Ë∑ØÂæÑÊú´Â∞æ+/ ÊòØÂê¶Â≠òÂú®Ê≥®ÂÜåÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">indices</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">indices</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">max</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">indices</span><span class="p">);</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">tsr</span> <span class="p">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">						<span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">nType</span> <span class="o">==</span> <span class="nx">catchAll</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)]</span> <span class="o">==</span> <span class="nx">prefix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">prefix</span><span class="p">):]</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// Â¶ÇÊûúËØ•ËäÇÁÇπÊ≤°ÊúâÈÄöÈÖçÁ¨¶(paramÊàñcatchAll)Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// Êàë‰ª¨ÂèØ‰ª•ÁªßÁª≠Êü•Êâæ‰∏ã‰∏Ä‰∏™Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">!</span><span class="nx">n</span><span class="p">.</span><span class="nx">wildChild</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">c</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="nx">indices</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">indices</span>
</span></span><span class="line"><span class="cl">				<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">max</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">indices</span><span class="p">);</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nx">c</span> <span class="o">==</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="c1">// ÈÅçÂéÜÊ†ë
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>						<span class="k">continue</span> <span class="nx">walk</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// Ê≤°ÊâæÂà∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// Â¶ÇÊûúÂ≠òÂú®‰∏Ä‰∏™Áõ∏ÂêåÁöÑURL‰ΩÜÊ≤°ÊúâÊú´Â∞æ/ÁöÑÂè∂Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// Êàë‰ª¨ÂèØ‰ª•Âª∫ËÆÆÈáçÂÆöÂêëÂà∞ÈÇ£Èáå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">value</span><span class="p">.</span><span class="nx">tsr</span> <span class="p">=</span> <span class="nx">path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Ê†πÊçÆËäÇÁÇπÁ±ªÂûãÂ§ÑÁêÜÈÄöÈÖçÁ¨¶Â≠êËäÇÁÇπ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="k">switch</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="nx">param</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// find param end (either &#39;/&#39; or path end)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">end</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">				<span class="k">for</span> <span class="nx">end</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span><span class="p">[</span><span class="nx">end</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;/&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">end</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// ‰øùÂ≠òÈÄöÈÖçÁ¨¶ÁöÑÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">params</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">Params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">i</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">value</span><span class="p">.</span><span class="nx">params</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[:</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1">// Âú®È¢ÑÂÖàÂàÜÈÖçÁöÑÂÆπÈáèÂÜÖÊâ©Â±ïslice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Key</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">				<span class="nx">val</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">[:</span><span class="nx">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">unescape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Value</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">QueryUnescape</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Value</span> <span class="p">=</span> <span class="nx">val</span> <span class="c1">// fallback, in case of error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Value</span> <span class="p">=</span> <span class="nx">val</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// ÁªßÁª≠Âêë‰∏ãÊü•ËØ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="nx">end</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="nx">end</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">						<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">						<span class="k">continue</span> <span class="nx">walk</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="c1">// ... but we can&#39;t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">value</span><span class="p">.</span><span class="nx">tsr</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">==</span> <span class="nx">end</span><span class="o">+</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span><span class="p">;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">fullPath</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// Ê≤°ÊúâÊâæÂà∞Â§ÑÁêÜÂáΩÊï∞. Ê£ÄÊü•Ê≠§Ë∑ØÂæÑÊú´Â∞æÂä†/ÁöÑË∑ØÁî±ÊòØÂê¶Â≠òÂú®Ê≥®ÂÜåÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="c1">// Áî®‰∫é TSR Êé®Ëçê
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">n</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">tsr</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="nx">catchAll</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// ‰øùÂ≠òÈÄöÈÖçÁ¨¶ÁöÑÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">params</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">Params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">maxParams</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">i</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">value</span><span class="p">.</span><span class="nx">params</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[:</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1">// Âú®È¢ÑÂÖàÂàÜÈÖçÁöÑÂÆπÈáèÂÜÖÊâ©Â±ïslice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Key</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">path</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">unescape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Value</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">QueryUnescape</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Value</span> <span class="p">=</span> <span class="nx">path</span> <span class="c1">// fallback, in case of error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">value</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Value</span> <span class="p">=</span> <span class="nx">path</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span>
</span></span><span class="line"><span class="cl">				<span class="nx">value</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">fullPath</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;invalid node type&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Êâæ‰∏çÂà∞ÔºåÂ¶ÇÊûúÂ≠òÂú®‰∏Ä‰∏™Âú®ÂΩìÂâçË∑ØÂæÑÊúÄÂêéÊ∑ªÂä†/ÁöÑË∑ØÁî±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// Êàë‰ª¨‰ºöÂª∫ËÆÆÈáçÂÆöÂêëÂà∞ÈÇ£Èáå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">value</span><span class="p">.</span><span class="nx">tsr</span> <span class="p">=</span> <span class="p">(</span><span class="nx">path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">prefix</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">				<span class="nx">path</span> <span class="o">==</span> <span class="nx">prefix</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ginÊ°ÜÊû∂‰∏≠Èó¥‰ª∂ËØ¶Ëß£">ginÊ°ÜÊû∂‰∏≠Èó¥‰ª∂ËØ¶Ëß£</h2>
<p>ginÊ°ÜÊû∂Ê∂âÂèä‰∏≠Èó¥‰ª∂Áõ∏ÂÖ≥Êúâ4‰∏™Â∏∏Áî®ÁöÑÊñπÊ≥ïÔºåÂÆÉ‰ª¨ÂàÜÂà´ÊòØ<code>c.Next()</code>„ÄÅ<code>c.Abort()</code>„ÄÅ<code>c.Set()</code>„ÄÅ<code>c.Get()</code>„ÄÇ</p>
<h3 id="‰∏≠Èó¥‰ª∂ÁöÑÊ≥®ÂÜå">‰∏≠Èó¥‰ª∂ÁöÑÊ≥®ÂÜå</h3>
<p>ginÊ°ÜÊû∂‰∏≠ÁöÑ‰∏≠Èó¥‰ª∂ËÆæËÆ°ÂæàÂ∑ßÂ¶ôÔºåÊàë‰ª¨ÂèØ‰ª•È¶ñÂÖà‰ªéÊàë‰ª¨ÊúÄÂ∏∏Áî®ÁöÑ<code>r := gin.Default()</code>ÁöÑ<code>Default</code>ÂáΩÊï∞ÂºÄÂßãÁúãÔºåÂÆÉÂÜÖÈÉ®ÊûÑÈÄ†‰∏Ä‰∏™Êñ∞ÁöÑ<code>engine</code>‰πãÂêéÂ∞±ÈÄöËøá<code>Use()</code>ÂáΩÊï∞Ê≥®ÂÜå‰∫Ü<code>Logger</code>‰∏≠Èó¥‰ª∂Âíå<code>Recovery</code>‰∏≠Èó¥‰ª∂Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Default</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">debugPrintWARNINGDefault</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span> <span class="o">:=</span> <span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">Logger</span><span class="p">(),</span> <span class="nf">Recovery</span><span class="p">())</span>  <span class="c1">// ÈªòËÆ§Ê≥®ÂÜåÁöÑ‰∏§‰∏™‰∏≠Èó¥‰ª∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nx">engine</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªßÁª≠ÂæÄ‰∏ãÊü•Áúã‰∏Ä‰∏ã<code>Use()</code>ÂáΩÊï∞ÁöÑ‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">Use</span><span class="p">(</span><span class="nx">middleware</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">middleware</span><span class="o">...</span><span class="p">)</span>  <span class="c1">// ÂÆûÈôÖ‰∏äËøòÊòØË∞ÉÁî®ÁöÑRouterGroupÁöÑUseÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">engine</span><span class="p">.</span><span class="nf">rebuild404Handlers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nf">rebuild405Handlers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">engine</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏ãÊñπÁöÑ‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫ÔºåÊ≥®ÂÜå‰∏≠Èó¥‰ª∂ÂÖ∂ÂÆûÂ∞±ÊòØÂ∞Ü‰∏≠Èó¥‰ª∂ÂáΩÊï∞ËøΩÂä†Âà∞<code>group.Handlers</code>‰∏≠Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Use</span><span class="p">(</span><span class="nx">middleware</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">group</span><span class="p">.</span><span class="nx">Handlers</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">Handlers</span><span class="p">,</span> <span class="nx">middleware</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">returnObj</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËÄåÊàë‰ª¨Ê≥®ÂÜåË∑ØÁî±Êó∂‰ºöÂ∞ÜÂØπÂ∫îË∑ØÁî±ÁöÑÂáΩÊï∞Âíå‰πãÂâçÁöÑ‰∏≠Èó¥‰ª∂ÂáΩÊï∞ÁªìÂêàÂà∞‰∏ÄËµ∑Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">,</span> <span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="nx">HandlersChain</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">absolutePath</span> <span class="o">:=</span> <span class="nx">group</span><span class="p">.</span><span class="nf">calculateAbsolutePath</span><span class="p">(</span><span class="nx">relativePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">handlers</span> <span class="p">=</span> <span class="nx">group</span><span class="p">.</span><span class="nf">combineHandlers</span><span class="p">(</span><span class="nx">handlers</span><span class="p">)</span>  <span class="c1">// Â∞ÜÂ§ÑÁêÜËØ∑Ê±ÇÁöÑÂáΩÊï∞‰∏é‰∏≠Èó¥‰ª∂ÂáΩÊï∞ÁªìÂêà
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">group</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">,</span> <span class="nx">absolutePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">returnObj</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠ÁªìÂêàÊìç‰ΩúÁöÑÂáΩÊï∞ÂÜÖÂÆπÂ¶Ç‰∏ãÔºåÊ≥®ÊÑèËßÇÂØüËøôÈáåÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÊãºÊé•‰∏§‰∏™ÂàáÁâáÂæóÂà∞‰∏Ä‰∏™Êñ∞ÂàáÁâáÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">abortIndex</span> <span class="kt">int8</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">MaxInt8</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">combineHandlers</span><span class="p">(</span><span class="nx">handlers</span> <span class="nx">HandlersChain</span><span class="p">)</span> <span class="nx">HandlersChain</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">finalSize</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">Handlers</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">finalSize</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">abortIndex</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// ËøôÈáåÊúâ‰∏Ä‰∏™ÊúÄÂ§ßÈôêÂà∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;too many handlers&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mergedHandlers</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">HandlersChain</span><span class="p">,</span> <span class="nx">finalSize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nb">copy</span><span class="p">(</span><span class="nx">mergedHandlers</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">Handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nb">copy</span><span class="p">(</span><span class="nx">mergedHandlers</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">Handlers</span><span class="p">):],</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">mergedHandlers</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰πüÂ∞±ÊòØËØ¥ÔºåÊàë‰ª¨‰ºöÂ∞Ü‰∏Ä‰∏™Ë∑ØÁî±ÁöÑ‰∏≠Èó¥‰ª∂ÂáΩÊï∞ÂíåÂ§ÑÁêÜÂáΩÊï∞ÁªìÂêàÂà∞‰∏ÄËµ∑ÁªÑÊàê‰∏ÄÊù°Â§ÑÁêÜÂáΩÊï∞ÈìæÊù°<code>HandlersChain</code>ÔºåËÄåÂÆÉÊú¨Ë¥®‰∏äÂ∞±ÊòØ‰∏Ä‰∏™Áî±<code>HandlerFunc</code>ÁªÑÊàêÁöÑÂàáÁâáÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">HandlersChain</span> <span class="p">[]</span><span class="nx">HandlerFunc</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∏≠Èó¥‰ª∂ÁöÑÊâßË°å">‰∏≠Èó¥‰ª∂ÁöÑÊâßË°å</h3>
<p>Êàë‰ª¨Âú®‰∏äÈù¢Ë∑ØÁî±ÂåπÈÖçÁöÑÊó∂ÂÄôËßÅËøáÂ¶Ç‰∏ãÈÄªËæëÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">value</span> <span class="o">:=</span> <span class="nx">root</span><span class="p">.</span><span class="nf">getValue</span><span class="p">(</span><span class="nx">rPath</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Params</span><span class="p">,</span> <span class="nx">unescape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">handlers</span>
</span></span><span class="line"><span class="cl">  <span class="nx">c</span><span class="p">.</span><span class="nx">Params</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">params</span>
</span></span><span class="line"><span class="cl">  <span class="nx">c</span><span class="p">.</span><span class="nx">fullPath</span> <span class="p">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">fullPath</span>
</span></span><span class="line"><span class="cl">  <span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>  <span class="c1">// ÊâßË°åÂáΩÊï∞ÈìæÊù°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">c</span><span class="p">.</span><span class="nx">writermem</span><span class="p">.</span><span class="nf">WriteHeaderNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠<code>c.Next()</code>Â∞±ÊòØÂæàÂÖ≥ÈîÆÁöÑ‰∏ÄÊ≠•ÔºåÂÆÉÁöÑ‰ª£Á†ÅÂæàÁÆÄÂçïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">c</span><span class="p">.</span><span class="nx">index</span> <span class="p">&lt;</span> <span class="nb">int8</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">index</span><span class="p">](</span><span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂèØ‰ª•ÁúãÂà∞ÔºåËøôÈáåÈÄöËøáÁ¥¢ÂºïÈÅçÂéÜ<code>HandlersChain</code>ÈìæÊù°Ôºå‰ªéËÄåÂÆûÁé∞‰æùÊ¨°Ë∞ÉÁî®ËØ•Ë∑ØÁî±ÁöÑÊØè‰∏Ä‰∏™ÂáΩÊï∞Ôºà‰∏≠Èó¥‰ª∂ÊàñÂ§ÑÁêÜËØ∑Ê±ÇÁöÑÂáΩÊï∞Ôºâ„ÄÇ</p>
<p><img src="https://www.liwenzhou.com/images/Go/gin/gin_middleware1.png"
	
	
	
	loading="lazy"
	
		alt="gin_middleware1"
	
	
></p>
<p>Êàë‰ª¨ÂèØ‰ª•Âú®‰∏≠Èó¥‰ª∂ÂáΩÊï∞‰∏≠ÈÄöËøáÂÜçÊ¨°Ë∞ÉÁî®<code>c.Next()</code>ÂÆûÁé∞ÂµåÂ•óË∞ÉÁî®Ôºàfunc1‰∏≠Ë∞ÉÁî®func2Ôºõfunc2‰∏≠Ë∞ÉÁî®func3ÔºâÔºå</p>
<p><img src="https://www.liwenzhou.com/images/Go/gin/gin_middleware2.png"
	
	
	
	loading="lazy"
	
		alt="gin_middleware2"
	
	
></p>
<p>ÊàñËÄÖÈÄöËøáË∞ÉÁî®<code>c.Abort()</code>‰∏≠Êñ≠Êï¥‰∏™Ë∞ÉÁî®ÈìæÊù°Ôºå‰ªéÂΩìÂâçÂáΩÊï∞ËøîÂõû„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Abort</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nx">index</span> <span class="p">=</span> <span class="nx">abortIndex</span>  <span class="c1">// Áõ¥Êé•Â∞ÜÁ¥¢ÂºïÁΩÆ‰∏∫ÊúÄÂ§ßÈôêÂà∂ÂÄºÔºå‰ªéËÄåÈÄÄÂá∫Âæ™ÁéØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="csetcget">c.Set()/c.Get()</h3>
<p><code>c.Set()</code>Âíå<code>c.Get()</code>Ëøô‰∏§‰∏™ÊñπÊ≥ïÂ§öÁî®‰∫éÂú®Â§ö‰∏™ÂáΩÊï∞‰πãÈó¥ÈÄöËøá<code>c</code>‰º†ÈÄíÊï∞ÊçÆÁöÑÔºåÊØîÂ¶ÇÊàë‰ª¨ÂèØ‰ª•Âú®ËÆ§ËØÅ‰∏≠Èó¥‰ª∂‰∏≠Ëé∑ÂèñÂΩìÂâçËØ∑Ê±ÇÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºàuserIDÁ≠âÔºâÈÄöËøá<code>c.Set()</code>Â≠òÂÖ•<code>c</code>ÔºåÁÑ∂ÂêéÂú®ÂêéÁª≠Â§ÑÁêÜ‰∏öÂä°ÈÄªËæëÁöÑÂáΩÊï∞‰∏≠ÈÄöËøá<code>c.Get()</code>Êù•Ëé∑ÂèñÂΩìÂâçËØ∑Ê±ÇÁöÑÁî®Êà∑„ÄÇ<code>c</code>Â∞±ÂÉèÊòØ‰∏ÄÊ†πÁª≥Â≠êÔºåÂ∞ÜËØ•Ê¨°ËØ∑Ê±ÇÁõ∏ÂÖ≥ÁöÑÊâÄÊúâÁöÑÂáΩÊï∞ÈÉΩ‰∏≤Ëµ∑Êù•‰∫Ü„ÄÇ<img src="https://www.liwenzhou.com/images/Go/gin/gin_middleware3.png"
	
	
	
	loading="lazy"
	
		alt="gin_middleware3"
	
	
></p>
<h2 id="ÊÄªÁªì">ÊÄªÁªì</h2>
<ol>
<li>ginÊ°ÜÊû∂Ë∑ØÁî±‰ΩøÁî®ÂâçÁºÄÊ†ëÔºåË∑ØÁî±Ê≥®ÂÜåÁöÑËøáÁ®ãÊòØÊûÑÈÄ†ÂâçÁºÄÊ†ëÁöÑËøáÁ®ãÔºåË∑ØÁî±ÂåπÈÖçÁöÑËøáÁ®ãÂ∞±ÊòØÊü•ÊâæÂâçÁºÄÊ†ëÁöÑËøáÁ®ã„ÄÇ</li>
<li>ginÊ°ÜÊû∂ÁöÑ‰∏≠Èó¥‰ª∂ÂáΩÊï∞ÂíåÂ§ÑÁêÜÂáΩÊï∞ÊòØ‰ª•ÂàáÁâáÂΩ¢ÂºèÁöÑË∞ÉÁî®ÈìæÊù°Â≠òÂú®ÁöÑÔºåÊàë‰ª¨ÂèØ‰ª•È°∫Â∫èË∞ÉÁî®‰πüÂèØ‰ª•ÂÄüÂä©<code>c.Next()</code>ÊñπÊ≥ïÂÆûÁé∞ÂµåÂ•óË∞ÉÁî®„ÄÇ</li>
<li>ÂÄüÂä©<code>c.Set()</code>Âíå<code>c.Get()</code>ÊñπÊ≥ïÊàë‰ª¨ËÉΩÂ§üÂú®‰∏çÂêåÁöÑ‰∏≠Èó¥‰ª∂ÂáΩÊï∞‰∏≠‰º†ÈÄíÊï∞ÊçÆ„ÄÇ</li>
</ol>
<h2 id="ginËøûÊé•mysql">GinËøûÊé•mysql</h2>
<p>È©±Âä®‰æùËµñ</p>
<blockquote>
<p>go get -u github.com/go-sql-driver/mysql</p>
</blockquote>
<p>Â¶Ç‰Ωï‰ΩøÁî®</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324201208661.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324201208661"
	
	
></p>
<blockquote>
<p>ÈáåÈù¢ÁöÑuser passwordÂèØÊîπ</p>
</blockquote>
<p>Ê≥®ÊÑèdeferÂæóÂç∏ËΩΩerrÁöÑ‰∏ãÈù¢Ôºå‰∏çÂèØ‰ª•ÂÜôÊàêËøôÊ†∑</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324201440212.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324201440212"
	
	
></p>
<blockquote>
<p>‰∏∫‰ªÄ‰πà‰∏çËÉΩÂÜôÂú®Ëøô‰∏™‰ΩçÁΩÆÔºü</p>
<p>Âõ†‰∏∫Â¶ÇÊûúÂá∫Èîô‰∫ÜÔºåÊàë‰ª¨Ëé∑ÂæóÁöÑopen‰ºöÊòØ‰∏Ä‰∏™nilÔºåÂú®ÊúÄÂêéË∞ÉÁî®‰ªñÁöÑcloseÔºå‰ºöÂá∫Áé∞Á©∫ÊåáÈíàÂºÇÂ∏∏„ÄÇ</p>
<p>ÊâÄ‰ª•Êàë‰ª¨Â∫îËØ•Âú®Âà§Êñ≠ÂΩìerr == nilÊâçÂéªÂÖ≥Èó≠Êï∞ÊçÆÂ∫ì„ÄÇ</p>
</blockquote>
<p>OpenÂáΩÊï∞ÂÆûÈôÖ‰∏äÂè™ÊòØÈ™åËØÅdsnÂèÇÊï∞ÊòØÂê¶Ê≠£Á°ÆÔºåÂπ∂‰∏çÊòØÁúüÊ≠£ÂíåÊï∞ÊçÆÂ∫ìËøûÊé•„ÄÇÂ¶ÇÊûúË¶ÅÊ£ÄÊü•Êï∞ÊçÆÊ∫êÁöÑÂêçÂ≠óÊòØÂê¶ÊúâÊïàÔºåÂ∫îËØ•Ë∞ÉÁî®pingÊñπÊ≥ï„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324203221687.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324203221687"
	
	
></p>
<p>ÂΩìÁÑ∂‰∏ÄËà¨‰∏çÂèØËÉΩÂÜôÂú®mainÂáΩÊï∞ÈáåÈù¢Ôºå‰∏ÄËà¨Â∫îËØ•‰ΩøÊ®°ÂùóÂåñÁöÑÊìç‰Ωú„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">import</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;database/sql&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">_</span> <span class="s">&#34;github.com/go-sql-driver/mysql&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">var</span> <span class="n">db</span> <span class="o">*</span><span class="n">sql</span><span class="o">.</span><span class="na">DB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ËøôÈáåÁî®‰∫Ü‰∏Ä‰∏™ÂåøÂêçÂèÇÊï∞ÔºåÊàë‰ª¨ÂèØ‰ª•‰∏çÁî®Âú®ÂáΩÊï∞‰∏≠Â£∞ÊòéerrÔºå‰ΩÜÊòØ‰ºöËá™Â∑±ËøîÂõûËøô‰∏™errÂèÇÊï∞„ÄÇÈùûÂ∏∏ÁöÑ‰ºòÈõÖ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">func</span> <span class="nf">initMysql</span><span class="o">()</span> <span class="o">(</span><span class="n">err</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">dsn</span> <span class="o">:=</span> <span class="s">&#34;root:abc123456@tcp(127.0.0.1:3306)/go&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">db</span><span class="o">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="na">Open</span><span class="o">(</span><span class="s">&#34;mysql&#34;</span><span class="o">,</span> <span class="n">dsn</span><span class="o">)</span> <span class="c1">//ËøôÈáåÂ∞±‰∏çËÉΩÁî® := Âõ†‰∏∫dbÊòØÂÖ¨ÂÖ±ÂèòÈáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">panic</span><span class="o">(</span><span class="n">err</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">err</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">Ping</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">fmt</span><span class="o">.</span><span class="na">Printf</span><span class="o">(</span><span class="s">&#34;connect fail , err : %v\n&#34;</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">panic</span><span class="o">(</span><span class="n">err</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">fmt</span><span class="o">.</span><span class="na">Printf</span><span class="o">(</span><span class="s">&#34;connect successful&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">func</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">initMysql</span><span class="o">();</span><span class="n">err</span><span class="o">!=</span><span class="n">nil</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">fmt</span><span class="o">.</span><span class="na">Printf</span><span class="o">(</span><span class="s">&#34;connect fail&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">defer</span> <span class="n">db</span><span class="o">.</span><span class="na">Close</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>‰∏§‰∏™Â∏∏Áî®ÈÖçÁΩÆ</p>
<p>SetMaxOpenCoons()	ËÆæÁΩÆÂíåmysqlÁöÑÊúÄÂ§ßËøûÊé•Êï∞</p>
<p>SetMaxIdleCoons()	ËÆæÁΩÆËøûÊé•Ê±†ÁöÑÊúÄÂ§ßÁ©∫Èó≤ËøûÊé•Êï∞</p>
</blockquote>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324204908119.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324204908119"
	
	
></p>
<h3 id="ÊµÖÊµÖÁöÑÁ†îÁ©∂‰∏Ä‰∏ãÊ∫êÁ†Å">ÊµÖÊµÖÁöÑÁ†îÁ©∂‰∏Ä‰∏ãÊ∫êÁ†Å</h3>
<blockquote>
<p>Áúã‰∏ÄÁúãÈ©±Âä®ÈáåÈù¢ÁöÑÊ∫êÁ†Å</p>
</blockquote>
<p>initÊñπÊ≥ï</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324211541736.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324211541736"
	
	
></p>
<p>ÁÇπËøõÂéªRegist</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324211653993.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324211653993"
	
	
></p>
<p>Ê≠§Êó∂ÂèØ‰ª•ÂèëÁé∞ÊòØË∑≥Âà∞‰∫ÜÂÜÖÁΩÆÁöÑÊ†áÂáÜÂ∫ìdatabaseÈáåÈù¢</p>
<p>Âú®Ê∫êÁ†Å‰∏≠ÔºåregistÁöÑÊòØmap‰∏≠ÁöÑÂÄºÔºåÊØîÂ¶Çmap[&ldquo;mysql&rdquo;] = È©±Âä®</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324213141955.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324213141955"
	
	
></p>
<p>Áúã‰∏ÄÁúãopenÂáΩÊï∞ÈáåÂÅö‰∫Ü‰ªÄ‰πà‰∫ãÊÉÖ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324214642804.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324214642804"
	
	
></p>
<p>ÂèØ‰ª•ÂèëÁé∞Êàë‰ª¨ÊòØË∞ÉÁî®ÁöÑopenDBÂáΩÊï∞ÔºåËøîÂõûÁöÑ‰∏Ä‰∏™DBÔºåÊúâ‰∏Ä‰∫õÂü∫Êú¨‰ø°ÊÅØ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220324214723014.png"
	
	
	
	loading="lazy"
	
		alt="image-20220324214723014"
	
	
></p>
<p>Êàë‰ª¨ÁöÑÁî®Êà∑ÂêçÔºåÂØÜÁ†ÅÈÉΩÂú®cÈáåÈù¢</p>
<h3 id="Â¢ûÂà†ÊîπÊü•">Â¢ûÂà†ÊîπÊü•</h3>
<h4 id="queryrowÊü•ËØ¢‰∏ÄÂàó">queryRowÔºàÊü•ËØ¢‰∏ÄÂàóÔºâ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">queryRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;select id,name,age from test_user where id = ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">u</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">QueryRow</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;scan failed , err : %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;id: %v,name: %v,age: %v&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôËæπÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåÂú®Ë∞ÉÁî®‰∫ÜqueryRow‰πãÂêé‰∏ÄÂÆöË¶ÅË∞ÉÁî®scanÔºå‰∏çÁÑ∂‰∏ç‰ºöÈáäÊîæËøûÊé•„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220325130016360.png"
	
	
	
	loading="lazy"
	
		alt="image-20220325130016360"
	
	
></p>
<h4 id="queryÊü•ËØ¢Â§öË°å">queryÔºàÊü•ËØ¢Â§öË°åÔºâ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">queryMultiRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;select id,name,age from test_user where id &gt; ? &#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">query</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;query failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span><span class="c1">//ËøôÈáåÈúÄË¶ÅÂÖ≥Èó≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">u</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;scan failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;id: %d,name: %s,age: %d\n&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>‰∏∫‰ªÄ‰πàÂú®‰∏≠Èó¥ÈúÄË¶ÅcloseÔºü‰∏çÊòØÂú®for‰∏≠Ë∞ÉÁî®‰∫ÜscanÔºåscanÂ∫îËØ•ÂèØ‰ª•Â∏ÆÊàë‰ª¨closeÂòõÔºüÂõ†‰∏∫‰∏ç‰∏ÄÂÆöËÉΩÂ§üËøõÂéªforÂæ™ÁéØ„ÄÇÂæóÊâãÂä®Ë∞ÉÁî®close„ÄÇ</p>
</blockquote>
<h4 id="execÊèíÂÖ•ÂíåÊõ¥Êñ∞ÂíåÂà†Èô§">execÔºàÊèíÂÖ•ÂíåÊõ¥Êñ∞ÂíåÂà†Èô§Ôºâ</h4>
<p>ÊèíÂÖ•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">insertRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;insert into test_user(name,age)values(?,?)&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">exec</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="s">&#34;peter&#34;</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;insert failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">id</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nf">LastInsertId</span><span class="p">()</span> <span class="c1">//ÂèØ‰ª•Ëé∑ÂæóÊñ∞ÊèíÂÖ•ÁöÑid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get id failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;insert success last id is %d \n&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êõ¥Êñ∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">updateRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;update test_user set name = ? where id = ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">exec</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="s">&#34;john&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;update failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">id</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nf">RowsAffected</span><span class="p">()</span> <span class="c1">//ÂèØ‰ª•ÂΩ±ÂìçÁöÑË°åÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get row count failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;update success row count is %d \n&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âà†Èô§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">deleteRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;delete from test_user where id = ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">exec</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;delete failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">id</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nf">RowsAffected</span><span class="p">()</span> <span class="c1">//ÂèØ‰ª•ÂΩ±ÂìçÁöÑË°åÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get row count failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;delete success row count is %d \n&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mysqlÈ¢ÑÂ§ÑÁêÜ‰∏ésqlÊ≥®ÂÖ•">MysqlÈ¢ÑÂ§ÑÁêÜ‰∏éSqlÊ≥®ÂÖ•</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220325134401692.png"
	
	
	
	loading="lazy"
	
		alt="image-20220325134401692"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">prepareDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;select id,name,age from test_user where id &gt; ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">prepare</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Prepare</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;prepare failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">prepare</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">query</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">prepare</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;query failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">u</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;scan failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;id: %d,name: %s,age: %d\n&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sqlÊ≥®ÂÖ•">sqlÊ≥®ÂÖ•</h4>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220325135656646.png"
	
	
	
	loading="lazy"
	
		alt="image-20220325135656646"
	
	
></p>
<p>ËØïËØïsqlÊ≥®ÂÖ•Âêß</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">sqlInjection</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;select id,name,age from test_user where name = %s&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">query</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;scan failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">u</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">query</span><span class="p">.</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;scan failed err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;id: %d,name: %s,age: %d\n&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220325150906255.png"
	
	
	
	loading="lazy"
	
		alt="image-20220325150906255"
	
	
></p>
<h3 id="mysqlÁöÑ‰∫ãÂä°">MysqlÁöÑ‰∫ãÂä°</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220325153721986.png"
	
	
	
	loading="lazy"
	
		alt="image-20220325153721986"
	
	
></p>
<h3 id="sqlx-Âº∫Â§ßÁöÑÂ∑•ÂÖ∑">sqlX Âº∫Â§ßÁöÑÂ∑•ÂÖ∑</h3>
<p>ÂÆâË£Ö</p>
<blockquote>
<p>go get github.com/jmoiron/sqlx</p>
</blockquote>
<h4 id="ËøûÊé•">ËøûÊé•</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">db1</span> <span class="o">*</span><span class="nx">sqlx</span><span class="p">.</span><span class="nx">DB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">initDB</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dsn</span> <span class="o">:=</span> <span class="s">&#34;root:abc123456@tcp(127.0.0.1:3306)/go&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db1</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sqlx</span><span class="p">.</span><span class="nf">Connect</span><span class="p">(</span><span class="s">&#34;mysql&#34;</span><span class="p">,</span> <span class="nx">dsn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err : %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">SetMaxOpenConns</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">SetMaxIdleConns</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sqlxÁöÑÂü∫Êú¨‰ΩøÁî®">SQLXÁöÑÂü∫Êú¨‰ΩøÁî®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">user1</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Id</span>   <span class="kt">int</span>    <span class="s">`db:&#34;id&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`db:&#34;name&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Age</span>  <span class="kt">int</span>    <span class="s">`db:&#34;age&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">queryRowDemo1</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;select id,name,age from test_user where id = ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">u</span> <span class="nx">user1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">db1</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">,</span> <span class="nx">sql</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get failed err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;id: %v,name: %v,age: %v&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Ê≥®ÊÑèÁªìÊûÑ‰ΩìÁöÑÂÄº‰∏çÂèØ‰ª•ÂÜô‰∏∫Â∞èÂÜôÔºådb1ÁöÑget‰ºöÈÄöËøáÂèçÂ∞ÑÁªôÂØπË±°ÁöÑÂ±ûÊÄßËµãÂÄº„ÄÇÂ¶ÇÊûú‰∏∫Â∞èÂÜôÁöÑËØùÂÖ∂‰ªñÁöÑÂåÖËÆøÈóÆ‰∏çÂà∞„ÄÇ</p>
</blockquote>
<p>Êü•ËØ¢Â§ö‰∏™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">queryRowMultiDemo1</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sql</span> <span class="o">:=</span> <span class="s">&#34;select id,name,age from test_user where id &gt; ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">u</span> <span class="p">[]</span><span class="nx">user1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">db1</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">,</span> <span class="nx">sql</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get failed err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;users:%v&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¢ûÂà†Êîπ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ÊèíÂÖ•Êï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">insertRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sqlStr</span> <span class="o">:=</span> <span class="s">&#34;insert into user(name, age) values (?,?)&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="nx">sqlStr</span><span class="p">,</span> <span class="s">&#34;Ê≤ôÊ≤≥Â∞èÁéãÂ≠ê&#34;</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;insert failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">theID</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ret</span><span class="p">.</span><span class="nf">LastInsertId</span><span class="p">()</span> <span class="c1">// Êñ∞ÊèíÂÖ•Êï∞ÊçÆÁöÑid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get lastinsert ID failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;insert success, the id is %d.\n&#34;</span><span class="p">,</span> <span class="nx">theID</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Êõ¥Êñ∞Êï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">updateRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sqlStr</span> <span class="o">:=</span> <span class="s">&#34;update user set age=? where id = ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="nx">sqlStr</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;update failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ret</span><span class="p">.</span><span class="nf">RowsAffected</span><span class="p">()</span> <span class="c1">// Êìç‰ΩúÂΩ±ÂìçÁöÑË°åÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get RowsAffected failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;update success, affected rows:%d\n&#34;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Âà†Èô§Êï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">deleteRowDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sqlStr</span> <span class="o">:=</span> <span class="s">&#34;delete from user where id = ?&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exec</span><span class="p">(</span><span class="nx">sqlStr</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;delete failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ret</span><span class="p">.</span><span class="nf">RowsAffected</span><span class="p">()</span> <span class="c1">// Êìç‰ΩúÂΩ±ÂìçÁöÑË°åÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get RowsAffected failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;delete success, affected rows:%d\n&#34;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="go-redis">go-redis</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">go</span> <span class="nx">get</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">redis</span><span class="o">/</span><span class="nx">redis</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ËøûÊé•redis">ËøûÊé•redis</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">initRedis</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rdb</span> <span class="p">=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">NewClient</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Addr</span><span class="p">:</span>     <span class="s">&#34;localhost:6379&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Password</span><span class="p">:</span> <span class="s">&#34;abc123456&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">DB</span><span class="p">:</span>       <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">PoolSize</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">//ËøûÊé•Ê±†Â§ßÂ∞è
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">Ping</span><span class="p">().</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">initRedis</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err : %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;connect success\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ËøûÊé•Âì®ÂÖµÊ®°Âºè">ËøûÊé•Âì®ÂÖµÊ®°Âºè</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326110711532.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326110711532"
	
	
></p>
<h3 id="Âü∫Êú¨‰ΩøÁî®">Âü∫Êú¨‰ΩøÁî®</h3>
<p>get/set</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">redisDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;score&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">Err</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;set error err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;score&#34;</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;get error err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;token&#34;</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//‰ºòÂÖàÂà§Êñ≠ÈîôËØØÊòØ‰∏çÊòØÂ±û‰∫éredisÊ≤°ÊúâÂØπÂ∫îÁöÑkey
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">Nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;the key is not exist\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err : %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s\n&#34;</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>hset,hmset,hget</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">hgetDemo</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rdb</span><span class="p">.</span><span class="nf">HMSet</span><span class="p">(</span><span class="s">&#34;school&#34;</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;name&#34;</span><span class="p">:</span>   <span class="s">&#34;scuec&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;addr&#34;</span><span class="p">:</span>   <span class="s">&#34;laofang&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;isLike&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">HSet</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;phm&#34;</span><span class="p">).</span><span class="nf">Err</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">HSet</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="s">&#34;1&#34;</span><span class="p">).</span><span class="nf">Err</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err :%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ÂæóÂà∞ÂÖ®ÈÉ®Â≠óÊÆµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">HGetAll</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">Nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;result :%v\n&#34;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">val</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">HGet</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">).</span><span class="nf">Val</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;val :%v\n&#34;</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>zset</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">zSetDemo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">key</span> <span class="o">:=</span> <span class="s">&#34;language_rank&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">languages</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span><span class="nx">Score</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">Member</span><span class="p">:</span> <span class="s">&#34;Java&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span><span class="nx">Score</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="nx">Member</span><span class="p">:</span> <span class="s">&#34;Golang&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span><span class="nx">Score</span><span class="p">:</span> <span class="mi">89</span><span class="p">,</span> <span class="nx">Member</span><span class="p">:</span> <span class="s">&#34;Python&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span><span class="nx">Score</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="nx">Member</span><span class="p">:</span> <span class="s">&#34;C&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span><span class="nx">Score</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Member</span><span class="p">:</span> <span class="s">&#34;C++&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//languageÂàáÁâáË¢´ÊâìÊï£‰∏Ä‰∏ÄaddÂà∞zset‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">ZAdd</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">languages</span><span class="o">...</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err :%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;zadd %d success!&#34;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ÊääGolangÁöÑÂàÜÊï∞+10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">ZIncrBy</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#34;Golang&#34;</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err :%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;new Score is %d\n&#34;</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ÂèñÊúÄÈ´òÁöÑ‰∏â‰∏™ÂàÜÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">zs</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">ZRevRangeWithScores</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err :%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">z</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">zs</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Member</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Score</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Âèñ90 - 100ÂàÜÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ranges</span> <span class="o">:=</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">ZRangeBy</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Min</span><span class="p">:</span> <span class="s">&#34;90&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Max</span><span class="p">:</span> <span class="s">&#34;100&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">strings</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">ZRevRangeByScoreWithScores</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">ranges</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err :%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;err :%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">z</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">strings</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Member</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Score</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pipeline">pipeline</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326115854778.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326115854778"
	
	
></p>
<h4 id="‰∫ãÂä°">‰∫ãÂä°</h4>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326120328668.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326120328668"
	
	
></p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326120421859.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326120421859"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ÁõëËßÜwatch_countÁöÑÂÄºÔºåÂπ∂Âú®ÂÄº‰∏çÂèòÁöÑÂâçÊèê‰∏ãÂ∞ÜÂÖ∂ÂÄº+1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">key</span> <span class="o">:=</span> <span class="s">&#34;watch_count&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">err</span> <span class="p">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Watch</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Tx</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">tx</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nf">Int</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">Nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nf">Pipelined</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">pipe</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">Pipeliner</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">pipe</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="nx">key</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="zapÊó•ÂøóÂ∫ì">ZapÊó•ÂøóÂ∫ì</h2>
<h3 id="gologger">Gologger</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326135236741.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326135236741"
	
	
></p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326135251372.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326135251372"
	
	
></p>
<h3 id="go-loggerÁöÑ‰ºòÂä£">Go loggerÁöÑ‰ºòÂä£Ôºü</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326135102671.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326135102671"
	
	
></p>
<h3 id="zapÁöÑ‰ºòÁÇπ">ZapÁöÑ‰ºòÁÇπ</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326135434518.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326135434518"
	
	
></p>
<h3 id="‰ΩøÁî®">‰ΩøÁî®</h3>
<p>Ëé∑Âæó</p>
<blockquote>
<p>‚Äã	go get  -u go.uber.org/zap</p>
</blockquote>
<p>ÈÖçÁΩÆzap</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220326135815921.png"
	
	
	
	loading="lazy"
	
		alt="image-20220326135815921"
	
	
></p>
<h4 id="logger">Logger</h4>
<ul>
<li>ÈÄöËøáË∞ÉÁî®<code>zap.NewProduction()</code>/<code>zap.NewDevelopment()</code>ÊàñËÄÖ<code>zap.Example()</code>ÂàõÂª∫‰∏Ä‰∏™Logger„ÄÇ</li>
<li>‰∏äÈù¢ÁöÑÊØè‰∏Ä‰∏™ÂáΩÊï∞ÈÉΩÂ∞ÜÂàõÂª∫‰∏Ä‰∏™logger„ÄÇÂîØ‰∏ÄÁöÑÂå∫Âà´Âú®‰∫éÂÆÉÂ∞ÜËÆ∞ÂΩïÁöÑ‰ø°ÊÅØ‰∏çÂêå„ÄÇ‰æãÂ¶Çproduction loggerÈªòËÆ§ËÆ∞ÂΩïË∞ÉÁî®ÂáΩÊï∞‰ø°ÊÅØ„ÄÅÊó•ÊúüÂíåÊó∂Èó¥Á≠â„ÄÇ</li>
<li>ÈÄöËøáLoggerË∞ÉÁî®Info/ErrorÁ≠â„ÄÇ</li>
<li>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÊó•ÂøóÈÉΩ‰ºöÊâìÂç∞Âà∞Â∫îÁî®Á®ãÂ∫èÁöÑconsoleÁïåÈù¢„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">logger</span> <span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">InitLogg</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span> <span class="c1">//Â∞ÜloggerÁöÑÊó•ÂøóÂà∑Âà∞Á£ÅÁõò
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">simpleHttp</span><span class="p">(</span><span class="s">&#34;www.google.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nf">simpleHttp</span><span class="p">(</span><span class="s">&#34;http://www.google.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">InitLogg</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewProduction</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">simpleHttp</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">get</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Error fetching url..&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;url&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">),</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logger</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;success..&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;statusCode&#34;</span><span class="p">,</span> <span class="nx">get</span><span class="p">.</span><span class="nx">Status</span><span class="p">),</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;url&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">get</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Ëá™ÂÆö‰πâÈÖçÁΩÆÈ°π">Ëá™ÂÆö‰πâÈÖçÁΩÆÈ°π</h4>
<h5 id="Â∞ÜÊó•ÂøóÂÜôÂÖ•Êñá‰ª∂ËÄå‰∏çÊòØÁªàÁ´Ø">Â∞ÜÊó•ÂøóÂÜôÂÖ•Êñá‰ª∂ËÄå‰∏çÊòØÁªàÁ´Ø</h5>
<p>Êàë‰ª¨Ë¶ÅÂÅöÁöÑÁ¨¨‰∏Ä‰∏™Êõ¥ÊîπÊòØÊääÊó•ÂøóÂÜôÂÖ•Êñá‰ª∂ÔºåËÄå‰∏çÊòØÊâìÂç∞Âà∞Â∫îÁî®Á®ãÂ∫èÊéßÂà∂Âè∞„ÄÇ</p>
<ul>
<li>Êàë‰ª¨Â∞Ü‰ΩøÁî®<code>zap.New(‚Ä¶)</code>ÊñπÊ≥ïÊù•ÊâãÂä®‰º†ÈÄíÊâÄÊúâÈÖçÁΩÆÔºåËÄå‰∏çÊòØ‰ΩøÁî®ÂÉè<code>zap.NewProduction()</code>ËøôÊ†∑ÁöÑÈ¢ÑÁΩÆÊñπÊ≥ïÊù•ÂàõÂª∫logger„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">New</span><span class="p">(</span><span class="nx">core</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Core</span><span class="p">,</span> <span class="nx">options</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="o">*</span><span class="nx">Logger</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>zapcore.Core</code>ÈúÄË¶Å‰∏â‰∏™ÈÖçÁΩÆ‚Äî‚Äî<code>Encoder</code>Ôºå<code>WriteSyncer</code>Ôºå<code>LogLevel</code>„ÄÇ</p>
<p>1.<strong>Encoder</strong>:ÁºñÁ†ÅÂô®(Â¶Ç‰ΩïÂÜôÂÖ•Êó•Âøó)„ÄÇÊàë‰ª¨Â∞Ü‰ΩøÁî®ÂºÄÁÆ±Âç≥Áî®ÁöÑ<code>NewJSONEncoder()</code>ÔºåÂπ∂‰ΩøÁî®È¢ÑÂÖàËÆæÁΩÆÁöÑ<code>ProductionEncoderConfig()</code>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">   <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewJSONEncoder</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.<strong>WriterSyncer</strong> ÔºöÊåáÂÆöÊó•ÂøóÂ∞ÜÂÜôÂà∞Âì™ÈáåÂéª„ÄÇÊàë‰ª¨‰ΩøÁî®<code>zapcore.AddSync()</code>ÂáΩÊï∞Âπ∂‰∏îÂ∞ÜÊâìÂºÄÁöÑÊñá‰ª∂Âè•ÊüÑ‰º†ËøõÂéª„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">   <span class="nx">file</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s">&#34;./logger.log&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nx">writeSyncer</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>3.<strong>Log Level</strong>ÔºöÂì™ÁßçÁ∫ßÂà´ÁöÑÊó•ÂøóÂ∞ÜË¢´ÂÜôÂÖ•„ÄÇ</p>
<p>Êàë‰ª¨Â∞Ü‰øÆÊîπ‰∏äËø∞ÈÉ®ÂàÜ‰∏≠ÁöÑLogger‰ª£Á†ÅÔºåÂπ∂ÈáçÂÜô<code>InitLogger()</code>ÊñπÊ≥ï„ÄÇÂÖ∂‰ΩôÊñπÊ≥ï‚Äî<code>main()</code> /<code>SimpleHttpGet()</code>‰øùÊåÅ‰∏çÂèò„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">InitLogg</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">writerSync</span> <span class="o">:=</span> <span class="nf">getLogWriter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoding</span> <span class="o">:=</span> <span class="nf">getEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">core</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">encoding</span><span class="p">,</span> <span class="nx">writerSync</span><span class="p">,</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span> <span class="p">=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getEncoder</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewJSONEncoder</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getLogWriter</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WriteSyncer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">f</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s">&#34;./logger.log&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì‰ΩøÁî®Ëøô‰∫õ‰øÆÊîπËøáÁöÑloggerÈÖçÁΩÆË∞ÉÁî®‰∏äËø∞ÈÉ®ÂàÜÁöÑ<code>main()</code>ÂáΩÊï∞Êó∂Ôºå‰ª•‰∏ãËæìÂá∫Â∞ÜÊâìÂç∞Âú®Êñá‰ª∂‚Äî‚Äî<code>test.log</code>‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;debug&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1572160754.994731,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Trying to hit GET request for www.sogo.com&#34;</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;error&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1572160754.994982,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Error fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme \&#34;\&#34;&#34;</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;debug&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1572160754.994996,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Trying to hit GET request for http://www.sogo.com&#34;</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1572160757.3755069,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Success! statusCode = 200 OK for URL http://www.sogo.com&#34;</span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="Â∞Üjson-encoderÊõ¥Êîπ‰∏∫ÊôÆÈÄöÁöÑlog-encoder">Â∞ÜJSON EncoderÊõ¥Êîπ‰∏∫ÊôÆÈÄöÁöÑLog Encoder</h5>
<p>Áé∞Âú®ÔºåÊàë‰ª¨Â∏åÊúõÂ∞ÜÁºñÁ†ÅÂô®‰ªéJSON EncoderÊõ¥Êîπ‰∏∫ÊôÆÈÄöEncoder„ÄÇ‰∏∫Ê≠§ÔºåÊàë‰ª¨ÈúÄË¶ÅÂ∞Ü<code>NewJSONEncoder()</code>Êõ¥Êîπ‰∏∫<code>NewConsoleEncoder()</code>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewConsoleEncoder</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì‰ΩøÁî®Ëøô‰∫õ‰øÆÊîπËøáÁöÑloggerÈÖçÁΩÆË∞ÉÁî®‰∏äËø∞ÈÉ®ÂàÜÁöÑ<code>main()</code>ÂáΩÊï∞Êó∂Ôºå‰ª•‰∏ãËæìÂá∫Â∞ÜÊâìÂç∞Âú®Êñá‰ª∂‚Äî‚Äî<code>test.log</code>‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.572161051846623e+09	debug	Trying to hit GET request <span class="k">for</span> www.sogo.com
</span></span><span class="line"><span class="cl">1.572161051846828e+09	error	Error fetching URL www.sogo.com : <span class="nv">Error</span> <span class="o">=</span> Get www.sogo.com: unsupported protocol scheme <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">1.5721610518468401e+09	debug	Trying to hit GET request <span class="k">for</span> http://www.sogo.com
</span></span><span class="line"><span class="cl">1.572161052068744e+09	info	Success! <span class="nv">statusCode</span> <span class="o">=</span> <span class="m">200</span> OK <span class="k">for</span> URL http://www.sogo.com
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="Êõ¥ÊîπÊó∂Èó¥ÁºñÁ†ÅÂπ∂Ê∑ªÂä†Ë∞ÉÁî®ËÄÖËØ¶ÁªÜ‰ø°ÊÅØ">Êõ¥ÊîπÊó∂Èó¥ÁºñÁ†ÅÂπ∂Ê∑ªÂä†Ë∞ÉÁî®ËÄÖËØ¶ÁªÜ‰ø°ÊÅØ</h5>
<p>Èâ¥‰∫éÊàë‰ª¨ÂØπÈÖçÁΩÆÊâÄÂÅöÁöÑÊõ¥ÊîπÔºåÊúâ‰∏ãÈù¢‰∏§‰∏™ÈóÆÈ¢òÔºö</p>
<ul>
<li>Êó∂Èó¥ÊòØ‰ª•Èùû‰∫∫Á±ªÂèØËØªÁöÑÊñπÂºèÂ±ïÁ§∫Ôºå‰æãÂ¶Ç1.572161051846623e+09</li>
<li>Ë∞ÉÁî®ÊñπÂáΩÊï∞ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÊ≤°ÊúâÊòæÁ§∫Âú®Êó•Âøó‰∏≠</li>
</ul>
<p>Êàë‰ª¨Ë¶ÅÂÅöÁöÑÁ¨¨‰∏Ä‰ª∂‰∫ãÊòØË¶ÜÁõñÈªòËÆ§ÁöÑ<code>ProductionConfig()</code>ÔºåÂπ∂ËøõË°å‰ª•‰∏ãÊõ¥Êîπ:</p>
<ul>
<li>‰øÆÊîπÊó∂Èó¥ÁºñÁ†ÅÂô®</li>
<li>Âú®Êó•ÂøóÊñá‰ª∂‰∏≠‰ΩøÁî®Â§ßÂÜôÂ≠óÊØçËÆ∞ÂΩïÊó•ÂøóÁ∫ßÂà´</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getEncoder</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewConsoleEncoder</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">TimeKey</span><span class="p">:</span>        <span class="s">&#34;ts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">LevelKey</span><span class="p">:</span>       <span class="s">&#34;level&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NameKey</span><span class="p">:</span>        <span class="s">&#34;logger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">CallerKey</span><span class="p">:</span>      <span class="s">&#34;caller&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">FunctionKey</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">OmitKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">MessageKey</span><span class="p">:</span>     <span class="s">&#34;msg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">StacktraceKey</span><span class="p">:</span>  <span class="s">&#34;stacktrace&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">LineEnding</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DefaultLineEnding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">EncodeLevel</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">LowercaseLevelEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">EncodeTime</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ISO8601TimeEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">EncodeDuration</span><span class="p">:</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">SecondsDurationEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">EncodeCaller</span><span class="p">:</span>   <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ShortCallerEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞Ü‰øÆÊîπzap logger‰ª£Á†ÅÔºåÊ∑ªÂä†Â∞ÜË∞ÉÁî®ÂáΩÊï∞‰ø°ÊÅØËÆ∞ÂΩïÂà∞Êó•Âøó‰∏≠ÁöÑÂäüËÉΩ„ÄÇ‰∏∫Ê≠§ÔºåÊàë‰ª¨Â∞ÜÂú®<code>zap.New(..)</code>ÂáΩÊï∞‰∏≠Ê∑ªÂä†‰∏Ä‰∏™<code>Option</code>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">logger</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">AddCaller</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì‰ΩøÁî®Ëøô‰∫õ‰øÆÊîπËøáÁöÑloggerÈÖçÁΩÆË∞ÉÁî®‰∏äËø∞ÈÉ®ÂàÜÁöÑ<code>main()</code>ÂáΩÊï∞Êó∂Ôºå‰ª•‰∏ãËæìÂá∫Â∞ÜÊâìÂç∞Âú®Êñá‰ª∂‚Äî‚Äî<code>test.log</code>‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">2019-10-27T15:33:29.855+0800	DEBUG	logic/temp2.go:47	Trying to hit GET request <span class="k">for</span> www.sogo.com
</span></span><span class="line"><span class="cl">2019-10-27T15:33:29.855+0800	ERROR	logic/temp2.go:50	Error fetching URL www.sogo.com : <span class="nv">Error</span> <span class="o">=</span> Get www.sogo.com: unsupported protocol scheme <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">2019-10-27T15:33:29.856+0800	DEBUG	logic/temp2.go:47	Trying to hit GET request <span class="k">for</span> http://www.sogo.com
</span></span><span class="line"><span class="cl">2019-10-27T15:33:30.125+0800	INFO	logic/temp2.go:52	Success! <span class="nv">statusCode</span> <span class="o">=</span> <span class="m">200</span> OK <span class="k">for</span> URL http://www.sogo.com
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ΩøÁî®lumberjackËøõË°åÊó•ÂøóÂàáÂâ≤ÂΩíÊ°£">‰ΩøÁî®LumberjackËøõË°åÊó•ÂøóÂàáÂâ≤ÂΩíÊ°£</h3>
<p>Ëøô‰∏™Êó•ÂøóÁ®ãÂ∫è‰∏≠ÂîØ‰∏ÄÁº∫Â∞ëÁöÑÂ∞±ÊòØÊó•ÂøóÂàáÂâ≤ÂΩíÊ°£ÂäüËÉΩ„ÄÇ</p>
<blockquote>
<p><em>ZapÊú¨Ë∫´‰∏çÊîØÊåÅÂàáÂâ≤ÂΩíÊ°£Êó•ÂøóÊñá‰ª∂</em></p>
</blockquote>
<p>‰∏∫‰∫ÜÊ∑ªÂä†Êó•ÂøóÂàáÂâ≤ÂΩíÊ°£ÂäüËÉΩÔºåÊàë‰ª¨Â∞Ü‰ΩøÁî®Á¨¨‰∏âÊñπÂ∫ì<a class="link" href="https://github.com/natefinch/lumberjack"  target="_blank" rel="noopener"
    >Lumberjack</a>Êù•ÂÆûÁé∞„ÄÇ</p>
<h4 id="ÂÆâË£Ö">ÂÆâË£Ö</h4>
<p>ÊâßË°å‰∏ãÈù¢ÁöÑÂëΩ‰ª§ÂÆâË£ÖLumberjack</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u github.com/natefinch/lumberjack
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="zap-logger‰∏≠Âä†ÂÖ•lumberjack">zap logger‰∏≠Âä†ÂÖ•Lumberjack</h4>
<p>Ë¶ÅÂú®zap‰∏≠Âä†ÂÖ•LumberjackÊîØÊåÅÔºåÊàë‰ª¨ÈúÄË¶Å‰øÆÊîπ<code>WriteSyncer</code>‰ª£Á†Å„ÄÇÊàë‰ª¨Â∞ÜÊåâÁÖß‰∏ãÈù¢ÁöÑ‰ª£Á†Å‰øÆÊîπ<code>getLogWriter()</code>ÂáΩÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getLogWriter</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WriteSyncer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">lumberJackLogger</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Filename</span><span class="p">:</span>   <span class="s">&#34;./test.log&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxSize</span><span class="p">:</span>    <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxBackups</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxAge</span><span class="p">:</span>     <span class="mi">30</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Compress</span><span class="p">:</span>   <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="nx">lumberJackLogger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Lumberjack LoggerÈááÁî®‰ª•‰∏ãÂ±ûÊÄß‰Ωú‰∏∫ËæìÂÖ•:</p>
<ul>
<li>Filename: Êó•ÂøóÊñá‰ª∂ÁöÑ‰ΩçÁΩÆ</li>
<li>MaxSizeÔºöÂú®ËøõË°åÂàáÂâ≤‰πãÂâçÔºåÊó•ÂøóÊñá‰ª∂ÁöÑÊúÄÂ§ßÂ§ßÂ∞èÔºà‰ª•MB‰∏∫Âçï‰ΩçÔºâ</li>
<li>MaxBackupsÔºö‰øùÁïôÊóßÊñá‰ª∂ÁöÑÊúÄÂ§ß‰∏™Êï∞</li>
<li>MaxAgesÔºö‰øùÁïôÊóßÊñá‰ª∂ÁöÑÊúÄÂ§ßÂ§©Êï∞</li>
<li>CompressÔºöÊòØÂê¶ÂéãÁº©/ÂΩíÊ°£ÊóßÊñá‰ª∂</li>
</ul>
<h4 id="ÊµãËØïÊâÄÊúâÂäüËÉΩ">ÊµãËØïÊâÄÊúâÂäüËÉΩ</h4>
<p>ÊúÄÁªàÔºå‰ΩøÁî®Zap/Lumberjack loggerÁöÑÂÆåÊï¥Á§∫‰æã‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/natefinch/lumberjack&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap/zapcore&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">sugarLogger</span> <span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">SugaredLogger</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">InitLogger</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">sugarLogger</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nf">simpleHttpGet</span><span class="p">(</span><span class="s">&#34;www.sogo.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nf">simpleHttpGet</span><span class="p">(</span><span class="s">&#34;http://www.sogo.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">InitLogger</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">writeSyncer</span> <span class="o">:=</span> <span class="nf">getLogWriter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoder</span> <span class="o">:=</span> <span class="nf">getEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">core</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">encoder</span><span class="p">,</span> <span class="nx">writeSyncer</span><span class="p">,</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">AddCaller</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugarLogger</span> <span class="p">=</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sugar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getEncoder</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeTime</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ISO8601TimeEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">CapitalLevelEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewConsoleEncoder</span><span class="p">(</span><span class="nx">encoderConfig</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getLogWriter</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WriteSyncer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">lumberJackLogger</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Filename</span><span class="p">:</span>   <span class="s">&#34;./test.log&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxSize</span><span class="p">:</span>    <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxBackups</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxAge</span><span class="p">:</span>     <span class="mi">30</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Compress</span><span class="p">:</span>   <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="nx">lumberJackLogger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">simpleHttpGet</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugarLogger</span><span class="p">.</span><span class="nf">Debugf</span><span class="p">(</span><span class="s">&#34;Trying to hit GET request for %s&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sugarLogger</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Error fetching URL %s : Error = %s&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sugarLogger</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;Success! statusCode = %s for URL %s&#34;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°å‰∏äËø∞‰ª£Á†ÅÔºå‰∏ãÈù¢ÁöÑÂÜÖÂÆπ‰ºöËæìÂá∫Âà∞Êñá‰ª∂‚Äî‚Äîtest.log‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">27</span><span class="nx">T15</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">32.944</span><span class="o">+</span><span class="mi">0800</span>	<span class="nx">DEBUG</span>	<span class="nx">logic</span><span class="o">/</span><span class="nx">temp2</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">48</span>	<span class="nx">Trying</span> <span class="nx">to</span> <span class="nx">hit</span> <span class="nx">GET</span> <span class="nx">request</span> <span class="k">for</span> <span class="nx">www</span><span class="p">.</span><span class="nx">sogo</span><span class="p">.</span><span class="nx">com</span>
</span></span><span class="line"><span class="cl"><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">27</span><span class="nx">T15</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">32.944</span><span class="o">+</span><span class="mi">0800</span>	<span class="nx">ERROR</span>	<span class="nx">logic</span><span class="o">/</span><span class="nx">temp2</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">51</span>	<span class="nx">Error</span> <span class="nx">fetching</span> <span class="nx">URL</span> <span class="nx">www</span><span class="p">.</span><span class="nx">sogo</span><span class="p">.</span><span class="nx">com</span> <span class="p">:</span> <span class="nx">Error</span> <span class="p">=</span> <span class="nx">Get</span> <span class="nx">www</span><span class="p">.</span><span class="nx">sogo</span><span class="p">.</span><span class="nx">com</span><span class="p">:</span> <span class="nx">unsupported</span> <span class="nx">protocol</span> <span class="nx">scheme</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">27</span><span class="nx">T15</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">32.944</span><span class="o">+</span><span class="mi">0800</span>	<span class="nx">DEBUG</span>	<span class="nx">logic</span><span class="o">/</span><span class="nx">temp2</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">48</span>	<span class="nx">Trying</span> <span class="nx">to</span> <span class="nx">hit</span> <span class="nx">GET</span> <span class="nx">request</span> <span class="k">for</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//www.sogo.com
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">27</span><span class="nx">T15</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">33.165</span><span class="o">+</span><span class="mi">0800</span>	<span class="nx">INFO</span>	<span class="nx">logic</span><span class="o">/</span><span class="nx">temp2</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">53</span>	<span class="nx">Success</span><span class="p">!</span> <span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">200</span> <span class="nx">OK</span> <span class="k">for</span> <span class="nx">URL</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//www.sogo.com
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêåÊó∂ÔºåÂèØ‰ª•Âú®<code>main</code>ÂáΩÊï∞‰∏≠Âæ™ÁéØËÆ∞ÂΩïÊó•ÂøóÔºåÊµãËØïÊó•ÂøóÊñá‰ª∂ÊòØÂê¶‰ºöËá™Âä®ÂàáÂâ≤ÂíåÂΩíÊ°£ÔºàÊó•ÂøóÊñá‰ª∂ÊØè1MB‰ºöÂàáÂâ≤Âπ∂‰∏îÂú®ÂΩìÂâçÁõÆÂΩï‰∏ãÊúÄÂ§ö‰øùÂ≠ò5‰∏™Â§á‰ªΩÔºâ„ÄÇ</p>
<p>Ëá≥Ê≠§ÔºåÊàë‰ª¨ÊÄªÁªì‰∫ÜÂ¶Ç‰ΩïÂ∞ÜZapÊó•ÂøóÁ®ãÂ∫èÈõÜÊàêÂà∞GoÂ∫îÁî®Á®ãÂ∫èÈ°πÁõÆ‰∏≠„ÄÇ</p>
<h3 id="ginÊï¥Âêàzap">ginÊï¥Âêàzap</h3>
<blockquote>
<p>go get -u github.com/gin-gonic/gin</p>
</blockquote>
<p>È¶ñÂÖàÊàë‰ª¨Êù•Áúã‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑginÈ°πÁõÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;hello liwenzhou.com!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•‰∏ãÊù•Êàë‰ª¨Áúã‰∏Ä‰∏ã<code>gin.Default()</code>ÁöÑÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Default</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">debugPrintWARNINGDefault</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span> <span class="o">:=</span> <span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">Logger</span><span class="p">(),</span> <span class="nf">Recovery</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">engine</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰πüÂ∞±ÊòØÊàë‰ª¨Âú®‰ΩøÁî®<code>gin.Default()</code>ÁöÑÂêåÊó∂ÊòØÁî®Âà∞‰∫ÜginÊ°ÜÊû∂ÂÜÖÁöÑ‰∏§‰∏™ÈªòËÆ§‰∏≠Èó¥‰ª∂<code>Logger()</code>Âíå<code>Recovery()</code>„ÄÇ</p>
<p>ÂÖ∂‰∏≠<code>Logger()</code>ÊòØÊääginÊ°ÜÊû∂Êú¨Ë∫´ÁöÑÊó•ÂøóËæìÂá∫Âà∞Ê†áÂáÜËæìÂá∫ÔºàÊàë‰ª¨Êú¨Âú∞ÂºÄÂèëË∞ÉËØïÊó∂Âú®ÁªàÁ´ØËæìÂá∫ÁöÑÈÇ£‰∫õÊó•ÂøóÂ∞±ÊòØÂÆÉÁöÑÂäüÂä≥ÔºâÔºåËÄå<code>Recovery()</code>ÊòØÂú®Á®ãÂ∫èÂá∫Áé∞panicÁöÑÊó∂ÂÄôÊÅ¢Â§çÁé∞Âú∫Âπ∂ÂÜôÂÖ•500ÂìçÂ∫îÁöÑ„ÄÇ</p>
<h4 id="Âü∫‰∫ézapÁöÑ‰∏≠Èó¥‰ª∂">Âü∫‰∫ézapÁöÑ‰∏≠Èó¥‰ª∂</h4>
<p>Êàë‰ª¨ÂèØ‰ª•Ê®°‰ªø<code>Logger()</code>Âíå<code>Recovery()</code>ÁöÑÂÆûÁé∞Ôºå‰ΩøÁî®Êàë‰ª¨ÁöÑÊó•ÂøóÂ∫ìÊù•Êé•Êî∂ginÊ°ÜÊû∂ÈªòËÆ§ËæìÂá∫ÁöÑÊó•Âøó„ÄÇ</p>
<p>ËøôÈáå‰ª•zap‰∏∫‰æãÔºåÊàë‰ª¨ÂÆûÁé∞‰∏§‰∏™‰∏≠Èó¥‰ª∂Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// GinLogger Êé•Êî∂ginÊ°ÜÊû∂ÈªòËÆ§ÁöÑÊó•Âøó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GinLogger</span><span class="p">(</span><span class="nx">logger</span> <span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span><span class="p">)</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">path</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span>
</span></span><span class="line"><span class="cl">		<span class="nx">query</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">cost</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logger</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;status&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Status</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;method&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Method</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;path&#34;</span><span class="p">,</span> <span class="nx">path</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;query&#34;</span><span class="p">,</span> <span class="nx">query</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;ip&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ClientIP</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;user-agent&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">UserAgent</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;errors&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Errors</span><span class="p">.</span><span class="nf">ByType</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nx">ErrorTypePrivate</span><span class="p">).</span><span class="nf">String</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="s">&#34;cost&#34;</span><span class="p">,</span> <span class="nx">cost</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GinRecovery recoverÊéâÈ°πÁõÆÂèØËÉΩÂá∫Áé∞ÁöÑpanic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GinRecovery</span><span class="p">(</span><span class="nx">logger</span> <span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span><span class="p">,</span> <span class="nx">stack</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Check for a broken connection, as it is not really a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// condition that warrants a panic stack trace.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="kd">var</span> <span class="nx">brokenPipe</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">ne</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">OpError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nx">se</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">Err</span><span class="p">.(</span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">SyscallError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">se</span><span class="p">.</span><span class="nf">Error</span><span class="p">()),</span> <span class="s">&#34;broken pipe&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">se</span><span class="p">.</span><span class="nf">Error</span><span class="p">()),</span> <span class="s">&#34;connection reset by peer&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="nx">brokenPipe</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="nx">httpRequest</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">httputil</span><span class="p">.</span><span class="nf">DumpRequest</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">brokenPipe</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">logger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// If the connection is dead, we can&#39;t write a status to it.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">c</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.(</span><span class="kt">error</span><span class="p">))</span> <span class="c1">// nolint: errcheck
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">stack</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">logger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;[Recovery from panic]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;stack&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">debug</span><span class="p">.</span><span class="nf">Stack</span><span class="p">())),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">logger</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;[Recovery from panic]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">c</span><span class="p">.</span><span class="nf">AbortWithStatus</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>Â¶ÇÊûú‰∏çÊÉ≥Ëá™Â∑±ÂÆûÁé∞ÔºåÂèØ‰ª•‰ΩøÁî®github‰∏äÊúâÂà´‰∫∫Â∞ÅË£ÖÂ•ΩÁöÑhttps://github.com/gin-contrib/zap„ÄÇ</em></p>
<p>ËøôÊ†∑Êàë‰ª¨Â∞±ÂèØ‰ª•Âú®ginÊ°ÜÊû∂‰∏≠‰ΩøÁî®Êàë‰ª¨‰∏äÈù¢ÂÆö‰πâÂ•ΩÁöÑ‰∏§‰∏™‰∏≠Èó¥‰ª∂Êù•‰ª£ÊõøginÊ°ÜÊû∂ÈªòËÆ§ÁöÑ<code>Logger()</code>Âíå<code>Recovery()</code>‰∫Ü„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">GinLogger</span><span class="p">(),</span> <span class="nf">GinRecovery</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Âú®ginÈ°πÁõÆ‰∏≠‰ΩøÁî®zap">Âú®ginÈ°πÁõÆ‰∏≠‰ΩøÁî®zap</h4>
<p>ÊúÄÂêéÊàë‰ª¨ÂÜçÂä†ÂÖ•Êàë‰ª¨È°πÁõÆ‰∏≠Â∏∏Áî®ÁöÑÊó•ÂøóÂàáÂâ≤ÔºåÂÆåÊï¥ÁâàÁöÑ<code>logger.go</code>‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">logger</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;gin_zap_demo/config&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http/httputil&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;runtime/debug&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/natefinch/lumberjack&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap/zapcore&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">lg</span> <span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// InitLogger ÂàùÂßãÂåñLogger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">InitLogger</span><span class="p">(</span><span class="nx">cfg</span> <span class="o">*</span><span class="nx">config</span><span class="p">.</span><span class="nx">LogConfig</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">writeSyncer</span> <span class="o">:=</span> <span class="nf">getLogWriter</span><span class="p">(</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">Filename</span><span class="p">,</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">MaxSize</span><span class="p">,</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">MaxBackups</span><span class="p">,</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">MaxAge</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoder</span> <span class="o">:=</span> <span class="nf">getEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">l</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">UnmarshalText</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">Level</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">core</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">encoder</span><span class="p">,</span> <span class="nx">writeSyncer</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">lg</span> <span class="p">=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">AddCaller</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="nx">zap</span><span class="p">.</span><span class="nf">ReplaceGlobals</span><span class="p">(</span><span class="nx">lg</span><span class="p">)</span> <span class="c1">// ÊõøÊç¢zapÂåÖ‰∏≠ÂÖ®Â±ÄÁöÑloggerÂÆû‰æãÔºåÂêéÁª≠Âú®ÂÖ∂‰ªñÂåÖ‰∏≠Âè™ÈúÄ‰ΩøÁî®zap.L()Ë∞ÉÁî®Âç≥ÂèØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getEncoder</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeTime</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ISO8601TimeEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">TimeKey</span> <span class="p">=</span> <span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">CapitalLevelEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeDuration</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">SecondsDurationEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeCaller</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ShortCallerEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewJSONEncoder</span><span class="p">(</span><span class="nx">encoderConfig</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getLogWriter</span><span class="p">(</span><span class="nx">filename</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">maxSize</span><span class="p">,</span> <span class="nx">maxBackup</span><span class="p">,</span> <span class="nx">maxAge</span> <span class="kt">int</span><span class="p">)</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WriteSyncer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">lumberJackLogger</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Filename</span><span class="p">:</span>   <span class="nx">filename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxSize</span><span class="p">:</span>    <span class="nx">maxSize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxBackups</span><span class="p">:</span> <span class="nx">maxBackup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxAge</span><span class="p">:</span>     <span class="nx">maxAge</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="nx">lumberJackLogger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GinLogger Êé•Êî∂ginÊ°ÜÊû∂ÈªòËÆ§ÁöÑÊó•Âøó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GinLogger</span><span class="p">()</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">path</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span>
</span></span><span class="line"><span class="cl">		<span class="nx">query</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">cost</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">lg</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;status&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Status</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;method&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Method</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;path&#34;</span><span class="p">,</span> <span class="nx">path</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;query&#34;</span><span class="p">,</span> <span class="nx">query</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;ip&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ClientIP</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;user-agent&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">UserAgent</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;errors&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Errors</span><span class="p">.</span><span class="nf">ByType</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nx">ErrorTypePrivate</span><span class="p">).</span><span class="nf">String</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="s">&#34;cost&#34;</span><span class="p">,</span> <span class="nx">cost</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GinRecovery recoverÊéâÈ°πÁõÆÂèØËÉΩÂá∫Áé∞ÁöÑpanicÔºåÂπ∂‰ΩøÁî®zapËÆ∞ÂΩïÁõ∏ÂÖ≥Êó•Âøó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GinRecovery</span><span class="p">(</span><span class="nx">stack</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Check for a broken connection, as it is not really a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// condition that warrants a panic stack trace.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="kd">var</span> <span class="nx">brokenPipe</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">ne</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">OpError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nx">se</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">Err</span><span class="p">.(</span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">SyscallError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">se</span><span class="p">.</span><span class="nf">Error</span><span class="p">()),</span> <span class="s">&#34;broken pipe&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">se</span><span class="p">.</span><span class="nf">Error</span><span class="p">()),</span> <span class="s">&#34;connection reset by peer&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="nx">brokenPipe</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="nx">httpRequest</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">httputil</span><span class="p">.</span><span class="nf">DumpRequest</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">brokenPipe</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">lg</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// If the connection is dead, we can&#39;t write a status to it.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">c</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.(</span><span class="kt">error</span><span class="p">))</span> <span class="c1">// nolint: errcheck
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">stack</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">lg</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;[Recovery from panic]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;stack&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">debug</span><span class="p">.</span><span class="nf">Stack</span><span class="p">())),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">lg</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;[Recovery from panic]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">c</span><span class="p">.</span><span class="nf">AbortWithStatus</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÂÆö‰πâÊó•ÂøóÁõ∏ÂÖ≥ÈÖçÁΩÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">LogConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Level</span> <span class="kt">string</span> <span class="s">`json:&#34;level&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Filename</span> <span class="kt">string</span> <span class="s">`json:&#34;filename&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxSize</span> <span class="kt">int</span> <span class="s">`json:&#34;maxsize&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxAge</span> <span class="kt">int</span> <span class="s">`json:&#34;max_age&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxBackups</span> <span class="kt">int</span> <span class="s">`json:&#34;max_backups&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®È°πÁõÆ‰∏≠ÂÖà‰ªéÈÖçÁΩÆÊñá‰ª∂Âä†ËΩΩÈÖçÁΩÆ‰ø°ÊÅØÔºåÂÜçË∞ÉÁî®<code>logger.InitLogger(config.Conf.LogConfig)</code>Âç≥ÂèØÂÆåÊàêloggerÂÆû‰æãÁöÑÂàùËØÜÂåñ„ÄÇÂÖ∂‰∏≠ÔºåÈÄöËøá<code>r.Use(logger.GinLogger(), logger.GinRecovery(true))</code>Ê≥®ÂÜåÊàë‰ª¨ÁöÑ‰∏≠Èó¥‰ª∂Êù•‰ΩøÁî®zapÊé•Êî∂ginÊ°ÜÊû∂Ëá™Ë∫´ÁöÑÊó•ÂøóÔºåÂú®È°πÁõÆ‰∏≠ÈúÄË¶ÅÁöÑÂú∞ÊñπÈÄöËøá‰ΩøÁî®<code>zap.L().Xxx()</code>ÊñπÊ≥ïÊù•ËÆ∞ÂΩïËá™ÂÆö‰πâÊó•Âøó‰ø°ÊÅØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;gin_zap_demo/config&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;gin_zap_demo/logger&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// load config from config.json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">config</span><span class="p">.</span><span class="nf">Init</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// init logger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">InitLogger</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Conf</span><span class="p">.</span><span class="nx">LogConfig</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;init logger failed, err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">gin</span><span class="p">.</span><span class="nf">SetMode</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Conf</span><span class="p">.</span><span class="nx">Mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Ê≥®ÂÜåzapÁõ∏ÂÖ≥‰∏≠Èó¥‰ª∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">logger</span><span class="p">.</span><span class="nf">GinLogger</span><span class="p">(),</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">GinRecovery</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ÂÅáËÆæ‰Ω†Êúâ‰∏Ä‰∫õÊï∞ÊçÆÈúÄË¶ÅËÆ∞ÂΩïÂà∞Êó•Âøó‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="nx">name</span> <span class="p">=</span> <span class="s">&#34;q1mi&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="nx">age</span>  <span class="p">=</span> <span class="mi">18</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ËÆ∞ÂΩïÊó•ÂøóÂπ∂‰ΩøÁî®zap.Xxx(key, val)ËÆ∞ÂΩïÁõ∏ÂÖ≥Â≠óÊÆµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Debug</span><span class="p">(</span><span class="s">&#34;this is hello func&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">),</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="nx">age</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello liwenzhou.com!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">addr</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;:%v&#34;</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">Conf</span><span class="p">.</span><span class="nx">Port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://github.com/spf13/viper"  target="_blank" rel="noopener"
    >Viper</a>ÊòØÈÄÇÁî®‰∫éGoÂ∫îÁî®Á®ãÂ∫èÁöÑÂÆåÊï¥ÈÖçÁΩÆËß£ÂÜ≥ÊñπÊ°à„ÄÇÂÆÉË¢´ËÆæËÆ°Áî®‰∫éÂú®Â∫îÁî®Á®ãÂ∫è‰∏≠Â∑•‰ΩúÔºåÂπ∂‰∏îÂèØ‰ª•Â§ÑÁêÜÊâÄÊúâÁ±ªÂûãÁöÑÈÖçÁΩÆÈúÄÊ±ÇÂíåÊ†ºÂºè„ÄÇ</p>
<h1 id="viper">Viper</h1>
<p><a class="link" href="https://github.com/spf13/viper"  target="_blank" rel="noopener"
    >Viper</a>ÊòØÈÄÇÁî®‰∫éGoÂ∫îÁî®Á®ãÂ∫èÁöÑÂÆåÊï¥ÈÖçÁΩÆËß£ÂÜ≥ÊñπÊ°à„ÄÇÂÆÉË¢´ËÆæËÆ°Áî®‰∫éÂú®Â∫îÁî®Á®ãÂ∫è‰∏≠Â∑•‰ΩúÔºåÂπ∂‰∏îÂèØ‰ª•Â§ÑÁêÜÊâÄÊúâÁ±ªÂûãÁöÑÈÖçÁΩÆÈúÄÊ±ÇÂíåÊ†ºÂºè„ÄÇ</p>
<p>Èâ¥‰∫é<code>viper</code>Â∫ìÊú¨Ë∫´ÁöÑREADMEÂ∑≤ÁªèÂÜôÂæóÂçÅÂàÜËØ¶ÁªÜÔºåËøôÈáåÂ∞±Â∞ÜÂÖ∂ÁøªËØëÊàê‰∏≠ÊñáÔºåÂπ∂Âú®ÊúÄÂêéÈôÑ‰∏ä‰∏§‰∏™È°πÁõÆ‰∏≠‰ΩøÁî®<code>viper</code>ÁöÑÁ§∫‰æã‰ª£Á†Å‰ª•‰æõÂèÇËÄÉ„ÄÇ</p>
<h2 id="ÂÆâË£Ö-1">ÂÆâË£Ö</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get github.com/spf13/viper
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="‰ªÄ‰πàÊòØviper">‰ªÄ‰πàÊòØViperÔºü</h2>
<p>ViperÊòØÈÄÇÁî®‰∫éGoÂ∫îÁî®Á®ãÂ∫èÔºàÂåÖÊã¨<code>Twelve-Factor App</code>ÔºâÁöÑÂÆåÊï¥ÈÖçÁΩÆËß£ÂÜ≥ÊñπÊ°à„ÄÇÂÆÉË¢´ËÆæËÆ°Áî®‰∫éÂú®Â∫îÁî®Á®ãÂ∫è‰∏≠Â∑•‰ΩúÔºåÂπ∂‰∏îÂèØ‰ª•Â§ÑÁêÜÊâÄÊúâÁ±ªÂûãÁöÑÈÖçÁΩÆÈúÄÊ±ÇÂíåÊ†ºÂºè„ÄÇÂÆÉÊîØÊåÅ‰ª•‰∏ãÁâπÊÄßÔºö</p>
<ul>
<li>ËÆæÁΩÆÈªòËÆ§ÂÄº</li>
<li>‰ªé<code>JSON</code>„ÄÅ<code>TOML</code>„ÄÅ<code>YAML</code>„ÄÅ<code>HCL</code>„ÄÅ<code>envfile</code>Âíå<code>Java properties</code>Ê†ºÂºèÁöÑÈÖçÁΩÆÊñá‰ª∂ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØ</li>
<li>ÂÆûÊó∂ÁõëÊéßÂíåÈáçÊñ∞ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÔºàÂèØÈÄâÔºâ</li>
<li>‰ªéÁéØÂ¢ÉÂèòÈáè‰∏≠ËØªÂèñ</li>
<li>‰ªéËøúÁ®ãÈÖçÁΩÆÁ≥ªÁªüÔºàetcdÊàñConsulÔºâËØªÂèñÂπ∂ÁõëÊéßÈÖçÁΩÆÂèòÂåñ</li>
<li>‰ªéÂëΩ‰ª§Ë°åÂèÇÊï∞ËØªÂèñÈÖçÁΩÆ</li>
<li>‰ªébufferËØªÂèñÈÖçÁΩÆ</li>
<li>ÊòæÂºèÈÖçÁΩÆÂÄº</li>
</ul>
<h2 id="‰∏∫‰ªÄ‰πàÈÄâÊã©viper">‰∏∫‰ªÄ‰πàÈÄâÊã©Viper?</h2>
<p>Âú®ÊûÑÂª∫Áé∞‰ª£Â∫îÁî®Á®ãÂ∫èÊó∂Ôºå‰Ω†Êó†ÈúÄÊãÖÂøÉÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºèÔºõ‰Ω†ÊÉ≥Ë¶Å‰∏ìÊ≥®‰∫éÊûÑÂª∫Âá∫Ëâ≤ÁöÑËΩØ‰ª∂„ÄÇViperÁöÑÂá∫Áé∞Â∞±ÊòØ‰∏∫‰∫ÜÂú®ËøôÊñπÈù¢Â∏ÆÂä©‰Ω†ÁöÑ„ÄÇ</p>
<p>ViperËÉΩÂ§ü‰∏∫‰Ω†ÊâßË°å‰∏ãÂàóÊìç‰ΩúÔºö</p>
<ol>
<li>Êü•Êâæ„ÄÅÂä†ËΩΩÂíåÂèçÂ∫èÂàóÂåñ<code>JSON</code>„ÄÅ<code>TOML</code>„ÄÅ<code>YAML</code>„ÄÅ<code>HCL</code>„ÄÅ<code>INI</code>„ÄÅ<code>envfile</code>Âíå<code>Java properties</code>Ê†ºÂºèÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇ</li>
<li>Êèê‰æõ‰∏ÄÁßçÊú∫Âà∂‰∏∫‰Ω†ÁöÑ‰∏çÂêåÈÖçÁΩÆÈÄâÈ°πËÆæÁΩÆÈªòËÆ§ÂÄº„ÄÇ</li>
<li>Êèê‰æõ‰∏ÄÁßçÊú∫Âà∂Êù•ÈÄöËøáÂëΩ‰ª§Ë°åÂèÇÊï∞Ë¶ÜÁõñÊåáÂÆöÈÄâÈ°πÁöÑÂÄº„ÄÇ</li>
<li>Êèê‰æõÂà´ÂêçÁ≥ªÁªüÔºå‰ª•‰æøÂú®‰∏çÁ†¥ÂùèÁé∞Êúâ‰ª£Á†ÅÁöÑÊÉÖÂÜµ‰∏ãËΩªÊùæÈáçÂëΩÂêçÂèÇÊï∞„ÄÇ</li>
<li>ÂΩìÁî®Êà∑Êèê‰æõ‰∫Ü‰∏éÈªòËÆ§ÂÄºÁõ∏ÂêåÁöÑÂëΩ‰ª§Ë°åÊàñÈÖçÁΩÆÊñá‰ª∂Êó∂ÔºåÂèØ‰ª•ÂæàÂÆπÊòìÂú∞ÂàÜËæ®Âá∫ÂÆÉ‰ª¨‰πãÈó¥ÁöÑÂå∫Âà´„ÄÇ</li>
</ol>
<p>Viper‰ºöÊåâÁÖß‰∏ãÈù¢ÁöÑ‰ºòÂÖàÁ∫ß„ÄÇÊØè‰∏™È°πÁõÆÁöÑ‰ºòÂÖàÁ∫ßÈÉΩÈ´ò‰∫éÂÆÉ‰∏ãÈù¢ÁöÑÈ°πÁõÆ:</p>
<ul>
<li>ÊòæÁ§∫Ë∞ÉÁî®<code>Set</code>ËÆæÁΩÆÂÄº</li>
<li>ÂëΩ‰ª§Ë°åÂèÇÊï∞ÔºàflagÔºâ</li>
<li>ÁéØÂ¢ÉÂèòÈáè</li>
<li>ÈÖçÁΩÆÊñá‰ª∂</li>
<li>key/valueÂ≠òÂÇ®</li>
<li>ÈªòËÆ§ÂÄº</li>
</ul>
<p><strong>ÈáçË¶ÅÔºö</strong> ÁõÆÂâçViperÈÖçÁΩÆÁöÑÈîÆÔºàKeyÔºâÊòØÂ§ßÂ∞èÂÜô‰∏çÊïèÊÑüÁöÑ„ÄÇÁõÆÂâçÊ≠£Âú®ËÆ®ËÆ∫ÊòØÂê¶Â∞ÜËøô‰∏ÄÈÄâÈ°πËÆæ‰∏∫ÂèØÈÄâ„ÄÇ</p>
<h2 id="ÊääÂÄºÂ≠òÂÖ•viper">ÊääÂÄºÂ≠òÂÖ•Viper</h2>
<h3 id="Âª∫Á´ãÈªòËÆ§ÂÄº">Âª∫Á´ãÈªòËÆ§ÂÄº</h3>
<p>‰∏Ä‰∏™Â•ΩÁöÑÈÖçÁΩÆÁ≥ªÁªüÂ∫îËØ•ÊîØÊåÅÈªòËÆ§ÂÄº„ÄÇÈîÆ‰∏çÈúÄË¶ÅÈªòËÆ§ÂÄºÔºå‰ΩÜÂ¶ÇÊûúÊ≤°ÊúâÈÄöËøáÈÖçÁΩÆÊñá‰ª∂„ÄÅÁéØÂ¢ÉÂèòÈáè„ÄÅËøúÁ®ãÈÖçÁΩÆÊàñÂëΩ‰ª§Ë°åÊ†áÂøóÔºàflagÔºâËÆæÁΩÆÈîÆÔºåÂàôÈªòËÆ§ÂÄºÈùûÂ∏∏ÊúâÁî®„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetDefault</span><span class="p">(</span><span class="s">&#34;ContentDir&#34;</span><span class="p">,</span> <span class="s">&#34;content&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetDefault</span><span class="p">(</span><span class="s">&#34;LayoutDir&#34;</span><span class="p">,</span> <span class="s">&#34;layouts&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetDefault</span><span class="p">(</span><span class="s">&#34;Taxonomies&#34;</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;tag&#34;</span><span class="p">:</span> <span class="s">&#34;tags&#34;</span><span class="p">,</span> <span class="s">&#34;category&#34;</span><span class="p">:</span> <span class="s">&#34;categories&#34;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ËØªÂèñÈÖçÁΩÆÊñá‰ª∂">ËØªÂèñÈÖçÁΩÆÊñá‰ª∂</h3>
<p>ViperÈúÄË¶ÅÊúÄÂ∞ëÁü•ÈÅìÂú®Âì™ÈáåÊü•ÊâæÈÖçÁΩÆÊñá‰ª∂ÁöÑÈÖçÁΩÆ„ÄÇViperÊîØÊåÅ<code>JSON</code>„ÄÅ<code>TOML</code>„ÄÅ<code>YAML</code>„ÄÅ<code>HCL</code>„ÄÅ<code>envfile</code>Âíå<code>Java properties</code>Ê†ºÂºèÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇViperÂèØ‰ª•ÊêúÁ¥¢Â§ö‰∏™Ë∑ØÂæÑÔºå‰ΩÜÁõÆÂâçÂçï‰∏™ViperÂÆû‰æãÂè™ÊîØÊåÅÂçï‰∏™ÈÖçÁΩÆÊñá‰ª∂„ÄÇViper‰∏çÈªòËÆ§‰ªª‰ΩïÈÖçÁΩÆÊêúÁ¥¢Ë∑ØÂæÑÔºåÂ∞ÜÈªòËÆ§ÂÜ≥Á≠ñÁïôÁªôÂ∫îÁî®Á®ãÂ∫è„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØ‰∏Ä‰∏™Â¶Ç‰Ωï‰ΩøÁî®ViperÊêúÁ¥¢ÂíåËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÁ§∫‰æã„ÄÇ‰∏çÈúÄË¶Å‰ªª‰ΩïÁâπÂÆöÁöÑË∑ØÂæÑÔºå‰ΩÜÊòØËá≥Â∞ëÂ∫îËØ•Êèê‰æõ‰∏Ä‰∏™ÈÖçÁΩÆÊñá‰ª∂È¢ÑÊúüÂá∫Áé∞ÁöÑË∑ØÂæÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigFile</span><span class="p">(</span><span class="s">&#34;./config.yaml&#34;</span><span class="p">)</span> <span class="c1">// ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigName</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">)</span> <span class="c1">// ÈÖçÁΩÆÊñá‰ª∂ÂêçÁß∞(Êó†Êâ©Â±ïÂêç)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;yaml&#34;</span><span class="p">)</span> <span class="c1">// Â¶ÇÊûúÈÖçÁΩÆÊñá‰ª∂ÁöÑÂêçÁß∞‰∏≠Ê≤°ÊúâÊâ©Â±ïÂêçÔºåÂàôÈúÄË¶ÅÈÖçÁΩÆÊ≠§È°π
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;/etc/appname/&#34;</span><span class="p">)</span>   <span class="c1">// Êü•ÊâæÈÖçÁΩÆÊñá‰ª∂ÊâÄÂú®ÁöÑË∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;$HOME/.appname&#34;</span><span class="p">)</span>  <span class="c1">// Â§öÊ¨°Ë∞ÉÁî®‰ª•Ê∑ªÂä†Â§ö‰∏™ÊêúÁ¥¢Ë∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">)</span>               <span class="c1">// ËøòÂèØ‰ª•Âú®Â∑•‰ΩúÁõÆÂΩï‰∏≠Êü•ÊâæÈÖçÁΩÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">()</span> <span class="c1">// Êü•ÊâæÂπ∂ËØªÂèñÈÖçÁΩÆÊñá‰ª∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span> <span class="c1">// Â§ÑÁêÜËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÈîôËØØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Fatal error config file: %s \n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®Âä†ËΩΩÈÖçÁΩÆÊñá‰ª∂Âá∫ÈîôÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÉè‰∏ãÈù¢ËøôÊ†∑Â§ÑÁêÜÊâæ‰∏çÂà∞ÈÖçÁΩÆÊñá‰ª∂ÁöÑÁâπÂÆöÊÉÖÂÜµÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">viper</span><span class="p">.</span><span class="nx">ConfigFileNotFoundError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÈÖçÁΩÆÊñá‰ª∂Êú™ÊâæÂà∞ÈîôËØØÔºõÂ¶ÇÊûúÈúÄË¶ÅÂèØ‰ª•ÂøΩÁï•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÈÖçÁΩÆÊñá‰ª∂Ë¢´ÊâæÂà∞Ôºå‰ΩÜ‰∫ßÁîü‰∫ÜÂè¶Â§ñÁöÑÈîôËØØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÈÖçÁΩÆÊñá‰ª∂ÊâæÂà∞Âπ∂ÊàêÂäüËß£Êûê
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><em>Ê≥®ÊÑè[Ëá™1.6Ëµ∑]Ôºö</em> ‰Ω†‰πüÂèØ‰ª•Êúâ‰∏çÂ∏¶Êâ©Â±ïÂêçÁöÑÊñá‰ª∂ÔºåÂπ∂‰ª•ÁºñÁ®ãÊñπÂºèÊåáÂÆöÂÖ∂Ê†ºÂºè„ÄÇÂØπ‰∫é‰Ωç‰∫éÁî®Êà∑<code>$HOME</code>ÁõÆÂΩï‰∏≠ÁöÑÈÖçÁΩÆÊñá‰ª∂Ê≤°Êúâ‰ªª‰ΩïÊâ©Â±ïÂêçÔºåÂ¶Ç<code>.bashrc</code>„ÄÇ</p>
<p><strong>ËøôÈáåË°•ÂÖÖ‰∏§‰∏™ÈóÆÈ¢ò‰æõËØªËÄÖËß£Á≠îÂπ∂Ëá™Ë°åÈ™åËØÅ</strong></p>
<p>ÂΩì‰Ω†‰ΩøÁî®Â¶Ç‰∏ãÊñπÂºèËØªÂèñÈÖçÁΩÆÊó∂Ôºåviper‰ºö‰ªé<code>./conf</code>ÁõÆÂΩï‰∏ãÊü•Êâæ‰ªª‰Ωï‰ª•<code>config</code>‰∏∫Êñá‰ª∂ÂêçÁöÑÈÖçÁΩÆÊñá‰ª∂ÔºåÂ¶ÇÊûúÂêåÊó∂Â≠òÂú®<code>./conf/config.json</code>Âíå<code>./conf/config.yaml</code>‰∏§‰∏™ÈÖçÁΩÆÊñá‰ª∂ÁöÑËØùÔºå<code>viper</code>‰ºö‰ªéÂì™‰∏™ÈÖçÁΩÆÊñá‰ª∂Âä†ËΩΩÈÖçÁΩÆÂë¢Ôºü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigName</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;./conf&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®‰∏äÈù¢‰∏§‰∏™ËØ≠Âè•‰∏ãÊê≠ÈÖç‰ΩøÁî®<code>viper.SetConfigType(&quot;yaml&quot;)</code>ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂Á±ªÂûãÂèØ‰ª•ÂÆûÁé∞È¢ÑÊúüÁöÑÊïàÊûúÂêóÔºü</p>
<h3 id="ÂÜôÂÖ•ÈÖçÁΩÆÊñá‰ª∂">ÂÜôÂÖ•ÈÖçÁΩÆÊñá‰ª∂</h3>
<p>‰ªéÈÖçÁΩÆÊñá‰ª∂‰∏≠ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÊòØÊúâÁî®ÁöÑÔºå‰ΩÜÊòØÊúâÊó∂‰Ω†ÊÉ≥Ë¶ÅÂ≠òÂÇ®Âú®ËøêË°åÊó∂ÊâÄÂÅöÁöÑÊâÄÊúâ‰øÆÊîπ„ÄÇ‰∏∫Ê≠§ÔºåÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢‰∏ÄÁªÑÂëΩ‰ª§ÔºåÊØè‰∏™ÂëΩ‰ª§ÈÉΩÊúâËá™Â∑±ÁöÑÁî®ÈÄî:</p>
<ul>
<li>WriteConfig - Â∞ÜÂΩìÂâçÁöÑ<code>viper</code>ÈÖçÁΩÆÂÜôÂÖ•È¢ÑÂÆö‰πâÁöÑË∑ØÂæÑÂπ∂Ë¶ÜÁõñÔºàÂ¶ÇÊûúÂ≠òÂú®ÁöÑËØùÔºâ„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÈ¢ÑÂÆö‰πâÁöÑË∑ØÂæÑÔºåÂàôÊä•Èîô„ÄÇ</li>
<li>SafeWriteConfig - Â∞ÜÂΩìÂâçÁöÑ<code>viper</code>ÈÖçÁΩÆÂÜôÂÖ•È¢ÑÂÆö‰πâÁöÑË∑ØÂæÑ„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÈ¢ÑÂÆö‰πâÁöÑË∑ØÂæÑÔºåÂàôÊä•Èîô„ÄÇÂ¶ÇÊûúÂ≠òÂú®ÔºåÂ∞Ü‰∏ç‰ºöË¶ÜÁõñÂΩìÂâçÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇ</li>
<li>WriteConfigAs - Â∞ÜÂΩìÂâçÁöÑ<code>viper</code>ÈÖçÁΩÆÂÜôÂÖ•ÁªôÂÆöÁöÑÊñá‰ª∂Ë∑ØÂæÑ„ÄÇÂ∞ÜË¶ÜÁõñÁªôÂÆöÁöÑÊñá‰ª∂(Â¶ÇÊûúÂÆÉÂ≠òÂú®ÁöÑËØù)„ÄÇ</li>
<li>SafeWriteConfigAs - Â∞ÜÂΩìÂâçÁöÑ<code>viper</code>ÈÖçÁΩÆÂÜôÂÖ•ÁªôÂÆöÁöÑÊñá‰ª∂Ë∑ØÂæÑ„ÄÇ‰∏ç‰ºöË¶ÜÁõñÁªôÂÆöÁöÑÊñá‰ª∂(Â¶ÇÊûúÂÆÉÂ≠òÂú®ÁöÑËØù)„ÄÇ</li>
</ul>
<p>Ê†πÊçÆÁªèÈ™åÔºåÊ†áËÆ∞‰∏∫<code>safe</code>ÁöÑÊâÄÊúâÊñπÊ≥ïÈÉΩ‰∏ç‰ºöË¶ÜÁõñ‰ªª‰ΩïÊñá‰ª∂ÔºåËÄåÊòØÁõ¥Êé•ÂàõÂª∫ÔºàÂ¶ÇÊûú‰∏çÂ≠òÂú®ÔºâÔºåËÄåÈªòËÆ§Ë°å‰∏∫ÊòØÂàõÂª∫ÊàñÊà™Êñ≠„ÄÇ</p>
<p>‰∏Ä‰∏™Â∞èÁ§∫‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">WriteConfig</span><span class="p">()</span> <span class="c1">// Â∞ÜÂΩìÂâçÈÖçÁΩÆÂÜôÂÖ•‚Äúviper.AddConfigPath()‚ÄùÂíå‚Äúviper.SetConfigName‚ÄùËÆæÁΩÆÁöÑÈ¢ÑÂÆö‰πâË∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">SafeWriteConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">WriteConfigAs</span><span class="p">(</span><span class="s">&#34;/path/to/my/.config&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SafeWriteConfigAs</span><span class="p">(</span><span class="s">&#34;/path/to/my/.config&#34;</span><span class="p">)</span> <span class="c1">// Âõ†‰∏∫ËØ•ÈÖçÁΩÆÊñá‰ª∂ÂÜôÂÖ•ËøáÔºåÊâÄ‰ª•‰ºöÊä•Èîô
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">SafeWriteConfigAs</span><span class="p">(</span><span class="s">&#34;/path/to/my/.other_config&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÁõëÊéßÂπ∂ÈáçÊñ∞ËØªÂèñÈÖçÁΩÆÊñá‰ª∂">ÁõëÊéßÂπ∂ÈáçÊñ∞ËØªÂèñÈÖçÁΩÆÊñá‰ª∂</h3>
<p>ViperÊîØÊåÅÂú®ËøêË°åÊó∂ÂÆûÊó∂ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÂäüËÉΩ„ÄÇ</p>
<p>ÈúÄË¶ÅÈáçÊñ∞ÂêØÂä®ÊúçÂä°Âô®‰ª•‰ΩøÈÖçÁΩÆÁîüÊïàÁöÑÊó•Â≠êÂ∑≤Áªè‰∏ÄÂéª‰∏çÂ§çËøî‰∫ÜÔºåviperÈ©±Âä®ÁöÑÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•Âú®ËøêË°åÊó∂ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÊõ¥Êñ∞ÔºåËÄå‰∏ç‰ºöÈîôËøá‰ªª‰ΩïÊ∂àÊÅØ„ÄÇ</p>
<p>Âè™ÈúÄÂëäËØâviperÂÆû‰æãwatchConfig„ÄÇÂèØÈÄâÂú∞Ôºå‰Ω†ÂèØ‰ª•‰∏∫ViperÊèê‰æõ‰∏Ä‰∏™ÂõûË∞ÉÂáΩÊï∞Ôºå‰ª•‰æøÂú®ÊØèÊ¨°ÂèëÁîüÊõ¥ÊîπÊó∂ËøêË°å„ÄÇ</p>
<p><strong>Á°Æ‰øùÂú®Ë∞ÉÁî®<code>WatchConfig()</code>‰πãÂâçÊ∑ªÂä†‰∫ÜÊâÄÊúâÁöÑÈÖçÁΩÆË∑ØÂæÑ„ÄÇ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">WatchConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">OnConfigChange</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">e</span> <span class="nx">fsnotify</span><span class="p">.</span><span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ÈÖçÁΩÆÊñá‰ª∂ÂèëÁîüÂèòÊõ¥‰πãÂêé‰ºöË∞ÉÁî®ÁöÑÂõûË∞ÉÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Config file changed:&#34;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ªéioreaderËØªÂèñÈÖçÁΩÆ">‰ªéio.ReaderËØªÂèñÈÖçÁΩÆ</h3>
<p>ViperÈ¢ÑÂÖàÂÆö‰πâ‰∫ÜËÆ∏Â§öÈÖçÁΩÆÊ∫êÔºåÂ¶ÇÊñá‰ª∂„ÄÅÁéØÂ¢ÉÂèòÈáè„ÄÅÊ†áÂøóÂíåËøúÁ®ãK/VÂ≠òÂÇ®Ôºå‰ΩÜ‰Ω†‰∏çÂèóÂÖ∂Á∫¶Êùü„ÄÇ‰Ω†ËøòÂèØ‰ª•ÂÆûÁé∞Ëá™Â∑±ÊâÄÈúÄÁöÑÈÖçÁΩÆÊ∫êÂπ∂Â∞ÜÂÖ∂Êèê‰æõÁªôviper„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;yaml&#34;</span><span class="p">)</span> <span class="c1">// ÊàñËÄÖ viper.SetConfigType(&#34;YAML&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ‰ªª‰ΩïÈúÄË¶ÅÂ∞ÜÊ≠§ÈÖçÁΩÆÊ∑ªÂä†Âà∞Á®ãÂ∫è‰∏≠ÁöÑÊñπÊ≥ï„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">yamlExample</span> <span class="p">=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">Hacker: true
</span></span></span><span class="line"><span class="cl"><span class="s">name: steve
</span></span></span><span class="line"><span class="cl"><span class="s">hobbies:
</span></span></span><span class="line"><span class="cl"><span class="s">- skateboarding
</span></span></span><span class="line"><span class="cl"><span class="s">- snowboarding
</span></span></span><span class="line"><span class="cl"><span class="s">- go
</span></span></span><span class="line"><span class="cl"><span class="s">clothing:
</span></span></span><span class="line"><span class="cl"><span class="s">  jacket: leather
</span></span></span><span class="line"><span class="cl"><span class="s">  trousers: denim
</span></span></span><span class="line"><span class="cl"><span class="s">age: 35
</span></span></span><span class="line"><span class="cl"><span class="s">eyes : brown
</span></span></span><span class="line"><span class="cl"><span class="s">beard: true
</span></span></span><span class="line"><span class="cl"><span class="s">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">ReadConfig</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nf">NewBuffer</span><span class="p">(</span><span class="nx">yamlExample</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">)</span> <span class="c1">// ËøôÈáå‰ºöÂæóÂà∞ &#34;steve&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ë¶ÜÁõñËÆæÁΩÆ">Ë¶ÜÁõñËÆæÁΩÆ</h3>
<p>Ëøô‰∫õÂèØËÉΩÊù•Ëá™ÂëΩ‰ª§Ë°åÊ†áÂøóÔºå‰πüÂèØËÉΩÊù•Ëá™‰Ω†Ëá™Â∑±ÁöÑÂ∫îÁî®Á®ãÂ∫èÈÄªËæë„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Verbose&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;LogFile&#34;</span><span class="p">,</span> <span class="nx">LogFile</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê≥®ÂÜåÂíå‰ΩøÁî®Âà´Âêç">Ê≥®ÂÜåÂíå‰ΩøÁî®Âà´Âêç</h3>
<p>Âà´ÂêçÂÖÅËÆ∏Â§ö‰∏™ÈîÆÂºïÁî®Âçï‰∏™ÂÄº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">RegisterAlias</span><span class="p">(</span><span class="s">&#34;loud&#34;</span><span class="p">,</span> <span class="s">&#34;Verbose&#34;</span><span class="p">)</span>  <span class="c1">// Ê≥®ÂÜåÂà´ÂêçÔºàÊ≠§Â§ÑloudÂíåVerboseÂª∫Á´ã‰∫ÜÂà´ÂêçÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;verbose&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// ÁªìÊûú‰∏é‰∏ã‰∏ÄË°åÁõ∏Âêå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;loud&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>   <span class="c1">// ÁªìÊûú‰∏éÂâç‰∏ÄË°åÁõ∏Âêå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">GetBool</span><span class="p">(</span><span class="s">&#34;loud&#34;</span><span class="p">)</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">viper</span><span class="p">.</span><span class="nf">GetBool</span><span class="p">(</span><span class="s">&#34;verbose&#34;</span><span class="p">)</span> <span class="c1">// true
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáè">‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáè</h3>
<p>ViperÂÆåÂÖ®ÊîØÊåÅÁéØÂ¢ÉÂèòÈáè„ÄÇËøô‰Ωø<code>Twelve-Factor App</code>ÂºÄÁÆ±Âç≥Áî®„ÄÇÊúâ‰∫îÁßçÊñπÊ≥ïÂèØ‰ª•Â∏ÆÂä©‰∏éENVÂçè‰Ωú:</p>
<ul>
<li><code>AutomaticEnv()</code></li>
<li><code>BindEnv(string...) : error</code></li>
<li><code>SetEnvPrefix(string)</code></li>
<li><code>SetEnvKeyReplacer(string...) *strings.Replacer</code></li>
<li><code>AllowEmptyEnv(bool)</code></li>
</ul>
<p><em>‰ΩøÁî®ENVÂèòÈáèÊó∂ÔºåÂä°ÂøÖË¶ÅÊÑèËØÜÂà∞ViperÂ∞ÜENVÂèòÈáèËßÜ‰∏∫Âå∫ÂàÜÂ§ßÂ∞èÂÜô„ÄÇ</em></p>
<p>ViperÊèê‰æõ‰∫Ü‰∏ÄÁßçÊú∫Âà∂Êù•Á°Æ‰øùENVÂèòÈáèÊòØÊÉü‰∏ÄÁöÑ„ÄÇÈÄöËøá‰ΩøÁî®<code>SetEnvPrefix</code>Ôºå‰Ω†ÂèØ‰ª•ÂëäËØâViperÂú®ËØªÂèñÁéØÂ¢ÉÂèòÈáèÊó∂‰ΩøÁî®ÂâçÁºÄ„ÄÇ<code>BindEnv</code>Âíå<code>AutomaticEnv</code>ÈÉΩÂ∞Ü‰ΩøÁî®Ëøô‰∏™ÂâçÁºÄ„ÄÇ</p>
<p><code>BindEnv</code>‰ΩøÁî®‰∏Ä‰∏™Êàñ‰∏§‰∏™ÂèÇÊï∞„ÄÇÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØÈîÆÂêçÁß∞ÔºåÁ¨¨‰∫å‰∏™ÊòØÁéØÂ¢ÉÂèòÈáèÁöÑÂêçÁß∞„ÄÇÁéØÂ¢ÉÂèòÈáèÁöÑÂêçÁß∞Âå∫ÂàÜÂ§ßÂ∞èÂÜô„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÊèê‰æõENVÂèòÈáèÂêçÔºåÈÇ£‰πàViperÂ∞ÜËá™Âä®ÂÅáËÆæENVÂèòÈáè‰∏é‰ª•‰∏ãÊ†ºÂºèÂåπÈÖçÔºöÂâçÁºÄ+ ‚Äú_‚Äù +ÈîÆÂêçÂÖ®ÈÉ®Â§ßÂÜô„ÄÇÂΩì‰Ω†ÊòæÂºèÊèê‰æõENVÂèòÈáèÂêçÔºàÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÔºâÊó∂ÔºåÂÆÉ <strong>‰∏ç‰ºö</strong> Ëá™Âä®Ê∑ªÂä†ÂâçÁºÄ„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÁ¨¨‰∫å‰∏™ÂèÇÊï∞ÊòØ‚Äúid‚ÄùÔºåViperÂ∞ÜÊü•ÊâæÁéØÂ¢ÉÂèòÈáè‚ÄúID‚Äù„ÄÇ</p>
<p>Âú®‰ΩøÁî®ENVÂèòÈáèÊó∂ÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑ‰∏Ä‰ª∂ÈáçË¶Å‰∫ãÊÉÖÊòØÔºåÊØèÊ¨°ËÆøÈóÆËØ•ÂÄºÊó∂ÈÉΩÂ∞ÜËØªÂèñÂÆÉ„ÄÇViperÂú®Ë∞ÉÁî®<code>BindEnv</code>Êó∂‰∏çÂõ∫ÂÆöËØ•ÂÄº„ÄÇ</p>
<p><code>AutomaticEnv</code>ÊòØ‰∏Ä‰∏™Âº∫Â§ßÁöÑÂä©ÊâãÔºåÂ∞§ÂÖ∂ÊòØ‰∏é<code>SetEnvPrefix</code>ÁªìÂêà‰ΩøÁî®Êó∂„ÄÇË∞ÉÁî®Êó∂ÔºåViper‰ºöÂú®ÂèëÂá∫<code>viper.Get</code>ËØ∑Ê±ÇÊó∂ÈöèÊó∂Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáè„ÄÇÂÆÉÂ∞ÜÂ∫îÁî®‰ª•‰∏ãËßÑÂàô„ÄÇÂÆÉÂ∞ÜÊ£ÄÊü•ÁéØÂ¢ÉÂèòÈáèÁöÑÂêçÁß∞ÊòØÂê¶‰∏éÈîÆÂåπÈÖçÔºàÂ¶ÇÊûúËÆæÁΩÆ‰∫Ü<code>EnvPrefix</code>Ôºâ„ÄÇ</p>
<p><code>SetEnvKeyReplacer</code>ÂÖÅËÆ∏‰Ω†‰ΩøÁî®<code>strings.Replacer</code>ÂØπË±°Âú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÈáçÂÜô Env ÈîÆ„ÄÇÂ¶ÇÊûú‰Ω†Â∏åÊúõÂú®<code>Get()</code>Ë∞ÉÁî®‰∏≠‰ΩøÁî®<code>-</code>ÊàñËÄÖÂÖ∂‰ªñ‰ªÄ‰πàÁ¨¶Âè∑Ôºå‰ΩÜÊòØÁéØÂ¢ÉÂèòÈáèÈáå‰ΩøÁî®<code>_</code>ÂàÜÈöîÁ¨¶ÔºåÈÇ£‰πàËøô‰∏™ÂäüËÉΩÊòØÈùûÂ∏∏ÊúâÁî®ÁöÑ„ÄÇÂèØ‰ª•Âú®<code>viper_test.go</code>‰∏≠ÊâæÂà∞ÂÆÉÁöÑ‰ΩøÁî®Á§∫‰æã„ÄÇ</p>
<p>ÊàñËÄÖÔºå‰Ω†ÂèØ‰ª•‰ΩøÁî®Â∏¶Êúâ<code>NewWithOptions</code>Â∑•ÂéÇÂáΩÊï∞ÁöÑ<code>EnvKeyReplacer</code>„ÄÇ‰∏é<code>SetEnvKeyReplacer</code>‰∏çÂêåÔºåÂÆÉÊé•Âèó<code>StringReplacer</code>Êé•Âè£ÔºåÂÖÅËÆ∏‰Ω†ÁºñÂÜôËá™ÂÆö‰πâÂ≠óÁ¨¶‰∏≤ÊõøÊç¢ÈÄªËæë„ÄÇ</p>
<p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÁ©∫ÁéØÂ¢ÉÂèòÈáèË¢´ËÆ§‰∏∫ÊòØÊú™ËÆæÁΩÆÁöÑÔºåÂπ∂Â∞ÜËøîÂõûÂà∞‰∏ã‰∏Ä‰∏™ÈÖçÁΩÆÊ∫ê„ÄÇËã•Ë¶ÅÂ∞ÜÁ©∫ÁéØÂ¢ÉÂèòÈáèËßÜ‰∏∫Â∑≤ËÆæÁΩÆÔºåËØ∑‰ΩøÁî®<code>AllowEmptyEnv</code>ÊñπÊ≥ï„ÄÇ</p>
<h4 id="env-Á§∫‰æã">Env Á§∫‰æãÔºö</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nf">SetEnvPrefix</span><span class="p">(</span><span class="s">&#34;spf&#34;</span><span class="p">)</span> <span class="c1">// Â∞ÜËá™Âä®ËΩ¨‰∏∫Â§ßÂÜô
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">BindEnv</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">os</span><span class="p">.</span><span class="nf">Setenv</span><span class="p">(</span><span class="s">&#34;SPF_ID&#34;</span><span class="p">,</span> <span class="s">&#34;13&#34;</span><span class="p">)</span> <span class="c1">// ÈÄöÂ∏∏ÊòØÂú®Â∫îÁî®Á®ãÂ∫è‰πãÂ§ñÂÆåÊàêÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">id</span> <span class="o">:=</span> <span class="nf">Get</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span> <span class="c1">// 13
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ΩøÁî®flags">‰ΩøÁî®Flags</h3>
<p>Viper ÂÖ∑ÊúâÁªëÂÆöÂà∞Ê†áÂøóÁöÑËÉΩÂäõ„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåViperÊîØÊåÅ<a class="link" href="https://github.com/spf13/cobra"  target="_blank" rel="noopener"
    >Cobra</a>Â∫ì‰∏≠‰ΩøÁî®ÁöÑ<code>Pflag</code>„ÄÇ</p>
<p>‰∏é<code>BindEnv</code>Á±ª‰ººÔºåËØ•ÂÄº‰∏çÊòØÂú®Ë∞ÉÁî®ÁªëÂÆöÊñπÊ≥ïÊó∂ËÆæÁΩÆÁöÑÔºåËÄåÊòØÂú®ËÆøÈóÆËØ•ÊñπÊ≥ïÊó∂ËÆæÁΩÆÁöÑ„ÄÇËøôÊÑèÂë≥ÁùÄ‰Ω†ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂ∞ΩÊó©ËøõË°åÁªëÂÆöÔºåÂç≥‰ΩøÂú®<code>init()</code>ÂáΩÊï∞‰∏≠‰πüÊòØÂ¶ÇÊ≠§„ÄÇ</p>
<p>ÂØπ‰∫éÂçï‰∏™Ê†áÂøóÔºå<code>BindPFlag()</code>ÊñπÊ≥ïÊèê‰æõÊ≠§ÂäüËÉΩ„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">serverCmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;port&#34;</span><span class="p">,</span> <span class="mi">1138</span><span class="p">,</span> <span class="s">&#34;Port to run Application server on&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">BindPFlag</span><span class="p">(</span><span class="s">&#34;port&#34;</span><span class="p">,</span> <span class="nx">serverCmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">Lookup</span><span class="p">(</span><span class="s">&#34;port&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰Ω†ËøòÂèØ‰ª•ÁªëÂÆö‰∏ÄÁªÑÁé∞ÊúâÁöÑpflags Ôºàpflag.FlagSetÔºâÔºö</p>
<p>‰∏æ‰∏™‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">pflag</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;flagname&#34;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="s">&#34;help message for flagname&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">pflag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">BindPFlags</span><span class="p">(</span><span class="nx">pflag</span><span class="p">.</span><span class="nx">CommandLine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">i</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;flagname&#34;</span><span class="p">)</span> <span class="c1">// ‰ªéviperËÄå‰∏çÊòØ‰ªépflagÊ£ÄÁ¥¢ÂÄº
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Âú® Viper ‰∏≠‰ΩøÁî® pflag Âπ∂‰∏çÈòªÁ¢çÂÖ∂‰ªñÂåÖ‰∏≠‰ΩøÁî®Ê†áÂáÜÂ∫ì‰∏≠ÁöÑ flag ÂåÖ„ÄÇpflag ÂåÖÂèØ‰ª•ÈÄöËøáÂØºÂÖ•Ëøô‰∫õ flags Êù•Â§ÑÁêÜflagÂåÖÂÆö‰πâÁöÑflags„ÄÇËøôÊòØÈÄöËøáË∞ÉÁî®pflagÂåÖÊèê‰æõÁöÑ‰æøÂà©ÂáΩÊï∞<code>AddGoFlagSet()</code>Êù•ÂÆûÁé∞ÁöÑ„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;flag&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/pflag&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ‰ΩøÁî®Ê†áÂáÜÂ∫ì &#34;flag&#34; ÂåÖ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">flag</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;flagname&#34;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="s">&#34;help message for flagname&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">pflag</span><span class="p">.</span><span class="nx">CommandLine</span><span class="p">.</span><span class="nf">AddGoFlagSet</span><span class="p">(</span><span class="nx">flag</span><span class="p">.</span><span class="nx">CommandLine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">pflag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">BindPFlags</span><span class="p">(</span><span class="nx">pflag</span><span class="p">.</span><span class="nx">CommandLine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;flagname&#34;</span><span class="p">)</span> <span class="c1">// ‰ªé viper Ê£ÄÁ¥¢ÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="flagÊé•Âè£">flagÊé•Âè£</h4>
<p>Â¶ÇÊûú‰Ω†‰∏ç‰ΩøÁî®<code>Pflag</code>ÔºåViper Êèê‰æõ‰∫Ü‰∏§‰∏™GoÊé•Âè£Êù•ÁªëÂÆöÂÖ∂‰ªñ flag Á≥ªÁªü„ÄÇ</p>
<p><code>FlagValue</code>Ë°®Á§∫Âçï‰∏™flag„ÄÇËøôÊòØ‰∏Ä‰∏™ÂÖ≥‰∫éÂ¶Ç‰ΩïÂÆûÁé∞Ëøô‰∏™Êé•Âè£ÁöÑÈùûÂ∏∏ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">myFlag</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">myFlag</span><span class="p">)</span> <span class="nf">HasChanged</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">myFlag</span><span class="p">)</span> <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;my-flag-name&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">myFlag</span><span class="p">)</span> <span class="nf">ValueString</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;my-flag-value&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">myFlag</span><span class="p">)</span> <span class="nf">ValueType</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;string&#34;</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ÄÊó¶‰Ω†ÁöÑ flag ÂÆûÁé∞‰∫ÜËøô‰∏™Êé•Âè£Ôºå‰Ω†ÂèØ‰ª•ÂæàÊñπ‰æøÂú∞ÂëäËØâViperÁªëÂÆöÂÆÉÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">BindFlagValue</span><span class="p">(</span><span class="s">&#34;my-flag-name&#34;</span><span class="p">,</span> <span class="nx">myFlag</span><span class="p">{})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>FlagValueSet</code>‰ª£Ë°®‰∏ÄÁªÑ flags „ÄÇËøôÊòØ‰∏Ä‰∏™ÂÖ≥‰∫éÂ¶Ç‰ΩïÂÆûÁé∞Ëøô‰∏™Êé•Âè£ÁöÑÈùûÂ∏∏ÁÆÄÂçïÁöÑ‰æãÂ≠ê:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">myFlagSet</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">flags</span> <span class="p">[]</span><span class="nx">myFlag</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">myFlagSet</span><span class="p">)</span> <span class="nf">VisitAll</span><span class="p">(</span><span class="nx">fn</span> <span class="kd">func</span><span class="p">(</span><span class="nx">FlagValue</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">flag</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">flags</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">fn</span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ÄÊó¶‰Ω†ÁöÑflag setÂÆûÁé∞‰∫ÜËøô‰∏™Êé•Âè£Ôºå‰Ω†Â∞±ÂèØ‰ª•ÂæàÊñπ‰æøÂú∞ÂëäËØâViperÁªëÂÆöÂÆÉÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">fSet</span> <span class="o">:=</span> <span class="nx">myFlagSet</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">flags</span><span class="p">:</span> <span class="p">[]</span><span class="nx">myFlag</span><span class="p">{</span><span class="nx">myFlag</span><span class="p">{},</span> <span class="nx">myFlag</span><span class="p">{}},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">BindFlagValues</span><span class="p">(</span><span class="s">&#34;my-flags&#34;</span><span class="p">,</span> <span class="nx">fSet</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ËøúÁ®ãkeyvalueÂ≠òÂÇ®ÊîØÊåÅ">ËøúÁ®ãKey/ValueÂ≠òÂÇ®ÊîØÊåÅ</h3>
<p>Âú®Viper‰∏≠ÂêØÁî®ËøúÁ®ãÊîØÊåÅÔºåÈúÄË¶ÅÂú®‰ª£Á†Å‰∏≠ÂåøÂêçÂØºÂÖ•<code>viper/remote</code>Ëøô‰∏™ÂåÖ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import _ &#34;github.com/spf13/viper/remote&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ViperÂ∞ÜËØªÂèñ‰ªéKey/ValueÂ≠òÂÇ®Ôºà‰æãÂ¶ÇetcdÊàñConsulÔºâ‰∏≠ÁöÑË∑ØÂæÑÊ£ÄÁ¥¢Âà∞ÁöÑÈÖçÁΩÆÂ≠óÁ¨¶‰∏≤ÔºàÂ¶Ç<code>JSON</code>„ÄÅ<code>TOML</code>„ÄÅ<code>YAML</code>„ÄÅ<code>HCL</code>„ÄÅ<code>envfile</code>Âíå<code>Java properties</code>Ê†ºÂºèÔºâ„ÄÇËøô‰∫õÂÄºÁöÑ‰ºòÂÖàÁ∫ßÈ´ò‰∫éÈªòËÆ§ÂÄºÔºå‰ΩÜÊòØ‰ºöË¢´‰ªéÁ£ÅÁõò„ÄÅflagÊàñÁéØÂ¢ÉÂèòÈáèÊ£ÄÁ¥¢Âà∞ÁöÑÈÖçÁΩÆÂÄºË¶ÜÁõñ„ÄÇÔºàËØëÊ≥®Ôºö‰πüÂ∞±ÊòØËØ¥ViperÂä†ËΩΩÈÖçÁΩÆÂÄºÁöÑ‰ºòÂÖàÁ∫ß‰∏∫ÔºöÁ£ÅÁõò‰∏äÁöÑÈÖçÁΩÆÊñá‰ª∂&gt;ÂëΩ‰ª§Ë°åÊ†áÂøó‰Ωç&gt;ÁéØÂ¢ÉÂèòÈáè&gt;ËøúÁ®ãKey/ValueÂ≠òÂÇ®&gt;ÈªòËÆ§ÂÄº„ÄÇÔºâ</p>
<p>Viper‰ΩøÁî®<a class="link" href="https://github.com/bketelsen/crypt"  target="_blank" rel="noopener"
    >crypt</a>‰ªéK/VÂ≠òÂÇ®‰∏≠Ê£ÄÁ¥¢ÈÖçÁΩÆÔºåËøôÊÑèÂë≥ÁùÄÂ¶ÇÊûú‰Ω†ÊúâÊ≠£Á°ÆÁöÑgpgÂØÜÂåôÔºå‰Ω†ÂèØ‰ª•Â∞ÜÈÖçÁΩÆÂÄºÂä†ÂØÜÂ≠òÂÇ®Âπ∂Ëá™Âä®Ëß£ÂØÜ„ÄÇÂä†ÂØÜÊòØÂèØÈÄâÁöÑ„ÄÇ</p>
<p>‰Ω†ÂèØ‰ª•Â∞ÜËøúÁ®ãÈÖçÁΩÆ‰∏éÊú¨Âú∞ÈÖçÁΩÆÁªìÂêà‰ΩøÁî®Ôºå‰πüÂèØ‰ª•Áã¨Á´ã‰ΩøÁî®„ÄÇ</p>
<p><code>crypt</code>Êúâ‰∏Ä‰∏™ÂëΩ‰ª§Ë°åÂä©ÊâãÔºå‰Ω†ÂèØ‰ª•‰ΩøÁî®ÂÆÉÂ∞ÜÈÖçÁΩÆÊîæÂÖ•K/VÂ≠òÂÇ®‰∏≠„ÄÇ<code>crypt</code>ÈªòËÆ§‰ΩøÁî®Âú®<a class="link" href="http://127.0.0.1:4001/"  target="_blank" rel="noopener"
    >http://127.0.0.1:4001</a>ÁöÑetcd„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go get github.com/bketelsen/crypt/bin/crypt
</span></span><span class="line"><span class="cl">$ crypt <span class="nb">set</span> -plaintext /config/hugo.json /Users/hugo/settings/config.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>Á°ÆËÆ§ÂÄºÂ∑≤ÁªèËÆæÁΩÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ crypt get -plaintext /config/hugo.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúâÂÖ≥Â¶Ç‰ΩïËÆæÁΩÆÂä†ÂØÜÂÄºÊàñÂ¶Ç‰Ωï‰ΩøÁî®ConsulÁöÑÁ§∫‰æãÔºåËØ∑ÂèÇËßÅ<code>crypt</code>ÊñáÊ°£„ÄÇ</p>
<h3 id="ËøúÁ®ãkeyvalueÂ≠òÂÇ®Á§∫‰æã-Êú™Âä†ÂØÜ">ËøúÁ®ãKey/ValueÂ≠òÂÇ®Á§∫‰æã-Êú™Âä†ÂØÜ</h3>
<h4 id="etcd">etcd</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">AddRemoteProvider</span><span class="p">(</span><span class="s">&#34;etcd&#34;</span><span class="p">,</span> <span class="s">&#34;http://127.0.0.1:4001&#34;</span><span class="p">,</span><span class="s">&#34;/config/hugo.json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;json&#34;</span><span class="p">)</span> <span class="c1">// Âõ†‰∏∫Âú®Â≠óËäÇÊµÅ‰∏≠Ê≤°ÊúâÊñá‰ª∂Êâ©Â±ïÂêçÔºåÊâÄ‰ª•ËøôÈáåÈúÄË¶ÅËÆæÁΩÆ‰∏ãÁ±ªÂûã„ÄÇÊîØÊåÅÁöÑÊâ©Â±ïÂêçÊúâ &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;, &#34;properties&#34;, &#34;props&#34;, &#34;prop&#34;, &#34;env&#34;, &#34;dotenv&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadRemoteConfig</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="consul">Consul</h4>
<p>‰Ω†ÈúÄË¶Å Consul Key/ValueÂ≠òÂÇ®‰∏≠ËÆæÁΩÆ‰∏Ä‰∏™Key‰øùÂ≠òÂåÖÂê´ÊâÄÈúÄÈÖçÁΩÆÁöÑJSONÂÄº„ÄÇ‰æãÂ¶ÇÔºåÂàõÂª∫‰∏Ä‰∏™key<code>MY_CONSUL_KEY</code>Â∞Ü‰∏ãÈù¢ÁöÑÂÄºÂ≠òÂÖ•Consul key/value Â≠òÂÇ®Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">8080</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;liwenzhou.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="err">viper.AddRemoteProvider(</span><span class="s2">&#34;consul&#34;</span><span class="err">,</span> <span class="s2">&#34;localhost:8500&#34;</span><span class="err">,</span> <span class="s2">&#34;MY_CONSUL_KEY&#34;</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">viper.SetConfigType(</span><span class="s2">&#34;json&#34;</span><span class="err">)</span> <span class="c1">// ÈúÄË¶ÅÊòæÁ§∫ËÆæÁΩÆÊàêjson
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">err</span> <span class="err">:=</span> <span class="err">viper.ReadRemoteConfig()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">fmt.Println(viper.Get(</span><span class="s2">&#34;port&#34;</span><span class="err">))</span> <span class="c1">// 8080
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">fmt.Println(viper.Get(</span><span class="s2">&#34;hostname&#34;</span><span class="err">))</span> <span class="c1">// liwenzhou.com
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="firestore">Firestore</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">AddRemoteProvider</span><span class="p">(</span><span class="s">&#34;firestore&#34;</span><span class="p">,</span> <span class="s">&#34;google-cloud-project-id&#34;</span><span class="p">,</span> <span class="s">&#34;collection/document&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;json&#34;</span><span class="p">)</span> <span class="c1">// ÈÖçÁΩÆÁöÑÊ†ºÂºè: &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadRemoteConfig</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩìÁÑ∂Ôºå‰Ω†‰πüÂèØ‰ª•‰ΩøÁî®<code>SecureRemoteProvider</code>„ÄÇ</p>
<h3 id="ËøúÁ®ãkeyvalueÂ≠òÂÇ®Á§∫‰æã-Âä†ÂØÜ">ËøúÁ®ãKey/ValueÂ≠òÂÇ®Á§∫‰æã-Âä†ÂØÜ</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">AddSecureRemoteProvider</span><span class="p">(</span><span class="s">&#34;etcd&#34;</span><span class="p">,</span><span class="s">&#34;http://127.0.0.1:4001&#34;</span><span class="p">,</span><span class="s">&#34;/config/hugo.json&#34;</span><span class="p">,</span><span class="s">&#34;/etc/secrets/mykeyring.gpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;json&#34;</span><span class="p">)</span> <span class="c1">// Âõ†‰∏∫Âú®Â≠óËäÇÊµÅ‰∏≠Ê≤°ÊúâÊñá‰ª∂Êâ©Â±ïÂêçÔºåÊâÄ‰ª•ËøôÈáåÈúÄË¶ÅËÆæÁΩÆ‰∏ãÁ±ªÂûã„ÄÇÊîØÊåÅÁöÑÊâ©Â±ïÂêçÊúâ &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;, &#34;properties&#34;, &#34;props&#34;, &#34;prop&#34;, &#34;env&#34;, &#34;dotenv&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadRemoteConfig</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÁõëÊéßetcd‰∏≠ÁöÑÊõ¥Êîπ-Êú™Âä†ÂØÜ">ÁõëÊéßetcd‰∏≠ÁöÑÊõ¥Êîπ-Êú™Âä†ÂØÜ</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ÊàñËÄÖ‰Ω†ÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑviperÂÆû‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">runtime_viper</span> <span class="p">=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">runtime_viper</span><span class="p">.</span><span class="nf">AddRemoteProvider</span><span class="p">(</span><span class="s">&#34;etcd&#34;</span><span class="p">,</span> <span class="s">&#34;http://127.0.0.1:4001&#34;</span><span class="p">,</span> <span class="s">&#34;/config/hugo.yml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">runtime_viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;yaml&#34;</span><span class="p">)</span> <span class="c1">// Âõ†‰∏∫Âú®Â≠óËäÇÊµÅ‰∏≠Ê≤°ÊúâÊñá‰ª∂Êâ©Â±ïÂêçÔºåÊâÄ‰ª•ËøôÈáåÈúÄË¶ÅËÆæÁΩÆ‰∏ãÁ±ªÂûã„ÄÇÊîØÊåÅÁöÑÊâ©Â±ïÂêçÊúâ &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;, &#34;properties&#34;, &#34;props&#34;, &#34;prop&#34;, &#34;env&#34;, &#34;dotenv&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Á¨¨‰∏ÄÊ¨°‰ªéËøúÁ®ãËØªÂèñÈÖçÁΩÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">runtime_viper</span><span class="p">.</span><span class="nf">ReadRemoteConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂèçÂ∫èÂàóÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">runtime_viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">runtime_conf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂºÄÂêØ‰∏Ä‰∏™ÂçïÁã¨ÁöÑgoroutine‰∏ÄÁõ¥ÁõëÊéßËøúÁ´ØÁöÑÂèòÊõ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	    <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// ÊØèÊ¨°ËØ∑Ê±ÇÂêéÂª∂Ëøü‰∏Ä‰∏ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	    <span class="c1">// ÁõÆÂâçÂè™ÊµãËØï‰∫ÜetcdÊîØÊåÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">runtime_viper</span><span class="p">.</span><span class="nf">WatchRemoteConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	        <span class="nx">log</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;unable to read remote config: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">	    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	    <span class="c1">// Â∞ÜÊñ∞ÈÖçÁΩÆÂèçÂ∫èÂàóÂåñÂà∞Êàë‰ª¨ËøêË°åÊó∂ÁöÑÈÖçÁΩÆÁªìÊûÑ‰Ωì‰∏≠„ÄÇ‰Ω†ËøòÂèØ‰ª•ÂÄüÂä©channelÂÆûÁé∞‰∏Ä‰∏™ÈÄöÁü•Á≥ªÁªüÊõ¥ÊîπÁöÑ‰ø°Âè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	    <span class="nx">runtime_viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">runtime_conf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="‰ªéviperËé∑ÂèñÂÄº">‰ªéViperËé∑ÂèñÂÄº</h2>
<p>Âú®Viper‰∏≠ÔºåÊúâÂá†ÁßçÊñπÊ≥ïÂèØ‰ª•Ê†πÊçÆÂÄºÁöÑÁ±ªÂûãËé∑ÂèñÂÄº„ÄÇÂ≠òÂú®‰ª•‰∏ãÂäüËÉΩÂíåÊñπÊ≥ï:</p>
<ul>
<li><code>Get(key string) : interface{}</code></li>
<li><code>GetBool(key string) : bool</code></li>
<li><code>GetFloat64(key string) : float64</code></li>
<li><code>GetInt(key string) : int</code></li>
<li><code>GetIntSlice(key string) : []int</code></li>
<li><code>GetString(key string) : string</code></li>
<li><code>GetStringMap(key string) : map[string]interface{}</code></li>
<li><code>GetStringMapString(key string) : map[string]string</code></li>
<li><code>GetStringSlice(key string) : []string</code></li>
<li><code>GetTime(key string) : time.Time</code></li>
<li><code>GetDuration(key string) : time.Duration</code></li>
<li><code>IsSet(key string) : bool</code></li>
<li><code>AllSettings() : map[string]interface{}</code></li>
</ul>
<p>ÈúÄË¶ÅËÆ§ËØÜÂà∞ÁöÑ‰∏Ä‰ª∂ÈáçË¶Å‰∫ãÊÉÖÊòØÔºåÊØè‰∏Ä‰∏™GetÊñπÊ≥ïÂú®Êâæ‰∏çÂà∞ÂÄºÁöÑÊó∂ÂÄôÈÉΩ‰ºöËøîÂõûÈõ∂ÂÄº„ÄÇ‰∏∫‰∫ÜÊ£ÄÊü•ÁªôÂÆöÁöÑÈîÆÊòØÂê¶Â≠òÂú®ÔºåÊèê‰æõ‰∫Ü<code>IsSet()</code>ÊñπÊ≥ï„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;logfile&#34;</span><span class="p">)</span> <span class="c1">// ‰∏çÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑËÆæÁΩÆÂíåËé∑Âèñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetBool</span><span class="p">(</span><span class="s">&#34;verbose&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;verbose enabled&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ËÆøÈóÆÂµåÂ•óÁöÑÈîÆ">ËÆøÈóÆÂµåÂ•óÁöÑÈîÆ</h3>
<p>ËÆøÈóÆÂô®ÊñπÊ≥ï‰πüÊé•ÂèóÊ∑±Â∫¶ÂµåÂ•óÈîÆÁöÑÊ†ºÂºèÂåñË∑ØÂæÑ„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÂä†ËΩΩ‰∏ãÈù¢ÁöÑJSONÊñá‰ª∂Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;localhost&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">5799</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;datastore&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;metric&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">3099</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;warehouse&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;198.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">2112</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ViperÂèØ‰ª•ÈÄöËøá‰º†ÂÖ•<code>.</code>ÂàÜÈöîÁöÑË∑ØÂæÑÊù•ËÆøÈóÆÂµåÂ•óÂ≠óÊÆµÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;datastore.metric.host&#34;</span><span class="p">)</span> <span class="c1">// (ËøîÂõû &#34;127.0.0.1&#34;)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈÅµÂÆà‰∏äÈù¢Âª∫Á´ãÁöÑ‰ºòÂÖàËßÑÂàôÔºõÊêúÁ¥¢Ë∑ØÂæÑÂ∞ÜÈÅçÂéÜÂÖ∂‰ΩôÈÖçÁΩÆÊ≥®ÂÜåË°®ÔºåÁõ¥Âà∞ÊâæÂà∞‰∏∫Ê≠¢„ÄÇ(ËØëÊ≥®ÔºöÂõ†‰∏∫ViperÊîØÊåÅ‰ªéÂ§öÁßçÈÖçÁΩÆÊù•Ê∫êÔºå‰æãÂ¶ÇÁ£ÅÁõò‰∏äÁöÑÈÖçÁΩÆÊñá‰ª∂&gt;ÂëΩ‰ª§Ë°åÊ†áÂøó‰Ωç&gt;ÁéØÂ¢ÉÂèòÈáè&gt;ËøúÁ®ãKey/ValueÂ≠òÂÇ®&gt;ÈªòËÆ§ÂÄºÔºåÊàë‰ª¨Âú®Êü•Êâæ‰∏Ä‰∏™ÈÖçÁΩÆÁöÑÊó∂ÂÄôÂ¶ÇÊûúÂú®ÂΩìÂâçÈÖçÁΩÆÊ∫ê‰∏≠Ê≤°ÊâæÂà∞ÔºåÂ∞±‰ºöÁªßÁª≠‰ªéÂêéÁª≠ÁöÑÈÖçÁΩÆÊ∫êÊü•ÊâæÔºåÁõ¥Âà∞ÊâæÂà∞‰∏∫Ê≠¢„ÄÇ)</p>
<p>‰æãÂ¶ÇÔºåÂú®ÁªôÂÆöÊ≠§ÈÖçÁΩÆÊñá‰ª∂ÁöÑÊÉÖÂÜµ‰∏ãÔºå<code>datastore.metric.host</code>Âíå<code>datastore.metric.port</code>ÂùáÂ∑≤ÂÆö‰πâÔºàÂπ∂‰∏îÂèØ‰ª•Ë¢´Ë¶ÜÁõñÔºâ„ÄÇÂ¶ÇÊûúÂè¶Â§ñÂú®ÈªòËÆ§ÂÄº‰∏≠ÂÆö‰πâ‰∫Ü<code>datastore.metric.protocol</code>ÔºåViper‰πü‰ºöÊâæÂà∞ÂÆÉ„ÄÇ</p>
<p>ÁÑ∂ËÄåÔºåÂ¶ÇÊûú<code>datastore.metric</code>Ë¢´Áõ¥Êé•ËµãÂÄºË¶ÜÁõñÔºàË¢´flagÔºåÁéØÂ¢ÉÂèòÈáèÔºå<code>set()</code>ÊñπÊ≥ïÁ≠âÁ≠â‚Ä¶ÔºâÔºåÈÇ£‰πà<code>datastore.metric</code>ÁöÑÊâÄÊúâÂ≠êÈîÆÈÉΩÂ∞ÜÂèò‰∏∫Êú™ÂÆö‰πâÁä∂ÊÄÅÔºåÂÆÉ‰ª¨Ë¢´È´ò‰ºòÂÖàÁ∫ßÈÖçÁΩÆÁ∫ßÂà´‚ÄúÈÅÆËîΩ‚ÄùÔºàshadowedÔºâ‰∫Ü„ÄÇ</p>
<p>ÊúÄÂêéÔºåÂ¶ÇÊûúÂ≠òÂú®‰∏éÂàÜÈöîÁöÑÈîÆË∑ØÂæÑÂåπÈÖçÁöÑÈîÆÔºåÂàôËøîÂõûÂÖ∂ÂÄº„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;datastore.metric.host&#34;</span><span class="p">:</span> <span class="s">&#34;0.0.0.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;host&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;address&#34;</span><span class="p">:</span> <span class="s">&#34;localhost&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;port&#34;</span><span class="p">:</span> <span class="mi">5799</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;datastore&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;metric&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;host&#34;</span><span class="p">:</span> <span class="s">&#34;127.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;port&#34;</span><span class="p">:</span> <span class="mi">3099</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;warehouse&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;host&#34;</span><span class="p">:</span> <span class="s">&#34;198.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;port&#34;</span><span class="p">:</span> <span class="mi">2112</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;datastore.metric.host&#34;</span><span class="p">)</span> <span class="c1">// ËøîÂõû &#34;0.0.0.0&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÊèêÂèñÂ≠êÊ†ë">ÊèêÂèñÂ≠êÊ†ë</h3>
<p>‰ªéViper‰∏≠ÊèêÂèñÂ≠êÊ†ë„ÄÇ</p>
<p>‰æãÂ¶ÇÔºå<code>viper</code>ÂÆû‰æãÁé∞Âú®‰ª£Ë°®‰∫Ü‰ª•‰∏ãÈÖçÁΩÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">app</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cache1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">max-items</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">item-size</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cache2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">max-items</span><span class="p">:</span><span class="w"> </span><span class="m">200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">item-size</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°åÂêéÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">subv</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="s">&#34;app.cache1&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>subv</code>Áé∞Âú®Â∞±‰ª£Ë°®Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">max-items</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">item-size</span><span class="p">:</span><span class="w"> </span><span class="m">64</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÅáËÆæÊàë‰ª¨Áé∞Âú®ÊúâËøô‰πà‰∏Ä‰∏™ÂáΩÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewCache</span><span class="p">(</span><span class="nx">cfg</span> <span class="o">*</span><span class="nx">Viper</span><span class="p">)</span> <span class="o">*</span><span class="nx">Cache</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÆÉÂü∫‰∫é<code>subv</code>Ê†ºÂºèÁöÑÈÖçÁΩÆ‰ø°ÊÅØÂàõÂª∫ÁºìÂ≠ò„ÄÇÁé∞Âú®ÔºåÂèØ‰ª•ËΩªÊùæÂú∞ÂàÜÂà´ÂàõÂª∫Ëøô‰∏§‰∏™ÁºìÂ≠òÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">cfg1</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="s">&#34;app.cache1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">cache1</span> <span class="o">:=</span> <span class="nf">NewCache</span><span class="p">(</span><span class="nx">cfg1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">cfg2</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="s">&#34;app.cache2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">cache2</span> <span class="o">:=</span> <span class="nf">NewCache</span><span class="p">(</span><span class="nx">cfg2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂèçÂ∫èÂàóÂåñ">ÂèçÂ∫èÂàóÂåñ</h3>
<p>‰Ω†ËøòÂèØ‰ª•ÈÄâÊã©Â∞ÜÊâÄÊúâÊàñÁâπÂÆöÁöÑÂÄºËß£ÊûêÂà∞ÁªìÊûÑ‰Ωì„ÄÅmapÁ≠â„ÄÇ</p>
<p>Êúâ‰∏§ÁßçÊñπÊ≥ïÂèØ‰ª•ÂÅöÂà∞Ëøô‰∏ÄÁÇπÔºö</p>
<ul>
<li><code>Unmarshal(rawVal interface{}) : error</code></li>
<li><code>UnmarshalKey(key string, rawVal interface{}) : error</code></li>
</ul>
<p>‰∏æ‰∏™‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">PathMap</span> <span class="kt">string</span> <span class="s">`mapstructure:&#34;path_map&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">C</span> <span class="nx">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">C</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;unable to decode into struct, %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅËß£ÊûêÈÇ£‰∫õÈîÆÊú¨Ë∫´Â∞±ÂåÖÂê´<code>.</code>(ÈªòËÆ§ÁöÑÈîÆÂàÜÈöîÁ¨¶ÔºâÁöÑÈÖçÁΩÆÔºå‰Ω†ÈúÄË¶Å‰øÆÊîπÂàÜÈöîÁ¨¶Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">v</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">NewWithOptions</span><span class="p">(</span><span class="nx">viper</span><span class="p">.</span><span class="nf">KeyDelimiter</span><span class="p">(</span><span class="s">&#34;::&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">v</span><span class="p">.</span><span class="nf">SetDefault</span><span class="p">(</span><span class="s">&#34;chart::values&#34;</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;ingress&#34;</span><span class="p">:</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;annotations&#34;</span><span class="p">:</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;traefik.frontend.rule.type&#34;</span><span class="p">:</span>                 <span class="s">&#34;PathPrefix&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;traefik.ingress.kubernetes.io/ssl-redirect&#34;</span><span class="p">:</span> <span class="s">&#34;true&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Chart</span> <span class="kd">struct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Values</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">C</span> <span class="nx">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">v</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">C</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ViperËøòÊîØÊåÅËß£ÊûêÂà∞ÂµåÂÖ•ÁöÑÁªìÊûÑ‰ΩìÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">Example config:
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">module:
</span></span></span><span class="line"><span class="cl"><span class="cm">    enabled: true
</span></span></span><span class="line"><span class="cl"><span class="cm">    token: 89h3f98hbwf987h3f98wenf89ehf
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Module</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Enabled</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">moduleConfig</span> <span class="s">`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// moduleConfig could be in a module specific package
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">moduleConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Token</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">C</span> <span class="nx">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">C</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;unable to decode into struct, %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ViperÂú®ÂêéÂè∞‰ΩøÁî®<a class="link" href="https://github.com/mitchellh/mapstructure"  target="_blank" rel="noopener"
    >github.com/mitchellh/mapstructure</a>Êù•Ëß£ÊûêÂÄºÔºåÂÖ∂ÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰ΩøÁî®<code>mapstructure</code>tag„ÄÇ</p>
<p><strong>Ê≥®ÊÑè</strong> ÂΩìÊàë‰ª¨ÈúÄË¶ÅÂ∞ÜviperËØªÂèñÁöÑÈÖçÁΩÆÂèçÂ∫èÂàóÂà∞Êàë‰ª¨ÂÆö‰πâÁöÑÁªìÊûÑ‰ΩìÂèòÈáè‰∏≠Êó∂Ôºå‰∏ÄÂÆöË¶Å‰ΩøÁî®<code>mapstructure</code>tagÂì¶ÔºÅ</p>
<h3 id="Â∫èÂàóÂåñÊàêÂ≠óÁ¨¶‰∏≤">Â∫èÂàóÂåñÊàêÂ≠óÁ¨¶‰∏≤</h3>
<p>‰Ω†ÂèØËÉΩÈúÄË¶ÅÂ∞Üviper‰∏≠‰øùÂ≠òÁöÑÊâÄÊúâËÆæÁΩÆÂ∫èÂàóÂåñÂà∞‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤‰∏≠ÔºåËÄå‰∏çÊòØÂ∞ÜÂÆÉ‰ª¨ÂÜôÂÖ•Âà∞‰∏Ä‰∏™Êñá‰ª∂‰∏≠„ÄÇ‰Ω†ÂèØ‰ª•Â∞ÜËá™Â∑±ÂñúÊ¨¢ÁöÑÊ†ºÂºèÁöÑÂ∫èÂàóÂåñÂô®‰∏é<code>AllSettings()</code>ËøîÂõûÁöÑÈÖçÁΩÆ‰∏ÄËµ∑‰ΩøÁî®„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">yaml</span> <span class="s">&#34;gopkg.in/yaml.v2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">yamlStringSettings</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">c</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">AllSettings</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">bs</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">yaml</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;unable to marshal config to YAML: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">bs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="‰ΩøÁî®Âçï‰∏™ËøòÊòØÂ§ö‰∏™viperÂÆû‰æã">‰ΩøÁî®Âçï‰∏™ËøòÊòØÂ§ö‰∏™ViperÂÆû‰æã?</h2>
<p>ViperÊòØÂºÄÁÆ±Âç≥Áî®ÁöÑ„ÄÇ‰Ω†‰∏çÈúÄË¶ÅÈÖçÁΩÆÊàñÂàùÂßãÂåñÂç≥ÂèØÂºÄÂßã‰ΩøÁî®Viper„ÄÇÁî±‰∫éÂ§ßÂ§öÊï∞Â∫îÁî®Á®ãÂ∫èÈÉΩÂ∏åÊúõ‰ΩøÁî®Âçï‰∏™‰∏≠Â§ÆÂ≠òÂÇ®Â∫ìÁÆ°ÁêÜÂÆÉ‰ª¨ÁöÑÈÖçÁΩÆ‰ø°ÊÅØÔºåÊâÄ‰ª•viperÂåÖÊèê‰æõ‰∫ÜËøô‰∏™ÂäüËÉΩ„ÄÇÂÆÉÁ±ª‰ºº‰∫éÂçï‰æãÊ®°Âºè„ÄÇ</p>
<p>Âú®‰∏äÈù¢ÁöÑÊâÄÊúâÁ§∫‰æã‰∏≠ÔºåÂÆÉ‰ª¨ÈÉΩ‰ª•ÂÖ∂Âçï‰æãÈ£éÊ†ºÁöÑÊñπÊ≥ïÊºîÁ§∫‰∫ÜÂ¶Ç‰Ωï‰ΩøÁî®viper„ÄÇ</p>
<h3 id="‰ΩøÁî®Â§ö‰∏™viperÂÆû‰æã">‰ΩøÁî®Â§ö‰∏™viperÂÆû‰æã</h3>
<p>‰Ω†ËøòÂèØ‰ª•Âú®Â∫îÁî®Á®ãÂ∫è‰∏≠ÂàõÂª∫ËÆ∏Â§ö‰∏çÂêåÁöÑviperÂÆû‰æã„ÄÇÊØè‰∏™ÈÉΩÊúâËá™Â∑±Áã¨ÁâπÁöÑ‰∏ÄÁªÑÈÖçÁΩÆÂíåÂÄº„ÄÇÊØè‰∏™‰∫∫ÈÉΩÂèØ‰ª•‰ªé‰∏çÂêåÁöÑÈÖçÁΩÆÊñá‰ª∂Ôºåkey valueÂ≠òÂÇ®Âå∫Á≠âËØªÂèñÊï∞ÊçÆ„ÄÇÊØè‰∏™ÈÉΩÂèØ‰ª•‰ªé‰∏çÂêåÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÅÈîÆÂÄºÂ≠òÂÇ®Á≠â‰∏≠ËØªÂèñ„ÄÇviperÂåÖÊîØÊåÅÁöÑÊâÄÊúâÂäüËÉΩÈÉΩË¢´ÈïúÂÉè‰∏∫viperÂÆû‰æãÁöÑÊñπÊ≥ï„ÄÇ</p>
<p>‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">x</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">y</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">x</span><span class="p">.</span><span class="nf">SetDefault</span><span class="p">(</span><span class="s">&#34;ContentDir&#34;</span><span class="p">,</span> <span class="s">&#34;content&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">y</span><span class="p">.</span><span class="nf">SetDefault</span><span class="p">(</span><span class="s">&#34;ContentDir&#34;</span><span class="p">,</span> <span class="s">&#34;foobar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì‰ΩøÁî®Â§ö‰∏™viperÂÆû‰æãÊó∂ÔºåÁî±Áî®Êà∑Êù•ÁÆ°ÁêÜ‰∏çÂêåÁöÑviperÂÆû‰æã„ÄÇ</p>
<h2 id="‰ΩøÁî®viperÁ§∫‰æã">‰ΩøÁî®ViperÁ§∫‰æã</h2>
<p>ÂÅáËÆæÊàë‰ª¨ÁöÑÈ°πÁõÆÁé∞Âú®Êúâ‰∏Ä‰∏™<code>./conf/config.yaml</code>ÈÖçÁΩÆÊñá‰ª∂ÔºåÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8123</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;v1.2.3&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Êé•‰∏ãÊù•ÈÄöËøáÁ§∫‰æã‰ª£Á†ÅÊºîÁ§∫‰∏§ÁßçÂú®È°πÁõÆ‰∏≠‰ΩøÁî®<code>viper</code>ÁÆ°ÁêÜÈ°πÁõÆÈÖçÁΩÆ‰ø°ÊÅØÁöÑÊñπÂºè„ÄÇ</p>
<h3 id="Áõ¥Êé•‰ΩøÁî®viperÁÆ°ÁêÜÈÖçÁΩÆ">Áõ¥Êé•‰ΩøÁî®viperÁÆ°ÁêÜÈÖçÁΩÆ</h3>
<p>ËøôÈáåÁî®‰∏Ä‰∏™demoÊºîÁ§∫Â¶Ç‰ΩïÂú®ginÊ°ÜÊû∂Êê≠Âª∫ÁöÑwebÈ°πÁõÆ‰∏≠‰ΩøÁî®<code>viper</code>Ôºå‰ΩøÁî®viperÂä†ËΩΩÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ‰ø°ÊÅØÔºåÂπ∂Âú®‰ª£Á†Å‰∏≠Áõ¥Êé•‰ΩøÁî®<code>viper.GetXXX()</code>ÊñπÊ≥ïËé∑ÂèñÂØπÂ∫îÁöÑÈÖçÁΩÆÂÄº„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/viper&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigFile</span><span class="p">(</span><span class="s">&#34;./conf/config.yaml&#34;</span><span class="p">)</span> <span class="c1">// ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">()</span>        <span class="c1">// ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>                    <span class="c1">// ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØÂ§±Ë¥•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Fatal error config file: %s \n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ÁõëÊéßÈÖçÁΩÆÊñá‰ª∂ÂèòÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">viper</span><span class="p">.</span><span class="nf">WatchConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ËÆøÈóÆ/versionÁöÑËøîÂõûÂÄº‰ºöÈöèÈÖçÁΩÆÊñá‰ª∂ÁöÑÂèòÂåñËÄåÂèòÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/version&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;version&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;:%d&#34;</span><span class="p">,</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;port&#34;</span><span class="p">)));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ΩøÁî®ÁªìÊûÑ‰ΩìÂèòÈáè‰øùÂ≠òÈÖçÁΩÆ‰ø°ÊÅØ">‰ΩøÁî®ÁªìÊûÑ‰ΩìÂèòÈáè‰øùÂ≠òÈÖçÁΩÆ‰ø°ÊÅØ</h3>
<p>Èô§‰∫Ü‰∏äÈù¢ÁöÑÁî®Ê≥ïÂ§ñÔºåÊàë‰ª¨ËøòÂèØ‰ª•Âú®È°πÁõÆ‰∏≠ÂÆö‰πâ‰∏éÈÖçÁΩÆÊñá‰ª∂ÂØπÂ∫îÁöÑÁªìÊûÑ‰ΩìÔºå<code>viper</code>Âä†ËΩΩÂÆåÈÖçÁΩÆ‰ø°ÊÅØÂêé‰ΩøÁî®ÁªìÊûÑ‰ΩìÂèòÈáè‰øùÂ≠òÈÖçÁΩÆ‰ø°ÊÅØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/fsnotify/fsnotify&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/viper&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span>    <span class="kt">int</span>    <span class="s">`mapstructure:&#34;port&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Version</span> <span class="kt">string</span> <span class="s">`mapstructure:&#34;version&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Conf</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigFile</span><span class="p">(</span><span class="s">&#34;./conf/config.yaml&#34;</span><span class="p">)</span> <span class="c1">// ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">()</span>               <span class="c1">// ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>                           <span class="c1">// ËØªÂèñÈÖçÁΩÆ‰ø°ÊÅØÂ§±Ë¥•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Fatal error config file: %s \n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Â∞ÜËØªÂèñÁöÑÈÖçÁΩÆ‰ø°ÊÅØ‰øùÂ≠òËá≥ÂÖ®Â±ÄÂèòÈáèConf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">Conf</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;unmarshal conf failed, err:%s \n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÁõëÊéßÈÖçÁΩÆÊñá‰ª∂ÂèòÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">viper</span><span class="p">.</span><span class="nf">WatchConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Ê≥®ÊÑèÔºÅÔºÅÔºÅÈÖçÁΩÆÊñá‰ª∂ÂèëÁîüÂèòÂåñÂêéË¶ÅÂêåÊ≠•Âà∞ÂÖ®Â±ÄÂèòÈáèConf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">viper</span><span class="p">.</span><span class="nf">OnConfigChange</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">in</span> <span class="nx">fsnotify</span><span class="p">.</span><span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Â§≠ÂØøÂï¶~ÈÖçÁΩÆÊñá‰ª∂Ë¢´‰∫∫‰øÆÊîπÂï¶...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">Conf</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;unmarshal conf failed, err:%s \n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ËÆøÈóÆ/versionÁöÑËøîÂõûÂÄº‰ºöÈöèÈÖçÁΩÆÊñá‰ª∂ÁöÑÂèòÂåñËÄåÂèòÂåñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/version&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">Conf</span><span class="p">.</span><span class="nx">Version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;:%d&#34;</span><span class="p">,</span> <span class="nx">Conf</span><span class="p">.</span><span class="nx">Port</span><span class="p">));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="‰ºòÈõÖÁöÑÂÖ≥Êú∫">‰ºòÈõÖÁöÑÂÖ≥Êú∫</h2>
<p>Êàë‰ª¨ÁºñÂÜôÁöÑWebÈ°πÁõÆÈÉ®ÁΩ≤‰πãÂêéÔºåÁªèÂ∏∏‰ºöÂõ†‰∏∫ÈúÄË¶ÅËøõË°åÈÖçÁΩÆÂèòÊõ¥ÊàñÂäüËÉΩËø≠‰ª£ËÄåÈáçÂêØÊúçÂä°ÔºåÂçïÁ∫ØÁöÑ<code>kill -9 pid</code>ÁöÑÊñπÂºè‰ºöÂº∫Âà∂ÂÖ≥Èó≠ËøõÁ®ãÔºåËøôÊ†∑Â∞±‰ºöÂØºËá¥ÊúçÂä°Á´ØÂΩìÂâçÊ≠£Âú®Â§ÑÁêÜÁöÑËØ∑Ê±ÇÂ§±Ë¥•ÔºåÈÇ£ÊúâÊ≤°ÊúâÊõ¥‰ºòÈõÖÁöÑÊñπÂºèÊù•ÂÆûÁé∞ÂÖ≥Êú∫ÊàñÈáçÂêØÂë¢Ôºü</p>
<blockquote>
<p>ÈòÖËØªÊú¨ÊñáÈúÄË¶Å‰∫ÜËß£‰∏Ä‰∫õUNIXÁ≥ªÁªü‰∏≠<code>‰ø°Âè∑</code>ÁöÑÊ¶ÇÂøµÔºåËØ∑ÊèêÂâçÊü•ÈòÖËµÑÊñôÈ¢Ñ‰π†„ÄÇ</p>
</blockquote>
<h2 id="‰ºòÈõÖÂú∞ÂÖ≥Êú∫">‰ºòÈõÖÂú∞ÂÖ≥Êú∫</h2>
<h3 id="‰ªÄ‰πàÊòØ‰ºòÈõÖÂÖ≥Êú∫">‰ªÄ‰πàÊòØ‰ºòÈõÖÂÖ≥Êú∫Ôºü</h3>
<p>‰ºòÈõÖÂÖ≥Êú∫Â∞±ÊòØÊúçÂä°Á´ØÂÖ≥Êú∫ÂëΩ‰ª§ÂèëÂá∫Âêé‰∏çÊòØÁ´ãÂç≥ÂÖ≥Êú∫ÔºåËÄåÊòØÁ≠âÂæÖÂΩìÂâçËøòÂú®Â§ÑÁêÜÁöÑËØ∑Ê±ÇÂÖ®ÈÉ®Â§ÑÁêÜÂÆåÊØïÂêéÂÜçÈÄÄÂá∫Á®ãÂ∫èÔºåÊòØ‰∏ÄÁßçÂØπÂÆ¢Êà∑Á´ØÂèãÂ•ΩÁöÑÂÖ≥Êú∫ÊñπÂºè„ÄÇËÄåÊâßË°å<code>Ctrl+C</code>ÂÖ≥Èó≠ÊúçÂä°Á´ØÊó∂Ôºå‰ºöÂº∫Âà∂ÁªìÊùüËøõÁ®ãÂØºËá¥Ê≠£Âú®ËÆøÈóÆÁöÑËØ∑Ê±ÇÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ</p>
<h3 id="Â¶Ç‰ΩïÂÆûÁé∞‰ºòÈõÖÂÖ≥Êú∫">Â¶Ç‰ΩïÂÆûÁé∞‰ºòÈõÖÂÖ≥Êú∫Ôºü</h3>
<p>Go 1.8ÁâàÊú¨‰πãÂêéÔºå http.Server ÂÜÖÁΩÆÁöÑ <a class="link" href="https://golang.org/pkg/net/http/#Server.Shutdown"  target="_blank" rel="noopener"
    >Shutdown()</a> ÊñπÊ≥ïÂ∞±ÊîØÊåÅ‰ºòÈõÖÂú∞ÂÖ≥Êú∫ÔºåÂÖ∑‰ΩìÁ§∫‰æãÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// +build go1.8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os/signal&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;syscall&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">router</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">router</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;Welcome Gin Server&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">srv</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Addr</span><span class="p">:</span>    <span class="s">&#34;:8080&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Handler</span><span class="p">:</span> <span class="nx">router</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ÂºÄÂêØ‰∏Ä‰∏™goroutineÂêØÂä®ÊúçÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">srv</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ErrServerClosed</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;listen: %s\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Á≠âÂæÖ‰∏≠Êñ≠‰ø°Âè∑Êù•‰ºòÈõÖÂú∞ÂÖ≥Èó≠ÊúçÂä°Âô®Ôºå‰∏∫ÂÖ≥Èó≠ÊúçÂä°Âô®Êìç‰ΩúËÆæÁΩÆ‰∏Ä‰∏™5ÁßíÁöÑË∂ÖÊó∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">quit</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// ÂàõÂª∫‰∏Ä‰∏™Êé•Êî∂‰ø°Âè∑ÁöÑÈÄöÈÅì
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// kill ÈªòËÆ§‰ºöÂèëÈÄÅ syscall.SIGTERM ‰ø°Âè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// kill -2 ÂèëÈÄÅ syscall.SIGINT ‰ø°Âè∑ÔºåÊàë‰ª¨Â∏∏Áî®ÁöÑCtrl+CÂ∞±ÊòØËß¶ÂèëÁ≥ªÁªüSIGINT‰ø°Âè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// kill -9 ÂèëÈÄÅ syscall.SIGKILL ‰ø°Âè∑Ôºå‰ΩÜÊòØ‰∏çËÉΩË¢´ÊçïËé∑ÔºåÊâÄ‰ª•‰∏çÈúÄË¶ÅÊ∑ªÂä†ÂÆÉ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// signal.NotifyÊääÊî∂Âà∞ÁöÑ syscall.SIGINTÊàñsyscall.SIGTERM ‰ø°Âè∑ËΩ¨ÂèëÁªôquit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">signal</span><span class="p">.</span><span class="nf">Notify</span><span class="p">(</span><span class="nx">quit</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGTERM</span><span class="p">)</span>  <span class="c1">// Ê≠§Â§Ñ‰∏ç‰ºöÈòªÂ°û
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="o">&lt;-</span><span class="nx">quit</span>  <span class="c1">// ÈòªÂ°ûÂú®Ê≠§ÔºåÂΩìÊé•Êî∂Âà∞‰∏äËø∞‰∏§Áßç‰ø°Âè∑Êó∂Êâç‰ºöÂæÄ‰∏ãÊâßË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Shutdown Server ...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÂàõÂª∫‰∏Ä‰∏™5ÁßíË∂ÖÊó∂ÁöÑcontext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">,</span> <span class="nx">cancel</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="mi">5</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nf">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 5ÁßíÂÜÖ‰ºòÈõÖÂÖ≥Èó≠ÊúçÂä°ÔºàÂ∞ÜÊú™Â§ÑÁêÜÂÆåÁöÑËØ∑Ê±ÇÂ§ÑÁêÜÂÆåÂÜçÂÖ≥Èó≠ÊúçÂä°ÔºâÔºåË∂ÖËøá5ÁßíÂ∞±Ë∂ÖÊó∂ÈÄÄÂá∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">srv</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;Server Shutdown: &#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Server exiting&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶Ç‰ΩïÈ™åËØÅ‰ºòÈõÖÂÖ≥Êú∫ÁöÑÊïàÊûúÂë¢Ôºü</p>
<p>‰∏äÈù¢ÁöÑ‰ª£Á†ÅËøêË°åÂêé‰ºöÂú®Êú¨Âú∞ÁöÑ<code>8080</code>Á´ØÂè£ÂºÄÂêØ‰∏Ä‰∏™webÊúçÂä°ÔºåÂÆÉÂè™Ê≥®ÂÜå‰∫Ü‰∏ÄÊù°Ë∑ØÁî±<code>/</code>ÔºåÂêéÁ´ØÊúçÂä°‰ºöÂÖàsleep 5ÁßíÈíüÁÑ∂ÂêéÊâçËøîÂõûÂìçÂ∫î‰ø°ÊÅØ„ÄÇ</p>
<p>Êàë‰ª¨Êåâ‰∏ã<code>Ctrl+C</code>Êó∂‰ºöÂèëÈÄÅ<code>syscall.SIGINT</code>Êù•ÈÄöÁü•Á®ãÂ∫è‰ºòÈõÖÂÖ≥Êú∫ÔºåÂÖ∑‰ΩìÂÅöÊ≥ïÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>ÊâìÂºÄÁªàÁ´ØÔºåÁºñËØëÂπ∂ÊâßË°å‰∏äÈù¢ÁöÑ‰ª£Á†Å</li>
<li>ÊâìÂºÄ‰∏Ä‰∏™ÊµèËßàÂô®ÔºåËÆøÈóÆ<code>127.0.0.1:8080/</code>ÔºåÊ≠§Êó∂ÊµèËßàÂô®ÁôΩÂ±èÁ≠âÂæÖÊúçÂä°Á´ØËøîÂõûÂìçÂ∫î„ÄÇ</li>
<li>Âú®ÁªàÁ´Ø<strong>ËøÖÈÄü</strong>ÊâßË°å<code>Ctrl+C</code>ÂëΩ‰ª§ÁªôÁ®ãÂ∫èÂèëÈÄÅ<code>syscall.SIGINT</code>‰ø°Âè∑</li>
<li>Ê≠§Êó∂Á®ãÂ∫èÂπ∂‰∏çÁ´ãÂç≥ÈÄÄÂá∫ËÄåÊòØÁ≠âÊàë‰ª¨Á¨¨2Ê≠•ÁöÑÂìçÂ∫îËøîÂõû‰πãÂêéÂÜçÈÄÄÂá∫Ôºå‰ªéËÄåÂÆûÁé∞‰ºòÈõÖÂÖ≥Êú∫„ÄÇ</li>
</ol>
<h3 id="‰ºòÈõÖÂú∞ÈáçÂêØ">‰ºòÈõÖÂú∞ÈáçÂêØ</h3>
<p>‰ºòÈõÖÂÖ≥Êú∫ÂÆûÁé∞‰∫ÜÔºåÈÇ£‰πàËØ•Â¶Ç‰ΩïÂÆûÁé∞‰ºòÈõÖÈáçÂêØÂë¢Ôºü</p>
<p>Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî® <a class="link" href="https://github.com/fvbock/endless"  target="_blank" rel="noopener"
    >fvbock/endless</a> Êù•ÊõøÊç¢ÈªòËÆ§ÁöÑ <code>ListenAndServe</code>ÂêØÂä®ÊúçÂä°Êù•ÂÆûÁé∞Ôºå Á§∫‰æã‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/fvbock/endless&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">router</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">router</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello gin!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÈªòËÆ§endlessÊúçÂä°Âô®‰ºöÁõëÂê¨‰∏ãÂàó‰ø°Âè∑Ôºö
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// syscall.SIGHUPÔºåsyscall.SIGUSR1Ôºåsyscall.SIGUSR2Ôºåsyscall.SIGINTÔºåsyscall.SIGTERMÂíåsyscall.SIGTSTP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Êé•Êî∂Âà∞ SIGHUP ‰ø°Âè∑Â∞ÜËß¶Âèë`fork/restart` ÂÆûÁé∞‰ºòÈõÖÈáçÂêØÔºàkill -1 pid‰ºöÂèëÈÄÅSIGHUP‰ø°Âè∑Ôºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Êé•Êî∂Âà∞ syscall.SIGINTÊàñsyscall.SIGTERM ‰ø°Âè∑Â∞ÜËß¶Âèë‰ºòÈõÖÂÖ≥Êú∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Êé•Êî∂Âà∞ SIGUSR2 ‰ø°Âè∑Â∞ÜËß¶ÂèëHammerTime
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// SIGUSR1 Âíå SIGTSTP Ë¢´Áî®Êù•Ëß¶Âèë‰∏Ä‰∫õÁî®Êà∑Ëá™ÂÆö‰πâÁöÑhookÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">endless</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">,</span> <span class="nx">router</span><span class="p">);</span> <span class="nx">err</span><span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;listen: %s\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Server exiting&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶Ç‰ΩïÈ™åËØÅ‰ºòÈõÖÈáçÂêØÁöÑÊïàÊûúÂë¢Ôºü</p>
<p>Êàë‰ª¨ÈÄöËøáÊâßË°å<code>kill -1 pid</code>ÂëΩ‰ª§ÂèëÈÄÅ<code>syscall.SIGINT</code>Êù•ÈÄöÁü•Á®ãÂ∫è‰ºòÈõÖÈáçÂêØÔºåÂÖ∑‰ΩìÂÅöÊ≥ïÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>ÊâìÂºÄÁªàÁ´ØÔºå<code>go build -o graceful_restart</code>ÁºñËØëÂπ∂ÊâßË°å<code>./graceful_restart</code>,ÁªàÁ´ØËæìÂá∫ÂΩìÂâçpid(ÂÅáËÆæ‰∏∫43682)</li>
<li>Â∞Ü‰ª£Á†Å‰∏≠Â§ÑÁêÜËØ∑Ê±ÇÂáΩÊï∞ËøîÂõûÁöÑ<code>hello gin!</code>‰øÆÊîπ‰∏∫<code>hello q1mi!</code>ÔºåÂÜçÊ¨°ÁºñËØë<code>go build -o graceful_restart</code></li>
<li>ÊâìÂºÄ‰∏Ä‰∏™ÊµèËßàÂô®ÔºåËÆøÈóÆ<code>127.0.0.1:8080/</code>ÔºåÊ≠§Êó∂ÊµèËßàÂô®ÁôΩÂ±èÁ≠âÂæÖÊúçÂä°Á´ØËøîÂõûÂìçÂ∫î„ÄÇ</li>
<li>Âú®ÁªàÁ´Ø<strong>ËøÖÈÄü</strong>ÊâßË°å<code>kill -1 43682</code>ÂëΩ‰ª§ÁªôÁ®ãÂ∫èÂèëÈÄÅ<code>syscall.SIGHUP</code>‰ø°Âè∑</li>
<li>Á≠âÁ¨¨3Ê≠•ÊµèËßàÂô®Êî∂Âà∞ÂìçÂ∫î‰ø°ÊÅØ<code>hello gin!</code>ÂêéÂÜçÊ¨°ËÆøÈóÆ<code>127.0.0.1:8080/</code>‰ºöÊî∂Âà∞<code>hello q1mi!</code>ÁöÑÂìçÂ∫î„ÄÇ</li>
<li>Âú®‰∏çÂΩ±ÂìçÂΩìÂâçÊú™Â§ÑÁêÜÂÆåËØ∑Ê±ÇÁöÑÂêåÊó∂ÂÆåÊàê‰∫ÜÁ®ãÂ∫è‰ª£Á†ÅÁöÑÊõøÊç¢ÔºåÂÆûÁé∞‰∫Ü‰ºòÈõÖÈáçÂêØ„ÄÇ</li>
</ol>
<p>‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÊ≠§Êó∂Á®ãÂ∫èÁöÑPIDÂèòÂåñ‰∫ÜÔºåÂõ†‰∏∫<code>endless</code> ÊòØÈÄöËøá<code>fork</code>Â≠êËøõÁ®ãÂ§ÑÁêÜÊñ∞ËØ∑Ê±ÇÔºåÂæÖÂéüËøõÁ®ãÂ§ÑÁêÜÂÆåÂΩìÂâçËØ∑Ê±ÇÂêéÂÜçÈÄÄÂá∫ÁöÑÊñπÂºèÂÆûÁé∞‰ºòÈõÖÈáçÂêØÁöÑ„ÄÇÊâÄ‰ª•ÂΩì‰Ω†ÁöÑÈ°πÁõÆÊòØ‰ΩøÁî®Á±ª‰ºº<code>supervisor</code>ÁöÑËΩØ‰ª∂ÁÆ°ÁêÜËøõÁ®ãÊó∂Â∞±<strong>‰∏çÈÄÇÁî®</strong>ËøôÁßçÊñπÂºè‰∫Ü„ÄÇ</p>
<h2 id="Êê≠Âª∫‰∏Ä‰∏™ÈÄöÁî®ÁöÑËÑöÊâãÊû∂Â∑•ÂÖ∑">Êê≠Âª∫‰∏Ä‰∏™ÈÄöÁî®ÁöÑËÑöÊâãÊû∂Â∑•ÂÖ∑</h2>
<h3 id="v10">v1.0</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220327131342952.png"
	
	
	
	loading="lazy"
	
		alt="image-20220327131342952"
	
	
></p>
<p>mysql.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">mysql</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/viper&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="s">&#34;github.com/go-sql-driver/mysql&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/jmoiron/sqlx&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">db</span> <span class="o">*</span><span class="nx">sqlx</span><span class="p">.</span><span class="nx">DB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Init</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">dsn</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s:%s@tcp(%s:%d)/%s?charset=utf8mb4&amp;parseTime=True&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;mysql.user&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;mysql.password&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;mysql.host&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;mysql.port&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;mysql.dbName&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">dsn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sqlx</span><span class="p">.</span><span class="nf">Connect</span><span class="p">(</span><span class="s">&#34;mysql&#34;</span><span class="p">,</span> <span class="nx">dsn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;mysql connect error,err : %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">SetMaxOpenConns</span><span class="p">(</span><span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;mysql.maxOpen&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">SetMaxIdleConns</span><span class="p">(</span><span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;mysql.maxIdle&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Close</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>redis.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">redis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/go-redis/redis&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/viper&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">rdb</span> <span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Init</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rdb</span> <span class="p">=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">NewClient</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Addr</span><span class="p">:</span>     <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s:%d&#34;</span><span class="p">,</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;redis.host&#34;</span><span class="p">),</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;redis.port&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Password</span><span class="p">:</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;redis.password&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">DB</span><span class="p">:</span>       <span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;redis.db&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">PoolSize</span><span class="p">:</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;redis.poolSize&#34;</span><span class="p">),</span> <span class="c1">//ËøûÊé•Ê±†Â§ßÂ∞è
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">Ping</span><span class="p">().</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;redis ping error,err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Close</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rdb</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>log.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">logger</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http/httputil&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;runtime/debug&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/natefinch/lumberjack&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/viper&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap/zapcore&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Init</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">writer</span> <span class="o">:=</span> <span class="nf">getLoggerWriter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;log.logName&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;log.max-size&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;log.max-age&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">viper</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="s">&#34;log.max-backup&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoder</span> <span class="o">:=</span> <span class="nf">getEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">l</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">UnmarshalText</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">viper</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="s">&#34;log.level&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">core</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">encoder</span><span class="p">,</span> <span class="nx">writer</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">AddCaller</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ÊõøÊç¢zapÂ∫ì‰∏≠ÁöÑÂÖ®Â±ÄlogÂØπË±°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">zap</span><span class="p">.</span><span class="nf">ReplaceGlobals</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getEncoder</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeTime</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ISO8601TimeEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="nx">encoderConfig</span><span class="p">.</span><span class="nx">EncodeLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">CapitalLevelEncoder</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewConsoleEncoder</span><span class="p">(</span><span class="nx">encoderConfig</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getLoggerWriter</span><span class="p">(</span><span class="nx">filePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">maxSize</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">maxAge</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">maxBackUp</span> <span class="kt">int</span><span class="p">)</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WriteSyncer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cfg</span> <span class="o">:=</span> <span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Filename</span><span class="p">:</span>   <span class="nx">filePath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxSize</span><span class="p">:</span>    <span class="nx">maxSize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxBackups</span><span class="p">:</span> <span class="nx">maxBackUp</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MaxAge</span><span class="p">:</span>     <span class="nx">maxAge</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Compress</span><span class="p">:</span>   <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">cfg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Êé•ÂèóginÊ°ÜÊû∂ÁöÑÈªòËÆ§Êó•Âøó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GinLogger</span><span class="p">()</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">path</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span>
</span></span><span class="line"><span class="cl">		<span class="nx">query</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="c1">//ÊâßË°åÂêéÈù¢ÁöÑ‰∏≠Èó¥‰ª∂ÔºåÁÑ∂ÂêéËÆ°ÁÆócost
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">cost</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Info</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;status&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Status</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;method&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Method</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;path&#34;</span><span class="p">,</span> <span class="nx">path</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;query&#34;</span><span class="p">,</span> <span class="nx">query</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;ip&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ClientIP</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;user-agent&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">UserAgent</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;errors&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Errors</span><span class="p">.</span><span class="nf">ByType</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nx">ErrorTypePrivate</span><span class="p">).</span><span class="nf">String</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zap</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="s">&#34;cost&#34;</span><span class="p">,</span> <span class="nx">cost</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GinRecovery recoverÊéâÈ°πÁõÆÂèØËÉΩÂá∫Áé∞ÁöÑpanicÔºåÂπ∂‰ΩøÁî®zapËÆ∞ÂΩïÁõ∏ÂÖ≥Êó•Âøó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GinRecovery</span><span class="p">(</span><span class="nx">stack</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Check for a broken connection, as it is not really a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// condition that warrants a panic stack trace.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="kd">var</span> <span class="nx">brokenPipe</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">ne</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">OpError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="nx">se</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">Err</span><span class="p">.(</span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">SyscallError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">se</span><span class="p">.</span><span class="nf">Error</span><span class="p">()),</span> <span class="s">&#34;broken pipe&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">(</span><span class="nx">se</span><span class="p">.</span><span class="nf">Error</span><span class="p">()),</span> <span class="s">&#34;connection reset by peer&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="nx">brokenPipe</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="nx">httpRequest</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">httputil</span><span class="p">.</span><span class="nf">DumpRequest</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">brokenPipe</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// If the connection is dead, we can&#39;t write a status to it.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">c</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">.(</span><span class="kt">error</span><span class="p">))</span> <span class="c1">// nolint: errcheck
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">					<span class="k">return</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">if</span> <span class="nx">stack</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;[Recovery from panic]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;stack&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">debug</span><span class="p">.</span><span class="nf">Stack</span><span class="p">())),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;[Recovery from panic]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;request&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">					<span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nx">c</span><span class="p">.</span><span class="nf">AbortWithStatus</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>route.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">route</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;comman_web_structure/logger&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">SetUp</span><span class="p">()</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">logger</span><span class="p">.</span><span class="nf">GinLogger</span><span class="p">(),</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">GinRecovery</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">r</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>setting.go</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/fsnotify/fsnotify&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/viper&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Init</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigName</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;yaml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;./settings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;read error,err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">WatchConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">OnConfigChange</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">in</span> <span class="nx">fsnotify</span><span class="p">.</span><span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;ÈÖçÁΩÆÊñá‰ª∂‰øÆÊîπ‰∫Ü..&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="v20Â∞ÜÈÖçÁΩÆ‰ø°ÊÅØÂÜôÈÅìÁªìÊûÑ‰Ωì">v2.0(Â∞ÜÈÖçÁΩÆ‰ø°ÊÅØÂÜôÈÅìÁªìÊûÑ‰Ωì)</h3>
<p>‰ºòÂåñÂêéÁöÑsettings</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Conf</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">AppConfig</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AppConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span>          <span class="kt">string</span> <span class="s">`mapstructure:&#34;name&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span>          <span class="kt">string</span> <span class="s">`mapstructure:&#34;port&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Mode</span>          <span class="kt">string</span> <span class="s">`mapstructure:&#34;mode&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">MysqlConfig</span>  <span class="s">`mapstructure:&#34;mysql&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">RedisConfig</span>  <span class="s">`mapstructure:&#34;redis&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">LoggerConfig</span> <span class="s">`mapstructure:&#34;log&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MysqlConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Host</span>     <span class="kt">string</span> <span class="s">`mapstructure:&#34;host&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span>     <span class="kt">int</span>    <span class="s">`mapstructure:&#34;port&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">User</span>     <span class="kt">string</span> <span class="s">`mapstructure:&#34;user&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Password</span> <span class="kt">string</span> <span class="s">`mapstructure:&#34;password&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">DbName</span>   <span class="kt">string</span> <span class="s">`mapstructure:&#34;dbName&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxOpen</span>  <span class="kt">int</span>    <span class="s">`mapstructure:&#34;maxOpen&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxIdle</span>  <span class="kt">int</span>    <span class="s">`mapstructure:&#34;maxIdle&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">RedisConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Host</span>     <span class="kt">string</span> <span class="s">`mapstructure:&#34;host&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span>     <span class="kt">int</span>    <span class="s">`mapstructure:&#34;port&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Password</span> <span class="kt">string</span> <span class="s">`mapstructure:&#34;password&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Db</span>       <span class="kt">int</span>    <span class="s">`mapstructure:&#34;db&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">PoolSize</span> <span class="kt">int</span>    <span class="s">`mapstructure:&#34;poolSize&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">LoggerConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Level</span>     <span class="kt">string</span> <span class="s">`mapstructure:&#34;level&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LogName</span>   <span class="kt">string</span> <span class="s">`mapstructure:&#34;logName&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxSize</span>   <span class="kt">int</span>    <span class="s">`mapstructure:&#34;max-size&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxAge</span>    <span class="kt">int</span>    <span class="s">`mapstructure:&#34;max-age&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MaxBackup</span> <span class="kt">int</span>    <span class="s">`mapstructure:&#34;max-backup&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Init</span><span class="p">()</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigName</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;yaml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;./settings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;read error,err:%v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">Conf</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;unMarshal error, err : %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">WatchConfig</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">OnConfigChange</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">in</span> <span class="nx">fsnotify</span><span class="p">.</span><span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;ÈÖçÁΩÆÊñá‰ª∂‰øÆÊîπ‰∫Ü..&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="v30Áî®ÂëΩ‰ª§Ë°åÊåáÂÆöÊñá‰ª∂">v3.0(Áî®ÂëΩ‰ª§Ë°åÊåáÂÆöÊñá‰ª∂)</h3>
<p>Áî®Á≥ªÁªüÂÜÖÁΩÆÁöÑos</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gO" data-lang="gO"><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;need config file..&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//1.Âä†ËΩΩÈÖçÁΩÆ ÈÄöËøáargs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">settings</span><span class="p">.</span><span class="nf">Init</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;init settings error,err:%v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áî®Á¨¨‰∏âÊñπÂ∫ìflag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ÂÆö‰πâÂëΩ‰ª§Ë°åÂèÇÊï∞ÊñπÂºè1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">age</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">married</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">delay</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
</span></span><span class="line"><span class="cl">	<span class="nx">flag</span><span class="p">.</span><span class="nf">StringVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">name</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;Âº†‰∏â&#34;</span><span class="p">,</span> <span class="s">&#34;ÂßìÂêç&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">flag</span><span class="p">.</span><span class="nf">IntVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">age</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#34;Âπ¥ÈæÑ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">flag</span><span class="p">.</span><span class="nf">BoolVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">married</span><span class="p">,</span> <span class="s">&#34;married&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;Â©öÂê¶&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">flag</span><span class="p">.</span><span class="nf">DurationVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">delay</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;Âª∂ËøüÁöÑÊó∂Èó¥Èó¥Èöî&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Ëß£ÊûêÂëΩ‰ª§Ë°åÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">flag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">,</span> <span class="nx">married</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ËøîÂõûÂëΩ‰ª§Ë°åÂèÇÊï∞ÂêéÁöÑÂÖ∂‰ªñÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">flag</span><span class="p">.</span><span class="nf">Args</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ËøîÂõûÂëΩ‰ª§Ë°åÂèÇÊï∞ÂêéÁöÑÂÖ∂‰ªñÂèÇÊï∞‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">flag</span><span class="p">.</span><span class="nf">NArg</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ËøîÂõû‰ΩøÁî®ÁöÑÂëΩ‰ª§Ë°åÂèÇÊï∞‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">flag</span><span class="p">.</span><span class="nf">NFlag</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="È°πÁõÆÊê≠Âª∫">È°πÁõÆÊê≠Âª∫</h2>
<h3 id="ÂàÜÂ∏ÉÂºèid">ÂàÜÂ∏ÉÂºèID</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220328151039155.png"
	
	
	
	loading="lazy"
	
		alt="image-20220328151039155"
	
	
></p>
<h3 id="Èõ™Ëä±ÁÆóÊ≥ï">Èõ™Ëä±ÁÆóÊ≥ï</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220328151232149.png"
	
	
	
	loading="lazy"
	
		alt="image-20220328151232149"
	
	
></p>
<h5 id="Â¶Ç‰Ωï‰ΩøÁî®">Â¶Ç‰Ωï‰ΩøÁî®</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">go get github.com/bwmarrin/snowflake
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Init</span><span class="p">(</span><span class="nx">startTime</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">machineId</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ÂÖàÂ∞ÜÂΩìÂâçÊó∂Èó¥Ê†ºÂºèËΩ¨Êç¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">t</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="s">&#34;2006-01-02&#34;</span><span class="p">,</span> <span class="nx">startTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">snowflake</span><span class="p">.</span><span class="nx">Epoch</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">UnixNano</span><span class="p">()</span> <span class="o">/</span> <span class="mi">100000</span>
</span></span><span class="line"><span class="cl">	<span class="nx">node</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">snowflake</span><span class="p">.</span><span class="nf">NewNode</span><span class="p">(</span><span class="nx">machineId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getId</span><span class="p">()</span> <span class="kt">int64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nf">Generate</span><span class="p">().</span><span class="nf">Int64</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê≥®ÂÜåÈÄªËæë">Ê≥®ÂÜåÈÄªËæë</h3>
<p>Âú®controllerÂ±ÇÔºå‰∏ÄËà¨ÂÅöÂèÇÊï∞Ê†°È™åÂ∑≤ÁªèÈÄöËøáserviceËøõË°å‰∏öÂä°Â§ÑÁêÜÊúÄÂêéËøîÂõû„ÄÇ</p>
<p>ÊôÆÈÄöÁöÑÂèÇÊï∞Âà§Êñ≠</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">par</span><span class="p">.</span><span class="nx">Username</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nb">len</span><span class="p">(</span><span class="nx">par</span><span class="p">.</span><span class="nx">Password</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nb">len</span><span class="p">(</span><span class="nx">par</span><span class="p">.</span><span class="nx">RePassword</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">par</span><span class="p">.</span><span class="nx">RePassword</span> <span class="o">!=</span> <span class="nx">par</span><span class="p">.</span><span class="nx">Password</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Signup with invalid param&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">context</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="s">&#34;ËØ∑Ê±ÇÂèÇÊï∞ÊúâËØØÔºÅ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Áî®Á¨¨‰∏âÊñπÂ∫ìËøõË°åÂèÇÊï∞Ê†°È™å">Áî®Á¨¨‰∏âÊñπÂ∫ìËøõË°åÂèÇÊï∞Ê†°È™å</h4>
<p>Âú®webÂºÄÂèë‰∏≠‰∏Ä‰∏™‰∏çÂèØÈÅøÂÖçÁöÑÁéØËäÇÂ∞±ÊòØÂØπËØ∑Ê±ÇÂèÇÊï∞ËøõË°åÊ†°È™åÔºåÈÄöÂ∏∏Êàë‰ª¨‰ºöÂú®‰ª£Á†Å‰∏≠ÂÆö‰πâ‰∏éËØ∑Ê±ÇÂèÇÊï∞Áõ∏ÂØπÂ∫îÁöÑÊ®°ÂûãÔºàÁªìÊûÑ‰ΩìÔºâÔºåÂÄüÂä©Ê®°ÂûãÁªëÂÆöÂø´Êç∑Âú∞Ëß£ÊûêËØ∑Ê±Ç‰∏≠ÁöÑÂèÇÊï∞Ôºå‰æãÂ¶Ç gin Ê°ÜÊû∂‰∏≠ÁöÑ<code>Bind</code>Âíå<code>ShouldBind</code>Á≥ªÂàóÊñπÊ≥ï„ÄÇÊú¨ÊñáÂ∞±‰ª• gin Ê°ÜÊû∂ÁöÑËØ∑Ê±ÇÂèÇÊï∞Ê†°È™å‰∏∫‰æãÔºå‰ªãÁªç‰∏Ä‰∫õ<code>validator</code>Â∫ìÁöÑÂÆûÁî®ÊäÄÂ∑ß„ÄÇ</p>
<p>ginÊ°ÜÊû∂‰ΩøÁî®<a class="link" href="https://github.com/go-playground/validator"  target="_blank" rel="noopener"
    >github.com/go-playground/validator</a>ËøõË°åÂèÇÊï∞Ê†°È™åÔºåÁõÆÂâçÂ∑≤ÁªèÊîØÊåÅ<code>github.com/go-playground/validator/v10</code>‰∫ÜÔºåÊàë‰ª¨ÈúÄË¶ÅÂú®ÂÆö‰πâÁªìÊûÑ‰ΩìÊó∂‰ΩøÁî® <code>binding</code> tagÊ†áËØÜÁõ∏ÂÖ≥Ê†°È™åËßÑÂàôÔºåÂèØ‰ª•Êü•Áúã<a class="link" href="https://godoc.org/github.com/go-playground/validator#hdr-Baked_In_Validators_and_Tags"  target="_blank" rel="noopener"
    >validatorÊñáÊ°£</a>Êü•ÁúãÊîØÊåÅÁöÑÊâÄÊúâ tag„ÄÇ</p>
<p>Áî®‰∏Ä‰∏™ÁÆÄÂçïÁöÑbindingÂç≥ÂèØÊ†°È™å</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220328172350104.png"
	
	
	
	loading="lazy"
	
		alt="image-20220328172350104"
	
	
></p>
<h4 id="validatorËøîÂõûÈîôËØØ‰ø°ÊÅØÁöÑÂõΩÈôÖÂåñ">validatorËøîÂõûÈîôËØØ‰ø°ÊÅØÁöÑÂõΩÈôÖÂåñ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin/binding&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/go-playground/locales/en&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/go-playground/locales/zh&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ut</span> <span class="s">&#34;github.com/go-playground/universal-translator&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/go-playground/validator/v10&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">enTranslations</span> <span class="s">&#34;github.com/go-playground/validator/v10/translations/en&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">zhTranslations</span> <span class="s">&#34;github.com/go-playground/validator/v10/translations/zh&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂÆö‰πâ‰∏Ä‰∏™ÂÖ®Â±ÄÁøªËØëÂô®T
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">trans</span> <span class="nx">ut</span><span class="p">.</span><span class="nx">Translator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// InitTrans ÂàùÂßãÂåñÁøªËØëÂô®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">InitTrans</span><span class="p">(</span><span class="nx">locale</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ‰øÆÊîπginÊ°ÜÊû∂‰∏≠ÁöÑValidatorÂºïÊìéÂ±ûÊÄßÔºåÂÆûÁé∞Ëá™ÂÆöÂà∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">Validator</span><span class="p">.</span><span class="nf">Engine</span><span class="p">().(</span><span class="o">*</span><span class="nx">validator</span><span class="p">.</span><span class="nx">Validate</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Ê≥®ÂÜå‰∏Ä‰∏™Ëé∑Âèñjson tagÁöÑËá™ÂÆö‰πâÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">v</span><span class="p">.</span><span class="nf">RegisterTagNameFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">fld</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">StructField</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">name</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">SplitN</span><span class="p">(</span><span class="nx">fld</span><span class="p">.</span><span class="nx">Tag</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;json&#34;</span><span class="p">),</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">name</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zhT</span> <span class="o">:=</span> <span class="nx">zh</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span> <span class="c1">// ‰∏≠ÊñáÁøªËØëÂô®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">enT</span> <span class="o">:=</span> <span class="nx">en</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span> <span class="c1">// Ëã±ÊñáÁøªËØëÂô®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØÂ§áÁî®ÔºàfallbackÔºâÁöÑËØ≠Ë®ÄÁéØÂ¢É
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// ÂêéÈù¢ÁöÑÂèÇÊï∞ÊòØÂ∫îËØ•ÊîØÊåÅÁöÑËØ≠Ë®ÄÁéØÂ¢ÉÔºàÊîØÊåÅÂ§ö‰∏™Ôºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// uni := ut.New(zhT, zhT) ‰πüÊòØÂèØ‰ª•ÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">uni</span> <span class="o">:=</span> <span class="nx">ut</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">enT</span><span class="p">,</span> <span class="nx">zhT</span><span class="p">,</span> <span class="nx">enT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// locale ÈÄöÂ∏∏ÂèñÂÜ≥‰∫é http ËØ∑Ê±ÇÂ§¥ÁöÑ &#39;Accept-Language&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kd">var</span> <span class="nx">ok</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ‰πüÂèØ‰ª•‰ΩøÁî® uni.FindTranslator(...) ‰º†ÂÖ•Â§ö‰∏™localeËøõË°åÊü•Êâæ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">trans</span><span class="p">,</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">uni</span><span class="p">.</span><span class="nf">GetTranslator</span><span class="p">(</span><span class="nx">locale</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;uni.GetTranslator(%s) failed&#34;</span><span class="p">,</span> <span class="nx">locale</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Ê≥®ÂÜåÁøªËØëÂô®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">switch</span> <span class="nx">locale</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="s">&#34;en&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="nx">err</span> <span class="p">=</span> <span class="nx">enTranslations</span><span class="p">.</span><span class="nf">RegisterDefaultTranslations</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">trans</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="s">&#34;zh&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="nx">err</span> <span class="p">=</span> <span class="nx">zhTranslations</span><span class="p">.</span><span class="nf">RegisterDefaultTranslations</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">trans</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="nx">err</span> <span class="p">=</span> <span class="nx">enTranslations</span><span class="p">.</span><span class="nf">RegisterDefaultTranslations</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">trans</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ÂéªÈô§ÊèêÁ§∫‰ø°ÊÅØÁöÑÁªìÊûÑ‰Ωì
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">removeTopStruct</span><span class="p">(</span><span class="nx">fields</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">fields</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">res</span><span class="p">[</span><span class="nx">field</span><span class="p">[</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]]</span> <span class="p">=</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Êó•ÂøóËæìÂá∫Âà∞ÊéßÂà∂Âè∞ÂíåÊñá‰ª∂devÁéØÂ¢É‰∏ãÊñπ‰æøË∞ÉËØï">Êó•ÂøóËæìÂá∫Âà∞ÊéßÂà∂Âè∞ÂíåÊñá‰ª∂ÔºàdevÁéØÂ¢É‰∏ãÊñπ‰æøË∞ÉËØïÔºâ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">Conf</span><span class="p">.</span><span class="nx">Mode</span> <span class="o">==</span> <span class="s">&#34;dev&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">consoleEncoder</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewConsoleEncoder</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nf">NewDevelopmentEncoderConfig</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//ÈÄöËøáteeÔºåÂæóÂà∞‰∫Ü‰∏§‰∏™ËæìÂá∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">core</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewTee</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">encoder</span><span class="p">,</span> <span class="nx">writer</span><span class="p">,</span> <span class="nx">l</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//ÂêëÁªàÁ´ØËæìÂá∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">consoleEncoder</span><span class="p">,</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">Lock</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">),</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">core</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">encoder</span><span class="p">,</span> <span class="nx">writer</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøáÈÖçÁΩÆÊñá‰ª∂ÁöÑmodeÔºåËé∑ÂæóÂΩìÂâçÁöÑÂºÄÂèëÁéØÂ¢ÉÔºåÁÑ∂ÂêéÂ¶ÇÊûúÊòØdevÔºåÂ∞±ÈÄöËøáteeÂæóÂà∞‰∏§‰∏™coreÔºå‰∏Ä‰∏™ËæìÂá∫Âà∞Êñá‰ª∂Ôºå‰∏Ä‰∏™ËæìÂá∫Âà∞ÊéßÂà∂Âè∞ÔºåÊñπ‰æøË∞ÉËØï„ÄÇ</p>
<h4 id="Â∞ÅË£ÖËøîÂõûÁöÑjson">Â∞ÅË£ÖËøîÂõûÁöÑjson</h4>
<p>ÊàëÊà™Âèñ‰∏ÄÊÆµ Áé∞Âú®ÁöÑ‰ª£Á†ÅÔºåÂ§ßÂÆ∂ÂèØ‰ª•ÂèëÁé∞ËøîÂõûÁöÑÊó∂ÂÄôÈÉΩË¶ÅË∞ÉÁî®context.jsonÂæàÈ∫ªÁÉ¶„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">LoginUser</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">p</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">LoginParam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">ShouldBindJSON</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">errors</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">validator</span><span class="p">.</span><span class="nx">ValidationErrors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;login with invalid json&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">context</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="nf">removeTopStruct</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">Translate</span><span class="p">(</span><span class="nx">trans</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">			<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">context</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">			<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">service</span><span class="p">.</span><span class="nf">Login</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;login error&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">context</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="s">&#34;Áî®Êà∑ÂêçÊàñËÄÖÂØÜÁ†ÅÈîôËØØ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">context</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="s">&#34;ÁôªÈôÜÊàêÂäü&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨ÂèØ‰ª•Â∞ÜËøîÂõûÂìçÂ∫îÂ∞ÅË£Ö‰∏∫‰∏Ä‰∏™ÂáΩÊï∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Response</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Code</span> <span class="nx">ResCode</span>     <span class="s">`json:&#34;code&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Msg</span>  <span class="kd">interface</span><span class="p">{}</span> <span class="s">`json:&#34;msg&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Data</span> <span class="kd">interface</span><span class="p">{}</span> <span class="s">`json:&#34;data&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ResponseError</span><span class="p">(</span><span class="nx">code</span> <span class="nx">ResCode</span><span class="p">,</span> <span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">Response</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Code</span><span class="p">:</span> <span class="nx">code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Msg</span><span class="p">:</span>  <span class="nf">Msg</span><span class="p">(</span><span class="nx">code</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Data</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ResponseErrorWithMsg</span><span class="p">(</span><span class="nx">code</span> <span class="nx">ResCode</span><span class="p">,</span> <span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">msg</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">Response</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Code</span><span class="p">:</span> <span class="nx">code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Msg</span><span class="p">:</span>  <span class="nx">msg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Data</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ResponseSuccess</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">data</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">Response</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Code</span><span class="p">:</span> <span class="nx">CodeSuccess</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Msg</span><span class="p">:</span>  <span class="nf">Msg</span><span class="p">(</span><span class="nx">CodeSuccess</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂØπÂ∫îÁöÑCodeÁ±ªÂûã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ResCode</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeSuccess</span> <span class="nx">ResCode</span> <span class="p">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="kc">iota</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeInvalidParam</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeUserExist</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeUserNotExist</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeInvalidPassword</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeServeBusy</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">codeMap</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="nx">ResCode</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeSuccess</span><span class="p">:</span>         <span class="s">&#34;ËØ∑Ê±ÇÊàêÂäü&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeInvalidParam</span><span class="p">:</span>    <span class="s">&#34;ËØ∑Ê±ÇÂèÇÊï∞ÂºÇÂ∏∏&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeUserExist</span><span class="p">:</span>       <span class="s">&#34;Áî®Êà∑Â∑≤Â≠òÂú®&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeUserNotExist</span><span class="p">:</span>    <span class="s">&#34;Áî®Êà∑‰∏çÂ≠òÂú®&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeInvalidPassword</span><span class="p">:</span> <span class="s">&#34;ÂØÜÁ†ÅÈîôËØØ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CodeServeBusy</span><span class="p">:</span>       <span class="s">&#34;ÊúçÂä°Âô®ÁπÅÂøô&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Msg</span><span class="p">(</span><span class="nx">code</span> <span class="nx">ResCode</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">codeMap</span><span class="p">[</span><span class="nx">code</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">codeMap</span><span class="p">[</span><span class="nx">CodeServeBusy</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">s</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Â∞ÜerrorsnewÂ∞ÅË£ÖÊàêÂØπË±°Êñπ‰æøcontrollerÂà§Êñ≠">Â∞Üerrors.NewÂ∞ÅË£ÖÊàêÂØπË±°ÔºåÊñπ‰æøcontrollerÂà§Êñ≠</h4>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220329131929645.png"
	
	
	
	loading="lazy"
	
		alt="image-20220329131929645"
	
	
></p>
<p>Ëøô‰∫õÈîôËØØÊàë‰ª¨ÁöÑcontroller‰∏çÂ•ΩÂà§Êñ≠ÔºåÊúÄÂ•ΩÊääÂÆÉÊç¢Êàê‰∏ãÂõæËøôÊ†∑</p>
<p>ÊîπÈÄ†ÂêéÔºåÂèòÂæó‰ºòÈõÖ‰∫ÜËÆ∏Â§ö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;comman_web_structure/dao/mysql&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;comman_web_structure/model&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;comman_web_structure/service&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/go-playground/validator/v10&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">SingUpUser</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">par</span> <span class="nx">model</span><span class="p">.</span><span class="nx">SignUpParam</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">ShouldBindJSON</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">par</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Signup with invalid json&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">errors</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">validator</span><span class="p">.</span><span class="nx">ValidationErrors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeInvalidParam</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseErrorWithMsg</span><span class="p">(</span><span class="nx">CodeInvalidParam</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nf">removeTopStruct</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">Translate</span><span class="p">(</span><span class="nx">trans</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">service</span><span class="p">.</span><span class="nf">SignUp</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">par</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Signup error&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">ErrorUserExist</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeUserExist</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeServeBusy</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">ResponseSuccess</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">LoginUser</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">p</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">LoginParam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">ShouldBindJSON</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">errors</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">validator</span><span class="p">.</span><span class="nx">ValidationErrors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;login with invalid json&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseErrorWithMsg</span><span class="p">(</span><span class="nx">CodeInvalidParam</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nf">removeTopStruct</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">Translate</span><span class="p">(</span><span class="nx">trans</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeInvalidParam</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">service</span><span class="p">.</span><span class="nf">Login</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;login error&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">ErrorUserNotExist</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeUserNotExist</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">ErrorUserPasswordWrong</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeInvalidPassword</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">CodeServeBusy</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">ResponseSuccess</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Âà©Áî®jwtÁöÑtokenËøõË°åÁôªÂΩï">Âà©Áî®JwtÁöÑtokenËøõË°åÁôªÂΩï</h3>
<p>‰∏ÄËà¨Ëøò‰ºöÊúâÂè¶‰∏ÄÁßç‰∏≠ÊñπÊ°àÔºöCookie + SessionÔºå‰ΩÜÊòØ‰ºöÊúâ‰∏ÄÁÇπÈ£éÈô©ÔºåÂõ†‰∏∫‰ºöÊúâÂÆâÂÖ®ÁöÑÂç±Èô©ÔºåÂÅáÂ¶ÇÊúâ‰∏Ä‰∏™ÈíìÈ±ºÁΩëÁ´ôÂæóÂà∞‰∫Ü‰Ω†ÁöÑcookieÔºåÂ∞±‰ºöÂèëÁîüÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇÂπ∂‰∏îsessionÊòØÈúÄË¶ÅÂ≠òÂÇ®Âú®ÊúçÂä°Âô®Á´ØÁöÑ„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220329144944634.png"
	
	
	
	loading="lazy"
	
		alt="image-20220329144944634"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">go</span> <span class="nx">get</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dgrijalva</span><span class="o">/</span><span class="nx">jwt</span><span class="o">-</span><span class="k">go</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ÈÄöËøátokenËøõË°åÊ†°È™å">ÈÄöËøátokenËøõË°åÊ†°È™å</h4>
<p>Ê†°È™åÊñπÊ≥ïÊàë‰ª¨‰ºöÊîæÂú®‰∏≠Èó¥‰ª∂‰∏≠ÔºåËã•Êüê‰∏™Êé•Âè£ÈúÄË¶ÅÁôªÈôÜÔºåÂèØ‰ª•Áõ¥Êé•Â∞Ü‰∏≠Èó¥ÈîÆÁöÑÊñπÊ≥ïÊîæÂà∞Ë∑ØÁî±ÈáåÈù¢Âç≥ÂèØ„ÄÇ</p>
<p>ÊñπÊ≥ïÂ§ßÊ¶ÇÊòØÂèñÂá∫Â§¥ÈÉ®ÁöÑtokenÔºåÂØπtokenÊ†°È™åÔºåËã•Âá∫ÈîôÂàôËøîÂõûÈîôËØØÔºåÂê¶Âàô‰ºöÂ∞ÜÁî®Êà∑ÁöÑidÊîæÂà∞context‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">JWTAuthMiddleware</span><span class="p">()</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ÂÆ¢Êà∑Á´ØÊê∫Â∏¶TokenÊúâ‰∏âÁßçÊñπÂºè 1.ÊîæÂú®ËØ∑Ê±ÇÂ§¥ 2.ÊîæÂú®ËØ∑Ê±Ç‰Ωì 3.ÊîæÂú®URI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// ËøôÈáåÂÅáËÆæTokenÊîæÂú®HeaderÁöÑAuthorization‰∏≠ÔºåÂπ∂‰ΩøÁî®BearerÂºÄÂ§¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// ËøôÈáåÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÊñπÂºèË¶Å‰æùÊçÆ‰Ω†ÁöÑÂÆûÈôÖ‰∏öÂä°ÊÉÖÂÜµÂÜ≥ÂÆö
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">authHeader</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">authHeader</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="mi">2003</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;msg&#34;</span><span class="p">:</span>  <span class="s">&#34;ËØ∑Ê±ÇÂ§¥‰∏≠auth‰∏∫Á©∫&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="p">})</span>
</span></span><span class="line"><span class="cl">         <span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="k">return</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ÊåâÁ©∫Ê†ºÂàÜÂâ≤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">parts</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">SplitN</span><span class="p">(</span><span class="nx">authHeader</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">!(</span><span class="nb">len</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#34;Bearer&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nx">controller</span><span class="p">.</span><span class="nf">ResponseError</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">CodeEmptyRequestHeader</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="k">return</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// parts[1]ÊòØËé∑ÂèñÂà∞ÁöÑtokenStringÔºåÊàë‰ª¨‰ΩøÁî®‰πãÂâçÂÆö‰πâÂ•ΩÁöÑËß£ÊûêJWTÁöÑÂáΩÊï∞Êù•Ëß£ÊûêÂÆÉ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">mc</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nf">ParseToken</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nx">controller</span><span class="p">.</span><span class="nf">ResponseError</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">CodeInvalidAuth</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="k">return</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Â∞ÜÂΩìÂâçËØ∑Ê±ÇÁöÑusername‰ø°ÊÅØ‰øùÂ≠òÂà∞ËØ∑Ê±ÇÁöÑ‰∏ä‰∏ãÊñác‰∏ä
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">c</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">ContextUserName</span><span class="p">,</span> <span class="nx">mc</span><span class="p">.</span><span class="nx">Username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">c</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">ContextUserID</span><span class="p">,</span> <span class="nx">mc</span><span class="p">.</span><span class="nx">UserId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="c1">// ÂêéÁª≠ÁöÑÂ§ÑÁêÜÂáΩÊï∞ÂèØ‰ª•Áî®Ëøác.Get(&#34;username&#34;)Êù•Ëé∑ÂèñÂΩìÂâçËØ∑Ê±ÇÁöÑÁî®Êà∑‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩÜÊòØÁé∞Âú®ÊàëÂéªgo buildÔºå‰ªñÂç¥ÂëäËØâÊàëÊúâÂæ™ÁéØÂºïÁî®ÔºåÂï•ÊÉÖÂÜµÔºü</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331151936339.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331151936339"
	
	
></p>
<p>È¶ñÂÖàÂàÜÊûê‰∏Ä‰∏ãÔºå‰∏ãÈù¢ÁöÑÊó•ÂøóÂëäËØâÊàë‰ª¨ÊòØcontrollerÂíåmiddleÂèëÁîüÂæ™ÁéØÂºïÁî®‰∫Ü„ÄÇ</p>
<p>requestÊòØÂú®controllerÂ±ÇÁöÑÔºå‰ªñÁî®‰∫éËß£ÊûêÂá∫requestÂ§¥ÈÉ®‰∏≠Â§¥ÈÉ®ÊâÄÂ∏¶ÁöÑpayloadÔºåÂÜçÁúãÁúãÈâ¥ÊùÉÊñπÊ≥ïÊòØÂ≠òÂú®‰∏émiddleÂåÖÁöÑ„ÄÇ</p>
<p>ÊòéÁ°Æ‰∫ÜËøô‰∏§ÁÇπÊù•ÁúãÁúã‰ª£Á†Å</p>
<p>Ôºàmiddle-&gt;controllerÔºâ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331152829862.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331152829862"
	
	
></p>
<p>(controller-&gt;middle)</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331152906096.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331152906096"
	
	
></p>
<blockquote>
<p>Ëß£ÂÜ≥ÊñπÊ≥ïÂæàÁÆÄÂçïÔºåÊàë‰ª¨‰∏çË¶ÅËÆ©controllerÂºïÁî®middleÁöÑidÂ∞±ÂèØ‰ª•‰∫ÜÔºåÊääidÊîæÂú®controllerÂ±Ç</p>
</blockquote>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331153020308.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331153020308"
	
	
></p>
<p>Áé∞Âú®Â∞±ÂèòÊàê‰∫Ücontrolle‰∏çÂºïÁî®Ôºåmiddle-&gt;controller,‰∏çÂ≠òÂú®Âæ™ÁéØÂºïÁî®„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331153408776.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331153408776"
	
	
></p>
<p>ÁªìÊûúÔºö</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331153414758.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331153414758"
	
	
></p>
<h4 id="refresh-token">refresh token</h4>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331154030413.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331154030413"
	
	
></p>
<p>‰ª•ÂâçÂú®javaÈ°πÁõÆ‰πüÁî®ËøáÔºåÂèå‰ª§ÁâåÔºåÂç≥Êó∂Èó¥ÈïøÁöÑ‰ª§ÁâåÂ¶ÇÊûúÂ≠òÂú®Ôºå‰ºöÁªôÁî®Êà∑‰∏Ä‰∏™Êñ∞ÁöÑaccess tokenÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÈÇ£Âè™ËÉΩÈáçÊñ∞ÁôªÂΩïÔºåÁÑ∂ÂêéÂéªÁî≥ËØ∑Âèå‰ª§Áâå‰∫Ü„ÄÇ</p>
<h4 id="Â¶Ç‰ΩïÈôêÂà∂‰∏ÄÂè∞ÁîµËÑëÂè™ËÉΩÁôªÂΩï‰∏Ä‰∏™Ë¥¶Âè∑">Â¶Ç‰ΩïÈôêÂà∂‰∏ÄÂè∞ÁîµËÑëÂè™ËÉΩÁôªÂΩï‰∏Ä‰∏™Ë¥¶Âè∑</h4>
<p>È¶ñÂÖàÔºåÊàë‰ª¨Áü•ÈÅìÂΩìÊàë‰ª¨ÂèëÂ∏ÉtokenÁöÑÊó∂ÂÄôÔºå‰∏ÄÂÆö‰∏ÄÂÆöÔºåË¥¶Âè∑ÁôªÂΩïÊòØÊ≤°ÊúâÈóÆÈ¢òÁöÑÔºåÈÇ£‰πàÊàë‰ª¨Â¶Ç‰ΩïÊù•‰øùÂ≠òtokenÁöÑÂîØ‰∏ÄÊÄßÂë¢ÔºüÔºà‰∏Ä‰∏™Ë¥¶Âè∑Âè™ËÉΩÁôªÂΩï‰∏Ä‰∏™ËÆæÂ§áÔºåÊç¢Âè•ËØùËØ¥Âêå‰∏ÄÊó∂Èó¥Âè™ËÉΩÂ≠òÂú®‰∏Ä‰∏™ÊúâÊïàtokenÔºâ</p>
<p>Êàë‰ª¨ÂèØ‰ª•Â∞ÜtokenÂ≠òÂà∞redisÔºåÂπ∂‰∏îÂ≠òÂÇ®userIdÂíåtokenÂØπÂ∫îÔºåÁî±‰∫éredisÁöÑstringÔºåkeyÊòØ‰∏ÄÂÆöË¶ÅÂîØ‰∏ÄÁöÑÔºåÊàë‰ª¨ÂèØ‰ª•ÊãøuserId‰∏∫keyÔºåtoken‰∏∫valÔºåÂú®Ë∞ÉÁî®Êé•Âè£ËøõË°åËÆ§ËØÅÁöÑÊó∂ÂÄôÔºåÂÖàÂèñÂá∫token‰∏≠ÁöÑuserIdÔºåÂÜçÂéªredisÈáåÈù¢ÂèñÂá∫tokenÔºåËøõË°åÂØπÊØîÔºåÂ¶ÇÊûútoken‰∏ç‰∏ÄËá¥ËØ¥ÊòéËØ•Ë¥¶Âè∑Êúâ‰∏§‰∏™‰∏çÂêåÊú∫Âô®Ê≠£Âú®ÁôªÈôÜÔºå‰ª•redis‰∏∫ÂáÜÂç≥ÂèØ„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331160117343.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331160117343"
	
	
></p>
<h3 id="‰∏∫goÈ°πÁõÆÁºñÂÜômake-file">‰∏∫goÈ°πÁõÆÁºñÂÜômake file</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331161901153.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331161901153"
	
	
></p>
<p>| <a class="link" href="https://www.liwenzhou.com/categories/Golang"  target="_blank" rel="noopener"
    >Golang</a></p>
<p>|ÊÄªÈòÖËØªÈáèÔºö11560Ê¨°</p>
<p>ÂÄüÂä©<code>Makefile</code>Êàë‰ª¨Âú®ÁºñËØëËøáÁ®ã‰∏≠‰∏çÂÜçÈúÄË¶ÅÊØèÊ¨°ÊâãÂä®ËæìÂÖ•ÁºñËØëÁöÑÂëΩ‰ª§ÂíåÁºñËØëÁöÑÂèÇÊï∞ÔºåÂèØ‰ª•ÊûÅÂ§ßÁÆÄÂåñÈ°πÁõÆÁºñËØëËøáÁ®ã„ÄÇ</p>
<h4 id="make‰ªãÁªç">make‰ªãÁªç</h4>
<p><code>make</code>ÊòØ‰∏Ä‰∏™ÊûÑÂª∫Ëá™Âä®ÂåñÂ∑•ÂÖ∑Ôºå‰ºöÂú®ÂΩìÂâçÁõÆÂΩï‰∏ãÂØªÊâæ<code>Makefile</code>Êàñ<code>makefile</code>Êñá‰ª∂„ÄÇÂ¶ÇÊûúÂ≠òÂú®Áõ∏Â∫îÁöÑÊñá‰ª∂ÔºåÂÆÉÂ∞±‰ºö‰æùÊçÆÂÖ∂‰∏≠ÂÆö‰πâÂ•ΩÁöÑËßÑÂàôÂÆåÊàêÊûÑÂª∫‰ªªÂä°„ÄÇ</p>
<h4 id="makefile‰ªãÁªç">Makefile‰ªãÁªç</h4>
<p>Êàë‰ª¨ÂèØ‰ª•Êää<code>Makefile</code>ÁÆÄÂçïÁêÜËß£‰∏∫ÂÆÉÂÆö‰πâ‰∫Ü‰∏Ä‰∏™È°πÁõÆÊñá‰ª∂ÁöÑÁºñËØëËßÑÂàô„ÄÇÂÄüÂä©<code>Makefile</code>Êàë‰ª¨Âú®ÁºñËØëËøáÁ®ã‰∏≠‰∏çÂÜçÈúÄË¶ÅÊØèÊ¨°ÊâãÂä®ËæìÂÖ•ÁºñËØëÁöÑÂëΩ‰ª§ÂíåÁºñËØëÁöÑÂèÇÊï∞ÔºåÂèØ‰ª•ÊûÅÂ§ßÁÆÄÂåñÈ°πÁõÆÁºñËØëËøáÁ®ã„ÄÇÂêåÊó∂‰ΩøÁî®<code>Makefile</code>‰πüÂèØ‰ª•Âú®È°πÁõÆ‰∏≠Á°ÆÂÆöÂÖ∑‰ΩìÁöÑÁºñËØëËßÑÂàôÂíåÊµÅÁ®ãÔºåÂæàÂ§öÂºÄÊ∫êÈ°πÁõÆ‰∏≠ÈÉΩ‰ºöÂÆö‰πâ<code>Makefile</code>Êñá‰ª∂„ÄÇ</p>
<p>Êú¨Êñá‰∏ç‰ºöËØ¶ÁªÜ‰ªãÁªç<code>Makefile</code>ÁöÑÂêÑÁßçËßÑÂàôÔºåÂè™‰ºöÁªôÂá∫GoÈ°πÁõÆ‰∏≠Â∏∏Áî®ÁöÑ<code>Makefile</code>Á§∫‰æã„ÄÇÂÖ≥‰∫é<code>Makefile</code>ÁöÑËØ¶ÁªÜÂÜÖÂÆπÊé®ËçêÈòÖËØª<a class="link" href="http://c.biancheng.net/view/7097.html"  target="_blank" rel="noopener"
    >MakefileÊïôÁ®ã</a>„ÄÇ</p>
<h4 id="ËßÑÂàôÊ¶ÇËø∞">ËßÑÂàôÊ¶ÇËø∞</h4>
<p><code>Makefile</code>Áî±Â§öÊù°ËßÑÂàôÁªÑÊàêÔºåÊØèÊù°ËßÑÂàô‰∏ªË¶ÅÁî±‰∏§‰∏™ÈÉ®ÂàÜÁªÑÊàêÔºåÂàÜÂà´ÊòØ‰æùËµñÁöÑÂÖ≥Á≥ªÂíåÊâßË°åÁöÑÂëΩ‰ª§„ÄÇ</p>
<p>ÂÖ∂ÁªìÊûÑÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">[target] ... </span><span class="o">:</span> [<span class="n">prerequisites</span>] ...
</span></span><span class="line"><span class="cl"><span class="err">&lt;tab&gt;[command]</span>
</span></span><span class="line"><span class="cl">    <span class="err">...</span>
</span></span><span class="line"><span class="cl">    <span class="err">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠Ôºö</p>
<ul>
<li>targetsÔºöËßÑÂàôÁöÑÁõÆÊ†á</li>
<li>prerequisitesÔºöÂèØÈÄâÁöÑË¶ÅÁîüÊàê targets ÈúÄË¶ÅÁöÑÊñá‰ª∂ÊàñËÄÖÊòØÁõÆÊ†á„ÄÇ</li>
<li>commandÔºömake ÈúÄË¶ÅÊâßË°åÁöÑÂëΩ‰ª§Ôºà‰ªªÊÑèÁöÑ shell ÂëΩ‰ª§Ôºâ„ÄÇÂèØ‰ª•ÊúâÂ§öÊù°ÂëΩ‰ª§ÔºåÊØè‰∏ÄÊù°ÂëΩ‰ª§Âç†‰∏ÄË°å„ÄÇ</li>
</ul>
<p>‰∏æ‰∏™‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">build</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build -o xx
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Á§∫‰æã">Á§∫‰æã</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">build</span> <span class="n">run</span> <span class="n">gotool</span> <span class="n">clean</span> <span class="n">help</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">BINARY</span><span class="o">=</span><span class="s2">&#34;bluebell&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">all</span><span class="o">:</span> <span class="n">gotool</span> <span class="n">build</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">build</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build -o <span class="si">${</span><span class="nv">BINARY</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">run</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	@go run ./
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gotool</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	go fmt ./
</span></span><span class="line"><span class="cl">	go vet ./
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	@if <span class="o">[</span> -f <span class="si">${</span><span class="nv">BINARY</span><span class="si">}</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span> rm <span class="si">${</span><span class="nv">BINARY</span><span class="si">}</span> <span class="p">;</span> <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">help</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	@echo <span class="s2">&#34;make - Ê†ºÂºèÂåñ Go ‰ª£Á†Å, Âπ∂ÁºñËØëÁîüÊàê‰∫åËøõÂà∂Êñá‰ª∂&#34;</span>
</span></span><span class="line"><span class="cl">	@echo <span class="s2">&#34;make build - ÁºñËØë Go ‰ª£Á†Å, ÁîüÊàê‰∫åËøõÂà∂Êñá‰ª∂&#34;</span>
</span></span><span class="line"><span class="cl">	@echo <span class="s2">&#34;make run - Áõ¥Êé•ËøêË°å Go ‰ª£Á†Å&#34;</span>
</span></span><span class="line"><span class="cl">	@echo <span class="s2">&#34;make clean - ÁßªÈô§‰∫åËøõÂà∂Êñá‰ª∂Âíå vim swap files&#34;</span>
</span></span><span class="line"><span class="cl">	@echo <span class="s2">&#34;make gotool - ËøêË°å Go Â∑•ÂÖ∑ &#39;fmt&#39; and &#39;vet&#39;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠Ôºö</p>
<ul>
<li><code>BINARY=&quot;bluebell&quot;</code>ÊòØÂÆö‰πâÂèòÈáè„ÄÇ</li>
<li><code>.PHONY</code>Áî®Êù•ÂÆö‰πâ‰º™ÁõÆÊ†á„ÄÇ‰∏çÂàõÂª∫ÁõÆÊ†áÊñá‰ª∂ÔºåËÄåÊòØÂéªÊâßË°åËøô‰∏™ÁõÆÊ†á‰∏ãÈù¢ÁöÑÂëΩ‰ª§„ÄÇ</li>
</ul>
<h3 id="airÂ§ßÂ§ßÊèêÈ´òÂºÄÂèëÊïàÁéá">airÔºàÂ§ßÂ§ßÊèêÈ´òÂºÄÂèëÊïàÁéáÔºâ</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220331163525711.png"
	
	
	
	loading="lazy"
	
		alt="image-20220331163525711"
	
	
></p>
<blockquote>
<p>go get -u github.com/cosmtrek/air</p>
</blockquote>
<h3 id="goÂÜÖÂ≠òÂØπÈΩê">GoÂÜÖÂ≠òÂØπÈΩê</h3>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220401125931874.png"
	
	
	
	loading="lazy"
	
		alt="image-20220401125931874"
	
	
></p>
<p>Ëøô‰∏§‰∏™ÁªìÊûÑ‰ΩìËôΩÁÑ∂Â±ûÊÄß‰∏ÄÊ†∑Ôºå‰ΩÜÊòØÊúÄÂêénewÂá∫Êù•‰∏Ä‰∏™ÂØπË±°ÔºåÂç†Áî®ÂÜÖÂ≠òÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºåÂõ†‰∏∫ÂÜÖÂ≠òÂØπÈΩê„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220401125958142.png"
	
	
	
	loading="lazy"
	
		alt="image-20220401125958142"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">s1</span> <span class="kd">struct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i1</span> <span class="kt">int8</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i2</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i3</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">s1</span> <span class="kd">struct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i1</span> <span class="kt">int8</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i3</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i2</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220401131455933.png"
	
	
	
	loading="lazy"
	
		alt="image-20220401131455933"
	
	
></p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220401131448737.png"
	
	
	
	loading="lazy"
	
		alt="image-20220401131448737"
	
	
></p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220401131443154.png"
	
	
	
	loading="lazy"
	
		alt="image-20220401131443154"
	
	
></p>
<h3 id="ÂØπÊü•ËØ¢ÁªìÊûúÁöÑ‰ºòÂåñ">ÂØπÊü•ËØ¢ÁªìÊûúÁöÑ‰ºòÂåñ</h3>
<p>ÂΩìÊàëÁ¨¨‰∏ÄÊ¨°ÁºñÂÜôÊé•Âè£ÔºåÂèëÁé∞Êúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂΩìÊàëËøîÂõûÂ∏ñÂ≠êÁöÑÁªÜËäÇÁöÑÊó∂ÂÄôÔºåÁî±‰∫éÊï∞ÊçÆÂ∫ìÂèäÈááÁî®ÁöÑÂ§ñÈîÆÂÖ≥ËÅîÔºåÊâÄ‰ª•ËøîÂõûÁöÑÊï∞ÊçÆÂπ∂‰∏çÊòØ‰ΩúËÄÖÂêçÂ≠óÔºåËÄåÊòØ‰ΩúËÄÖIDÔºåËøôÊ†∑ÈùûÂ∏∏‰∏çÂèãÂ•ΩÔºåÊàëÊÉ≥ÊääÂÖ≥ËÅî‰ø°ÊÅØ‰πü‰∏ÄÂπ∂ËøîÂõû„ÄÇ</p>
<blockquote>
<p>ÈÅáÂà∞ÁöÑÈóÆÈ¢òÔºöËøîÂõûÊï¥‰∏™ÁªìÊûúÁöÑÊó∂ÂÄôÂèëÁîüÁ©∫ÊåáÈíà„ÄÇ„ÄÇÔºàÁ≤óÂøÉ‰∫ÜÔºâ</p>
</blockquote>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402094735937.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402094735937"
	
	
></p>
<p>ÂèØ‰ª•ÁúãÂà∞pÊòØÊ≤°ÊúâÂàùÂßãÂåñÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨new‰∏Ä‰∏ãÂ∞±Â•Ω‰∫Ü„ÄÇÊü•Âá∫Êù•Â∞±Ê≤°Âï•ÊØõÁóÖ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402094840987.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402094840987"
	
	
></p>
<p>ËøôÈáå‰ºöÂèëÁé∞ÔºåÊï∞ÊçÆÂÖ∂ÂÆûÊúâÁÇπÊå§Âú®‰∏ÄËµ∑ÔºåÁúãÁùÄ‰∏çËàíÊúçÔºåÊàë‰ª¨ÊÉ≥ÊääÁ§æÂå∫ÁöÑÊîæ‰∏ÄËæπÔºå‰ΩúËÄÖÊîæ‰∏ÄËæπÔºåÊÄé‰πàÂäûÂë¢Ôºü</p>
<p>‚Äã	<img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402095058100.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402095058100"
	
	
></p>
<p>ÊîπÈÄ†‰∏Ä‰∏ã</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402095138946.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402095138946"
	
	
></p>
<p>ËàíÊúçÂ§ö‰∫Ü</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402095158535.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402095158535"
	
	
></p>
<h3 id="ÂàÜÈ°µÊü•ËØ¢">ÂàÜÈ°µÊü•ËØ¢</h3>
<p>‰ªéÂâçÁ´ØÂêéÁöÑÈ°µÁ†ÅÂíåsizeÂç≥ÂèØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">func GetPostList(offset int64, size int64) (list []*model.Post, err error) {
</span></span><span class="line"><span class="cl">   list = make([]*model.Post, 0, size)
</span></span><span class="line"><span class="cl">   sqlStr := &#34;select post_id,author_id,community_id,title,content,create_time from post limit ?,?&#34;
</span></span><span class="line"><span class="cl">   err = db.Select(&amp;list, sqlStr, offset, size)
</span></span><span class="line"><span class="cl">   return list, err
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêéÁ´ØÁî®selectÊü•ËØ¢Êï∞ÊçÆÂ∫ìÂ∞ÅË£ÖÂà∞ÂàáÁâáÈáåÈù¢ËøîÂõûÂ∞±Â•Ω‰∫Ü„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402110559448.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402110559448"
	
	
></p>
<p>ÂÖ∂ÂÆûÊàë‰ª¨ÂèØËÉΩ‰ºöÊúâÂæàÂ§öÈúÄË¶ÅÂàÜÈ°µÁöÑÈ°πÁõÆÔºåÊâÄ‰ª•Êàë‰ª¨‰∏∫‰∫ÜÈÅøÂÖçÈáçÂ§ç‰π¶ÂÜô‰ª£Á†ÅÔºåÂèØ‰ª•Â∞ÜËé∑ÂæóÈ°µÁ†ÅÁöÑ‰ª£Á†ÅÁªôÊäΩÂá∫Êù•„ÄÇÊîæÂà∞Request.go‰∏≠</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402110800218.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402110800218"
	
	
></p>
<h3 id="Ëß£ÂÜ≥idÂèëÈÄÅÁªôÂâçÁ´ØÂ§±ÁúüÁöÑÈóÆÈ¢ò">Ëß£ÂÜ≥idÂèëÈÄÅÁªôÂâçÁ´ØÂ§±ÁúüÁöÑÈóÆÈ¢ò</h3>
<p>Áî±‰∫égoÂêéÁ´ØËøôËæπÁöÑidÁî®ÁöÑ‰∏∫int64Á±ªÂûãÔºåÊï∞ÊçÆÂ§ßÂ∞èÂú®2^-63 + 1~2^63 - 1,‰ΩÜÊòØJSÁöÑNumberÊï∞ÊçÆÁ±ªÂûãÁöÑÊï∞ÊçÆÂ§ßÂ∞è‰ºöÂú®2^-53 + 1~2^53 - 1.‰ºöÂØºËá¥Êï∞ÊçÆÁ≤æÂ∫¶ÊúâÈóÆÈ¢ò„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•Â∞ÜËøô‰∏™ÂÄºÂèòÊàêstringÁ±ªÂûã‰º†ËæìÂç≥ÂèØ„ÄÇ</p>
<p>‰ΩÜÊòØÁî±‰∫éÂâçÁ´Ø‰ºö‰º†ÁªôÊàë‰ª¨ÂêéÁ´Ø‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÔºåÂ¶ÇÊûúÁªìÊûÑ‰Ωì‰ªçÁÑ∂Áî®‰ª•ÂâçÁöÑÁªìÊûÑ‰ΩìÔºåÂ¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Community</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span>   <span class="kt">int64</span>  <span class="s">`json:&#34;community_id&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;community_name&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊòØÊó†Ê≥ïË∞ÉÁî®UnmarshalÁöÑÔºåÂõ†‰∏∫ÂâçÁ´ØÂèëÁöÑÊòØstringÔºågoËøôËæπÁî®ÁöÑint64ÔºåÊàë‰ª¨Á®çÂæÆ‰øÆÊîπ‰∏Ä‰∏ãÂ∞±ÂèØ‰ª•‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Community</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span>   <span class="kt">int64</span>  <span class="s">`json:&#34;community_id,string&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;community_name&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êõ¥Â§ögolang jsonÁöÑÁî®Ê≥ïÔºöhttps://www.liwenzhou.com/posts/Go/json_tricks_in_go/</p>
<h3 id="ÊäïÁ•®ÂäüËÉΩ">ÊäïÁ•®ÂäüËÉΩ</h3>
<p>Êàë‰ª¨Âú®ÂÜôÊäïÁ•®ÂäüËÉΩ‰πãÂâçÔºåÈ¶ñÂÖàÊòéÁ°ÆÊàë‰ª¨ÊÉ≥ÂÆûÁé∞‰ªÄ‰πàÂäüËÉΩÔºåÈ¶ñÂÖàÂæóËÆ∞ÂΩïÊØè‰∏™Áî®Êà∑ÊäïÁöÑÊòØËµûÊàêÁ•®ËøòÊòØÂèçÂØπÁ•®ÔºåÂÖ∂Ê¨°Êàë‰ª¨ÊÉ≥ÂÆûÁé∞‰∏Ä‰∏™ÂÖ≥‰∫éÊó∂Èó¥ÂíåÔºåÁÉ≠Â∫¶ÁöÑÊéíË°åÊ¶ú„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•Âà©Áî®redis‰∏≠ÁöÑZsetÊù•ÂÆûÁé∞ÔºåÂØπ‰∫éËÆ∞ÂΩïÁî®Êà∑Êàë‰ª¨ÂèØ‰ª•‰∏∫ÊØè‰∏Ä‰∏™Â∏ñÂ≠êÂÅö‰∏Ä‰∏™zsetÔºåkeyÊòØÊüê‰∏Ä‰∏™key+Â∏ñÂ≠êIDÔºåÈáåÈù¢Â≠òÂÇ®ÁöÑÊòØuserIdÂØπÂ∫îÊòØÂê¶ÊäïÁ•®Ôºà-1ÔºöÊäïÂèçÂØπÔºå1ÊäïËµûÊàêÔºâ</p>
<p>ÂØπ‰∫éÊéíË°åÊ¶úÂ∞±ÂæàÁÆÄÂçïÔºåÁõ¥Êé•ÂØπÂ∫îÁöÑÂ∏ñÂ≠êÁªô‰∏äÂìçÂ∫îÁöÑÊùÉÂÄºÂç≥ÂèØ„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402201701950.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402201701950"
	
	
></p>
<p>Êàë‰ª¨Â¶Ç‰ΩïËÆ°ÁÆóÁÉ≠Â∫¶Âë¢ÔºåÊàë‰ª¨ËøôÈáåÊØîËæÉÁÆÄÂçïÔºåËµûÊàêÁ•®Â∞±+432ÔºåÂèçÂØπÂ∞±-432„ÄÇ</p>
<p>Â∞ÜÂèØËÉΩÂèëÁîüÁöÑÊÉÖÂÜµÁ©∑‰∏æÂá∫Êù•Ôºö</p>
<blockquote>
<p>db:1  request:1     0                    abs = 0</p>
<p>db:1  request:0     -432               abs = 1</p>
<p>db:1   request:-1   -432 * 2         abs = 2</p>
<p>db:0  request:1      432                abs = 1</p>
<p>db:0  request:0      0                     abs = 0</p>
<p>db:0  request:-1     -432               abs = 1</p>
<p>db:-1  request:1     + 432* 2        abs = 2</p>
<p>db:-1   request:-1   0                    abs = 0</p>
<p>db:-1  request:0     + 432             abs = 0</p>
</blockquote>
<p>Êàë‰ª¨ÂèØ‰ª•ÈÄöËøáabsÊù•Âà§Êñ≠ÂΩìÂâçÂ∫îËØ•ÊîπÂèòÂ§öÂ∞ëÁßØÂàÜ</p>
<p>ÂèØ‰ª•ÁúãÂà∞ÂΩìabs=0ÁßØÂàÜ‰∏çÂèòÔºåabs=1ÁßØÂàÜÂèòÂåñ432(+ÊàñËÄÖ-)ÔºåÂΩìabs=2ÁßØÂàÜÂèòÂåñ2*432Ôºà+ÊàñËÄÖ-Ôºâ</p>
<p>ÂèàÂèØ‰ª•ÂèëÁé∞ÂΩìrequest &gt; 0 Â∞±ÊòØ+ÔºåÂê¶Âàô‰∏∫-</p>
<p>Áé∞Âú®ÈÄªËæëÂ∞±ÂæàÊ∏ÖÊô∞„ÄÇ</p>
<p>ÈÇ£‰πàÈóÆÈ¢òÊù•‰∫ÜÔºå‰∏ÄÂºÄÂßãÊàë‰ª¨Â•ΩÂÉèÂπ∂Ê≤°ÊúâÊéíË°åÊ¶úÊâÄÈúÄÁöÑÈÇ£‰∏§‰∏™zsetÔºåÊàë‰ª¨ÈúÄË¶ÅÂàõÂª∫zset</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402221055324.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402221055324"
	
	
></p>
<p>ÈÇ£ÂÜçÁúãÔºåÂÖ∂ÂÆûËøôÂ∫îËØ•ÊòØ‰∏Ä‰∏™ÂéüÂ≠êÊÄßÁöÑÊìç‰ΩúÔºå‰∏çËÉΩ‰∏Ä‰∏™ÊàêÂäü‰∏Ä‰∏™Â§±Ë¥•ÔºåÊâÄ‰ª•Â∫îËØ•ÊîæÂà∞‰∫ãÂä°ÈáåÈù¢Ôºå‰∏äÈù¢ÊõæËÆ≤Ëøá‰∫ãÂä°pipelineÔºåÂ§™ÂÆåÁæé‰∫Ü„ÄÇ</p>
<p><img src="/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220402221226392.png"
	
	
	
	loading="lazy"
	
		alt="image-20220402221226392"
	
	
></p>
<p>‰ºöÁúãÂà∞daoÂ±ÇÁöÑÊäïÁ•®ÂäüËÉΩÔºåÈáåÈù¢‰ºöÂØπÁî®Êà∑ÊäïÁ•®ËÆ∞ÂΩïÂíåÂàÜÊï∞ËÆ∞ÂΩïÔºåËøô‰∏§‰∏™‰πüÊòØÂ∫îËØ•ÊòØÂéüÂ≠êÊÄßÁöÑ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">VoteForPost</span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">postId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">flag</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">score</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">ZScore</span><span class="p">(</span><span class="nf">getKey</span><span class="p">(</span><span class="nx">TimeZSet</span><span class="p">),</span> <span class="nx">postId</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">())</span><span class="o">-</span><span class="nx">score</span> <span class="p">&gt;</span> <span class="nx">weekUnix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">ErrorTimeExpire</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//ÂæóÂà∞ËØ•Áî®Êà∑Âú®redis‰∏≠ÊòØÂê¶ÊäïÁ•®Ëøá
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="nx">score</span> <span class="p">=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">ZScore</span><span class="p">(</span><span class="nf">getKey</span><span class="p">(</span><span class="nx">FlagZSet</span><span class="o">+</span><span class="nx">postId</span><span class="p">),</span> <span class="nx">userId</span><span class="p">).</span><span class="nf">Val</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="nx">dif</span> <span class="o">:=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="nx">score</span> <span class="o">-</span> <span class="nx">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nx">pipeline</span> <span class="o">:=</span> <span class="nx">rdb</span><span class="p">.</span><span class="nf">TxPipeline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">score</span> <span class="p">&lt;</span> <span class="nx">flag</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pipeline</span><span class="p">.</span><span class="nf">IncrBy</span><span class="p">(</span><span class="nf">getKey</span><span class="p">(</span><span class="nx">ScoreZSet</span><span class="p">),</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">dif</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="nx">perFlagScore</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pipeline</span><span class="p">.</span><span class="nf">IncrBy</span><span class="p">(</span><span class="nf">getKey</span><span class="p">(</span><span class="nx">ScoreZSet</span><span class="p">),</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">dif</span><span class="o">*-</span><span class="mi">1</span><span class="o">*</span><span class="nx">perFlagScore</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//Êõ¥Êñ∞ËÆ∞ÂΩïÁî®Êà∑ÊäïÁ•®ÁöÑzset
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">if</span> <span class="nx">flag</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pipeline</span><span class="p">.</span><span class="nf">ZRem</span><span class="p">(</span><span class="nf">getKey</span><span class="p">(</span><span class="nx">FlagZSet</span><span class="o">+</span><span class="nx">postId</span><span class="p">),</span> <span class="nx">userId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pipeline</span><span class="p">.</span><span class="nf">ZAdd</span><span class="p">(</span><span class="nf">getKey</span><span class="p">(</span><span class="nx">FlagZSet</span><span class="o">+</span><span class="nx">postId</span><span class="p">),</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nx">Score</span><span class="p">:</span>  <span class="nx">flag</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nx">Member</span><span class="p">:</span> <span class="nx">userId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">pipeline</span><span class="p">.</span><span class="nf">Exec</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="swaggerÊé•Âè£ÊñáÊ°£">swaggerÊé•Âè£ÊñáÊ°£</h2>
<blockquote>
<p>Â¶Ç‰ΩïÂæóÂà∞Ôºö</p>
<p>go get -u github.com/swaggo/swag/cmd/swag</p>
</blockquote>
<p>ÊÉ≥Ë¶Å‰ΩøÁî®<code>gin-swagger</code>‰∏∫‰Ω†ÁöÑ‰ª£Á†ÅËá™Âä®ÁîüÊàêÊé•Âè£ÊñáÊ°£Ôºå‰∏ÄËà¨ÈúÄË¶Å‰∏ãÈù¢‰∏â‰∏™Ê≠•È™§Ôºö</p>
<ol>
<li>ÊåâÁÖßswaggerË¶ÅÊ±ÇÁªôÊé•Âè£‰ª£Á†ÅÊ∑ªÂä†Â£∞ÊòéÂºèÊ≥®ÈáäÔºåÂÖ∑‰ΩìÂèÇÁÖß<a class="link" href="https://swaggo.github.io/swaggo.io/declarative_comments_format/"  target="_blank" rel="noopener"
    >Â£∞ÊòéÂºèÊ≥®ÈáäÊ†ºÂºè</a>„ÄÇ</li>
<li>‰ΩøÁî®swagÂ∑•ÂÖ∑Êâ´Êèè‰ª£Á†ÅËá™Âä®ÁîüÊàêAPIÊé•Âè£ÊñáÊ°£Êï∞ÊçÆ</li>
<li>‰ΩøÁî®gin-swaggerÊ∏≤ÊüìÂú®Á∫øÊé•Âè£ÊñáÊ°£È°µÈù¢</li>
</ol>
<h3 id="Á¨¨‰∏ÄÊ≠•Ê∑ªÂä†Ê≥®Èáä">Á¨¨‰∏ÄÊ≠•ÔºöÊ∑ªÂä†Ê≥®Èáä</h3>
<p>Âú®Á®ãÂ∫èÂÖ•Âè£mainÂáΩÊï∞‰∏ä‰ª•Ê≥®ÈáäÁöÑÊñπÂºèÂÜô‰∏ãÈ°πÁõÆÁõ∏ÂÖ≥‰ªãÁªç‰ø°ÊÅØ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// @title ËøôÈáåÂÜôÊ†áÈ¢ò
</span></span></span><span class="line"><span class="cl"><span class="c1">// @version 1.0
</span></span></span><span class="line"><span class="cl"><span class="c1">// @description ËøôÈáåÂÜôÊèèËø∞‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1">// @termsOfService http://swagger.io/terms/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// @contact.name ËøôÈáåÂÜôËÅîÁ≥ª‰∫∫‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1">// @contact.url http://www.swagger.io/support
</span></span></span><span class="line"><span class="cl"><span class="c1">// @contact.email support@swagger.io
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// @license.name Apache 2.0
</span></span></span><span class="line"><span class="cl"><span class="c1">// @license.url http://www.apache.org/licenses/LICENSE-2.0.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// @host ËøôÈáåÂÜôÊé•Âè£ÊúçÂä°ÁöÑhost
</span></span></span><span class="line"><span class="cl"><span class="c1">// @BasePath ËøôÈáåÂÜôbase path
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// liwenzhou.com ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®‰Ω†‰ª£Á†Å‰∏≠Â§ÑÁêÜËØ∑Ê±ÇÁöÑÊé•Âè£ÂáΩÊï∞ÔºàÈÄöÂ∏∏‰Ωç‰∫écontrollerÂ±ÇÔºâÊåâÂ¶Ç‰∏ãÊñπÂºèÂÜô‰∏äÊ≥®ÈáäÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// GetPostListHandler2 ÂçáÁ∫ßÁâàÂ∏ñÂ≠êÂàóË°®Êé•Âè£
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Summary ÂçáÁ∫ßÁâàÂ∏ñÂ≠êÂàóË°®Êé•Âè£
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Description ÂèØÊåâÁ§æÂå∫ÊåâÊó∂Èó¥ÊàñÂàÜÊï∞ÊéíÂ∫èÊü•ËØ¢Â∏ñÂ≠êÂàóË°®Êé•Âè£
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Tags Â∏ñÂ≠êÁõ∏ÂÖ≥Êé•Âè£
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Accept application/json
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Produce application/json
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Param Authorization header string false &#34;Bearer Áî®Êà∑‰ª§Áâå&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Param object query models.ParamPostList false &#34;Êü•ËØ¢ÂèÇÊï∞&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Security ApiKeyAuth
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Success 200 {object} _ResponsePostList
</span></span></span><span class="line"><span class="cl"><span class="c1">// @Router /posts2 [get]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GetPostListHandler2</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// GETËØ∑Ê±ÇÂèÇÊï∞(query string)Ôºö/api/v1/posts2?page=1&amp;size=10&amp;order=time
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ÂàùÂßãÂåñÁªìÊûÑ‰ΩìÊó∂ÊåáÂÆöÂàùÂßãÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">ParamPostList</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Page</span><span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Size</span><span class="p">:</span>  <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Order</span><span class="p">:</span> <span class="nx">models</span><span class="p">.</span><span class="nx">OrderTime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">ShouldBindQuery</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;GetPostListHandler2 with invalid params&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">CodeInvalidParam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">logic</span><span class="p">.</span><span class="nf">GetPostListNew</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Ëé∑ÂèñÊï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;logic.GetPostList() failed&#34;</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nf">ResponseError</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">CodeServerBusy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">ResponseSuccess</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ËøîÂõûÂìçÂ∫î
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢Ê≥®Èáä‰∏≠ÂèÇÊï∞Á±ªÂûã‰ΩøÁî®‰∫Ü<code>object</code>Ôºå<code>models.ParamPostList</code>ÂÖ∑‰ΩìÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// bluebell/models/params.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ParamPostList Ëé∑ÂèñÂ∏ñÂ≠êÂàóË°®query stringÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ParamPostList</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CommunityID</span> <span class="kt">int64</span>  <span class="s">`json:&#34;community_id&#34; form:&#34;community_id&#34;`</span>   <span class="c1">// ÂèØ‰ª•‰∏∫Á©∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Page</span>        <span class="kt">int64</span>  <span class="s">`json:&#34;page&#34; form:&#34;page&#34; example:&#34;1&#34;`</span>       <span class="c1">// È°µÁ†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Size</span>        <span class="kt">int64</span>  <span class="s">`json:&#34;size&#34; form:&#34;size&#34; example:&#34;10&#34;`</span>      <span class="c1">// ÊØèÈ°µÊï∞ÊçÆÈáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Order</span>       <span class="kt">string</span> <span class="s">`json:&#34;order&#34; form:&#34;order&#34; example:&#34;score&#34;`</span> <span class="c1">// ÊéíÂ∫è‰æùÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂìçÂ∫îÊï∞ÊçÆÁ±ªÂûã‰πü‰ΩøÁî®ÁöÑ<code>object</code>ÔºåÊàë‰∏™‰∫∫‰π†ÊÉØÂú®controllerÂ±Ç‰∏ìÈó®ÂÆö‰πâ‰∏Ä‰∏™<code>docs_models.go</code>Êñá‰ª∂Êù•Â≠òÂÇ®ÊñáÊ°£‰∏≠‰ΩøÁî®ÁöÑÂìçÂ∫îÊï∞ÊçÆmodel„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// bluebell/controller/docs_models.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// _ResponsePostList Â∏ñÂ≠êÂàóË°®Êé•Âè£ÂìçÂ∫îÊï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">_ResponsePostList</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Code</span>    <span class="nx">ResCode</span>                 <span class="s">`json:&#34;code&#34;`</span>    <span class="c1">// ‰∏öÂä°ÂìçÂ∫îÁä∂ÊÄÅÁ†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Message</span> <span class="kt">string</span>                  <span class="s">`json:&#34;message&#34;`</span> <span class="c1">// ÊèêÁ§∫‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Data</span>    <span class="p">[]</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">ApiPostDetail</span> <span class="s">`json:&#34;data&#34;`</span>    <span class="c1">// Êï∞ÊçÆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Á¨¨‰∫åÊ≠•ÁîüÊàêÊé•Âè£ÊñáÊ°£Êï∞ÊçÆ">Á¨¨‰∫åÊ≠•ÔºöÁîüÊàêÊé•Âè£ÊñáÊ°£Êï∞ÊçÆ</h3>
<p>ÁºñÂÜôÂÆåÊ≥®ÈáäÂêéÔºå‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§ÂÆâË£ÖswagÂ∑•ÂÖ∑Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u github.com/swaggo/swag/cmd/swag
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®È°πÁõÆÊ†πÁõÆÂΩïÊâßË°å‰ª•‰∏ãÂëΩ‰ª§Ôºå‰ΩøÁî®swagÂ∑•ÂÖ∑ÁîüÊàêÊé•Âè£ÊñáÊ°£Êï∞ÊçÆ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">swag init
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°åÂÆå‰∏äËø∞ÂëΩ‰ª§ÂêéÔºåÂ¶ÇÊûú‰Ω†ÂÜôÁöÑÊ≥®ÈáäÊ†ºÂºèÊ≤°ÈóÆÈ¢òÔºåÊ≠§Êó∂‰Ω†ÁöÑÈ°πÁõÆÊ†πÁõÆÂΩï‰∏ã‰ºöÂ§öÂá∫‰∏Ä‰∏™<code>docs</code>Êñá‰ª∂Â§π„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./docs
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ docs.go
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ swagger.json
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ swagger.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Á¨¨‰∏âÊ≠•ÂºïÂÖ•gin-swaggerÊ∏≤ÊüìÊñáÊ°£Êï∞ÊçÆ">Á¨¨‰∏âÊ≠•ÔºöÂºïÂÖ•gin-swaggerÊ∏≤ÊüìÊñáÊ°£Êï∞ÊçÆ</h3>
<p>ÁÑ∂ÂêéÂú®È°πÁõÆ‰ª£Á†Å‰∏≠Ê≥®ÂÜåË∑ØÁî±ÁöÑÂú∞ÊñπÊåâÂ¶Ç‰∏ãÊñπÂºèÂºïÂÖ•<code>gin-swagger</code>Áõ∏ÂÖ≥ÂÜÖÂÆπÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// liwenzhou.com ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="s">&#34;bluebell/docs&#34;</span>  <span class="c1">// ÂçÉ‰∏á‰∏çË¶ÅÂøò‰∫ÜÂØºÂÖ•Êää‰Ω†‰∏ä‰∏ÄÊ≠•ÁîüÊàêÁöÑdocs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">gs</span> <span class="s">&#34;github.com/swaggo/gin-swagger&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/swaggo/gin-swagger/swaggerFiles&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÂÜåswagger apiÁõ∏ÂÖ≥Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/swagger/*any&#34;</span><span class="p">,</span> <span class="nx">gs</span><span class="p">.</span><span class="nf">WrapHandler</span><span class="p">(</span><span class="nx">swaggerFiles</span><span class="p">.</span><span class="nx">Handler</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êää‰Ω†ÁöÑÈ°πÁõÆÁ®ãÂ∫èËøêË°åËµ∑Êù•ÔºåÊâìÂºÄÊµèËßàÂô®ËÆøÈóÆhttp://localhost:8080/swagger/index.htmlÂ∞±ËÉΩÁúãÂà∞Swagger 2.0 ApiÊñáÊ°£‰∫Ü„ÄÇ</p>
<p><img src="https://www.liwenzhou.com/images/Go/gin_swagger/gin_swagger.png"
	
	
	
	loading="lazy"
	
		alt="gin_swaggerÊñáÊ°£"
	
	
></p>
<p><code>gin-swagger</code>ÂêåÊó∂ËøòÊèê‰æõ‰∫Ü<code>DisablingWrapHandler</code>ÂáΩÊï∞ÔºåÊñπ‰æøÊàë‰ª¨ÈÄöËøáËÆæÁΩÆÊüê‰∫õÁéØÂ¢ÉÂèòÈáèÊù•Á¶ÅÁî®Swagger„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/swagger/*any&#34;</span><span class="p">,</span> <span class="nx">gs</span><span class="p">.</span><span class="nf">DisablingWrapHandler</span><span class="p">(</span><span class="nx">swaggerFiles</span><span class="p">.</span><span class="nx">Handler</span><span class="p">,</span> <span class="s">&#34;NAME_OF_ENV_VARIABLE&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Êó∂Â¶ÇÊûúÂ∞ÜÁéØÂ¢ÉÂèòÈáè<code>NAME_OF_ENV_VARIABLE</code>ËÆæÁΩÆ‰∏∫‰ªªÊÑèÂÄºÔºåÂàô<code>/swagger/*any</code>Â∞ÜËøîÂõû404ÂìçÂ∫îÔºåÂ∞±ÂÉèÊú™ÊåáÂÆöË∑ØÁî±Êó∂‰∏ÄÊ†∑„ÄÇ</p>
<p>ËøôÊòØGoËØ≠Ë®ÄÂçïÂÖÉÊµãËØï‰ªéÈõ∂Âà∞Ê∫úÁ≥ªÂàóÊïôÁ®ãÁöÑÁ¨¨0ÁØáÔºå‰∏ªË¶ÅËÆ≤Ëß£Âú®GoËØ≠Ë®Ä‰∏≠Â¶Ç‰ΩïÁºñÂÜôÂçïÂÖÉÊµãËØï‰ª•Âèä‰ªãÁªç‰∫ÜË°®Ê†ºÈ©±Âä®ÊµãËØï„ÄÅÂõûÂΩíÊµãËØïÂíåÂçïÂÖÉÊµãËØï‰∏≠Â∏∏Áî®ÁöÑÊñ≠Ë®ÄÂ∑•ÂÖ∑„ÄÇ</p>
<p>GoËØ≠Ë®ÄÂçïÂÖÉÊµãËØï‰ªéÈõ∂Âà∞Ê∫úÁ≥ªÂàóÂÖ±7ÁØáÔºåÊú¨ÊñáÊòØÁ¨¨0ÁØáÔºå‰ªãÁªç‰∫ÜGoËØ≠Ë®ÄÂçïÂÖÉÊµãËØïÁöÑÂü∫Á°ÄÂÜÖÂÆπ„ÄÇÊú¨ÁØáÈÉ®ÂàÜÂÜÖÂÆπÂü∫‰∫éÊàë‰πãÂâçÂÜôËøáÁöÑÈÇ£ÁØá<a class="link" href="https://www.liwenzhou.com/posts/Go/unit-test/"  target="_blank" rel="noopener"
    >„ÄäGoËØ≠Ë®ÄÂü∫Á°Ä‰πãÂçïÂÖÉÊµãËØï„Äã</a>ÔºåÂÜÖÂÆπÁï•ÊúâÂà†Êîπ„ÄÇÁâπÂà´ÊòØÁî±‰∫éÁØáÂπÖÈôêÂà∂ÁßªÈô§‰∫ÜÂü∫ÂáÜÊµãËØïÁõ∏ÂÖ≥ÂÜÖÂÆπÔºåÊÉ≥‰∫ÜËß£Âü∫ÂáÜÊµãËØï/ÊÄßËÉΩÊµãËØïÁöÑÂêåÂ≠¶ÂèØ‰ª•ÁÇπÂáª‰∏äÊñáÈìæÊé•Êü•Áúã„ÄÇ</p>
<blockquote>
<p>„ÄäGoÂçïÊµã‰ªéÈõ∂Âà∞Ê∫úÁ≥ªÂàó„ÄãÁöÑÁ§∫‰æã‰ª£Á†ÅÂ∑≤‰∏ä‰º†Ëá≥GithubÔºåÁÇπÂáªüëâüèªhttps://github.com/Q1mi/golang-unit-test-demo Êü•ÁúãÂÆåÊï¥Ê∫ê‰ª£Á†Å„ÄÇ</p>
</blockquote>
<h2 id="goËØ≠Ë®ÄÂçïÂÖÉÊµãËØï">GoËØ≠Ë®ÄÂçïÂÖÉÊµãËØï</h2>
<h3 id="go-testÂ∑•ÂÖ∑">go testÂ∑•ÂÖ∑</h3>
<p>GoËØ≠Ë®Ä‰∏≠ÁöÑÊµãËØï‰æùËµñ<code>go test</code>ÂëΩ‰ª§„ÄÇÁºñÂÜôÊµãËØï‰ª£Á†ÅÂíåÁºñÂÜôÊôÆÈÄöÁöÑGo‰ª£Á†ÅËøáÁ®ãÊòØÁ±ª‰ººÁöÑÔºåÂπ∂‰∏çÈúÄË¶ÅÂ≠¶‰π†Êñ∞ÁöÑËØ≠Ê≥ï„ÄÅËßÑÂàôÊàñÂ∑•ÂÖ∑„ÄÇ</p>
<p>go testÂëΩ‰ª§ÊòØ‰∏Ä‰∏™ÊåâÁÖß‰∏ÄÂÆöÁ∫¶ÂÆöÂíåÁªÑÁªáÁöÑÊµãËØï‰ª£Á†ÅÁöÑÈ©±Âä®Á®ãÂ∫è„ÄÇÂú®ÂåÖÁõÆÂΩïÂÜÖÔºåÊâÄÊúâ‰ª•<code>_test.go</code>‰∏∫ÂêéÁºÄÂêçÁöÑÊ∫ê‰ª£Á†ÅÊñá‰ª∂ÈÉΩÊòØ<code>go test</code>ÊµãËØïÁöÑ‰∏ÄÈÉ®ÂàÜÔºå‰∏ç‰ºöË¢´<code>go build</code>ÁºñËØëÂà∞ÊúÄÁªàÁöÑÂèØÊâßË°åÊñá‰ª∂‰∏≠„ÄÇ</p>
<p>Âú®<code>*_test.go</code>Êñá‰ª∂‰∏≠Êúâ‰∏âÁßçÁ±ªÂûãÁöÑÂáΩÊï∞ÔºåÂçïÂÖÉÊµãËØïÂáΩÊï∞„ÄÅÂü∫ÂáÜÊµãËØïÂáΩÊï∞ÂíåÁ§∫‰æãÂáΩÊï∞„ÄÇ</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:center">Á±ªÂûã</th>
<th style="text-align:center">Ê†ºÂºè</th>
<th style="text-align:center">‰ΩúÁî®</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ÊµãËØïÂáΩÊï∞</td>
<td style="text-align:center">ÂáΩÊï∞ÂêçÂâçÁºÄ‰∏∫Test</td>
<td style="text-align:center">ÊµãËØïÁ®ãÂ∫èÁöÑ‰∏Ä‰∫õÈÄªËæëË°å‰∏∫ÊòØÂê¶Ê≠£Á°Æ</td>
</tr>
<tr>
<td style="text-align:center">Âü∫ÂáÜÂáΩÊï∞</td>
<td style="text-align:center">ÂáΩÊï∞ÂêçÂâçÁºÄ‰∏∫Benchmark</td>
<td style="text-align:center">ÊµãËØïÂáΩÊï∞ÁöÑÊÄßËÉΩ</td>
</tr>
<tr>
<td style="text-align:center">Á§∫‰æãÂáΩÊï∞</td>
<td style="text-align:center">ÂáΩÊï∞ÂêçÂâçÁºÄ‰∏∫Example</td>
<td style="text-align:center">‰∏∫ÊñáÊ°£Êèê‰æõÁ§∫‰æãÊñáÊ°£</td>
</tr>
</tbody>
</table></div>
<p><code>go test</code>ÂëΩ‰ª§‰ºöÈÅçÂéÜÊâÄÊúâÁöÑ<code>*_test.go</code>Êñá‰ª∂‰∏≠Á¨¶Âêà‰∏äËø∞ÂëΩÂêçËßÑÂàôÁöÑÂáΩÊï∞ÔºåÁÑ∂ÂêéÁîüÊàê‰∏Ä‰∏™‰∏¥Êó∂ÁöÑmainÂåÖÁî®‰∫éË∞ÉÁî®Áõ∏Â∫îÁöÑÊµãËØïÂáΩÊï∞ÔºåÁÑ∂ÂêéÊûÑÂª∫Âπ∂ËøêË°å„ÄÅÊä•ÂëäÊµãËØïÁªìÊûúÔºåÊúÄÂêéÊ∏ÖÁêÜÊµãËØï‰∏≠ÁîüÊàêÁöÑ‰∏¥Êó∂Êñá‰ª∂„ÄÇ</p>
<h3 id="ÂçïÂÖÉÊµãËØïÂáΩÊï∞">ÂçïÂÖÉÊµãËØïÂáΩÊï∞</h3>
<h4 id="Ê†ºÂºè">Ê†ºÂºè</h4>
<p>ÊØè‰∏™ÊµãËØïÂáΩÊï∞ÂøÖÈ°ªÂØºÂÖ•<code>testing</code>ÂåÖÔºåÊµãËØïÂáΩÊï∞ÁöÑÂü∫Êú¨Ê†ºÂºèÔºàÁ≠æÂêçÔºâÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestName</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊµãËØïÂáΩÊï∞ÁöÑÂêçÂ≠óÂøÖÈ°ª‰ª•<code>Test</code>ÂºÄÂ§¥ÔºåÂèØÈÄâÁöÑÂêéÁºÄÂêçÂøÖÈ°ª‰ª•Â§ßÂÜôÂ≠óÊØçÂºÄÂ§¥Ôºå‰∏æÂá†‰∏™‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestAdd</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSum</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestLog</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span> <span class="o">...</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂‰∏≠ÂèÇÊï∞<code>t</code>Áî®‰∫éÊä•ÂëäÊµãËØïÂ§±Ë¥•ÂíåÈôÑÂä†ÁöÑÊó•Âøó‰ø°ÊÅØ„ÄÇ <code>testing.T</code>ÁöÑÊã•ÊúâÁöÑÊñπÊ≥ïÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Cleanup</span><span class="p">(</span><span class="kd">func</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Error</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Errorf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Fail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">FailNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Failed</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Fatal</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Helper</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Log</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Logf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Skip</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">SkipNow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Skipf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">Skipped</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">TempDir</span><span class="p">()</span> <span class="kt">string</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ÂçïÂÖÉÊµãËØïÁ§∫‰æã">ÂçïÂÖÉÊµãËØïÁ§∫‰æã</h4>
<p>Â∞±ÂÉèÁªÜËÉûÊòØÊûÑÊàêÊàë‰ª¨Ë∫´‰ΩìÁöÑÂü∫Êú¨Âçï‰ΩçÔºå‰∏Ä‰∏™ËΩØ‰ª∂Á®ãÂ∫è‰πüÊòØÁî±ÂæàÂ§öÂçïÂÖÉÁªÑ‰ª∂ÊûÑÊàêÁöÑ„ÄÇÂçïÂÖÉÁªÑ‰ª∂ÂèØ‰ª•ÊòØÂáΩÊï∞„ÄÅÁªìÊûÑ‰Ωì„ÄÅÊñπÊ≥ïÂíåÊúÄÁªàÁî®Êà∑ÂèØËÉΩ‰æùËµñÁöÑ‰ªªÊÑè‰∏úË•ø„ÄÇÊÄª‰πãÊàë‰ª¨ÈúÄË¶ÅÁ°Æ‰øùËøô‰∫õÁªÑ‰ª∂ÊòØËÉΩÂ§üÊ≠£Â∏∏ËøêË°åÁöÑ„ÄÇÂçïÂÖÉÊµãËØïÊòØ‰∏Ä‰∫õÂà©Áî®ÂêÑÁßçÊñπÊ≥ïÊµãËØïÂçïÂÖÉÁªÑ‰ª∂ÁöÑÁ®ãÂ∫èÔºåÂÆÉ‰ºöÂ∞ÜÁªìÊûú‰∏éÈ¢ÑÊúüËæìÂá∫ËøõË°åÊØîËæÉ„ÄÇ</p>
<p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨Âú®<code>base_demo</code>ÂåÖ‰∏≠ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™<code>Split</code>ÂáΩÊï∞ÔºåÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// base_demo/split.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">base_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Split ÊääÂ≠óÁ¨¶‰∏≤sÊåâÁÖßÁªôÂÆöÁöÑÂàÜÈöîÁ¨¶sepËøõË°åÂàÜÂâ≤ËøîÂõûÂ≠óÁ¨¶‰∏≤ÂàáÁâá
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">[:</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span> <span class="p">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">i</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ÂΩìÂâçÁõÆÂΩï‰∏ãÔºåÊàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™<code>split_test.go</code>ÁöÑÊµãËØïÊñá‰ª∂ÔºåÂπ∂ÂÆö‰πâ‰∏Ä‰∏™ÊµãËØïÂáΩÊï∞Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// split/split_test.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplit</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ÊµãËØïÂáΩÊï∞ÂêçÂøÖÈ°ª‰ª•TestÂºÄÂ§¥ÔºåÂøÖÈ°ªÊé•Êî∂‰∏Ä‰∏™*testing.TÁ±ªÂûãÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="s">&#34;a:b:c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">)</span>         <span class="c1">// Á®ãÂ∫èËæìÂá∫ÁöÑÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">want</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}</span>    <span class="c1">// ÊúüÊúõÁöÑÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Âõ†‰∏∫slice‰∏çËÉΩÊØîËæÉÁõ¥Êé•ÔºåÂÄüÂä©ÂèçÂ∞ÑÂåÖ‰∏≠ÁöÑÊñπÊ≥ïÊØîËæÉ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%v, got:%v&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span> <span class="c1">// ÊµãËØïÂ§±Ë¥•ËæìÂá∫ÈîôËØØÊèêÁ§∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Êó∂<code>split</code>Ëøô‰∏™ÂåÖ‰∏≠ÁöÑÊñá‰ª∂Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ ls -l
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> liwenzhou  staff  <span class="m">408</span>  <span class="m">4</span> <span class="m">29</span> 15:50 split.go
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> liwenzhou  staff  <span class="m">466</span>  <span class="m">4</span> <span class="m">29</span> 16:04 split_test.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ÂΩìÂâçË∑ØÂæÑ‰∏ãÊâßË°å<code>go test</code>ÂëΩ‰ª§ÔºåÂèØ‰ª•ÁúãÂà∞ËæìÂá∫ÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo       0.005s
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="go-test--v">go test -v</h3>
<p>‰∏Ä‰∏™ÊµãËØïÁî®‰æãÊúâÁÇπÂçïËñÑÔºåÊàë‰ª¨ÂÜçÁºñÂÜô‰∏Ä‰∏™ÊµãËØï‰ΩøÁî®Â§ö‰∏™Â≠óÁ¨¶ÂàáÂâ≤Â≠óÁ¨¶‰∏≤ÁöÑ‰æãÂ≠êÔºåÂú®<code>split_test.go</code>‰∏≠Ê∑ªÂä†Â¶Ç‰∏ãÊµãËØïÂáΩÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplitWithComplexSep</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="s">&#34;bc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">want</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%v, got:%v&#34;</span><span class="p">,</span> <span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áé∞Âú®Êàë‰ª¨ÊúâÂ§ö‰∏™ÊµãËØïÁî®‰æã‰∫ÜÔºå‰∏∫‰∫ÜËÉΩÊõ¥Â•ΩÁöÑÂú®ËæìÂá∫ÁªìÊûú‰∏≠ÁúãÂà∞ÊØè‰∏™ÊµãËØïÁî®‰æãÁöÑÊâßË°åÊÉÖÂÜµÔºåÊàë‰ª¨ÂèØ‰ª•‰∏∫<code>go test</code>ÂëΩ‰ª§Ê∑ªÂä†<code>-v</code>ÂèÇÊï∞ÔºåËÆ©ÂÆÉËæìÂá∫ÂÆåÊï¥ÁöÑÊµãËØïÁªìÊûú„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">    split_test.go:20: expected:<span class="o">[</span>a d<span class="o">]</span>, got:<span class="o">[</span>a cd<span class="o">]</span>
</span></span><span class="line"><span class="cl">--- FAIL: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">FAIL
</span></span><span class="line"><span class="cl"><span class="nb">exit</span> status <span class="m">1</span>
</span></span><span class="line"><span class="cl">FAIL    golang-unit-test-demo/base_demo 0.009s
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏äÈù¢ÁöÑËæìÂá∫ÁªìÊûúÊàë‰ª¨ËÉΩÊ∏ÖÊ•öÁöÑÁúãÂà∞ÊòØ<code>TestSplitWithComplexSep</code>Ëøô‰∏™ÊµãËØïÁî®‰æãÊ≤°ÊúâÊµãËØïÈÄöËøá„ÄÇ</p>
<h3 id="go-test--run">go test -run</h3>
<p>ÂçïÂÖÉÊµãËØïÁöÑÁªìÊûúË°®Êòé<code>split</code>ÂáΩÊï∞ÁöÑÂÆûÁé∞Âπ∂‰∏çÂèØÈù†ÔºåÊ≤°ÊúâËÄÉËôëÂà∞‰º†ÂÖ•ÁöÑsepÂèÇÊï∞ÊòØÂ§ö‰∏™Â≠óÁ¨¶ÁöÑÊÉÖÂÜµÔºå‰∏ãÈù¢Êàë‰ª¨Êù•‰øÆÂ§ç‰∏ãËøô‰∏™BugÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">base_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;strings&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Split ÊääÂ≠óÁ¨¶‰∏≤sÊåâÁÖßÁªôÂÆöÁöÑÂàÜÈöîÁ¨¶sepËøõË°åÂàÜÂâ≤ËøîÂõûÂ≠óÁ¨¶‰∏≤ÂàáÁâá
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="p">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">[:</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span> <span class="p">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="nx">sep</span><span class="p">):]</span> <span class="c1">// ËøôÈáå‰ΩøÁî®len(sep)Ëé∑ÂèñsepÁöÑÈïøÂ∫¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">i</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ÊâßË°å<code>go test</code>ÂëΩ‰ª§ÁöÑÊó∂ÂÄôÂèØ‰ª•Ê∑ªÂä†<code>-run</code>ÂèÇÊï∞ÔºåÂÆÉÂØπÂ∫î‰∏Ä‰∏™Ê≠£ÂàôË°®ËææÂºèÔºåÂè™ÊúâÂáΩÊï∞ÂêçÂåπÈÖç‰∏äÁöÑÊµãËØïÂáΩÊï∞Êâç‰ºöË¢´<code>go test</code>ÂëΩ‰ª§ÊâßË°å„ÄÇ</p>
<p>‰æãÂ¶ÇÈÄöËøáÁªô<code>go test</code>Ê∑ªÂä†<code>-run=Sep</code>ÂèÇÊï∞Êù•ÂëäËØâÂÆÉÊú¨Ê¨°ÊµãËØïÂè™ËøêË°å<code>TestSplitWithComplexSep</code>Ëøô‰∏™ÊµãËØïÁî®‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span> -run<span class="o">=</span>Sep -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.010s
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúÄÁªàÁöÑÊµãËØïÁªìÊûúË°®ÊÉÖÊàë‰ª¨ÊàêÂäü‰øÆÂ§ç‰∫Ü‰πãÂâçÁöÑBug„ÄÇ</p>
<h3 id="ÂõûÂΩíÊµãËØï">ÂõûÂΩíÊµãËØï</h3>
<p>Êàë‰ª¨‰øÆÊîπ‰∫Ü‰ª£Á†Å‰πãÂêé‰ªÖ‰ªÖÊâßË°åÈÇ£‰∫õÂ§±Ë¥•ÁöÑÊµãËØïÁî®‰æãÊàñÊñ∞ÂºïÂÖ•ÁöÑÊµãËØïÁî®‰æãÊòØÈîôËØØ‰∏îÂç±Èô©ÁöÑÔºåÊ≠£Á°ÆÁöÑÂÅöÊ≥ïÂ∫îËØ•ÊòØÂÆåÊï¥ËøêË°åÊâÄÊúâÁöÑÊµãËØïÁî®‰æãÔºå‰øùËØÅ‰∏ç‰ºöÂõ†‰∏∫‰øÆÊîπ‰ª£Á†ÅËÄåÂºïÂÖ•Êñ∞ÁöÑÈóÆÈ¢ò„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.011s
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊµãËØïÁªìÊûúË°®ÊòéÊàë‰ª¨ÁöÑÂçïÂÖÉÊµãËØïÂÖ®ÈÉ®ÈÄöËøá„ÄÇ</p>
<p>ÈÄöËøáËøô‰∏™Á§∫‰æãÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÔºåÊúâ‰∫ÜÂçïÂÖÉÊµãËØïÂ∞±ËÉΩÂ§üÂú®‰ª£Á†ÅÊîπÂä®ÂêéÂø´ÈÄüËøõË°åÂõûÂΩíÊµãËØïÔºåÊûÅÂ§ßÂú∞ÊèêÈ´òÂºÄÂèëÊïàÁéáÂπ∂‰øùËØÅ‰ª£Á†ÅÁöÑË¥®Èáè„ÄÇ</p>
<h3 id="Ë∑≥ËøáÊüê‰∫õÊµãËØïÁî®‰æã">Ë∑≥ËøáÊüê‰∫õÊµãËØïÁî®‰æã</h3>
<p>‰∏∫‰∫ÜËäÇÁúÅÊó∂Èó¥ÊîØÊåÅÂú®ÂçïÂÖÉÊµãËØïÊó∂Ë∑≥ËøáÊüê‰∫õËÄóÊó∂ÁöÑÊµãËØïÁî®‰æã„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestTimeConsuming</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">testing</span><span class="p">.</span><span class="nf">Short</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">t</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="s">&#34;shortÊ®°Âºè‰∏ã‰ºöË∑≥ËøáËØ•ÊµãËØïÁî®‰æã&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩìÊâßË°å<code>go test -short</code>Êó∂Â∞±‰∏ç‰ºöÊâßË°å‰∏äÈù¢ÁöÑ<code>TestTimeConsuming</code>ÊµãËØïÁî®‰æã„ÄÇ</p>
<h3 id="Â≠êÊµãËØï">Â≠êÊµãËØï</h3>
<p>Âú®‰∏äÈù¢ÁöÑÁ§∫‰æã‰∏≠Êàë‰ª¨‰∏∫ÊØè‰∏Ä‰∏™ÊµãËØïÊï∞ÊçÆÁºñÂÜô‰∫Ü‰∏Ä‰∏™ÊµãËØïÂáΩÊï∞ÔºåËÄåÈÄöÂ∏∏ÂçïÂÖÉÊµãËØï‰∏≠ÈúÄË¶ÅÂ§öÁªÑÊµãËØïÊï∞ÊçÆ‰øùËØÅÊµãËØïÁöÑÊïàÊûú„ÄÇGo1.7+‰∏≠Êñ∞Â¢û‰∫ÜÂ≠êÊµãËØïÔºåÊîØÊåÅÂú®ÊµãËØïÂáΩÊï∞‰∏≠‰ΩøÁî®<code>t.Run</code>ÊâßË°å‰∏ÄÁªÑÊµãËØïÁî®‰æãÔºåËøôÊ†∑Â∞±‰∏çÈúÄË¶Å‰∏∫‰∏çÂêåÁöÑÊµãËØïÊï∞ÊçÆÂÆö‰πâÂ§ö‰∏™ÊµãËØïÂáΩÊï∞‰∫Ü„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestXXX</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;case1&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span><span class="o">...</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;case2&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span><span class="o">...</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;case3&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span><span class="o">...</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ë°®Ê†ºÈ©±Âä®ÊµãËØï">Ë°®Ê†ºÈ©±Âä®ÊµãËØï</h3>
<h4 id="‰ªãÁªç">‰ªãÁªç</h4>
<p>Ë°®Ê†ºÈ©±Âä®ÊµãËØï‰∏çÊòØÂ∑•ÂÖ∑„ÄÅÂåÖÊàñÂÖ∂‰ªñ‰ªª‰Ωï‰∏úË•øÔºåÂÆÉÂè™ÊòØÁºñÂÜôÊõ¥Ê∏ÖÊô∞ÊµãËØïÁöÑ‰∏ÄÁßçÊñπÂºèÂíåËßÜËßí„ÄÇ</p>
<p>ÁºñÂÜôÂ•ΩÁöÑÊµãËØïÂπ∂ÈùûÊòì‰∫ãÔºå‰ΩÜÂú®ËÆ∏Â§öÊÉÖÂÜµ‰∏ãÔºåË°®Ê†ºÈ©±Âä®ÊµãËØïÂèØ‰ª•Ê∂µÁõñÂæàÂ§öÊñπÈù¢ÔºöË°®Ê†ºÈáåÁöÑÊØè‰∏Ä‰∏™Êù°ÁõÆÈÉΩÊòØ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑÊµãËØïÁî®‰æãÔºåÂåÖÂê´ËæìÂÖ•ÂíåÈ¢ÑÊúüÁªìÊûúÔºåÊúâÊó∂ËøòÂåÖÂê´ÊµãËØïÂêçÁß∞Á≠âÈôÑÂä†‰ø°ÊÅØÔºå‰ª•‰ΩøÊµãËØïËæìÂá∫Êòì‰∫éÈòÖËØª„ÄÇ</p>
<p>‰ΩøÁî®Ë°®Ê†ºÈ©±Âä®ÊµãËØïËÉΩÂ§üÂæàÊñπ‰æøÁöÑÁª¥Êä§Â§ö‰∏™ÊµãËØïÁî®‰æãÔºåÈÅøÂÖçÂú®ÁºñÂÜôÂçïÂÖÉÊµãËØïÊó∂È¢ëÁπÅÁöÑÂ§çÂà∂Á≤òË¥¥„ÄÇ</p>
<p>Ë°®Ê†ºÈ©±Âä®ÊµãËØïÁöÑÊ≠•È™§ÈÄöÂ∏∏ÊòØÂÆö‰πâ‰∏Ä‰∏™ÊµãËØïÁî®‰æãË°®Ê†ºÔºåÁÑ∂ÂêéÈÅçÂéÜË°®Ê†ºÔºåÂπ∂‰ΩøÁî®<code>t.Run</code>ÂØπÊØè‰∏™Êù°ÁõÆÊâßË°åÂøÖË¶ÅÁöÑÊµãËØï„ÄÇ</p>
<h4 id="Á§∫‰æã-1">Á§∫‰æã</h4>
<p>ÂÆòÊñπÊ†áÂáÜÂ∫ì‰∏≠ÊúâÂæàÂ§öË°®Ê†ºÈ©±Âä®ÊµãËØïÁöÑÁ§∫‰æãÔºå‰æãÂ¶ÇfmtÂåÖ‰∏≠‰æøÊúâÂ¶Ç‰∏ãÊµãËØï‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">flagtests</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">in</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">out</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}{</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%a&#34;</span><span class="p">,</span> <span class="s">&#34;[%a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-a&#34;</span><span class="p">,</span> <span class="s">&#34;[%-a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%+a&#34;</span><span class="p">,</span> <span class="s">&#34;[%+a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%#a&#34;</span><span class="p">,</span> <span class="s">&#34;[%#a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;% a&#34;</span><span class="p">,</span> <span class="s">&#34;[% a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%0a&#34;</span><span class="p">,</span> <span class="s">&#34;[%0a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%-1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%+1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%+1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-+1.2a&#34;</span><span class="p">,</span> <span class="s">&#34;[%+-1.2a]&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-+1.2abc&#34;</span><span class="p">,</span> <span class="s">&#34;[%+-1.2a]bc&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s">&#34;%-1.2abc&#34;</span><span class="p">,</span> <span class="s">&#34;[%-1.2a]bc&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestFlagParser</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">flagprinter</span> <span class="nx">flagPrinter</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">flagtests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">in</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">s</span> <span class="o">:=</span> <span class="nf">Sprintf</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">in</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">flagprinter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">s</span> <span class="o">!=</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">out</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;got %q, want %q&#34;</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöÂ∏∏Ë°®Ê†ºÊòØÂåøÂêçÁªìÊûÑ‰ΩìÂàáÁâáÔºåÂèØ‰ª•ÂÆö‰πâÁªìÊûÑ‰ΩìÊàñ‰ΩøÁî®Â∑≤ÁªèÂ≠òÂú®ÁöÑÁªìÊûÑËøõË°åÁªìÊûÑ‰ΩìÊï∞ÁªÑÂ£∞Êòé„ÄÇnameÂ±ûÊÄßÁî®Êù•ÊèèËø∞ÁâπÂÆöÁöÑÊµãËØïÁî®‰æã„ÄÇ</p>
<p>Êé•‰∏ãÊù•ËÆ©Êàë‰ª¨ËØïÁùÄËá™Â∑±ÁºñÂÜôË°®Ê†ºÈ©±Âä®ÊµãËØïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplitAll</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÂÆö‰πâÊµãËØïË°®Ê†º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ËøôÈáå‰ΩøÁî®ÂåøÂêçÁªìÊûÑ‰ΩìÂÆö‰πâ‰∫ÜËã•Âπ≤‰∏™ÊµãËØïÁî®‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Âπ∂‰∏î‰∏∫ÊØè‰∏™ÊµãËØïÁî®‰æãËÆæÁΩÆ‰∫Ü‰∏Ä‰∏™ÂêçÁß∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">input</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">want</span>  <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;base case&#34;</span><span class="p">,</span> <span class="s">&#34;a:b:c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;wrong sep&#34;</span><span class="p">,</span> <span class="s">&#34;a:b:c&#34;</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a:b:c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;more sep&#34;</span><span class="p">,</span> <span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="s">&#34;bc&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;leading sep&#34;</span><span class="p">,</span> <span class="s">&#34;Ê≤ôÊ≤≥ÊúâÊ≤ôÂèàÊúâÊ≤≥&#34;</span><span class="p">,</span> <span class="s">&#34;Ê≤ô&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;Ê≤≥Êúâ&#34;</span><span class="p">,</span> <span class="s">&#34;ÂèàÊúâÊ≤≥&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÈÅçÂéÜÊµãËØïÁî®‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ‰ΩøÁî®t.Run()ÊâßË°åÂ≠êÊµãËØï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®ÁªàÁ´ØÊâßË°å<code>go test -v</code>Ôºå‰ºöÂæóÂà∞Â¶Ç‰∏ãÊµãËØïËæìÂá∫ÁªìÊûúÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span> -v
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplit
</span></span><span class="line"><span class="cl">--- PASS: TestSplit <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitWithComplexSep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitWithComplexSep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   <span class="nv">TestSplitAll</span>
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/base_case
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/wrong_sep
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/more_sep
</span></span><span class="line"><span class="cl"><span class="o">===</span> RUN   TestSplitAll/leading_sep
</span></span><span class="line"><span class="cl">--- PASS: TestSplitAll <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/base_case <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/wrong_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/more_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">    --- PASS: TestSplitAll/leading_sep <span class="o">(</span>0.00s<span class="o">)</span>
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.010s
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Âπ∂Ë°åÊµãËØï">Âπ∂Ë°åÊµãËØï</h4>
<p>Ë°®Ê†ºÈ©±Âä®ÊµãËØï‰∏≠ÈÄöÂ∏∏‰ºöÂÆö‰πâÊØîËæÉÂ§öÁöÑÊµãËØïÁî®‰æãÔºåËÄåGoËØ≠Ë®ÄÂèàÂ§©ÁîüÊîØÊåÅÂπ∂ÂèëÔºåÊâÄ‰ª•ÂæàÂÆπÊòìÂèëÊå•Ëá™Ë∫´Âπ∂Âèë‰ºòÂäøÂ∞ÜË°®Ê†ºÈ©±Âä®ÊµãËØïÂπ∂Ë°åÂåñ„ÄÇ ÊÉ≥Ë¶ÅÂú®ÂçïÂÖÉÊµãËØïËøáÁ®ã‰∏≠‰ΩøÁî®Âπ∂Ë°åÊµãËØïÔºåÂèØ‰ª•ÂÉè‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÁ§∫‰æã‰∏≠ÈÇ£Ê†∑ÈÄöËøáÊ∑ªÂä†<code>t.Parallel()</code>Êù•ÂÆûÁé∞„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplitAll</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Parallel</span><span class="p">()</span>  <span class="c1">// Â∞Ü TLog Ê†áËÆ∞‰∏∫ËÉΩÂ§ü‰∏éÂÖ∂‰ªñÊµãËØïÂπ∂Ë°åËøêË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ÂÆö‰πâÊµãËØïË°®Ê†º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ËøôÈáå‰ΩøÁî®ÂåøÂêçÁªìÊûÑ‰ΩìÂÆö‰πâ‰∫ÜËã•Âπ≤‰∏™ÊµãËØïÁî®‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Âπ∂‰∏î‰∏∫ÊØè‰∏™ÊµãËØïÁî®‰æãËÆæÁΩÆ‰∫Ü‰∏Ä‰∏™ÂêçÁß∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>  <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">input</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">want</span>  <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;base case&#34;</span><span class="p">,</span> <span class="s">&#34;a:b:c&#34;</span><span class="p">,</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="s">&#34;c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;wrong sep&#34;</span><span class="p">,</span> <span class="s">&#34;a:b:c&#34;</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a:b:c&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;more sep&#34;</span><span class="p">,</span> <span class="s">&#34;abcd&#34;</span><span class="p">,</span> <span class="s">&#34;bc&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span><span class="s">&#34;leading sep&#34;</span><span class="p">,</span> <span class="s">&#34;Ê≤ôÊ≤≥ÊúâÊ≤ôÂèàÊúâÊ≤≥&#34;</span><span class="p">,</span> <span class="s">&#34;Ê≤ô&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;Ê≤≥Êúâ&#34;</span><span class="p">,</span> <span class="s">&#34;ÂèàÊúâÊ≤≥&#34;</span><span class="p">}},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ÈÅçÂéÜÊµãËØïÁî®‰æã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tt</span> <span class="o">:=</span> <span class="nx">tt</span>  <span class="c1">// Ê≥®ÊÑèËøôÈáåÈáçÊñ∞Â£∞ÊòéttÂèòÈáèÔºàÈÅøÂÖçÂ§ö‰∏™goroutine‰∏≠‰ΩøÁî®‰∫ÜÁõ∏ÂêåÁöÑÂèòÈáèÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ‰ΩøÁî®t.Run()ÊâßË°åÂ≠êÊµãËØï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">t</span><span class="p">.</span><span class="nf">Parallel</span><span class="p">()</span>  <span class="c1">// Â∞ÜÊØè‰∏™ÊµãËØïÁî®‰æãÊ†áËÆ∞‰∏∫ËÉΩÂ§üÂΩºÊ≠§Âπ∂Ë°åËøêË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÊ†∑Êàë‰ª¨ÊâßË°å<code>go test -v</code>ÁöÑÊó∂ÂÄôÂ∞±‰ºöÁúãÂà∞ÊØè‰∏™ÊµãËØïÁî®‰æãÂπ∂‰∏çÊòØÊåâÁÖßÊàë‰ª¨ÂÆö‰πâÁöÑÈ°∫Â∫èÊâßË°åÔºåËÄåÊòØ‰∫íÁõ∏Âπ∂Ë°å‰∫Ü„ÄÇ</p>
<h4 id="‰ΩøÁî®Â∑•ÂÖ∑ÁîüÊàêÊµãËØï‰ª£Á†Å">‰ΩøÁî®Â∑•ÂÖ∑ÁîüÊàêÊµãËØï‰ª£Á†Å</h4>
<p>Á§æÂå∫ÈáåÊúâÂæàÂ§öËá™Âä®ÁîüÊàêË°®Ê†ºÈ©±Âä®ÊµãËØïÂáΩÊï∞ÁöÑÂ∑•ÂÖ∑ÔºåÊØîÂ¶Ç<a class="link" href="https://github.com/cweill/gotests"  target="_blank" rel="noopener"
    >gotests</a>Á≠âÔºåÂæàÂ§öÁºñËæëÂô®Â¶ÇGoland‰πüÊîØÊåÅÂø´ÈÄüÁîüÊàêÊµãËØïÊñá‰ª∂„ÄÇËøôÈáåÁÆÄÂçïÊºîÁ§∫‰∏Ä‰∏ã<code>gotests</code>ÁöÑ‰ΩøÁî®„ÄÇ</p>
<p>ÂÆâË£Ö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u github.com/cweill/gotests/...
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gotests -all -w split.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢ÁöÑÂëΩ‰ª§Ë°®Á§∫Ôºå‰∏∫<code>split.go</code>Êñá‰ª∂ÁöÑÊâÄÊúâÂáΩÊï∞ÁîüÊàêÊµãËØï‰ª£Á†ÅËá≥<code>split_test.go</code>Êñá‰ª∂ÔºàÁõÆÂΩï‰∏ãÂ¶ÇÊûú‰∫ãÂÖàÂ≠òÂú®Ëøô‰∏™Êñá‰ª∂Â∞±‰∏çÂÜçÁîüÊàêÔºâ„ÄÇ</p>
<p>ÁîüÊàêÁöÑÊµãËØï‰ª£Á†ÅÂ§ßËá¥Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">base_demo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSplit</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">type</span> <span class="nx">args</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">s</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">sep</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span>       <span class="kt">string</span>
</span></span><span class="line"><span class="cl">		<span class="nx">args</span>       <span class="nx">args</span>
</span></span><span class="line"><span class="cl">		<span class="nx">wantResult</span> <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="p">}{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// TODO: Add test cases.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">gotResult</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">sep</span><span class="p">);</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">gotResult</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">wantResult</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Split() = %v, want %v&#34;</span><span class="p">,</span> <span class="nx">gotResult</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">wantResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ª£Á†ÅÊ†ºÂºè‰∏éÊàë‰ª¨‰∏äÈù¢ÁöÑÁ±ª‰ººÔºåÂè™ÈúÄË¶ÅÂú®TODO‰ΩçÁΩÆÊ∑ªÂä†Êàë‰ª¨ÁöÑÊµãËØïÈÄªËæëÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<h3 id="ÊµãËØïË¶ÜÁõñÁéá">ÊµãËØïË¶ÜÁõñÁéá</h3>
<p>ÊµãËØïË¶ÜÁõñÁéáÊòØÊåá‰ª£Á†ÅË¢´ÊµãËØïÂ•ó‰ª∂Ë¶ÜÁõñÁöÑÁôæÂàÜÊØî„ÄÇÈÄöÂ∏∏Êàë‰ª¨‰ΩøÁî®ÁöÑÈÉΩÊòØËØ≠Âè•ÁöÑË¶ÜÁõñÁéáÔºå‰πüÂ∞±ÊòØÂú®ÊµãËØï‰∏≠Ëá≥Â∞ëË¢´ËøêË°å‰∏ÄÊ¨°ÁöÑ‰ª£Á†ÅÂç†ÊÄª‰ª£Á†ÅÁöÑÊØî‰æã„ÄÇÂú®ÂÖ¨Âè∏ÂÜÖÈÉ®‰∏ÄËà¨‰ºöË¶ÅÊ±ÇÊµãËØïË¶ÜÁõñÁéáËææÂà∞80%Â∑¶Âè≥„ÄÇ</p>
<p>GoÊèê‰æõÂÜÖÁΩÆÂäüËÉΩÊù•Ê£ÄÊü•‰Ω†ÁöÑ‰ª£Á†ÅË¶ÜÁõñÁéáÔºåÂç≥‰ΩøÁî®<code>go test -cover</code>Êù•Êü•ÁúãÊµãËØïË¶ÜÁõñÁéá„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span> -cover
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">coverage: 100.0% of statements
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.009s
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏äÈù¢ÁöÑÁªìÊûúÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÁöÑÊµãËØïÁî®‰æãË¶ÜÁõñ‰∫Ü100%ÁöÑ‰ª£Á†Å„ÄÇ</p>
<p>GoËøòÊèê‰æõ‰∫Ü‰∏Ä‰∏™È¢ùÂ§ñÁöÑ<code>-coverprofile</code>ÂèÇÊï∞ÔºåÁî®Êù•Â∞ÜË¶ÜÁõñÁéáÁõ∏ÂÖ≥ÁöÑËÆ∞ÂΩï‰ø°ÊÅØËæìÂá∫Âà∞‰∏Ä‰∏™Êñá‰ª∂„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ go <span class="nb">test</span> -cover -coverprofile<span class="o">=</span>c.out
</span></span><span class="line"><span class="cl">PASS
</span></span><span class="line"><span class="cl">coverage: 100.0% of statements
</span></span><span class="line"><span class="cl">ok      golang-unit-test-demo/base_demo 0.009s
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢ÁöÑÂëΩ‰ª§‰ºöÂ∞ÜË¶ÜÁõñÁéáÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØËæìÂá∫Âà∞ÂΩìÂâçÊñá‰ª∂Â§π‰∏ãÈù¢ÁöÑ<code>c.out</code>Êñá‰ª∂‰∏≠„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ùØ tree .
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ c.out
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ split.go
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ split_test.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÊàë‰ª¨ÊâßË°å<code>go tool cover -html=c.out</code>Ôºå‰ΩøÁî®<code>cover</code>Â∑•ÂÖ∑Êù•Â§ÑÁêÜÁîüÊàêÁöÑËÆ∞ÂΩï‰ø°ÊÅØÔºåËØ•ÂëΩ‰ª§‰ºöÊâìÂºÄÊú¨Âú∞ÁöÑÊµèËßàÂô®Á™óÂè£ÁîüÊàê‰∏Ä‰∏™HTMLÊä•Âëä„ÄÇ<img src="https://www.liwenzhou.com/images/Go/unit_test/cover.png"
	
	
	
	loading="lazy"
	
		alt="Go test cover"
	
	
>‰∏äÂõæ‰∏≠ÊØè‰∏™Áî®ÁªøËâ≤Ê†áËÆ∞ÁöÑËØ≠Âè•ÂùóË°®Á§∫Ë¢´Ë¶ÜÁõñ‰∫ÜÔºåËÄåÁ∫¢Ëâ≤ÁöÑË°®Á§∫Ê≤°ÊúâË¢´Ë¶ÜÁõñ„ÄÇ</p>
<h2 id="testifyassert">testify/assert</h2>
<p><a class="link" href="https://github.com/stretchr/testify"  target="_blank" rel="noopener"
    >testify</a>ÊòØ‰∏Ä‰∏™Á§æÂå∫ÈùûÂ∏∏ÊµÅË°åÁöÑGoÂçïÂÖÉÊµãËØïÂ∑•ÂÖ∑ÂåÖÔºåÂÖ∂‰∏≠‰ΩøÁî®ÊúÄÂ§öÁöÑÂäüËÉΩÂ∞±ÊòØÂÆÉÊèê‰æõÁöÑÊñ≠Ë®ÄÂ∑•ÂÖ∑‚Äî‚Äî<code>testify/assert</code>Êàñ<code>testify/require</code>„ÄÇ</p>
<h3 id="ÂÆâË£Ö-2">ÂÆâË£Ö</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get github.com/stretchr/testify
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ΩøÁî®Á§∫‰æã">‰ΩøÁî®Á§∫‰æã</h3>
<p>Êàë‰ª¨Âú®ÂÜôÂçïÂÖÉÊµãËØïÁöÑÊó∂ÂÄôÔºåÈÄöÂ∏∏ÈúÄË¶Å‰ΩøÁî®Êñ≠Ë®ÄÊù•Ê†°È™åÊµãËØïÁªìÊûúÔºå‰ΩÜÊòØÁî±‰∫éGoËØ≠Ë®ÄÂÆòÊñπÊ≤°ÊúâÊèê‰æõÊñ≠Ë®ÄÔºåÊâÄ‰ª•Êàë‰ª¨‰ºöÂÜôÂá∫ÂæàÂ§öÁöÑ<code>if...else...</code>ËØ≠Âè•„ÄÇËÄå<code>testify/assert</code>‰∏∫Êàë‰ª¨Êèê‰æõ‰∫ÜÂæàÂ§öÂ∏∏Áî®ÁöÑÊñ≠Ë®ÄÂáΩÊï∞ÔºåÂπ∂‰∏îËÉΩÂ§üËæìÂá∫ÂèãÂ•Ω„ÄÅÊòì‰∫éÈòÖËØªÁöÑÈîôËØØÊèèËø∞‰ø°ÊÅØ„ÄÇ</p>
<p>ÊØîÂ¶ÇÊàë‰ª¨‰πãÂâçÂú®<code>TestSplit</code>ÊµãËØïÂáΩÊï∞‰∏≠Â∞±‰ΩøÁî®‰∫Ü<code>reflect.DeepEqual</code>Êù•Âà§Êñ≠ÊúüÊúõÁªìÊûú‰∏éÂÆûÈôÖÁªìÊûúÊòØÂê¶‰∏ÄËá¥„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ‰ΩøÁî®t.Run()ÊâßË°åÂ≠êÊµãËØï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;expected:%#v, got:%#v&#34;</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">,</span> <span class="nx">got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩøÁî®<code>testify/assert</code>‰πãÂêéÂ∞±ËÉΩÂ∞Ü‰∏äËø∞Âà§Êñ≠ËøáÁ®ãÁÆÄÂåñÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ‰ΩøÁî®t.Run()ÊâßË°åÂ≠êÊµãËØï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">got</span> <span class="o">:=</span> <span class="nf">Split</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">sep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span>  <span class="c1">// ‰ΩøÁî®assertÊèê‰æõÁöÑÊñ≠Ë®ÄÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩìÊàë‰ª¨ÊúâÂ§ö‰∏™Êñ≠Ë®ÄËØ≠Âè•Êó∂ÔºåËøòÂèØ‰ª•‰ΩøÁî®<code>assert := assert.New(t)</code>ÂàõÂª∫‰∏Ä‰∏™assertÂØπË±°ÔºåÂÆÉÊã•ÊúâÂâçÈù¢ÊâÄÊúâÁöÑÊñ≠Ë®ÄÊñπÊ≥ïÔºåÂè™ÊòØ‰∏çÈúÄË¶ÅÂÜç‰º†ÂÖ•<code>Testing.T</code>ÂèÇÊï∞‰∫Ü„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSomething</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">assert</span> <span class="o">:=</span> <span class="nx">assert</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert equality
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="s">&#34;they should be equal&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert inequality
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">assert</span><span class="p">.</span><span class="nf">NotEqual</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="s">&#34;they should not be equal&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert for nil (good for errors)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">assert</span><span class="p">.</span><span class="nf">Nil</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// assert for not nil (good when you expect something)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nx">assert</span><span class="p">.</span><span class="nf">NotNil</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// now we know that object isn&#39;t nil, we are safe to make
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// further assertions without causing any errors
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="s">&#34;Something&#34;</span><span class="p">,</span> <span class="nx">object</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>testify/assert</code>Êèê‰æõ‰∫ÜÈùûÂ∏∏Â§öÁöÑÊñ≠Ë®ÄÂáΩÊï∞ÔºåËøôÈáåÊ≤°ÂäûÊ≥ï‰∏Ä‰∏ÄÂàó‰∏æÂá∫Êù•ÔºåÂ§ßÂÆ∂ÂèØ‰ª•Êü•Áúã<a class="link" href="https://pkg.go.dev/github.com/stretchr/testify/assert#pkg-functions"  target="_blank" rel="noopener"
    >ÂÆòÊñπÊñáÊ°£</a>‰∫ÜËß£„ÄÇ</p>
<p><code>testify/require</code>Êã•Êúâ<code>testify/assert</code>ÊâÄÊúâÊñ≠Ë®ÄÂáΩÊï∞ÔºåÂÆÉ‰ª¨ÁöÑÂîØ‰∏ÄÂå∫Âà´Â∞±ÊòØ‚Äî‚Äî<code>testify/require</code>ÈÅáÂà∞Â§±Ë¥•ÁöÑÁî®‰æã‰ºöÁ´ãÂç≥ÁªàÊ≠¢Êú¨Ê¨°ÊµãËØï„ÄÇ</p>
<p>Ê≠§Â§ñÔºå<code>testify</code>ÂåÖËøòÊèê‰æõ‰∫Ü<a class="link" href="https://pkg.go.dev/github.com/stretchr/testify/mock"  target="_blank" rel="noopener"
    >mock</a>„ÄÅ<a class="link" href="https://pkg.go.dev/github.com/stretchr/testify/http"  target="_blank" rel="noopener"
    >http</a>Á≠âÂÖ∂‰ªñÊµãËØïÂ∑•ÂÖ∑ÔºåÁØáÂπÖÊâÄÈôêËøôÈáåÂ∞±‰∏çËØ¶ÁªÜ‰ªãÁªç‰∫ÜÔºåÊúâÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•Ëá™Â∑±‰∫ÜËß£‰∏Ä‰∏ã„ÄÇ</p>
<h1 id="Â∏∏Áî®ÈôêÊµÅÁ≠ñÁï•ÊºèÊ°∂‰∏é‰ª§ÁâåÊ°∂‰ªãÁªç">Â∏∏Áî®ÈôêÊµÅÁ≠ñÁï•‚Äî‚ÄîÊºèÊ°∂‰∏é‰ª§ÁâåÊ°∂‰ªãÁªç</h1>
<p>ÂèëÂ∏É‰∫é2020/09/13 ,Êõ¥Êñ∞‰∫é2020/09/13 18:41:02</p>
<p>| <a class="link" href="https://www.liwenzhou.com/categories/Golang"  target="_blank" rel="noopener"
    >Golang</a></p>
<p>|ÊÄªÈòÖËØªÈáèÔºö8321Ê¨°</p>
<p>ÈôêÊµÅÂèàÁß∞‰∏∫ÊµÅÈáèÊéßÂà∂ÔºàÊµÅÊéßÔºâÔºåÈÄöÂ∏∏ÊòØÊåáÈôêÂà∂Âà∞ËææÁ≥ªÁªüÁöÑÂπ∂ÂèëËØ∑Ê±ÇÊï∞ÔºåÊú¨ÊñáÂàó‰∏æ‰∫ÜÂ∏∏ËßÅÁöÑÈôêÊµÅÁ≠ñÁï•ÔºåÂπ∂‰ª•ginÊ°ÜÊû∂‰∏∫‰æãÊºîÁ§∫‰∫ÜÂ¶Ç‰Ωï‰∏∫È°πÁõÆÊ∑ªÂä†ÈôêÊµÅÁªÑ‰ª∂„ÄÇ</p>
<h2 id="ÈôêÊµÅ">ÈôêÊµÅ</h2>
<p>ÈôêÊµÅÂèàÁß∞‰∏∫ÊµÅÈáèÊéßÂà∂ÔºàÊµÅÊéßÔºâÔºåÈÄöÂ∏∏ÊòØÊåáÈôêÂà∂Âà∞ËææÁ≥ªÁªüÁöÑÂπ∂ÂèëËØ∑Ê±ÇÊï∞„ÄÇ</p>
<p>Êàë‰ª¨ÁîüÊ¥ª‰∏≠‰πü‰ºöÁªèÂ∏∏ÈÅáÂà∞ÈôêÊµÅÁöÑÂú∫ÊôØÔºåÊØîÂ¶ÇÔºöÊüêÊôØÂå∫ÈôêÂà∂ÊØèÊó•ËøõÂÖ•ÊôØÂå∫ÁöÑÊ∏∏ÂÆ¢Êï∞Èáè‰∏∫8‰∏á‰∫∫ÔºõÊ≤ôÊ≤≥Âú∞ÈìÅÁ´ôÊó©È´òÂ≥∞ÈÄöËøáÁ´ôÂ§ñÊéíÈòüÈÄê‰∏ÄÊîæË°åÁöÑÊñπÂºèÈôêÂà∂Âêå‰∏ÄÊó∂Èó¥ËøõÂÖ•ËΩ¶Á´ôÁöÑÊóÖÂÆ¢Êï∞ÈáèÁ≠â„ÄÇ</p>
<p>ÈôêÊµÅËôΩÁÑ∂‰ºöÂΩ±ÂìçÈÉ®ÂàÜÁî®Êà∑ÁöÑ‰ΩøÁî®‰ΩìÈ™åÔºå‰ΩÜÊòØÂç¥ËÉΩÂú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÊä•ÈöúÁ≥ªÁªüÁöÑÁ®≥ÂÆöÊÄßÔºå‰∏çËá≥‰∫éÂ¥©Ê∫ÉÔºàÂ§ßÂÆ∂ÈÉΩÊ≤°‰∫ÜÁî®Êà∑‰ΩìÈ™åÔºâ„ÄÇ</p>
<p>ËÄå‰∫íËÅîÁΩë‰∏äÁ±ª‰ººÈúÄË¶ÅÈôêÊµÅÁöÑ‰∏öÂä°Âú∫ÊôØ‰πüÊúâÂæàÂ§öÔºåÊØîÂ¶ÇÁîµÂïÜÁ≥ªÁªüÁöÑÁßíÊùÄ„ÄÅÂæÆÂçö‰∏äÁ™ÅÂèëÁÉ≠ÁÇπÊñ∞Èóª„ÄÅÂèåÂçÅ‰∏ÄË¥≠Áâ©ËäÇ„ÄÅ12306Êä¢Á•®Á≠âÁ≠â„ÄÇËøô‰∫õÂú∫ÊôØ‰∏ãÁöÑÁî®Êà∑ËØ∑Ê±ÇÈáèÈÄöÂ∏∏‰ºöÊøÄÂ¢ûÔºåËøúËøúË∂ÖËøáÂπ≥Êó∂Ê≠£Â∏∏ÁöÑËØ∑Ê±ÇÈáèÔºåÊ≠§Êó∂Â¶ÇÊûú‰∏çÂä†‰ªª‰ΩïÈôêÂà∂ÂæàÂÆπÊòìÂ∞±‰ºöÂ∞ÜÂêéÁ´ØÊúçÂä°ÊâìÂûÆÔºåÂΩ±ÂìçÊúçÂä°ÁöÑÁ®≥ÂÆöÊÄß„ÄÇ</p>
<p>Ê≠§Â§ñÔºå‰∏Ä‰∫õÂéÇÂïÜÂÖ¨ÂºÄÁöÑAPIÊúçÂä°ÈÄöÂ∏∏‰πü‰ºöÈôêÂà∂Áî®Êà∑ÁöÑËØ∑Ê±ÇÊ¨°Êï∞ÔºåÊØîÂ¶ÇÁôæÂ∫¶Âú∞ÂõæÂºÄÊîæÂπ≥Âè∞Á≠â‰ºöÊ†πÊçÆÁî®Êà∑ÁöÑ‰ªòË¥πÊÉÖÂÜµÊù•ÈôêÂà∂Áî®Êà∑ÁöÑËØ∑Ê±ÇÊï∞Á≠â„ÄÇ<img src="https://www.liwenzhou.com/images/Go/ratelimit/baidumap_ratelimit.jpg"
	
	
	
	loading="lazy"
	
		alt="ÁôæÂ∫¶Âú∞ÂõæÂºÄÊîæÂπ≥Âè∞APIË∞ÉÁî®Á≠ñÁï•"
	
	
></p>
<h2 id="Â∏∏Áî®ÁöÑÈôêÊµÅÁ≠ñÁï•">Â∏∏Áî®ÁöÑÈôêÊµÅÁ≠ñÁï•</h2>
<h3 id="ÊºèÊ°∂">ÊºèÊ°∂</h3>
<p>ÊºèÊ°∂Ê≥ïÈôêÊµÅÂæàÂ•ΩÁêÜËß£ÔºåÂÅáËÆæÊàë‰ª¨Êúâ‰∏Ä‰∏™Ê∞¥Ê°∂ÊåâÂõ∫ÂÆöÁöÑÈÄüÁéáÂêë‰∏ãÊñπÊª¥ËêΩ‰∏ÄÊª¥Ê∞¥ÔºåÊó†ËÆ∫ÊúâÂ§öÂ∞ëËØ∑Ê±ÇÔºåËØ∑Ê±ÇÁöÑÈÄüÁéáÊúâÂ§öÂ§ßÔºåÈÉΩÊåâÁÖßÂõ∫ÂÆöÁöÑÈÄüÁéáÊµÅÂá∫ÔºåÂØπÂ∫îÂà∞Á≥ªÁªü‰∏≠Â∞±ÊòØÊåâÁÖßÂõ∫ÂÆöÁöÑÈÄüÁéáÂ§ÑÁêÜËØ∑Ê±Ç„ÄÇ</p>
<p><img src="https://www.liwenzhou.com/images/Go/ratelimit/loutong.jpg"
	
	
	
	loading="lazy"
	
		alt="ÊºèÊ°∂ÁÆóÊ≥ïÂéüÁêÜ"
	
	
></p>
<p>ÊºèÊ°∂Ê≥ïÁöÑÂÖ≥ÈîÆÁÇπÂú®‰∫éÊºèÊ°∂ÂßãÁªàÊåâÁÖßÂõ∫ÂÆöÁöÑÈÄüÁéáËøêË°åÔºå‰ΩÜÊòØÂÆÉÂπ∂‰∏çËÉΩÂæàÂ•ΩÁöÑÂ§ÑÁêÜÊúâÂ§ßÈáèÁ™ÅÂèëËØ∑Ê±ÇÁöÑÂú∫ÊôØÔºåÊØïÁ´üÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãÊàë‰ª¨ÂèØËÉΩÈúÄË¶ÅÊèêÈ´òÁ≥ªÁªüÁöÑÂ§ÑÁêÜÊïàÁéáÔºåËÄå‰∏çÊòØ‰∏ÄÂë≥ÁöÑÊåâÁÖßÂõ∫ÂÆöÈÄüÁéáÂ§ÑÁêÜËØ∑Ê±Ç„ÄÇ</p>
<p>ÂÖ≥‰∫éÊºèÊ°∂ÁöÑÂÆûÁé∞ÔºåuberÂõ¢ÈòüÊúâ‰∏Ä‰∏™ÂºÄÊ∫êÁöÑ<a class="link" href="https://github.com/uber-go/ratelimit"  target="_blank" rel="noopener"
    >github.com/uber-go/ratelimit</a>Â∫ì„ÄÇ Ëøô‰∏™Â∫ìÁöÑ‰ΩøÁî®ÊñπÊ≥ïÊØîËæÉÁÆÄÂçïÔºå<code>Take()</code> ÊñπÊ≥ï‰ºöËøîÂõûÊºèÊ°∂‰∏ã‰∏ÄÊ¨°Êª¥Ê∞¥ÁöÑÊó∂Èó¥„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/ratelimit&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rl</span> <span class="o">:=</span> <span class="nx">ratelimit</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1">// per second
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nx">prev</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">now</span> <span class="o">:=</span> <span class="nx">rl</span><span class="p">.</span><span class="nf">Take</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">now</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">prev</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nx">prev</span> <span class="p">=</span> <span class="nx">now</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Output:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 1 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 2 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 3 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 4 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 5 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 6 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 7 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 8 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 9 10ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÆÉÁöÑÊ∫êÁ†ÅÂÆûÁé∞‰πüÊØîËæÉÁÆÄÂçïÔºåËøôÈáåÂ§ßËá¥ËØ¥‰∏Ä‰∏ãÂÖ≥ÈîÆÁöÑÂú∞ÊñπÔºåÊúâÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶ÂèØ‰ª•Ëá™Â∑±ÂéªÁúã‰∏Ä‰∏ãÂÆåÊï¥ÁöÑÊ∫êÁ†Å„ÄÇ</p>
<p>ÈôêÂà∂Âô®ÊòØ‰∏Ä‰∏™Êé•Âè£Á±ªÂûãÔºåÂÖ∂Ë¶ÅÊ±ÇÂÆûÁé∞‰∏Ä‰∏™<code>Take()</code>ÊñπÊ≥ïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Limiter</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TakeÊñπÊ≥ïÂ∫îËØ•ÈòªÂ°ûÂ∑≤Á°Æ‰øùÊª°Ë∂≥ RPS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Take</span><span class="p">()</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÆûÁé∞ÈôêÂà∂Âô®Êé•Âè£ÁöÑÁªìÊûÑ‰ΩìÂÆö‰πâÂ¶Ç‰∏ãÔºåËøôÈáåÂèØ‰ª•ÈáçÁÇπÁïôÊÑè‰∏ã<code>maxSlack</code>Â≠óÊÆµÔºåÂÆÉÂú®ÂêéÈù¢ÁöÑ<code>Take()</code>ÊñπÊ≥ï‰∏≠ÁöÑÂ§ÑÁêÜ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">limiter</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>                <span class="c1">// ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">last</span>       <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>      <span class="c1">// ‰∏ä‰∏ÄÊ¨°ÁöÑÊó∂Âàª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">sleepFor</span>   <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>  <span class="c1">// ÈúÄË¶ÅÁ≠âÂæÖÁöÑÊó∂Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">perRequest</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>  <span class="c1">// ÊØèÊ¨°ÁöÑÊó∂Èó¥Èó¥Èöî
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">maxSlack</span>   <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>  <span class="c1">// ÊúÄÂ§ßÁöÑÂØå‰ΩôÈáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">clock</span>      <span class="nx">Clock</span>          <span class="c1">// Êó∂Èíü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>limiter</code>ÁªìÊûÑ‰ΩìÂÆûÁé∞<code>Limiter</code>Êé•Âè£ÁöÑ<code>Take()</code>ÊñπÊ≥ïÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Take ‰ºöÈòªÂ°ûÁ°Æ‰øù‰∏§Ê¨°ËØ∑Ê±Ç‰πãÈó¥ÁöÑÊó∂Èó¥Ëµ∞ÂÆå
</span></span></span><span class="line"><span class="cl"><span class="c1">// Take Ë∞ÉÁî®Âπ≥ÂùáÊï∞‰∏∫ time.Second/rate.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">limiter</span><span class="p">)</span> <span class="nf">Take</span><span class="p">()</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">now</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">clock</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇÂ∞±Áõ¥Êé•ÊîæË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">last</span><span class="p">.</span><span class="nf">IsZero</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nx">last</span> <span class="p">=</span> <span class="nx">now</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">last</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// sleepFor Ê†πÊçÆ perRequest Âíå‰∏ä‰∏ÄÊ¨°ËØ∑Ê±ÇÁöÑÊó∂ÂàªËÆ°ÁÆóÂ∫îËØ•sleepÁöÑÊó∂Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Áî±‰∫éÊØèÊ¨°ËØ∑Ê±ÇÈó¥ÈöîÁöÑÊó∂Èó¥ÂèØËÉΩ‰ºöË∂ÖËøáperRequest, ÊâÄ‰ª•Ëøô‰∏™Êï∞Â≠óÂèØËÉΩ‰∏∫Ë¥üÊï∞ÔºåÂπ∂Âú®Â§ö‰∏™ËØ∑Ê±Ç‰πãÈó¥Á¥ØÂä†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span> <span class="o">+=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">perRequest</span> <span class="o">-</span> <span class="nx">now</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Êàë‰ª¨‰∏çÂ∫îËØ•ËÆ©sleepForË¥üÁöÑÂ§™Â§öÔºåÂõ†‰∏∫ËøôÊÑèÂë≥ÁùÄ‰∏Ä‰∏™ÊúçÂä°Âú®Áü≠Êó∂Èó¥ÂÜÖÊÖ¢‰∫ÜÂæàÂ§öÈöèÂêé‰ºöÂæóÂà∞Êõ¥È´òÁöÑRPS„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span> <span class="p">&lt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">maxSlack</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">maxSlack</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Â¶ÇÊûú sleepFor ÊòØÊ≠£ÂÄºÈÇ£‰πàÂ∞± sleep
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nx">clock</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nx">last</span> <span class="p">=</span> <span class="nx">now</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nx">sleepFor</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nx">last</span> <span class="p">=</span> <span class="nx">now</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">last</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊ†πÊçÆËÆ∞ÂΩïÊØèÊ¨°ËØ∑Ê±ÇÁöÑÈó¥ÈöîÊó∂Èó¥Âíå‰∏ä‰∏ÄÊ¨°ËØ∑Ê±ÇÁöÑÊó∂ÂàªÊù•ËÆ°ÁÆóÂΩìÊ¨°ËØ∑Ê±ÇÈúÄË¶ÅÈòªÂ°ûÁöÑÊó∂Èó¥‚Äî‚Äî<code>sleepFor</code>ÔºåËøôÈáåÈúÄË¶ÅÁïôÊÑèÁöÑÊòØ<code>sleepFor</code>ÁöÑÂÄºÂèØËÉΩ‰∏∫Ë¥üÔºåÂú®ÁªèËøáÈó¥ÈöîÊó∂Èó¥ÈïøÁöÑ‰∏§Ê¨°ËÆøÈóÆ‰πãÂêé‰ºöÂØºËá¥ÈöèÂêéÂ§ßÈáèÁöÑËØ∑Ê±ÇË¢´ÊîæË°åÔºåÊâÄ‰ª•‰ª£Á†Å‰∏≠ÈíàÂØπËøô‰∏™Âú∫ÊôØÊúâ‰∏ìÈó®ÁöÑ‰ºòÂåñÂ§ÑÁêÜ„ÄÇÂàõÂª∫ÈôêÂà∂Âô®ÁöÑ<code>New()</code>ÂáΩÊï∞‰∏≠‰ºö‰∏∫<code>maxSlack</code>ËÆæÁΩÆÂàùÂßãÂÄºÔºå‰πüÂèØ‰ª•ÈÄöËøá<code>WithoutSlack</code>Ëøô‰∏™OptionÂèñÊ∂àËøô‰∏™ÈªòËÆ§ÂÄº„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">New</span><span class="p">(</span><span class="nx">rate</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="nx">Limiter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">limiter</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">perRequest</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">/</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="nx">rate</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">maxSlack</span><span class="p">:</span>   <span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">/</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="nx">rate</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">opt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">opt</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">l</span><span class="p">.</span><span class="nx">clock</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span><span class="p">.</span><span class="nx">clock</span> <span class="p">=</span> <span class="nx">clock</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">l</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰ª§ÁâåÊ°∂">‰ª§ÁâåÊ°∂</h3>
<p>‰ª§ÁâåÊ°∂ÂÖ∂ÂÆûÂíåÊºèÊ°∂ÁöÑÂéüÁêÜÁ±ª‰ººÔºå‰ª§ÁâåÊ°∂ÊåâÂõ∫ÂÆöÁöÑÈÄüÁéáÂæÄÊ°∂ÈáåÊîæÂÖ•‰ª§ÁâåÔºåÂπ∂‰∏îÂè™Ë¶ÅËÉΩ‰ªéÊ°∂ÈáåÂèñÂá∫‰ª§ÁâåÂ∞±ËÉΩÈÄöËøáÔºå‰ª§ÁâåÊ°∂ÊîØÊåÅÁ™ÅÂèëÊµÅÈáèÁöÑÂø´ÈÄüÂ§ÑÁêÜ„ÄÇ</p>
<p><img src="https://www.liwenzhou.com/images/Go/ratelimit/lingpaitong.jpg"
	
	
	
	loading="lazy"
	
		alt="‰ª§ÁâåÊ°∂ÂéüÁêÜ"
	
	
></p>
<p>ÂØπ‰∫é‰ªéÊ°∂ÈáåÂèñ‰∏çÂà∞‰ª§ÁâåÁöÑÂú∫ÊôØÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄâÊã©Á≠âÂæÖ‰πüÂèØ‰ª•Áõ¥Êé•ÊãíÁªùÂπ∂ËøîÂõû„ÄÇ</p>
<p>ÂØπ‰∫é‰ª§ÁâåÊ°∂ÁöÑGoËØ≠Ë®ÄÂÆûÁé∞ÔºåÂ§ßÂÆ∂ÂèØ‰ª•ÂèÇÁÖß<a class="link" href="https://github.com/juju/ratelimit"  target="_blank" rel="noopener"
    >github.com/juju/ratelimit</a>Â∫ì„ÄÇËøô‰∏™Â∫ìÊîØÊåÅÂ§öÁßç‰ª§ÁâåÊ°∂Ê®°ÂºèÔºåÂπ∂‰∏î‰ΩøÁî®Ëµ∑Êù•‰πüÊØîËæÉÁÆÄÂçï„ÄÇ</p>
<p>ÂàõÂª∫‰ª§ÁâåÊ°∂ÁöÑÊñπÊ≥ïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ÂàõÂª∫ÊåáÂÆöÂ°´ÂÖÖÈÄüÁéáÂíåÂÆπÈáèÂ§ßÂ∞èÁöÑ‰ª§ÁâåÊ°∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewBucket</span><span class="p">(</span><span class="nx">fillInterval</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span> <span class="nx">capacity</span> <span class="kt">int64</span><span class="p">)</span> <span class="o">*</span><span class="nx">Bucket</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ÂàõÂª∫ÊåáÂÆöÂ°´ÂÖÖÈÄüÁéá„ÄÅÂÆπÈáèÂ§ßÂ∞èÂíåÊØèÊ¨°Â°´ÂÖÖÁöÑ‰ª§ÁâåÊï∞ÁöÑ‰ª§ÁâåÊ°∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewBucketWithQuantum</span><span class="p">(</span><span class="nx">fillInterval</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span> <span class="nx">capacity</span><span class="p">,</span> <span class="nx">quantum</span> <span class="kt">int64</span><span class="p">)</span> <span class="o">*</span><span class="nx">Bucket</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ÂàõÂª∫Â°´ÂÖÖÈÄüÂ∫¶‰∏∫ÊåáÂÆöÈÄüÁéáÂíåÂÆπÈáèÂ§ßÂ∞èÁöÑ‰ª§ÁâåÊ°∂
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewBucketWithRate(0.1, 200) Ë°®Á§∫ÊØèÁßíÂ°´ÂÖÖ20‰∏™‰ª§Áâå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewBucketWithRate</span><span class="p">(</span><span class="nx">rate</span> <span class="kt">float64</span><span class="p">,</span> <span class="nx">capacity</span> <span class="kt">int64</span><span class="p">)</span> <span class="o">*</span><span class="nx">Bucket</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèñÂá∫‰ª§ÁâåÁöÑÊñπÊ≥ïÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ÂèñtokenÔºàÈùûÈòªÂ°ûÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">Take</span><span class="p">(</span><span class="nx">count</span> <span class="kt">int64</span><span class="p">)</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">TakeAvailable</span><span class="p">(</span><span class="nx">count</span> <span class="kt">int64</span><span class="p">)</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÊúÄÂ§öÁ≠âmaxWaitÊó∂Èó¥Âèñtoken
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">TakeMaxDuration</span><span class="p">(</span><span class="nx">count</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">maxWait</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂèñtokenÔºàÈòªÂ°ûÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">Wait</span><span class="p">(</span><span class="nx">count</span> <span class="kt">int64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">WaitMaxDuration</span><span class="p">(</span><span class="nx">count</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">maxWait</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="kt">bool</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËôΩËØ¥ÊòØ‰ª§ÁâåÊ°∂Ôºå‰ΩÜÊòØÊàë‰ª¨Ê≤°ÊúâÂøÖË¶ÅÁúüÁöÑÂéªÁîüÊàê‰ª§ÁâåÊîæÂà∞Ê°∂ÈáåÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÊØèÊ¨°Êù•Âèñ‰ª§ÁâåÁöÑÊó∂ÂÄôËÆ°ÁÆó‰∏Ä‰∏ãÔºåÂΩìÂâçÊòØÂê¶ÊúâË∂≥Â§üÁöÑ‰ª§ÁâåÂ∞±ÂèØ‰ª•‰∫ÜÔºåÂÖ∑‰ΩìÁöÑËÆ°ÁÆóÊñπÂºèÂèØ‰ª•ÊÄªÁªì‰∏∫‰∏ãÈù¢ÁöÑÂÖ¨ÂºèÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ÂΩìÂâç‰ª§ÁâåÊï∞ <span class="o">=</span> ‰∏ä‰∏ÄÊ¨°Ââ©‰ΩôÁöÑ‰ª§ÁâåÊï∞ + <span class="o">(</span>Êú¨Ê¨°Âèñ‰ª§ÁâåÁöÑÊó∂Âàª-‰∏ä‰∏ÄÊ¨°Âèñ‰ª§ÁâåÁöÑÊó∂Âàª<span class="o">)</span>/ÊîæÁΩÆ‰ª§ÁâåÁöÑÊó∂Èó¥Èó¥Èöî * ÊØèÊ¨°ÊîæÁΩÆÁöÑ‰ª§ÁâåÊï∞
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://github.com/juju/ratelimit"  target="_blank" rel="noopener"
    >github.com/juju/ratelimit</a>Ëøô‰∏™Â∫ì‰∏≠ÂÖ≥‰∫é‰ª§ÁâåÊï∞ËÆ°ÁÆóÁöÑÊ∫ê‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">currentTick</span><span class="p">(</span><span class="nx">now</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="kt">int64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nf">Sub</span><span class="p">(</span><span class="nx">tb</span><span class="p">.</span><span class="nx">startTime</span><span class="p">)</span> <span class="o">/</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">fillInterval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">adjustavailableTokens</span><span class="p">(</span><span class="nx">tick</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="o">&gt;=</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">capacity</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">tick</span> <span class="o">-</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">latestTick</span><span class="p">)</span> <span class="o">*</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">quantum</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="p">&gt;</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">capacity</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="p">=</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">capacity</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tb</span><span class="p">.</span><span class="nx">latestTick</span> <span class="p">=</span> <span class="nx">tick</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëé∑Âèñ‰ª§ÁâåÁöÑ<code>TakeAvailable()</code>ÂáΩÊï∞ÂÖ≥ÈîÆÈÉ®ÂàÜÁöÑÊ∫ê‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">tb</span> <span class="o">*</span><span class="nx">Bucket</span><span class="p">)</span> <span class="nf">takeAvailable</span><span class="p">(</span><span class="nx">now</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span> <span class="nx">count</span> <span class="kt">int64</span><span class="p">)</span> <span class="kt">int64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">count</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tb</span><span class="p">.</span><span class="nf">adjustavailableTokens</span><span class="p">(</span><span class="nx">tb</span><span class="p">.</span><span class="nf">currentTick</span><span class="p">(</span><span class="nx">now</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">count</span> <span class="p">&gt;</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">count</span> <span class="p">=</span> <span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tb</span><span class="p">.</span><span class="nx">availableTokens</span> <span class="o">-=</span> <span class="nx">count</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">count</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â§ßÂÆ∂‰ªé‰ª£Á†Å‰∏≠‰πüÂèØ‰ª•ÁúãÂà∞ÂÖ∂ÂÆû‰ª§ÁâåÊ°∂ÁöÑÂÆûÁé∞Âπ∂Ê≤°ÊúâÂæàÂ§çÊùÇ„ÄÇ</p>
<h2 id="ginÊ°ÜÊû∂‰∏≠‰ΩøÁî®ÈôêÊµÅ‰∏≠Èó¥‰ª∂">ginÊ°ÜÊû∂‰∏≠‰ΩøÁî®ÈôêÊµÅ‰∏≠Èó¥‰ª∂</h2>
<p>Âú®ginÊ°ÜÊû∂ÊûÑÂª∫ÁöÑÈ°πÁõÆ‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•Â∞ÜÈôêÊµÅÁªÑ‰ª∂ÂÆö‰πâÊàê‰∏≠Èó¥‰ª∂„ÄÇ</p>
<p>ËøôÈáå‰ΩøÁî®‰ª§ÁâåÊ°∂‰Ωú‰∏∫ÈôêÊµÅÁ≠ñÁï•ÔºåÁºñÂÜô‰∏Ä‰∏™ÈôêÊµÅ‰∏≠Èó¥‰ª∂Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">RateLimitMiddleware</span><span class="p">(</span><span class="nx">fillInterval</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span> <span class="nx">cap</span> <span class="kt">int64</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">bucket</span> <span class="o">:=</span> <span class="nx">ratelimit</span><span class="p">.</span><span class="nf">NewBucket</span><span class="p">(</span><span class="nx">fillInterval</span><span class="p">,</span> <span class="nx">cap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Â¶ÇÊûúÂèñ‰∏çÂà∞‰ª§ÁâåÂ∞±‰∏≠Êñ≠Êú¨Ê¨°ËØ∑Ê±ÇËøîÂõû rate limit...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">bucket</span><span class="p">.</span><span class="nf">TakeAvailable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;rate limit...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂØπ‰∫éËØ•ÈôêÊµÅ‰∏≠Èó¥‰ª∂ÁöÑÊ≥®ÂÜå‰ΩçÁΩÆÔºåÊàë‰ª¨ÂèØ‰ª•ÊåâÁÖß‰∏çÂêåÁöÑÈôêÊµÅÁ≠ñÁï•Â∞ÜÂÖ∂Ê≥®ÂÜåÂà∞‰∏çÂêåÁöÑ‰ΩçÁΩÆÔºå‰æãÂ¶ÇÔºö</p>
<ol>
<li>Â¶ÇÊûúË¶ÅÂØπÂÖ®Á´ôÈôêÊµÅÂ∞±ÂèØ‰ª•Ê≥®ÂÜåÊàêÂÖ®Â±ÄÁöÑ‰∏≠Èó¥‰ª∂„ÄÇ</li>
<li>Â¶ÇÊûúÊòØÊüê‰∏ÄÁªÑË∑ØÁî±ÈúÄË¶ÅÈôêÊµÅÔºåÈÇ£‰πàÂ∞±Âè™ÈúÄÂ∞ÜËØ•ÈôêÊµÅ‰∏≠Èó¥‰ª∂Ê≥®ÂÜåÂà∞ÂØπÂ∫îÁöÑË∑ØÁî±ÁªÑÂç≥ÂèØ„ÄÇ</li>
</ol>
<blockquote>
<p>ÂØπ‰∫éÊºèÊ°∂Ôºå‰ºöÁª¥Êä§‰∏Ä‰∏™Á®≥ÂÆöÁöÑËÆøÈóÆÈÄüÁéáÔºåÈÄöËøáÊ≠§Ê¨°ËÆøÈóÆÂíå‰∏ä‰∏ÄÊ¨°ËÆøÈóÆÁöÑÊó∂Èó¥Â∑ÆÔºåÂà§Êñ≠ËØ•Êó∂Èó¥Â∑ÆÊòØÂê¶Â§ß‰∫éËÆøÈóÆÈÄüÁéáÔºåËã•Â§ß‰∫éÂàô‰ºösleepËã•Âπ≤Êó∂Èó¥Ôºå‰∏çÁÑ∂Â∞±ÂèØ‰ª•ËÆøÈóÆ„ÄÇ</p>
<p>ÂØπ‰∫é‰ª§ÁâåÊ°∂Ôºå‰∏ç‰ºöÁúüÊ≠£ÁöÑÂÆûÁé∞‰∏Ä‰∏™Ê°∂ÔºåËÄåÊòØ‰ºöÊúâ‰∏Ä‰∏™Âä†‰ª§ÁâåÁöÑÈÄüÂ∫¶Ôºå‰æãÂ¶Ç5‰∏™/tickÔºå‰ºöËÆ∞ÂΩï‰∏Ä‰∏™startTimeÔºåÁî®now-startÂ∞±‰ºöÂæóÂà∞‰∏Ä‰∏™Êó∂Èó¥ÊÆµÔºåËØ•Êó∂Èó¥ÊÆµÈô§‰ª•ÁîüÊàê‰ª§ÁâåÁöÑÈó¥ÈöîÔºåÂ∞±‰ºöÂæóÂà∞ÂΩìÂâçÁöÑtickÔºåÁî®ÂΩìÂâçÁöÑtickÂáèÂéª‰∏ä‰∏ÄÊ¨°ÁöÑtickÂÜç‰πò‰ª•ÈÄüÁéáÂ∞±ÊòØÂΩìÂâç‰ª§ÁâåÊ°∂ÁöÑ‰ª§ÁâåÊï∞Â≠óÔºåÂíåËØ∑Ê±ÇÁöÑ‰ª§ÁâåÊï∞ÊØîËæÉ‰∏Ä‰∏ãÂ∞±Â•Ω‰∫Ü„ÄÇ</p>
</blockquote>
<h2 id="ÂÆå">ÂÆå</h2>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/golang/">Golang</a>
        
            <a href="/tags/grpc/">GRPC</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/posts/golang/">
        
        
            <div class="article-image">
                <img src="/posts/golang/grpc.f4eb406ee134e77570370eaeeb059063_hu1eee0aeb00d0db40f03f5ec8233f4563_83469_250x150_fill_q75_box_smart1.jpeg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post GRPC"
                        
                        data-hash="md5-9OtAbuE053VwNw6u6wWQYw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">GRPC</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2023 ËèúGOÁöÑÂçöÂÆ¢
    </section>
    
    <section class="powerby">
        
            welcome to my blog,here we can study together <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
