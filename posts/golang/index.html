<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='GRPCçš„ç¬”è®°'>
<title>GRPC</title>

<link rel='canonical' href='https://wolvestorm.github.io/blog/posts/golang/'>

<link rel="stylesheet" href="/blog/scss/style.min.5be32ca3f6e1a997c75795c4359147cc6d4fbd34948c0acd51e31d237033978a.css"><meta property='og:title' content='GRPC'>
<meta property='og:description' content='GRPCçš„ç¬”è®°'>
<meta property='og:url' content='https://wolvestorm.github.io/blog/posts/golang/'>
<meta property='og:site_name' content='èœGOçš„åšå®¢'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='Golang' /><meta property='article:tag' content='GRPC' /><meta property='article:published_time' content='2023-01-06T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-01-06T00:00:00&#43;00:00'/><meta property='og:image' content='https://wolvestorm.github.io/blog/posts/golang/grpc.jpeg' />
<meta name="twitter:title" content="GRPC">
<meta name="twitter:description" content="GRPCçš„ç¬”è®°"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://wolvestorm.github.io/blog/posts/golang/grpc.jpeg' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/blog/">
                
                    
                    
                    
                        
                        <img src="/blog/img/avatar_hu8b46cb020651f4f5a46bc8297d5d9089_86497_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/blog">èœGOçš„åšå®¢</a></h1>
            <h2 class="site-description">A Blog Of Vegetable Gopher</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://weibo.com/u/6116124329'
                        target="_blank"
                        title="Weibo"
                        rel="me"
                    >
                        
                        
                            <svg viewBox="0 0 32 32" style="width:1em;height:1em;vertical-align:middle" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" overflow="hidden"><path fill="currentColor" d="M22.4 8.891c.754 1.074 3.52.046 3.909 2.4.251 1.554 0 2.309.983 2.217.894-.069 2.446-3.017-.32-5.12-3.017-2.263-5.166-.389-4.571.503zm-.731-4.937c.32 1.143 2.741.777 4.638 1.166.937.183 2.651 1.326 3.451 4.114.802 2.789-1.003 5.349.937 5.577 1.6.206 1.465-5.029.937-6.743-.549-1.737-2.24-4.503-5.646-5.44-3.403-.937-4.661.137-4.318 1.326zM7.291 22.037c.389 2.398 3.109 3.952 6.034 3.474 2.857-.457 4.8-2.697 4.434-5.003-.389-2.313-2.949-3.867-5.806-3.502-2.926.366-5.051 2.629-4.663 5.031zm1.532.294c-.16-.914.526-1.826 1.577-2.034 1.029-.206 2.011.366 2.194 1.278.16.937-.526 1.831-1.577 2.037-1.029.229-2.011-.366-2.194-1.28zm6.88-10.445c-.48-.503 1.371-2.994-.343-4.411-1.943-1.623-6.469.48-10.354 3.977C1.097 14.949-.548 18.949.16 22.469c.686 3.543 7.177 7.909 16.251 7.131 9.074-.779 12.526-7.819 12.094-10.583-.437-2.743-3.088-2.951-3.771-3.086-.711-.137-2.08-.046-1.054-1.371 1.054-1.349.549-3.063-.8-3.634-1.326-.549-3.634-.069-4.709.434-1.44.686-2.469.526-2.469.526zm-12.069 9.6c-.389-3.451 3.566-7.017 8.914-7.726 5.349-.686 10.469 1.783 10.834 5.237.389 3.449-4.046 7.381-9.394 8.066-5.326.688-9.966-2.126-10.354-5.577z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://user.qzone.qq.com/892552140/infocenter'
                        target="_blank"
                        title="qq"
                        rel="me"
                    >
                        
                        
                            <svg viewBox="0 0 32 32" style="width:1em;height:1em;vertical-align:middle" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" overflow="hidden"><path fill="currentColor" d="M16 0l-4.937 10.537L0 12.228l8 8.183L6.103 32 16 26.535 25.897 32l-1.6-9.714c-4.343.594-9.44 1.003-14.88.297l8.869-6.857s-5.143-.869-11.154-1.737c0 0 8.594-1.851 17.872-.274l-9.438 6.718s3.566 1.006 8.571.848L24 20.412l8-8.183-11.063-1.691L16 .001z"/></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/blog/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blog/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blog/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blog/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://wolvestorm.github.io/blog/en/" >English</option>
                        
                            <option value="https://wolvestorm.github.io/blog/" selected>ä¸­æ–‡</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#åˆè¯†protobuffer">åˆè¯†protobuffer</a>
      <ol>
        <li><a href="#ç¬¬ä¸€ä¸ªproto">ç¬¬ä¸€ä¸ªproto</a></li>
        <li><a href="#ç”Ÿæˆgoæ–‡ä»¶">ç”Ÿæˆgoæ–‡ä»¶</a></li>
        <li><a href="#ç”Ÿæˆçš„pbgoæ–‡ä»¶">ç”Ÿæˆçš„pb.goæ–‡ä»¶</a></li>
        <li><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–">åºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></li>
        <li><a href="#protoå’Œjsonçš„ç›¸äº’è½¬æ¢">protoå’Œjsonçš„ç›¸äº’è½¬æ¢</a></li>
        <li><a href="#åœ¨protobufferä¸­å®šä¹‰æœåŠ¡">åœ¨protobufferä¸­å®šä¹‰æœåŠ¡</a></li>
      </ol>
    </li>
    <li><a href="#åˆè¯†rpc">åˆè¯†rpc</a>
      <ol>
        <li><a href="#rpcçš„ç»„æˆ">rpcçš„ç»„æˆ</a></li>
        <li><a href="#rpcçš„åŸç†">rpcçš„åŸç†</a></li>
        <li><a href="#goå®ç°rpc">goå®ç°rpc</a>
          <ol>
            <li><a href="#æœåŠ¡å®šä¹‰å’Œæš´éœ²">æœåŠ¡å®šä¹‰å’Œæš´éœ²</a></li>
            <li><a href="#æ³¨å†ŒæœåŠ¡å’Œç›‘å¬">æ³¨å†ŒæœåŠ¡å’Œç›‘å¬</a></li>
            <li><a href="#å®¢æˆ·ç«¯è°ƒç”¨">å®¢æˆ·ç«¯è°ƒç”¨</a></li>
          </ol>
        </li>
        <li><a href="#rpcå’Œprotobuffer">rpcå’Œprotobuffer</a></li>
      </ol>
    </li>
    <li><a href="#åˆè¯†grpc">åˆè¯†grpc</a>
      <ol>
        <li><a href="#å¾—åˆ°grpc">å¾—åˆ°grpc</a></li>
        <li><a href="#grpcçš„ä½¿ç”¨">grpcçš„ä½¿ç”¨</a>
          <ol>
            <li><a href="#grpcç¼–è¯‘æ”¯æŒ">gRPCç¼–è¯‘æ”¯æŒ</a></li>
            <li><a href="#å®ç°rpcæœåŠ¡">å®ç°rpcæœåŠ¡</a></li>
            <li><a href="#grpcå®ç°æœåŠ¡å™¨">grpcå®ç°æœåŠ¡å™¨</a></li>
            <li><a href="#grpcå®ç°å®¢æˆ·ç«¯">grpcå®ç°å®¢æˆ·ç«¯</a></li>
          </ol>
        </li>
        <li><a href="#grpcçš„æµæ¨¡å¼">grpcçš„æµæ¨¡å¼</a>
          <ol>
            <li><a href="#æœåŠ¡å™¨æµå½¢å¼">æœåŠ¡å™¨æµå½¢å¼</a></li>
            <li><a href="#å®¢æˆ·ç«¯æµæ¨¡å¼">å®¢æˆ·ç«¯æµæ¨¡å¼</a></li>
            <li><a href="#åŒå‘æµæ¨¡å¼">åŒå‘æµæ¨¡å¼</a></li>
          </ol>
        </li>
        <li><a href="#grpcéªŒè¯">grpcéªŒè¯</a>
          <ol>
            <li><a href="#åŸºäºtoken">åŸºäºtoken</a></li>
            <li><a href="#æœåŠ¡å™¨-1">æœåŠ¡å™¨</a></li>
            <li><a href="#å®¢æˆ·ç«¯-1">å®¢æˆ·ç«¯</a></li>
          </ol>
        </li>
        <li><a href="#grpcæ‹¦æˆªå™¨">grpcæ‹¦æˆªå™¨</a>
          <ol>
            <li><a href="#æœåŠ¡å™¨-2">æœåŠ¡å™¨</a></li>
            <li><a href="#å®¢æˆ·ç«¯-2">å®¢æˆ·ç«¯</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/blog/posts/golang/">
                <img src="/blog/posts/golang/grpc_hu1eee0aeb00d0db40f03f5ec8233f4563_83469_800x0_resize_q75_box.jpeg"
                        srcset="/blog/posts/golang/grpc_hu1eee0aeb00d0db40f03f5ec8233f4563_83469_800x0_resize_q75_box.jpeg 800w, /blog/posts/golang/grpc_hu1eee0aeb00d0db40f03f5ec8233f4563_83469_1600x0_resize_q75_box.jpeg 1600w"
                        width="800" 
                        height="339" 
                        loading="lazy"
                        alt="Featured image of post GRPC" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/blog/categories/golang/" >
                Golang
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/blog/posts/golang/">GRPC</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            GRPCçš„ç¬”è®°
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 06, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 29 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="grpc">grpc</h1>
<h2 id="åˆè¯†protobuffer">åˆè¯†protobuffer</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u github.com/golang/protobuf/protoc-gen-go
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¬¬ä¸€ä¸ªproto">ç¬¬ä¸€ä¸ªproto</h3>
<p>protoæ–‡ä»¶éƒ½éœ€è¦ä»¥.protoä½œä¸ºåç¼€ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„protobufferï¼Œname = 1ä¸æ˜¯æŒ‡ä»–çš„å€¼æ˜¯1ï¼Œè€Œæ˜¯æŒ‡ä»–åœ¨Personä¸­çš„åºå·æ˜¯1.</p>
<p>option go_package = &ldquo;path;package&rdquo;</p>
<p>pathä»£è¡¨ç”Ÿæˆçš„goæ–‡ä»¶åœ¨å½“å‰ç›®å½•ï¼Œpackageä»£è¡¨åŒ…ä¸ºfirstã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="line"><span class="cl"><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">option</span> <span class="n">go_package</span><span class="o">=</span><span class="s">&#34;./;first&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="kn">package</span> <span class="nn">first</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="kd">message</span> <span class="nc">Person</span><span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">int32</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">email</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kd">enum</span> <span class="n">status</span><span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="n">CHILD</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="n">ADULT</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="n">OLD</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç”Ÿæˆgoæ–‡ä»¶">ç”Ÿæˆgoæ–‡ä»¶</h3>
<blockquote>
<p>protoc &ndash;go_out= . ./*.proto</p>
</blockquote>
<h3 id="ç”Ÿæˆçš„pbgoæ–‡ä»¶">ç”Ÿæˆçš„pb.goæ–‡ä»¶</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Code generated by protoc-gen-go. DO NOT EDIT.
</span></span></span><span class="line"><span class="cl"><span class="c1">// versions:
</span></span></span><span class="line"><span class="cl"><span class="c1">// 	protoc-gen-go v1.28.0
</span></span></span><span class="line"><span class="cl"><span class="c1">// 	protoc        v3.20.0
</span></span></span><span class="line"><span class="cl"><span class="c1">// source: person.proto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">first</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">protoreflect</span> <span class="s">&#34;google.golang.org/protobuf/reflect/protoreflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">protoimpl</span> <span class="s">&#34;google.golang.org/protobuf/runtime/protoimpl&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">reflect</span> <span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sync</span> <span class="s">&#34;sync&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Verify that this generated code is sufficiently up-to-date.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_</span> <span class="p">=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nf">EnforceVersion</span><span class="p">(</span><span class="mi">20</span> <span class="o">-</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MinVersion</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Verify that runtime/protoimpl is sufficiently up-to-date.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_</span> <span class="p">=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nf">EnforceVersion</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MaxVersion</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PersonStatus</span> <span class="kt">int32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Person_CHILD</span> <span class="nx">PersonStatus</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Person_ADULT</span> <span class="nx">PersonStatus</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Person_OLD</span>   <span class="nx">PersonStatus</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Enum value maps for PersonStatus.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">PersonStatus_name</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int32</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="mi">0</span><span class="p">:</span> <span class="s">&#34;CHILD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mi">1</span><span class="p">:</span> <span class="s">&#34;ADULT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mi">2</span><span class="p">:</span> <span class="s">&#34;OLD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">PersonStatus_value</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int32</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;CHILD&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;ADULT&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;OLD&#34;</span><span class="p">:</span>   <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">PersonStatus</span><span class="p">)</span> <span class="nf">Enum</span><span class="p">()</span> <span class="o">*</span><span class="nx">PersonStatus</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">PersonStatus</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">p</span> <span class="p">=</span> <span class="nx">x</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">PersonStatus</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">EnumStringOf</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nf">Descriptor</span><span class="p">(),</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nf">EnumNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">PersonStatus</span><span class="p">)</span> <span class="nf">Descriptor</span><span class="p">()</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">EnumDescriptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">file_person_proto_enumTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">Descriptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">PersonStatus</span><span class="p">)</span> <span class="nf">Type</span><span class="p">()</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">EnumType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">file_person_proto_enumTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">PersonStatus</span><span class="p">)</span> <span class="nf">Number</span><span class="p">()</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">EnumNumber</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nf">EnumNumber</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Deprecated: Use PersonStatus.Descriptor instead.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">PersonStatus</span><span class="p">)</span> <span class="nf">EnumDescriptor</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">file_person_proto_rawDescGZIP</span><span class="p">(),</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Person</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">state</span>         <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MessageState</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sizeCache</span>     <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">SizeCache</span>
</span></span><span class="line"><span class="cl">	<span class="nx">unknownFields</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnknownFields</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span>  <span class="kt">string</span> <span class="s">`protobuf:&#34;bytes,1,opt,name=name,proto3&#34; json:&#34;name,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Age</span>   <span class="kt">int32</span>  <span class="s">`protobuf:&#34;varint,2,opt,name=age,proto3&#34; json:&#34;age,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Email</span> <span class="kt">string</span> <span class="s">`protobuf:&#34;bytes,3,opt,name=email,proto3&#34; json:&#34;email,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">x</span> <span class="p">=</span> <span class="nx">Person</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">mi</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">file_person_proto_msgTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStateOf</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span><span class="p">.</span><span class="nf">StoreMessageInfo</span><span class="p">(</span><span class="nx">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStringOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">ProtoMessage</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">ProtoReflect</span><span class="p">()</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">Message</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mi</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">file_person_proto_msgTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStateOf</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ms</span><span class="p">.</span><span class="nf">LoadMessageInfo</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ms</span><span class="p">.</span><span class="nf">StoreMessageInfo</span><span class="p">(</span><span class="nx">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">ms</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">mi</span><span class="p">.</span><span class="nf">MessageOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Deprecated: Use Person.ProtoReflect.Descriptor instead.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">Descriptor</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">file_person_proto_rawDescGZIP</span><span class="p">(),</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">GetName</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Name</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">GetAge</span><span class="p">()</span> <span class="kt">int32</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Age</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">Person</span><span class="p">)</span> <span class="nf">GetEmail</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Email</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">File_person_proto</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">FileDescriptor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_person_proto_rawDesc</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_person_proto_rawDescOnce</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_person_proto_rawDescData</span> <span class="p">=</span> <span class="nx">file_person_proto_rawDesc</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">file_person_proto_rawDescGZIP</span><span class="p">()</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_person_proto_rawDescOnce</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">file_person_proto_rawDescData</span> <span class="p">=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">CompressGZIP</span><span class="p">(</span><span class="nx">file_person_proto_rawDescData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">file_person_proto_rawDescData</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_person_proto_enumTypes</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">EnumInfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_person_proto_msgTypes</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MessageInfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_person_proto_goTypes</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="nx">PersonStatus</span><span class="p">)(</span><span class="mi">0</span><span class="p">),</span> <span class="c1">// 0: first.Person.status
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">(</span><span class="o">*</span><span class="nx">Person</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>    <span class="c1">// 1: first.Person
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_person_proto_depIdxs</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">int32</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for method output_type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for method input_type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for extension type_name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for extension extendee
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for field type_name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> <span class="nf">file_person_proto_init</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">file_person_proto_init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">File_person_proto</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">file_person_proto_msgTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Exporter</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">v</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">switch</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.(</span><span class="o">*</span><span class="nx">Person</span><span class="p">);</span> <span class="nx">i</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">state</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">sizeCache</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">unknownFields</span>
</span></span><span class="line"><span class="cl">			<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">type</span> <span class="nx">x</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">out</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">TypeBuilder</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">File</span><span class="p">:</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">DescBuilder</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">GoPackagePath</span><span class="p">:</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">x</span><span class="p">{}).</span><span class="nf">PkgPath</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">RawDescriptor</span><span class="p">:</span> <span class="nx">file_person_proto_rawDesc</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumEnums</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumMessages</span><span class="p">:</span>   <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumExtensions</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumServices</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">GoTypes</span><span class="p">:</span>           <span class="nx">file_person_proto_goTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">DependencyIndexes</span><span class="p">:</span> <span class="nx">file_person_proto_depIdxs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EnumInfos</span><span class="p">:</span>         <span class="nx">file_person_proto_enumTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MessageInfos</span><span class="p">:</span>      <span class="nx">file_person_proto_msgTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">File_person_proto</span> <span class="p">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">File</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_person_proto_rawDesc</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_person_proto_goTypes</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_person_proto_depIdxs</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–">åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/golang/protobuf/proto&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;phm&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span><span class="nx">Email</span><span class="p">:</span> <span class="s">&#34;8888888@qq.com&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//åºåˆ—åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">marshal</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">proto</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">marshal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">newP</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//ååºåˆ—åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_</span> <span class="p">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">marshal</span><span class="p">,</span> <span class="nx">newP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">newP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="protoå’Œjsonçš„ç›¸äº’è½¬æ¢">protoå’Œjsonçš„ç›¸äº’è½¬æ¢</h3>
<p>é¦–å…ˆå®‰è£…ä¸€ä¸ªåŒ…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">go</span> <span class="nx">get</span> <span class="nx">google</span><span class="p">.</span><span class="nx">golang</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">protobuf</span><span class="o">/</span><span class="nx">encoding</span><span class="o">/</span><span class="nx">protojson</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/protobuf/encoding/protojson&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;phm&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Age</span><span class="p">:</span>   <span class="mi">13</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Email</span><span class="p">:</span> <span class="s">&#34;999999@qq.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">format</span> <span class="o">:=</span> <span class="nx">protojson</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nf">ProtoReflect</span><span class="p">().</span><span class="nf">Interface</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">format</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">message</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nf">ProtoReflect</span><span class="p">().</span><span class="nf">Interface</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">protojson</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">format</span><span class="p">),</span> <span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åœ¨protobufferä¸­å®šä¹‰æœåŠ¡">åœ¨protobufferä¸­å®šä¹‰æœåŠ¡</h3>
<p>å¦‚æœä½ æƒ³åœ¨RPC(è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ç³»ç»Ÿä¸­ä½¿ç”¨ä½ çš„æ¶ˆæ¯ç±»å‹ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ª.protoæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªRPCæœåŠ¡æ¥å£ï¼Œå¹¶ä¸”Protocol Buffersç¼–è¯‘å™¨å°†ä»¥ä½ é€‰æ‹©çš„è¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç å’Œå­˜æ ¹ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å®šä¹‰ä¸€ä¸ªRPCæœåŠ¡ï¼Œå®ƒçš„æ–¹æ³•æ¥å—ä½ çš„SeanchRequestå¹¶è¿”å›ä¸€ä¸ªSeanchResponseï¼Œä½ å¯ä»¥åœ¨ä½ çš„.protoæ–‡ä»¶ä¸­å®šä¹‰å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="line"><span class="cl"><span class="kd">service</span> <span class="n">RpcService</span><span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="k">rpc</span> <span class="n">Search</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">Person</span><span class="p">);</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="k">rpc</span> <span class="n">register</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">Person</span><span class="p">);</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆè¯†rpc">åˆè¯†rpc</h2>
<p>åœ¨ä¸Šè¿°æœ¬åœ°è¿‡ç¨‹è°ƒç”¨çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨ä¸€å°è®¡ç®—æœºä¸Šæ‰§è¡Œäº†è®¡ç®—æœºä¸Šçš„ç¨‹åºï¼Œå®Œæˆè°ƒç”¨ã€‚éšç€è®¡ç®—æœºæŠ€æœ¯çš„å‘å±•å’Œéœ€æ±‚åœºæ™¯çš„å˜åŒ–ï¼Œæœ‰æ—¶å°±éœ€è¦ä»ä¸€å°è®¡ç®—æœºä¸Šæ‰§è¡Œå¦å¤–ä¸€å°è®¡ç®—æœºä¸Šçš„ç¨‹åºçš„éœ€æ±‚ï¼Œå› æ­¤åæ¥åˆå‘å±•å‡ºæ¥äº†RPCæŠ€æœ¯ã€‚ç‰¹åˆ«æ˜¯ç›®å‰éšç€äº’è”ç½‘æŠ€æœ¯çš„å¿«é€Ÿè¿­ä»£å’Œå‘å±•ï¼Œç”¨æˆ·å’Œéœ€æ±‚å‡ ä¹éƒ½æ˜¯ä»¥æŒ‡æ•°å¼çš„æ–¹å¼åœ¨é«˜é€Ÿå¢é•¿ï¼Œè¿™ä¸ªæ—¶å€™ç»å¤§å¤šæ•°æƒ…å†µä¸‹ç¨‹åºéƒ½æ˜¯<strong>éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Š</strong>ï¼Œå°±éœ€è¦åœ¨<strong>è°ƒç”¨</strong>å…¶ä»–ç‰©ç†æœºå™¨ä¸Šçš„ç¨‹åºçš„æƒ…å†µã€‚</p>
<p>RPCæ˜¯Remote Procedure Call Protocolå•è¯é¦–å­—æ¯çš„ç¼©å†™ï¼Œç®€ç§°ä¸ºï¼šRPCï¼Œç¿»è¯‘æˆä¸­æ–‡å«è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ã€‚æ‰€è°“è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé€šä¿—çš„ç†è§£å°±æ˜¯å¯ä»¥åœ¨æœ¬åœ°ç¨‹åºä¸­è°ƒç”¨è¿è¡Œåœ¨å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šçš„ç¨‹åºçš„åŠŸèƒ½æ–¹æ³•ã€‚è¿™ç§è°ƒç”¨çš„è¿‡ç¨‹è·¨è¶Šäº†ç‰©ç†æœåŠ¡å™¨çš„é™åˆ¶ï¼Œæ˜¯åœ¨ç½‘ç»œä¸­å®Œæˆçš„ï¼Œåœ¨è°ƒç”¨è¿œç«¯æœåŠ¡å™¨ä¸Šç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œæœ¬åœ°ç¨‹åºç­‰å¾…è¿”å›è°ƒç”¨ç»“æœï¼Œç›´åˆ°è¿œç«¯ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œå°†ç»“æœè¿›è¡Œè¿”å›åˆ°æœ¬åœ°ï¼Œæœ€ç»ˆå®Œæˆä¸€æ¬¡å®Œæ•´çš„è°ƒç”¨ã€‚</p>
<p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼š<strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æŒ‡çš„æ˜¯è°ƒç”¨è¿œç«¯æœåŠ¡å™¨ä¸Šçš„ç¨‹åºçš„æ–¹æ³•æ•´ä¸ªè¿‡ç¨‹ã€‚</strong></p>
<h3 id="rpcçš„ç»„æˆ">rpcçš„ç»„æˆ</h3>
<p>RPCæŠ€æœ¯åœ¨æ¶æ„è®¾è®¡ä¸Šæœ‰å››éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>å®¢æˆ·ç«¯ã€å®¢æˆ·ç«¯å­˜æ ¹ã€æœåŠ¡ç«¯ã€æœåŠ¡ç«¯å­˜æ ¹ã€‚</strong></p>
<p>è¿™é‡Œæåˆ°äº†<strong>å®¢æˆ·ç«¯</strong>å’Œ<strong>æœåŠ¡ç«¯</strong>çš„æ¦‚å¿µï¼Œå…¶å±äºç¨‹åºè®¾è®¡æ¶æ„çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨ç°ä»£çš„è®¡ç®—æœºè½¯ä»¶ç¨‹åºæ¶æ„è®¾è®¡ä¸Šï¼Œå¤§æ–¹å‘ä¸Šåˆ†ä¸ºä¸¤ç§æ–¹å‘ï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>B/Sæ¶æ„</strong>ã€<strong>C/Sæ¶æ„</strong>ã€‚B/Sæ¶æ„æŒ‡çš„æ˜¯æµè§ˆå™¨åˆ°æœåŠ¡å™¨äº¤äº’çš„æ¶æ„æ–¹å¼ï¼Œå¦å¤–ä¸€ç§æ˜¯åœ¨è®¡ç®—æœºä¸Šå®‰è£…ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ï¼Œç§°ä¹‹ä¸ºå®¢æˆ·ç«¯ï¼Œä¸æœåŠ¡å™¨äº¤äº’çš„æ¨¡å¼ã€‚</p>
<p>ç”±äºåœ¨æœåŠ¡çš„è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€æ–¹æ˜¯å‘èµ·è°ƒç”¨æ–¹ï¼Œå¦ä¸€æ–¹æ˜¯æä¾›æœåŠ¡æ–¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŠŠæœåŠ¡å‘èµ·æ–¹ç§°ä¹‹ä¸ºå®¢æˆ·ç«¯ï¼ŒæŠŠæœåŠ¡æä¾›æ–¹ç§°ä¹‹ä¸ºæœåŠ¡ç«¯ã€‚ä»¥ä¸‹æ˜¯å¯¹RPCçš„å››ç§è§’è‰²çš„è§£é‡Šå’Œè¯´æ˜ï¼š</p>
<ul>
<li>**å®¢æˆ·ç«¯(Client)ï¼š**æœåŠ¡è°ƒç”¨å‘èµ·æ–¹ï¼Œä¹Ÿç§°ä¸ºæœåŠ¡æ¶ˆè´¹è€…ã€‚</li>
<li>**å®¢æˆ·ç«¯å­˜æ ¹(Client Stub)ï¼š**è¯¥ç¨‹åºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ‰€åœ¨çš„è®¡ç®—æœºæœºå™¨ä¸Šï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨è¦è°ƒç”¨çš„æœåŠ¡å™¨çš„åœ°å€ï¼Œå¦å¤–ï¼Œè¯¥ç¨‹åºè¿˜è´Ÿè´£å°†å®¢æˆ·ç«¯è¯·æ±‚è¿œç«¯æœåŠ¡å™¨ç¨‹åºçš„æ•°æ®ä¿¡æ¯æ‰“åŒ…æˆæ•°æ®åŒ…ï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™æœåŠ¡ç«¯Stubç¨‹åºï¼›å…¶æ¬¡ï¼Œè¿˜è¦æ¥æ”¶æœåŠ¡ç«¯Stubç¨‹åºå‘é€çš„è°ƒç”¨ç»“æœæ•°æ®åŒ…ï¼Œå¹¶è§£æè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>**æœåŠ¡ç«¯(Server)ï¼š**è¿œç«¯çš„è®¡ç®—æœºæœºå™¨ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œå…¶ä¸­æœ‰å®¢æˆ·ç«¯è¦è°ƒç”¨çš„æ–¹æ³•ã€‚</li>
<li>**æœåŠ¡ç«¯å­˜æ ¹(Server Stub)ï¼š**æ¥æ”¶å®¢æˆ·Stubç¨‹åºé€šè¿‡ç½‘ç»œå‘é€çš„è¯·æ±‚æ¶ˆæ¯æ•°æ®åŒ…ï¼Œå¹¶è°ƒç”¨æœåŠ¡ç«¯ä¸­çœŸæ­£çš„ç¨‹åºåŠŸèƒ½æ–¹æ³•ï¼Œå®ŒæˆåŠŸèƒ½è°ƒç”¨ï¼›å…¶æ¬¡ï¼Œå°†æœåŠ¡ç«¯æ‰§è¡Œè°ƒç”¨çš„ç»“æœè¿›è¡Œæ•°æ®å¤„ç†æ‰“åŒ…å‘é€ç»™å®¢æˆ·ç«¯Stubç¨‹åºã€‚</li>
</ul>
<h3 id="rpcçš„åŸç†">rpcçš„åŸç†</h3>
<p>äº†è§£å®Œäº†RPCæŠ€æœ¯çš„ç»„æˆç»“æ„æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“æ˜¯å¦‚ä½•å®ç°å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è°ƒç”¨çš„ã€‚å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ç½‘ç»œä¸­çš„ä»»æ„ä¸¤å°è®¡ç®—æœºä¸Šå®ç°è¿œç¨‹è°ƒç”¨è¿‡ç¨‹ï¼Œè¦è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>ä¸¤å°ç‰©ç†æœºå™¨åœ¨ç½‘ç»œä¸­è¦å»ºç«‹ç¨³å®šå¯é çš„é€šä¿¡è¿æ¥ã€‚</li>
<li>ä¸¤å°æœåŠ¡å™¨çš„é€šä¿¡åè®®çš„å®šä¹‰é—®é¢˜ï¼Œå³ä¸¤å°æœåŠ¡å™¨ä¸Šçš„ç¨‹åºå¦‚ä½•è¯†åˆ«å¯¹æ–¹çš„è¯·æ±‚å’Œè¿”å›ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ä¸¤å°è®¡ç®—æœºå¿…é¡»éƒ½èƒ½å¤Ÿè¯†åˆ«å¯¹æ–¹å‘æ¥çš„ä¿¡æ¯ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¯†åˆ«å‡ºå…¶ä¸­çš„è¯·æ±‚å«ä¹‰å’Œè¿”å›å«ä¹‰ï¼Œç„¶åæ‰èƒ½è¿›è¡Œå¤„ç†ã€‚è¿™å…¶å®å°±æ˜¯é€šä¿¡åè®®æ‰€è¦å®Œæˆçš„å·¥ä½œã€‚</li>
</ul>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹RPCå…·ä½“æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼ŒRPCå…·ä½“çš„è°ƒç”¨æ­¥éª¤å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://7xtcwd.com1.z0.glb.clouddn.com/WX20190726-151825@2x.png"
	
	
	
	loading="lazy"
	
		alt="RPCè°ƒç”¨æ­¥éª¤å›¾"
	
	
></p>
<p>åœ¨ä¸Šè¿°å›¾ä¸­ï¼Œé€šè¿‡1-10çš„æ­¥éª¤å›¾è§£çš„å½¢å¼ï¼Œè¯´æ˜äº†RPCæ¯ä¸€æ­¥çš„è°ƒç”¨è¿‡ç¨‹ã€‚å…·ä½“æè¿°ä¸ºï¼š</p>
<ul>
<li>1ã€å®¢æˆ·ç«¯æƒ³è¦å‘èµ·ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé¦–å…ˆé€šè¿‡è°ƒç”¨æœ¬åœ°å®¢æˆ·ç«¯Stubç¨‹åºçš„æ–¹å¼è°ƒç”¨æƒ³è¦ä½¿ç”¨çš„åŠŸèƒ½æ–¹æ³•åï¼›</li>
<li>2ã€å®¢æˆ·ç«¯Stubç¨‹åºæ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„åŠŸèƒ½è°ƒç”¨è¯·æ±‚ï¼Œ<strong>å°†å®¢æˆ·ç«¯è¯·æ±‚è°ƒç”¨çš„æ–¹æ³•åï¼Œæºå¸¦çš„å‚æ•°ç­‰ä¿¡æ¯åšåºåˆ—åŒ–æ“ä½œï¼Œå¹¶æ‰“åŒ…æˆæ•°æ®åŒ…ã€‚</strong></li>
<li>3ã€å®¢æˆ·ç«¯StubæŸ¥æ‰¾åˆ°è¿œç¨‹æœåŠ¡å™¨ç¨‹åºçš„IPåœ°å€ï¼Œè°ƒç”¨Socketé€šä¿¡åè®®ï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™æœåŠ¡ç«¯ã€‚</li>
<li>4ã€æœåŠ¡ç«¯Stubç¨‹åºæ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åŒ…ä¿¡æ¯ï¼Œå¹¶<strong>é€šè¿‡çº¦å®šå¥½çš„åè®®å°†æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°è¯·æ±‚çš„æ–¹æ³•åå’Œè¯·æ±‚å‚æ•°ç­‰ä¿¡æ¯ã€‚</strong></li>
<li>5ã€æœåŠ¡ç«¯Stubç¨‹åºå‡†å¤‡ç›¸å…³æ•°æ®ï¼Œ<strong>è°ƒç”¨æœ¬åœ°Serverå¯¹åº”çš„åŠŸèƒ½æ–¹æ³•è¿›è¡Œï¼Œå¹¶ä¼ å…¥ç›¸åº”çš„å‚æ•°ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚</strong></li>
<li>6ã€æœåŠ¡ç«¯ç¨‹åºæ ¹æ®å·²æœ‰ä¸šåŠ¡é€»è¾‘æ‰§è¡Œè°ƒç”¨è¿‡ç¨‹ï¼Œå¾…ä¸šåŠ¡æ‰§è¡Œç»“æŸï¼Œå°†æ‰§è¡Œç»“æœè¿”å›ç»™æœåŠ¡ç«¯Stubç¨‹åºã€‚</li>
<li>7ã€æœåŠ¡ç«¯Stubç¨‹åº**å°†ç¨‹åºè°ƒç”¨ç»“æœæŒ‰ç…§çº¦å®šçš„åè®®è¿›è¡Œåºåˆ—åŒ–ï¼Œ**å¹¶é€šè¿‡ç½‘ç»œå‘é€å›å®¢æˆ·ç«¯Stubç¨‹åºã€‚</li>
<li>8ã€å®¢æˆ·ç«¯Stubç¨‹åºæ¥æ”¶åˆ°æœåŠ¡ç«¯Stubå‘é€çš„è¿”å›æ•°æ®ï¼Œ**å¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œ**å¹¶å°†è°ƒç”¨è¿”å›çš„æ•°æ®ä¼ é€’ç»™å®¢æˆ·ç«¯è¯·æ±‚å‘èµ·è€…ã€‚</li>
<li>9ã€å®¢æˆ·ç«¯è¯·æ±‚å‘èµ·è€…å¾—åˆ°è°ƒç”¨ç»“æœï¼Œæ•´ä¸ªRPCè°ƒç”¨è¿‡ç¨‹ç»“æŸã€‚</li>
</ul>
<h3 id="goå®ç°rpc">goå®ç°rpc</h3>
<p>åœ¨Goè¯­è¨€å®˜æ–¹ç½‘ç«™çš„pkgè¯´æ˜ä¸­ï¼Œæä¾›äº†å®˜æ–¹æ”¯æŒçš„rpcåŒ…ï¼Œå…·ä½“é“¾æ¥å¦‚ä¸‹ï¼šhttps://golang.org/pkg/net/rpc/ã€‚å®˜æ–¹æä¾›çš„rpcåŒ…å®Œæ•´çš„åŒ…åæ˜¯ï¼š<strong>net/rpc</strong>ã€‚æ ¹æ®å®˜æ–¹çš„è§£é‡Šï¼ŒrpcåŒ…ä¸»è¦æ˜¯æä¾›é€šè¿‡ç½‘ç»œè®¿é—®ä¸€ä¸ªå¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
<p>æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨goè¯­è¨€å®˜æ–¹æä¾›çš„RPCåŒ…å®ç°RPCè°ƒç”¨ç¼–ç ã€‚</p>
<h4 id="æœåŠ¡å®šä¹‰å’Œæš´éœ²">æœåŠ¡å®šä¹‰å’Œæš´éœ²</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="nf">MethodName</span><span class="p">(</span><span class="nx">request</span> <span class="nx">T1</span><span class="p">,</span><span class="nx">response</span> <span class="o">*</span><span class="nx">T2</span><span class="p">)</span> <span class="kt">error</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç æ˜¯goè¯­è¨€å®˜æ–¹ç»™å‡ºçš„å¯¹å¤–æš´éœ²çš„æœåŠ¡æ–¹æ³•çš„å®šä¹‰æ ‡å‡†ï¼Œå…¶ä¸­åŒ…å«äº†ä¸»è¦çš„å‡ æ¡è§„åˆ™ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>1ã€å¯¹å¤–æš´éœ²çš„æ–¹æ³•æœ‰ä¸”åªèƒ½æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œè¿™ä¸ªä¸¤ä¸ªå‚æ•°åªèƒ½æ˜¯è¾“å‡ºç±»å‹æˆ–å†…å»ºç±»å‹ï¼Œä¸¤ç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚</li>
<li>2ã€æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹ã€‚</li>
<li>3ã€æ–¹æ³•çš„è¿”å›ç±»å‹ä¸ºerrorã€‚</li>
<li>4ã€æ–¹æ³•çš„ç±»å‹æ˜¯å¯è¾“å‡ºçš„ã€‚</li>
<li>5ã€æ–¹æ³•æœ¬èº«ä¹Ÿæ˜¯å¯è¾“å‡ºçš„ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ï¼šå‡è®¾ç›®å‰æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œç»™å‡ºä¸€ä¸ªfloatç±»å‹å˜é‡ï¼Œä½œä¸ºåœ†å½¢çš„åŠå¾„ï¼Œè¦æ±‚é€šè¿‡RPCè°ƒç”¨ï¼Œè¿”å›å¯¹åº”çš„åœ†å½¢é¢ç§¯ã€‚å…·ä½“çš„ç¼–ç¨‹å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MathUtil</span> <span class="kd">struct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¯¥æ–¹æ³•å‘å¤–æš´éœ²ï¼šæä¾›è®¡ç®—åœ†å½¢é¢ç§¯çš„æœåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">mu</span> <span class="o">*</span><span class="nx">MathUtil</span><span class="p">)</span> <span class="nf">CalculateCircleArea</span><span class="p">(</span><span class="nx">req</span> <span class="kt">float32</span><span class="p">,</span> <span class="nx">resp</span> <span class="o">*</span><span class="kt">float32</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">resp</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">*</span> <span class="nx">req</span> <span class="o">*</span> <span class="nx">req</span> <span class="c1">//åœ†å½¢çš„é¢ç§¯ s = Ï€ * r * r
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="kc">nil</span> <span class="c1">//è¿”å›ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ³¨å†ŒæœåŠ¡å’Œç›‘å¬">æ³¨å†ŒæœåŠ¡å’Œç›‘å¬</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;math&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/rpc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MathUtil</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">MathUtil</span><span class="p">)</span><span class="nf">mathFunc</span><span class="p">(</span><span class="nx">req</span> <span class="kt">float32</span><span class="p">,</span><span class="nx">resp</span> <span class="o">*</span><span class="kt">float32</span><span class="p">)</span><span class="kt">error</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">resp</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">*</span> <span class="nx">req</span> <span class="o">*</span> <span class="nx">req</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//åˆå§‹åŒ–æŒ‡é’ˆç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">MathUtil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//æ³¨å†ŒæœåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">rpc</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//3ã€é€šè¿‡è¯¥å‡½æ•°æŠŠmathUtilä¸­æä¾›çš„æœåŠ¡æ³¨å†Œåˆ°HTTPåè®®ä¸Šï¼Œæ–¹ä¾¿è°ƒç”¨è€…å¯ä»¥åˆ©ç”¨httpçš„æ–¹å¼è¿›è¡Œæ•°æ®ä¼ é€’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">rpc</span><span class="p">.</span><span class="nf">HandleHTTP</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//4ã€åœ¨ç‰¹å®šç«¯å£ç›‘å¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">go</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">,</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»è¿‡æœåŠ¡æ³¨å†Œå’Œç›‘å¬å¤„ç†ï¼ŒRPCè°ƒç”¨è¿‡ç¨‹ä¸­çš„æœåŠ¡ç«¯å®ç°å°±å·²ç»å®Œæˆäº†ã€‚æ¥ä¸‹æ¥éœ€è¦å®ç°çš„æ˜¯å®¢æˆ·ç«¯è¯·æ±‚ä»£ç çš„å®ç°ã€‚</p>
<h4 id="å®¢æˆ·ç«¯è°ƒç”¨">å®¢æˆ·ç«¯è°ƒç”¨</h4>
<p>ä¸Šè¿°çš„è°ƒç”¨æ–¹æ³•æ ¸å¿ƒåœ¨äºclient.Callæ–¹æ³•çš„è°ƒç”¨ï¼Œè¯¥æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¦è°ƒç”¨çš„è¿œç«¯æœåŠ¡çš„æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨æ—¶è¦ä¼ å…¥çš„å‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è°ƒç”¨è¦æ¥æ”¶çš„è¿”å›å€¼ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/rpc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//è¿æ¥æœåŠ¡å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rpc</span><span class="p">.</span><span class="nf">DialHTTP</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;localhost:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">req</span> <span class="kt">float32</span> <span class="c1">//è¯·æ±‚å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">req</span> <span class="p">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">resp</span> <span class="kt">float32</span> <span class="c1">//è¿”å›å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//è°ƒç”¨æœåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">err</span> <span class="p">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Call</span><span class="p">(</span><span class="s">&#34;MathUtil.MathFunc&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å®¢æˆ·ç«¯å¼‚æ­¥è°ƒç”¨">å®¢æˆ·ç«¯å¼‚æ­¥è°ƒç”¨</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//è¿æ¥æœåŠ¡å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rpc</span><span class="p">.</span><span class="nf">DialHTTP</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;localhost:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">req</span> <span class="kt">float32</span> <span class="c1">//è¯·æ±‚å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">req</span> <span class="p">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">resp</span> <span class="kt">float32</span> <span class="c1">//è¿”å›å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//è°ƒç”¨æœåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">call</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="s">&#34;MathUtil.MathFunc&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">resp</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">replyDone</span> <span class="o">:=</span>  <span class="o">&lt;-</span><span class="nx">call</span><span class="p">.</span><span class="nx">Done</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">replyDone</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å¤šå‚æ•°ä¼ é€’">å¤šå‚æ•°ä¼ é€’</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AddParma</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Args1</span> <span class="kt">float32</span> <span class="c1">//ç¬¬ä¸€ä¸ªå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Args2</span> <span class="kt">float32</span> <span class="c1">//ç¬¬äºŒä¸ªå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">mu</span> <span class="o">*</span><span class="nx">MathUtil</span><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">param</span> <span class="nx">param</span><span class="p">.</span><span class="nx">AddParma</span><span class="p">,</span> <span class="nx">resp</span> <span class="o">*</span><span class="kt">float32</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">resp</span> <span class="p">=</span> <span class="nx">param</span><span class="p">.</span><span class="nx">Args1</span> <span class="o">+</span> <span class="nx">param</span><span class="p">.</span><span class="nx">Args2</span> <span class="c1">//å®ç°ä¸¤æ•°ç›¸åŠ çš„åŠŸèƒ½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">mathUtil</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">MathUtil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rpc</span><span class="p">.</span><span class="nf">RegisterName</span><span class="p">(</span><span class="s">&#34;MathUtil&#34;</span><span class="p">,</span> <span class="nx">mathUtil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">rpc</span><span class="p">.</span><span class="nf">HandleHTTP</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8082&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="rpcå’Œprotobuffer">rpcå’Œprotobuffer</h3>
<p>é¦–å…ˆå¯ä»¥å°†callå‡½æ•°ä¸­çš„reqå’Œrespéƒ½ç”¨protobufferç”Ÿæˆã€‚å…¶ä»–æ­¥éª¤ç±»ä¼¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="line"><span class="cl"><span class="n">syntax</span><span class="o">=</span><span class="s">&#34;proto3&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">option</span> <span class="n">go_package</span><span class="o">=</span><span class="s">&#34;./;rpcAndproto&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">message</span> <span class="nc">OrderRequest</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">orderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">int64</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">message</span> <span class="nc">OrderInfo</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderName</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderStatus</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="kd">service</span> <span class="n">OrderService</span><span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="k">rpc</span> <span class="n">GetOrderInfo</span><span class="p">(</span><span class="n">OrderRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">OrderInfo</span><span class="p">);</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Code generated by protoc-gen-go. DO NOT EDIT.
</span></span></span><span class="line"><span class="cl"><span class="c1">// versions:
</span></span></span><span class="line"><span class="cl"><span class="c1">// 	protoc-gen-go v1.28.0
</span></span></span><span class="line"><span class="cl"><span class="c1">// 	protoc        v3.20.0
</span></span></span><span class="line"><span class="cl"><span class="c1">// source: Order.proto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">rpcAndproto</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">protoreflect</span> <span class="s">&#34;google.golang.org/protobuf/reflect/protoreflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">protoimpl</span> <span class="s">&#34;google.golang.org/protobuf/runtime/protoimpl&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">reflect</span> <span class="s">&#34;reflect&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sync</span> <span class="s">&#34;sync&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Verify that this generated code is sufficiently up-to-date.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_</span> <span class="p">=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nf">EnforceVersion</span><span class="p">(</span><span class="mi">20</span> <span class="o">-</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MinVersion</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Verify that runtime/protoimpl is sufficiently up-to-date.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">_</span> <span class="p">=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nf">EnforceVersion</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MaxVersion</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è®¢å•è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">OrderRequest</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">state</span>         <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MessageState</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sizeCache</span>     <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">SizeCache</span>
</span></span><span class="line"><span class="cl">	<span class="nx">unknownFields</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnknownFields</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">OrderId</span>   <span class="kt">string</span> <span class="s">`protobuf:&#34;bytes,1,opt,name=orderId,proto3&#34; json:&#34;orderId,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TimeStamp</span> <span class="kt">int64</span>  <span class="s">`protobuf:&#34;varint,2,opt,name=timeStamp,proto3&#34; json:&#34;timeStamp,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">x</span> <span class="p">=</span> <span class="nx">OrderRequest</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">mi</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">file_Order_proto_msgTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStateOf</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span><span class="p">.</span><span class="nf">StoreMessageInfo</span><span class="p">(</span><span class="nx">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStringOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">ProtoMessage</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">ProtoReflect</span><span class="p">()</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">Message</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mi</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">file_Order_proto_msgTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStateOf</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ms</span><span class="p">.</span><span class="nf">LoadMessageInfo</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ms</span><span class="p">.</span><span class="nf">StoreMessageInfo</span><span class="p">(</span><span class="nx">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">ms</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">mi</span><span class="p">.</span><span class="nf">MessageOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Deprecated: Use OrderRequest.ProtoReflect.Descriptor instead.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">Descriptor</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">file_Order_proto_rawDescGZIP</span><span class="p">(),</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">GetOrderId</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">OrderId</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">GetTimeStamp</span><span class="p">()</span> <span class="kt">int64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">TimeStamp</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è®¢å•ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">OrderInfo</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">state</span>         <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MessageState</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sizeCache</span>     <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">SizeCache</span>
</span></span><span class="line"><span class="cl">	<span class="nx">unknownFields</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnknownFields</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">OrderId</span>     <span class="kt">string</span> <span class="s">`protobuf:&#34;bytes,1,opt,name=OrderId,proto3&#34; json:&#34;OrderId,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">OrderName</span>   <span class="kt">string</span> <span class="s">`protobuf:&#34;bytes,2,opt,name=OrderName,proto3&#34; json:&#34;OrderName,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">OrderStatus</span> <span class="kt">string</span> <span class="s">`protobuf:&#34;bytes,3,opt,name=OrderStatus,proto3&#34; json:&#34;OrderStatus,omitempty&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">*</span><span class="nx">x</span> <span class="p">=</span> <span class="nx">OrderInfo</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">mi</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">file_Order_proto_msgTypes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStateOf</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span><span class="p">.</span><span class="nf">StoreMessageInfo</span><span class="p">(</span><span class="nx">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStringOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">ProtoMessage</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">ProtoReflect</span><span class="p">()</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">Message</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mi</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">file_Order_proto_msgTypes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ms</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">MessageStateOf</span><span class="p">(</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ms</span><span class="p">.</span><span class="nf">LoadMessageInfo</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ms</span><span class="p">.</span><span class="nf">StoreMessageInfo</span><span class="p">(</span><span class="nx">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">ms</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">mi</span><span class="p">.</span><span class="nf">MessageOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Deprecated: Use OrderInfo.ProtoReflect.Descriptor instead.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">Descriptor</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">file_Order_proto_rawDescGZIP</span><span class="p">(),</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">GetOrderId</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">OrderId</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">GetOrderName</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">OrderName</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="nf">GetOrderStatus</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">OrderStatus</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">File_Order_proto</span> <span class="nx">protoreflect</span><span class="p">.</span><span class="nx">FileDescriptor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_Order_proto_rawDesc</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0x33</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_Order_proto_rawDescOnce</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_Order_proto_rawDescData</span> <span class="p">=</span> <span class="nx">file_Order_proto_rawDesc</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">file_Order_proto_rawDescGZIP</span><span class="p">()</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_Order_proto_rawDescOnce</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">file_Order_proto_rawDescData</span> <span class="p">=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nf">CompressGZIP</span><span class="p">(</span><span class="nx">file_Order_proto_rawDescData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">file_Order_proto_rawDescData</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_Order_proto_msgTypes</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">MessageInfo</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_Order_proto_goTypes</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">	<span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span> <span class="c1">// 0: OrderRequest
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>    <span class="c1">// 1: OrderInfo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">file_Order_proto_depIdxs</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">int32</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="mi">0</span><span class="p">,</span> <span class="c1">// 0: OrderService.GetOrderInfo:input_type -&gt; OrderRequest
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">1</span><span class="p">,</span> <span class="c1">// 1: OrderService.GetOrderInfo:output_type -&gt; OrderInfo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">1</span><span class="p">,</span> <span class="c1">// [1:2] is the sub-list for method output_type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:1] is the sub-list for method input_type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for extension type_name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for extension extendee
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mi">0</span><span class="p">,</span> <span class="c1">// [0:0] is the sub-list for field type_name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> <span class="nf">file_Order_proto_init</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">file_Order_proto_init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">File_Order_proto</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">protoimpl</span><span class="p">.</span><span class="nx">UnsafeEnabled</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">file_Order_proto_msgTypes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Exporter</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">v</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">switch</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">);</span> <span class="nx">i</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">state</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">sizeCache</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">unknownFields</span>
</span></span><span class="line"><span class="cl">			<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">file_Order_proto_msgTypes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">Exporter</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">v</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">switch</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">);</span> <span class="nx">i</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">state</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">sizeCache</span>
</span></span><span class="line"><span class="cl">			<span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="o">&amp;</span><span class="nx">v</span><span class="p">.</span><span class="nx">unknownFields</span>
</span></span><span class="line"><span class="cl">			<span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">type</span> <span class="nx">x</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">out</span> <span class="o">:=</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">TypeBuilder</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">File</span><span class="p">:</span> <span class="nx">protoimpl</span><span class="p">.</span><span class="nx">DescBuilder</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">GoPackagePath</span><span class="p">:</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">x</span><span class="p">{}).</span><span class="nf">PkgPath</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">RawDescriptor</span><span class="p">:</span> <span class="nx">file_Order_proto_rawDesc</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumEnums</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumMessages</span><span class="p">:</span>   <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumExtensions</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">NumServices</span><span class="p">:</span>   <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">GoTypes</span><span class="p">:</span>           <span class="nx">file_Order_proto_goTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">DependencyIndexes</span><span class="p">:</span> <span class="nx">file_Order_proto_depIdxs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MessageInfos</span><span class="p">:</span>      <span class="nx">file_Order_proto_msgTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}.</span><span class="nf">Build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">File_Order_proto</span> <span class="p">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">File</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_Order_proto_rawDesc</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_Order_proto_goTypes</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nx">file_Order_proto_depIdxs</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœåŠ¡å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/rpcAndproto&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/rpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">OrderService</span><span class="p">)</span> <span class="nf">GetAccount</span><span class="p">(</span><span class="nx">request</span> <span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">,</span><span class="nx">response</span> <span class="o">*</span><span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">orderMap</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907300001&#34;</span><span class="p">:</span> <span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907300001&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;è¡£æœ&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;å·²ä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907310001&#34;</span><span class="p">:</span> <span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310001&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;é›¶é£Ÿ&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;å·²ä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907310002&#34;</span><span class="p">:</span> <span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310002&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;é£Ÿå“&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;æœªä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">current</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">TimeStamp</span> <span class="p">&gt;</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">*</span><span class="nx">response</span> <span class="p">=</span> <span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;0&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;è®¢å•ä¿¡æ¯å¼‚å¸¸&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="o">:=</span> <span class="nx">orderMap</span><span class="p">[</span><span class="nx">request</span><span class="p">.</span><span class="nx">OrderId</span><span class="p">]</span><span class="c1">//201907310003
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">result</span><span class="p">.</span><span class="nx">OrderId</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="nx">response</span> <span class="p">=</span> <span class="nx">orderMap</span><span class="p">[</span><span class="nx">request</span><span class="p">.</span><span class="nx">OrderId</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;server error&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">o</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderService</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">rpc</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rpc</span><span class="p">.</span><span class="nf">HandleHTTP</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">http</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">,</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®¢æˆ·ç«¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/rpcAndproto&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/rpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rpc</span><span class="p">.</span><span class="nf">DialHTTP</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;localhost:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">timeStamp</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">request</span> <span class="o">:=</span> <span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310001&#34;</span><span class="p">,</span> <span class="nx">TimeStamp</span><span class="p">:</span> <span class="nx">timeStamp</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">response</span> <span class="o">*</span><span class="nx">rpcAndproto</span><span class="p">.</span><span class="nx">OrderInfo</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Call</span><span class="p">(</span><span class="s">&#34;OrderService.GetAccount&#34;</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆè¯†grpc">åˆè¯†grpc</h2>
<h3 id="å¾—åˆ°grpc">å¾—åˆ°grpc</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">go</span> <span class="nx">get</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">google</span><span class="p">.</span><span class="nx">golang</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">grpc</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="grpcçš„ä½¿ç”¨">grpcçš„ä½¿ç”¨</h3>
<p>æˆ‘ä»¬æƒ³è¦å®ç°çš„æ˜¯é€šè¿‡gRPCæ¡†æ¶è¿›è¡Œè¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥åº”è¯¥æ˜¯è¦æœ‰æœåŠ¡ã€‚åˆ©ç”¨ä¹‹å‰æ‰€æŒæ¡çš„å†…å®¹ï¼ŒgRPCæ¡†æ¶æ”¯æŒå¯¹æœåŠ¡çš„å®šä¹‰å’Œç”Ÿæˆã€‚
gRPCæ¡†æ¶é»˜è®¤ä½¿ç”¨protocol buffersä½œä¸ºæ¥å£å®šä¹‰è¯­è¨€ï¼Œç”¨äºæè¿°ç½‘ç»œä¼ è¾“æ¶ˆæ¯ç»“æ„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨protobufå®šä¹‰æœåŠ¡æ¥å£ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">syntax</span> <span class="p">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è®¢å•è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">message</span> <span class="nx">OrderRequest</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="nx">orderId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int64</span> <span class="nx">timeStamp</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è®¢å•ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">message</span> <span class="nx">OrderInfo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="nx">OrderId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="nx">OrderName</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="nx">OrderStatus</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è®¢å•æœåŠ¡serviceå®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">service</span> <span class="nx">OrderService</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rpc</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="nf">returns</span> <span class="p">(</span><span class="nx">OrderInfo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="grpcç¼–è¯‘æ”¯æŒ">gRPCç¼–è¯‘æ”¯æŒ</h4>
<p>å¦‚æœå®šä¹‰çš„.protoæ–‡ä»¶ï¼Œå¦‚æœ¬æ¡ˆä¾‹ä¸­æ‰€ç¤ºï¼Œå®šä¹‰ä¸­åŒ…å«äº†æœåŠ¡æ¥å£çš„å®šä¹‰ï¼Œè€Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨gRPCæ¡†æ¶å®ç°RPCè°ƒç”¨ã€‚å¼€å‘è€…å¯ä»¥é‡‡ç”¨protocol-gen-goåº“æä¾›çš„æ’ä»¶ç¼–è¯‘åŠŸèƒ½ï¼Œç”Ÿæˆå…¼å®¹gRPCæ¡†æ¶çš„golangè¯­è¨€ä»£ç ã€‚åªéœ€è¦åœ¨åŸºæœ¬ç¼–è¯‘å‘½ä»¤çš„åŸºç¡€ä¸Šï¼ŒæŒ‡å®šæ’ä»¶çš„å‚æ•°ï¼Œå‘ŠçŸ¥protocç¼–è¯‘å™¨å³å¯ã€‚å…·ä½“çš„ç¼–è¯‘ç”Ÿæˆå…¼å®¹gRPCæ¡†æ¶çš„æœåŠ¡ä»£ç çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">protoc --go_out<span class="o">=</span><span class="nv">plugins</span><span class="o">=</span>grpc:. *.proto
</span></span></code></pre></td></tr></table>
</div>
</div><p>pb.goç”Ÿæˆçš„å®¢æˆ·ç«¯æ–¹æ³•ä»£ç ï¼Œç»™äº†ç”Ÿæˆå®¢æˆ·ç«¯çš„æ–¹æ³•ï¼Œç»™äº†è°ƒç”¨æœåŠ¡çš„æ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// OrderServiceClient is the client API for OrderService service.
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// For semantics around ctx use and closing/ending streaming RPCs, please refer to https://godoc.org/google.golang.org/grpc#ClientConn.NewStream.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">OrderServiceClient</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceClient</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cc</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConnInterface</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">cc</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConnInterface</span><span class="p">)</span> <span class="nx">OrderServiceClient</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">orderServiceClient</span><span class="p">{</span><span class="nx">cc</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">orderServiceClient</span><span class="p">)</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">out</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cc</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;/OrderService/GetOrderInfo&#34;</span><span class="p">,</span> <span class="nx">in</span><span class="p">,</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">out</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>pb.goç”Ÿæˆçš„æœåŠ¡å™¨æ–¹æ³•ä»£ç ï¼Œæä¾›äº†æ³¨å†Œå·²å®ç°OrderServiceæ¥å£çš„æ–¹æ³•ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ²¡æœ‰å®ç°æ–¹æ³•çš„ç±»ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// OrderServiceServer is the server API for OrderService service.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">OrderServiceServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// UnimplementedOrderServiceServer can be embedded to have forward compatible implementations.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UnimplementedOrderServiceServer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">UnimplementedOrderServiceServer</span><span class="p">)</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unimplemented</span><span class="p">,</span> <span class="s">&#34;method GetOrderInfo not implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">Server</span><span class="p">,</span> <span class="nx">srv</span> <span class="nx">OrderServiceServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">RegisterService</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">_OrderService_serviceDesc</span><span class="p">,</span> <span class="nx">srv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®ç°rpcæœåŠ¡">å®ç°rpcæœåŠ¡</h4>
<p>åœ¨ä¸Šé¢çš„protoæ–‡ä»¶ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¹¶æ²¡æœ‰æ–¹æ³•ä½“ï¼Œç±»ä¼¼äºæ¥å£ï¼Œæˆ‘ä»¬è¦å®ç°è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>å¯¹äºå®ç°çš„æ–¹æ³•ï¼Œå‚æ•°ä¼šå¯¹åº”çš„æ”¹å˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">os</span> <span class="o">*</span><span class="nx">OrderServiceImpl</span><span class="p">)</span><span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="nx">request</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">)(</span><span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">,</span><span class="kt">error</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blog/C:%5cUsers%5cMyHope%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220408104515526.png"
	
	
	
	loading="lazy"
	
		alt="image-20220408104515526"
	
	
></p>
<h4 id="grpcå®ç°æœåŠ¡å™¨">grpcå®ç°æœåŠ¡å™¨</h4>
<p>è¿™é‡Œç”±äºæˆ‘çš„åŒ…åè®¾ç½®æˆäº†grpcï¼ˆæ–¹ä¾¿å¤ä¹ ï¼‰ï¼Œæ‰€ä»¥å°†googleçš„grpcèµ·åˆ«åæˆäº†Grpc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nx">Grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span><span class="nb">new</span><span class="p">(</span><span class="nx">OrderServiceImpl</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="grpcå®ç°å®¢æˆ·ç«¯">grpcå®ç°å®¢æˆ·ç«¯</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;golang.org/x/net/context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Grpc</span> <span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">Grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">Grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ä»protoä¸­è·å¾—è¿æ¥æœåŠ¡çš„å®¢æˆ·ç«¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">client</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">OrderId</span><span class="p">:</span>   <span class="s">&#34;201907300001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">TimeStamp</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">info</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">info</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nf">GetOrderId</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nf">GetOrderName</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nf">GetOrderStatus</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="grpcçš„æµæ¨¡å¼">grpcçš„æµæ¨¡å¼</h3>
<p>åœ¨ä¸ŠèŠ‚è¯¾å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä½¿ç”¨gRPCæ¡†æ¶å®ç°æœåŠ¡çš„è°ƒç”¨ç¼–ç¨‹ã€‚åœ¨gRPCæ¡†æ¶ä¸­ï¼Œè¯¸å¦‚ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ çš„åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´é€šè¿‡æ¶ˆæ¯ç»“æ„ä½“å®šä¹‰çš„æ–¹å¼æ¥ä¼ é€’æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå•é¡¹RPCâ€ï¼Œä¹Ÿç§°ä¹‹ä¸ºç®€å•æ¨¡å¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒgRPCä¸­è¿˜æœ‰<strong>æ•°æ®æµæ¨¡å¼</strong>çš„RPCè°ƒç”¨å®ç°ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æœ¬èŠ‚è¯¾è¦å­¦ä¹ çš„å†…å®¹ã€‚</p>
<h4 id="æœåŠ¡å™¨æµå½¢å¼">æœåŠ¡å™¨æµå½¢å¼</h4>
<h5 id="å®šä¹‰protoæ–‡ä»¶">å®šä¹‰protoæ–‡ä»¶</h5>
<p>è¿™ä¸€æ¬¡çš„protoæ–‡ä»¶å’Œä¸Šä¸€ä¸ªCsæ¨¡å¼çš„æœ‰äº›è®¸ä¸åŒï¼Œreturnçš„å¸¦æœ‰stream</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="line"><span class="cl"><span class="kd">service</span> <span class="n">OrderService</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="k">rpc</span> <span class="n">GetOrderInfos</span> <span class="p">(</span><span class="n">OrderRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">OrderInfo</span><span class="p">)</span> <span class="p">{};</span> <span class="c1">//æœåŠ¡ç«¯æµæ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡streamä¿®é¥°çš„æ–¹å¼è¡¨ç¤ºè¯¥æ¥å£è°ƒç”¨æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šä»¥æ•°æ®æµçš„å½¢å¼å°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">protoc --go_out<span class="o">=</span><span class="nv">plugins</span><span class="o">=</span>grpc:. ./*.proto
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆçš„æ–‡ä»¶ä¹Ÿä¼šæœ‰äº›è®¸ä¸åŒã€‚</p>
<p>å¯¹äºæ–¹æ³•æ–¹é¢ï¼Œå®¢æˆ·ç«¯å¦‚ä¸‹ï¼Œå‘ç°ç›¸è¾ƒäºä¸Šé¢çš„éæµä¼ è¾“ï¼Œå¤šäº†ä¸€ä¸ªrecvå‡½æ•°ï¼Œè¿™ä¸ªåº”è¯¥æ—¶ç”¨æ¥æ¥å—æœåŠ¡å™¨ä¼ è¿‡æ¥çš„OrderInfo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">cc</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConnInterface</span><span class="p">)</span> <span class="nx">OrderServiceClient</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">orderServiceClient</span><span class="p">{</span><span class="nx">cc</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">orderServiceClient</span><span class="p">)</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="nx">OrderService_GetOrderInfoClient</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cc</span><span class="p">.</span><span class="nf">NewStream</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">_OrderService_serviceDesc</span><span class="p">.</span><span class="nx">Streams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#34;/OrderService/GetOrderInfo&#34;</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">x</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">orderServiceGetOrderInfoClient</span><span class="p">{</span><span class="nx">stream</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">in</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">CloseSend</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfoClient</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceGetOrderInfoClient</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfoClient</span><span class="p">)</span> <span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">RecvMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœåŠ¡å™¨è¿™è¾¹ä¹Ÿæ˜¯ï¼Œå¤šäº†ä¸€ä¸ªsendæ–¹æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// OrderServiceServer is the server API for OrderService service.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">OrderServiceServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GetOrderInfo</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="nx">OrderService_GetOrderInfoServer</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// UnimplementedOrderServiceServer can be embedded to have forward compatible implementations.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UnimplementedOrderServiceServer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">UnimplementedOrderServiceServer</span><span class="p">)</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="nx">OrderService_GetOrderInfoServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unimplemented</span><span class="p">,</span> <span class="s">&#34;method GetOrderInfo not implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">Server</span><span class="p">,</span> <span class="nx">srv</span> <span class="nx">OrderServiceServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">RegisterService</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">_OrderService_serviceDesc</span><span class="p">,</span> <span class="nx">srv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">_OrderService_GetOrderInfo_Handler</span><span class="p">(</span><span class="nx">srv</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">stream</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">RecvMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">srv</span><span class="p">.(</span><span class="nx">OrderServiceServer</span><span class="p">).</span><span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">orderServiceGetOrderInfoServer</span><span class="p">{</span><span class="nx">stream</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfoServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Send</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceGetOrderInfoServer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfoServer</span><span class="p">)</span> <span class="nf">Send</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="æœåŠ¡å™¨">æœåŠ¡å™¨</h5>
<p>ç”±äºæœåŠ¡å™¨ç”¨çš„æµå½¢å¼å›ä¼ ï¼Œæ‰€ä»¥å‚æ•°ä¸­å¸¦æœ‰OrderService_GetOrderInfoServerè¿™ä¸ªå«æœ‰sendæ–¹æ³•çš„æ¥å£ï¼Œç”¨äºä¼ è¾“æµã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfoServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Send</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">os</span> <span class="o">*</span><span class="nx">OrderServiceImpl</span><span class="p">)</span> <span class="nf">GetOrderInfos</span><span class="p">(</span><span class="nx">request</span> <span class="o">*</span><span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="nx">stream</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderService_GetOrderInfoServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; æœåŠ¡ç«¯æµ RPC æ¨¡å¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">orderMap</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907300001&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907300001&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;è¡£æœ&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;å·²ä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907310001&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310001&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;é›¶é£Ÿ&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;å·²ä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907310002&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310002&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;é£Ÿå“&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;æœªä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">orderMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">TimeStamp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;è®¢å•åºåˆ—å·IDï¼š&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;è®¢å•è¯¦æƒ…ï¼š&#34;</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//é€šè¿‡æµæ¨¡å¼å‘é€ç»™å®¢æˆ·ç«¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœåŠ¡çš„ç›‘å¬ä¸å¤„ç†ä¸å‰æ–‡æ‰€å­¦å†…å®¹æ²¡æœ‰åŒºåˆ«ï¼Œä¾ç„¶æ˜¯ç›¸åŒçš„æ­¥éª¤:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">streamRpc</span><span class="p">.</span><span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span><span class="nb">new</span><span class="p">(</span><span class="nx">OrderServiceImpl</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h5>
<p>æœåŠ¡ç«¯ä½¿ç”¨Sendæ–¹æ³•å°†æ•°æ®ä»¥æµçš„å½¢å¼è¿›è¡Œå‘é€ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨Recv()æ–¹æ³•æ¥æ”¶æµæ•°æ®,<strong>å› ä¸ºæ•°æ®æµå¤±æºæºä¸æ–­çš„</strong>ï¼Œå› æ­¤ä½¿ç”¨foræ— é™å¾ªç¯å®ç°æ•°æ®æµçš„è¯»å–ï¼Œå½“è¯»å–åˆ°io.EOFæ—¶ï¼Œè¡¨ç¤ºæµæ•°æ®ç»“æŸã€‚å®¢æˆ·ç«¯æ•°æ®è¯»å–å®ç°å¦‚ä¸‹</p>
<p>å…ˆè¿˜æ˜¯æ‹¨å·åˆ°æŒ‡å®šç«¯å£ï¼Œç„¶åå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªclientè°ƒç”¨æœåŠ¡ï¼ŒæœåŠ¡ä¼šè¿”å›ä¸€ä¸ªOrderService_GetOrderInfoClientï¼Œè¯¥æ¥å£å®ç°äº†Recvï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨Recvæ–¹æ³•æ¥å—ä¿¡æ¯å³å¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/streamRpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;io&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">client</span> <span class="o">:=</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">OrderId</span><span class="p">:</span>   <span class="s">&#34;201907300001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">TimeStamp</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;è¯»å–çš„æ¶ˆæ¯:&#34;</span><span class="p">,</span><span class="nx">recv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®¢æˆ·ç«¯æµæ¨¡å¼">å®¢æˆ·ç«¯æµæ¨¡å¼</h4>
<h5 id="å®šä¹‰protoæ–‡ä»¶-1">å®šä¹‰protoæ–‡ä»¶</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="line"><span class="cl"><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">option</span> <span class="n">go_package</span><span class="o">=</span><span class="s">&#34;./;streamRpc&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">message</span> <span class="nc">OrderRequest</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">orderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">int64</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">message</span> <span class="nc">OrderInfo</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderName</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderStatus</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="kd">service</span> <span class="n">OrderService</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="k">rpc</span> <span class="n">AddOrderList</span> <span class="p">(</span><span class="n">stream</span> <span class="n">OrderRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">OrderInfo</span><span class="p">)</span> <span class="p">{};</span> <span class="c1">//å®¢æˆ·ç«¯æµæ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆçš„å®¢æˆ·ç«¯æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderServiceClient</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="nx">OrderService_GetOrderInfoClient</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceClient</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">cc</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConnInterface</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">cc</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConnInterface</span><span class="p">)</span> <span class="nx">OrderServiceClient</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">orderServiceClient</span><span class="p">{</span><span class="nx">cc</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">orderServiceClient</span><span class="p">)</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="nx">OrderService_GetOrderInfoClient</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cc</span><span class="p">.</span><span class="nf">NewStream</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">_OrderService_serviceDesc</span><span class="p">.</span><span class="nx">Streams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#34;/OrderService/GetOrderInfo&#34;</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">x</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">orderServiceGetOrderInfoClient</span><span class="p">{</span><span class="nx">stream</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfoClient</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Send</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nf">CloseAndRecv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceGetOrderInfoClient</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfoClient</span><span class="p">)</span> <span class="nf">Send</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfoClient</span><span class="p">)</span> <span class="nf">CloseAndRecv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">CloseSend</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">RecvMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>SendAndCloseå’ŒRecvæ–¹æ³•æ˜¯å®¢æˆ·ç«¯æµæ¨¡å¼ä¸‹çš„æœåŠ¡ç«¯å¯¹è±¡æ‰€æ‹¥æœ‰çš„æ–¹æ³•ã€‚</p>
<p>æœåŠ¡å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderServiceServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">OrderService_GetOrderInfoServer</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// UnimplementedOrderServiceServer can be embedded to have forward compatible implementations.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UnimplementedOrderServiceServer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">UnimplementedOrderServiceServer</span><span class="p">)</span> <span class="nf">GetOrderInfo</span><span class="p">(</span><span class="nx">OrderService_GetOrderInfoServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unimplemented</span><span class="p">,</span> <span class="s">&#34;method GetOrderInfo not implemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">Server</span><span class="p">,</span> <span class="nx">srv</span> <span class="nx">OrderServiceServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">RegisterService</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">_OrderService_serviceDesc</span><span class="p">,</span> <span class="nx">srv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">_OrderService_GetOrderInfo_Handler</span><span class="p">(</span><span class="nx">srv</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">stream</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">srv</span><span class="p">.(</span><span class="nx">OrderServiceServer</span><span class="p">).</span><span class="nf">GetOrderInfo</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">orderServiceGetOrderInfoServer</span><span class="p">{</span><span class="nx">stream</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfoServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">SendAndClose</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceGetOrderInfoServer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfoServer</span><span class="p">)</span> <span class="nf">SendAndClose</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfoServer</span><span class="p">)</span> <span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">.</span><span class="nf">RecvMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Sendå’ŒCloseAndRecvæ˜¯å®¢æˆ·ç«¯æµæ¨¡å¼ä¸‹çš„å®¢æˆ·ç«¯å¯¹è±¡æ‰€æ‹¥æœ‰çš„æ–¹æ³•ã€‚</p>
<h5 id="æœåŠ¡å™¨å®ç°">æœåŠ¡å™¨å®ç°</h5>
<p>ç”±äºä¿¡æ¯å…¨åœ¨æµä¸­ï¼Œæ‰€ä»¥ä¸éœ€è¦reqäº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">os</span> <span class="o">*</span><span class="nx">OrderServiceImpl</span><span class="p">)</span> <span class="nf">AddOrderList</span><span class="p">(</span><span class="nx">stream</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderService_AddOrderListServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; å®¢æˆ·ç«¯ RPC æ¨¡å¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; è¯»å–æ•°æ®ç»“æŸ &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">result</span> <span class="o">:=</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34; è¯»å–æ•°æ®ç»“æŸ &#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">SendAndClose</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">recv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›‘å¬æœåŠ¡å™¨ä¾ç„¶å·®ä¸å¤š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">streamRpc</span><span class="p">.</span><span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span><span class="nb">new</span><span class="p">(</span><span class="nx">OrderServiceImpl</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å®¢æˆ·ç«¯å®ç°">å®¢æˆ·ç«¯å®ç°</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/streamRpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;io&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">orderMap</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907300001&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907300001&#34;</span><span class="p">,</span><span class="nx">TimeStamp</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907310001&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310001&#34;</span><span class="p">,</span> <span class="nx">TimeStamp</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()},</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;201907310002&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310002&#34;</span><span class="p">,</span> <span class="nx">TimeStamp</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Unix</span><span class="p">()},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">client</span> <span class="o">:=</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">AddOrderList</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//è°ƒç”¨æ–¹æ³•å‘é€æµæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">orderMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">orderInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">CloseAndRecv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; è¯»å–æ•°æ®ç»“æŸäº† &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">orderInfo</span><span class="p">.</span><span class="nf">GetOrderStatus</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªäº¤äº’ç±»ä¼¼äºï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡recvæ¥æ”¶ç„¶åè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œç„¶åé€šè¿‡sendAndCloseè¿›è¡Œå›ä¼ ç»“æœï¼Œclienté€šè¿‡sendå‘é€æµä¿¡æ¯ï¼Œç„¶åé€šè¿‡CloseAndReciveæ¥å—æ¶ˆæ¯ã€‚</p>
<h4 id="åŒå‘æµæ¨¡å¼">åŒå‘æµæ¨¡å¼</h4>
<h5 id="å®šä¹‰protoæ–‡ä»¶-2">å®šä¹‰protoæ–‡ä»¶</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="line"><span class="cl"><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">option</span> <span class="n">go_package</span><span class="o">=</span><span class="s">&#34;./;streamRpc&#34;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•è¯·æ±‚å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">message</span> <span class="nc">OrderRequest</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">orderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">int64</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">message</span> <span class="nc">OrderInfo</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderName</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="kt">string</span> <span class="n">OrderStatus</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="p">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c1">//è®¢å•æœåŠ¡serviceå®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">service</span> <span class="n">OrderService</span> <span class="p">{</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  <span class="k">rpc</span> <span class="n">GetOrderInfos</span> <span class="p">(</span><span class="n">stream</span> <span class="n">OrderRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">OrderInfo</span><span class="p">)</span> <span class="p">{};</span> <span class="c1">//åŒå‘æµæ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®¢æˆ·ç«¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfosClient</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Send</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceGetOrderInfosClient</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfosClient</span><span class="p">)</span> <span class="nf">Send</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">OrderRequest</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfosClient</span><span class="p">)</span> <span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ClientStream</span><span class="p">.</span><span class="nf">RecvMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœåŠ¡å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderService_GetOrderInfosServer</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Send</span><span class="p">(</span><span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">orderServiceGetOrderInfosServer</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grpc</span><span class="p">.</span><span class="nx">ServerStream</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfosServer</span><span class="p">)</span> <span class="nf">Send</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">OrderInfo</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span><span class="nx">orderServiceGetOrderInfosServer</span><span class="p">)</span> <span class="nf">Recv</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">OrderRequest</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">OrderRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">ServerStream</span><span class="p">.</span><span class="nf">RecvMsg</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å‘ç°æ— è®ºæ˜¯æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½å¢åŠ äº†recvå’Œsendæ–¹æ³•ã€‚</p>
<h5 id="æœåŠ¡å™¨å®ç°-1">æœåŠ¡å™¨å®ç°</h5>
<p>å‚æ•°æ˜¯å®ç°äº†recvå’Œsendçš„æ¥å£ï¼Œå¯ä»¥å‘ç°recvå’Œsendéƒ½æ”¾åˆ°äº†åŒä¸€ä¸ªforä¸­ï¼Œå¦‚æœè¯»å–ç»“æŸè‡ªåŠ¨break</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/streamRpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;io&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">OrderServiceImpl</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å®ç°grpcåŒå‘æµæ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">os</span> <span class="o">*</span><span class="nx">OrderServiceImpl</span><span class="p">)</span> <span class="nf">GetOrderInfos</span><span class="p">(</span><span class="nx">stream</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderService_GetOrderInfosServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">orderRequest</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; æ•°æ®è¯»å–ç»“æŸ &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">orderRequest</span><span class="p">.</span><span class="nf">GetOrderId</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="nx">orderMap</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;201907300001&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907300001&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;è¡£æœ&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;å·²ä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;201907310001&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310001&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;é›¶é£Ÿ&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;å·²ä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;201907310002&#34;</span><span class="p">:</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderInfo</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="s">&#34;201907310002&#34;</span><span class="p">,</span> <span class="nx">OrderName</span><span class="p">:</span> <span class="s">&#34;é£Ÿå“&#34;</span><span class="p">,</span> <span class="nx">OrderStatus</span><span class="p">:</span> <span class="s">&#34;æœªä»˜æ¬¾&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="o">:=</span> <span class="nx">orderMap</span><span class="p">[</span><span class="nx">orderRequest</span><span class="p">.</span><span class="nf">GetOrderId</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//å‘é€æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">streamRpc</span><span class="p">.</span><span class="nf">RegisterOrderServiceServer</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span><span class="nb">new</span><span class="p">(</span><span class="nx">OrderServiceImpl</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å®¢æˆ·ç«¯å®ç°-1">å®¢æˆ·ç«¯å®ç°</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/streamRpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;io&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//1ã€Dailè¿æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">orderServiceClient</span> <span class="o">:=</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nf">NewOrderServiceClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;å®¢æˆ·ç«¯è¯·æ±‚RPCè°ƒç”¨ï¼šåŒå‘æµæ¨¡å¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">orderIDs</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;201907300001&#34;</span><span class="p">,</span> <span class="s">&#34;201907310001&#34;</span><span class="p">,</span> <span class="s">&#34;201907310002&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">orderInfoClient</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">orderServiceClient</span><span class="p">.</span><span class="nf">GetOrderInfos</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">orderID</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">orderIDs</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">orderRequest</span> <span class="o">:=</span> <span class="nx">streamRpc</span><span class="p">.</span><span class="nx">OrderRequest</span><span class="p">{</span><span class="nx">OrderId</span><span class="p">:</span> <span class="nx">orderID</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="o">:=</span> <span class="nx">orderInfoClient</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">orderRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//å…³é—­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">orderInfoClient</span><span class="p">.</span><span class="nf">CloseSend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">orderInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">orderInfoClient</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;è¯»å–ç»“æŸ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;è¯»å–åˆ°çš„ä¿¡æ¯ï¼š&#34;</span><span class="p">,</span> <span class="nx">orderInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="grpcéªŒè¯">grpcéªŒè¯</h3>
<p>gRPCä¸­é»˜è®¤æ”¯æŒä¸¤ç§æˆæƒæ–¹å¼,åˆ†åˆ«æ˜¯ï¼šSSL/TLSè®¤è¯æ–¹å¼ã€åŸºäºTokençš„è®¤è¯æ–¹å¼ã€‚</p>
<p>SSLå…¨ç§°æ˜¯Secure Sockets Layerï¼Œåˆè¢«ç§°ä¹‹ä¸ºå®‰å…¨å¥—æ¥å­—å±‚ï¼Œæ˜¯ä¸€ç§æ ‡å‡†å®‰å…¨åè®®ï¼Œç”¨äºåœ¨é€šä¿¡è¿‡ç¨‹ä¸­å»ºç«‹å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„åŠ å¯†é“¾æ¥ã€‚
TLSçš„å…¨ç§°æ˜¯Transport Layer Securityï¼ŒTLSæ˜¯SSLçš„å‡çº§ç‰ˆã€‚åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€ä¹ æƒ¯äºå°†SSLå’ŒTLSç»„åˆåœ¨ä¸€èµ·å†™ä½œSSL/TLSã€‚
ç®€è€Œè¨€ä¹‹ï¼ŒSSL/TLSæ˜¯ä¸€ç§ç”¨äºç½‘ç»œé€šä¿¡ä¸­åŠ å¯†çš„å®‰å…¨åè®®ã€‚</p>
<h4 id="åŸºäºtoken">åŸºäºtoken</h4>
<p>åœ¨gRPCä¸­ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰è‡ªå·±çš„è®¤è¯è§„åˆ™ï¼Œé€šè¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">WithPerRPCCredentials</span><span class="p">(</span><span class="nx">creds</span> <span class="nx">credentials</span><span class="p">.</span><span class="nx">PerRPCCredentials</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªPerRPCCredentialsæ¥å£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PerRPCCredentials</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// GetRequestMetadata gets the current request metadata, refreshing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// tokens if required. This should be called by the transport layer on
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// each request, and the data should be populated in headers or other
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// context. If a status code is returned, it will be used as the status
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// for the RPC. uri is the URI of the entry point for the request.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// When supported by the underlying implementation, ctx can be used for
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// timeout and cancellation. Additionally, RequestInfo data will be
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// available via ctx to this call.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// TODO(zhaoq): Define the set of the qualified keys instead of leaving
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// it as an arbitrary string.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">GetRequestMetadata</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">uri</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// RequireTransportSecurity indicates whether the credentials requires
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// transport security.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">RequireTransportSecurity</span><span class="p">()</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªç»“æ„ä½“å®ç°ä¸€ä¸‹å§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">TokenAuthentication</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ApiKey</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ApiSecret</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç»„ç»‡tokenä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TokenAuthentication</span><span class="p">)</span> <span class="nf">GetRequestMetadata</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">uri</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;apikey&#34;</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">ApiKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;apisecret&#34;</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">ApiSecret</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span><span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ˜¯å¦åŸºäºTLSè®¤è¯è¿›è¡Œå®‰å…¨ä¼ è¾“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TokenAuthentication</span><span class="p">)</span> <span class="nf">RequireTransportSecurity</span><span class="p">()</span>  <span class="kt">bool</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥åå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡tokenæ¥è®¿é—®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">auth</span> <span class="o">:=</span> <span class="nx">TokenAuthentication</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ApiKey</span><span class="p">:</span>    <span class="s">&#34;hello&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ApiSecret</span><span class="p">:</span> <span class="s">&#34;20190812&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dial</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithPerRPCCredentials</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">auth</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æœåŠ¡å™¨-1">æœåŠ¡å™¨</h4>
<p>è¿™é‡Œçš„æœåŠ¡å™¨é€šè¿‡metadata.FromIncomingContext(ctx)ï¼Œè·å¾—keyï¼Œsecretï¼Œç„¶åè¿›è¡Œæ ¡éªŒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/rpcToken&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;golang.org/x/net/context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc/codes&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc/metadata&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc/status&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MathManager</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">mm</span> <span class="o">*</span><span class="nx">MathManager</span><span class="p">)</span> <span class="nf">AddMethod</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">request</span> <span class="o">*</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">RequestArgs</span><span class="p">)</span> <span class="p">(</span><span class="nx">response</span> <span class="o">*</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">meta</span><span class="p">,</span> <span class="nx">exist</span> <span class="o">:=</span> <span class="nx">metadata</span><span class="p">.</span><span class="nf">FromIncomingContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">exist</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span><span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unauthenticated</span><span class="p">,</span><span class="s">&#34;æ— token&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">appKey</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">appSecret</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">key</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nx">meta</span><span class="p">[</span><span class="s">&#34;apikey&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ok</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">appKey</span> <span class="p">=</span> <span class="nx">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">secret</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nx">meta</span><span class="p">[</span><span class="s">&#34;apisecret&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ok</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">appSecret</span> <span class="p">=</span> <span class="nx">secret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">appKey</span><span class="p">,</span><span class="nx">appSecret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//æ§åˆ¶token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">appKey</span> <span class="o">!=</span> <span class="s">&#34;hello&#34;</span> <span class="o">||</span> <span class="nx">appSecret</span> <span class="o">!=</span> <span class="s">&#34;20190812&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unauthenticated</span><span class="p">,</span> <span class="s">&#34;Token ä¸åˆæ³•&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; æœåŠ¡ç«¯ Addæ–¹æ³• &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="o">:=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Args1</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Args2</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; è®¡ç®—ç»“æœæ˜¯ï¼š&#34;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">response</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">response</span><span class="p">.</span><span class="nx">Code</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">response</span><span class="p">.</span><span class="nx">Message</span> <span class="p">=</span> <span class="s">&#34;æ‰§è¡ŒæˆåŠŸ&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">response</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rpcToken</span><span class="p">.</span><span class="nf">RegisterMathServiceServer</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span><span class="nb">new</span><span class="p">(</span><span class="nx">MathManager</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®¢æˆ·ç«¯-1">å®¢æˆ·ç«¯</h4>
<p>è¦æ³¨æ„ grpc.Dial(&ldquo;localhost:8081&rdquo;, grpc.WithPerRPCCredentials(tk),grpc.WithInsecure())ï¼Œå¦‚æœåªç”¨tokenéœ€è¦ç”¨grpc.WithInsecure()</p>
<p>å¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;goTrip/rpcToken&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;goTrip/rpcToken/token&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">tk</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">token</span><span class="p">.</span><span class="nx">TokenAuthentication</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">ApiKey</span><span class="p">:</span>    <span class="s">&#34;hello&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">ApiSecret</span><span class="p">:</span> <span class="s">&#34;20190812&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nx">dial</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithPerRPCCredentials</span><span class="p">(</span><span class="nx">tk</span><span class="p">),</span><span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nx">client</span> <span class="o">:=</span> <span class="nx">rpcToken</span><span class="p">.</span><span class="nf">NewMathServiceClient</span><span class="p">(</span><span class="nx">dial</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">RequestArgs</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Args1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Args2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">AddMethod</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nf">GetCode</span><span class="p">(),</span><span class="nx">resp</span><span class="p">.</span><span class="nf">GetMessage</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="grpcæ‹¦æˆªå™¨">grpcæ‹¦æˆªå™¨</h3>
<p>åœ¨ä¸ŠèŠ‚è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ ä½¿ç”¨äº†gRPCæ¡†æ¶ä¸­çš„ä¸¤ç§è®¤è¯æ–¹å¼ï¼šTLSéªŒè¯å’ŒTokenéªŒè¯ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨æœåŠ¡ç«¯çš„æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¦è¿›è¡Œtokençš„åˆ¤æ–­ã€‚ç¨‹åºæ•ˆç‡å¤ªä½ï¼Œå¯ä»¥ä¼˜åŒ–ä¸€ä¸‹å¤„ç†é€»è¾‘ï¼Œåœ¨è°ƒç”¨æœåŠ¡ç«¯çš„å…·ä½“æ–¹æ³•ä¹‹å‰ï¼Œå…ˆè¿›è¡Œæ‹¦æˆªï¼Œå¹¶è¿›è¡ŒtokenéªŒè¯åˆ¤æ–­ï¼Œè¿™ç§æ–¹å¼ç§°ä¹‹ä¸ºæ‹¦æˆªå™¨å¤„ç†ã€‚</p>
<p>é™¤äº†æ­¤å¤„çš„tokenéªŒè¯åˆ¤æ–­å¤„ç†ä»¥å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ—¥å¿—å¤„ç†ç­‰ã€‚</p>
<p>ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œé¦–å…ˆéœ€è¦æ³¨å†Œã€‚åœ¨grpcä¸­ç¼–ç¨‹å®ç°ä¸­ï¼Œå¯ä»¥åœ¨NewSeveræ—¶æ·»åŠ æ‹¦æˆªå™¨è®¾ç½®ï¼Œgrpcæ¡†æ¶ä¸­å¯ä»¥é€šè¿‡UnaryInterceptoræ–¹æ³•è®¾ç½®è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œå¹¶è¿”å›ServerOptionã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">grpc</span><span class="p">.</span><span class="nf">UnaryInterceptor</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç‚¹è¿›å»å‘ç°éœ€è¦ä¸€ä¸ªå‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">UnaryServerInterceptor</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">info</span> <span class="o">*</span><span class="nx">UnaryServerInfo</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">UnaryHandler</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æŒ‰è‡ªå·±çš„é€»è¾‘å®ç°å°±å¥½äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TokenInterceptor</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">info</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">UnaryServerInfo</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">UnaryHandler</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//é€šè¿‡metadata
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">md</span><span class="p">,</span> <span class="nx">exist</span> <span class="o">:=</span> <span class="nx">metadata</span><span class="p">.</span><span class="nf">FromIncomingContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">exist</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unauthenticated</span><span class="p">,</span> <span class="s">&#34;æ— Tokenè®¤è¯ä¿¡æ¯&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">appKey</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">appSecret</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">md</span><span class="p">[</span><span class="s">&#34;apikey&#34;</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">appKey</span> <span class="p">=</span> <span class="nx">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">md</span><span class="p">[</span><span class="s">&#34;apisecret&#34;</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">appSecret</span> <span class="p">=</span> <span class="nx">secret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">appKey</span> <span class="o">!=</span> <span class="s">&#34;hello&#34;</span> <span class="o">||</span> <span class="nx">appSecret</span> <span class="o">!=</span> <span class="s">&#34;20190812&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unauthenticated</span><span class="p">,</span> <span class="s">&#34;Token ä¸åˆæ³•&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æœ‰ç‚¹åƒjavaçš„doFilterï¼Œå‘ä¸‹æ‰§è¡Œçš„æ„æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nf">handler</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶å…‰å†™äº†æ‹¦æˆªæ–¹æ³•ä¸è¡Œï¼Œæˆ‘ä»¬å¾—æ³¨å†Œåˆ°æœåŠ¡å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">(</span><span class="nx">grpc</span><span class="p">.</span><span class="nf">UnaryInterceptor</span><span class="p">(</span><span class="nx">TokenInterceptor</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•´ä½“ä»£ç ï¼š</p>
<h4 id="æœåŠ¡å™¨-2">æœåŠ¡å™¨</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;goTrip/rpcToken&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;golang.org/x/net/context&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;google.golang.org/grpc/codes&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;google.golang.org/grpc/metadata&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;google.golang.org/grpc/status&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MathManager</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TokenInterceptor</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">info</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">UnaryServerInfo</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">UnaryHandler</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//é€šè¿‡metadata
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="nx">md</span><span class="p">,</span> <span class="nx">exist</span> <span class="o">:=</span> <span class="nx">metadata</span><span class="p">.</span><span class="nf">FromIncomingContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="p">!</span><span class="nx">exist</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unauthenticated</span><span class="p">,</span> <span class="s">&#34;æ— Tokenè®¤è¯ä¿¡æ¯&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kd">var</span> <span class="nx">appKey</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">   <span class="kd">var</span> <span class="nx">appSecret</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">md</span><span class="p">[</span><span class="s">&#34;apikey&#34;</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">appKey</span> <span class="p">=</span> <span class="nx">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">md</span><span class="p">[</span><span class="s">&#34;apisecret&#34;</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">appSecret</span> <span class="p">=</span> <span class="nx">secret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">appKey</span> <span class="o">!=</span> <span class="s">&#34;hello&#34;</span> <span class="o">||</span> <span class="nx">appSecret</span> <span class="o">!=</span> <span class="s">&#34;20190812&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">codes</span><span class="p">.</span><span class="nx">Unauthenticated</span><span class="p">,</span> <span class="s">&#34;Token ä¸åˆæ³•&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="nf">handler</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">mm</span> <span class="o">*</span><span class="nx">MathManager</span><span class="p">)</span> <span class="nf">AddMethod</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">request</span> <span class="o">*</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">RequestArgs</span><span class="p">)</span> <span class="p">(</span><span class="nx">response</span> <span class="o">*</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//meta, exist := metadata.FromIncomingContext(ctx)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//if !exist{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">// return nil,status.Errorf(codes.Unauthenticated,&#34;æ— token&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//var appKey string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//var appSecret string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//key,ok := meta[&#34;apikey&#34;]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//if ok{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">// appKey = key[0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//secret,ok := meta[&#34;apisecret&#34;]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//if ok{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">// appSecret = secret[0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//fmt.Println(appKey,appSecret)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">////æ§åˆ¶token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//if appKey != &#34;hello&#34; || appSecret != &#34;20190812&#34; {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">// return nil, status.Errorf(codes.Unauthenticated, &#34;Token ä¸åˆæ³•&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; æœåŠ¡ç«¯ Addæ–¹æ³• &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nx">result</span> <span class="o">:=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Args1</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Args2</span>
</span></span><span class="line"><span class="cl">   <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34; è®¡ç®—ç»“æœæ˜¯ï¼š&#34;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nx">response</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="nx">response</span><span class="p">.</span><span class="nx">Code</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="nx">response</span><span class="p">.</span><span class="nx">Message</span> <span class="p">=</span> <span class="s">&#34;æ‰§è¡ŒæˆåŠŸ&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="nx">response</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">server</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">(</span><span class="nx">grpc</span><span class="p">.</span><span class="nf">UnaryInterceptor</span><span class="p">(</span><span class="nx">TokenInterceptor</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="nx">rpcToken</span><span class="p">.</span><span class="nf">RegisterMathServiceServer</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span><span class="nb">new</span><span class="p">(</span><span class="nx">MathManager</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="nx">listen</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:8081&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nx">server</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">listen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å®¢æˆ·ç«¯-2">å®¢æˆ·ç«¯</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/rpcToken&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;goTrip/rpcToken/token&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;google.golang.org/grpc&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">tk</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">token</span><span class="p">.</span><span class="nx">TokenAuthentication</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ApiKey</span><span class="p">:</span>    <span class="s">&#34;hello&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ApiSecret</span><span class="p">:</span> <span class="s">&#34;20190812&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dial</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;localhost:8081&#34;</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithPerRPCCredentials</span><span class="p">(</span><span class="nx">tk</span><span class="p">),</span><span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">client</span> <span class="o">:=</span> <span class="nx">rpcToken</span><span class="p">.</span><span class="nf">NewMathServiceClient</span><span class="p">(</span><span class="nx">dial</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">rpcToken</span><span class="p">.</span><span class="nx">RequestArgs</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Args1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Args2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">AddMethod</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nf">GetCode</span><span class="p">(),</span><span class="nx">resp</span><span class="p">.</span><span class="nf">GetMessage</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€‹</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/blog/tags/golang/">Golang</a>
        
            <a href="/blog/tags/grpc/">GRPC</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/blog/posts/gin/">
        
        
            <div class="article-image">
                <img src="/blog/posts/gin/_hu7f5d8dacba1592bb3a5cf38c96474382_14659_e68df950acabd0155bf55f83e3624d63.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post å­¦ä¹ Gin"
                        
                        data-hash="md5-3SDIzGsO9XH1zGvuc0lwvQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">å­¦ä¹ Gin</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2023 èœGOçš„åšå®¢
    </section>
    
    <section class="powerby">
        
            welcome to my blog,here we can study together <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/blog/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
